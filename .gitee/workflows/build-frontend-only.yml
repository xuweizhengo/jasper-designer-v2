name: "Frontend Build Only"

# Gitee Go æ”¯æŒçš„å‰ç«¯æ„å»ºæµæ°´çº¿
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ===============================================
  # å‰ç«¯æ„å»ºå’Œæ£€æŸ¥ï¼ˆGitee Go æ”¯æŒï¼‰
  # ===============================================
  frontend-build:
    name: "å‰ç«¯æ„å»ºæ£€æŸ¥"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v3

      - name: "ğŸ“¦ å®‰è£… Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: v2-tauri/package-lock.json

      - name: "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–"
        working-directory: v2-tauri
        run: npm ci

      - name: "ğŸ” TypeScript ç±»å‹æ£€æŸ¥"
        working-directory: v2-tauri
        run: npx tsc --noEmit

      - name: "ğŸ”¨ å‰ç«¯æ„å»º"
        working-directory: v2-tauri
        run: npm run build

      - name: "ğŸ“ åˆ—å‡ºæ„å»ºäº§ç‰©"
        working-directory: v2-tauri/dist
        run: |
          echo "=== å‰ç«¯æ„å»ºäº§ç‰© ==="
          ls -la
          du -sh *

      - name: "ğŸš€ ä¸Šä¼ å‰ç«¯æ„å»ºäº§ç‰©"
        uses: actions/upload-artifact@v3
        with:
          name: frontend-build
          path: v2-tauri/dist/
          retention-days: 7

  # ===============================================
  # ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆä»…å‰ç«¯ï¼‰
  # ===============================================
  code-quality:
    name: "ä»£ç è´¨é‡æ£€æŸ¥"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v3

      - name: "ğŸ“¦ å®‰è£… Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: "ğŸ“¦ å®‰è£…ä¾èµ–"
        working-directory: v2-tauri
        run: npm ci

      - name: "ğŸ” ESLint æ£€æŸ¥"
        working-directory: v2-tauri
        run: npm run lint || echo "ESLint æ£€æŸ¥å®Œæˆ"

      - name: "ğŸ” ä»£ç æ ¼å¼æ£€æŸ¥"
        working-directory: v2-tauri
        run: |
          echo "æ£€æŸ¥ TypeScript æ–‡ä»¶æ ¼å¼..."
          find src -name "*.ts" -o -name "*.tsx" | head -10

      - name: "âœ… æ£€æŸ¥å®Œæˆ"
        run: echo "âœ… å‰ç«¯ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ"