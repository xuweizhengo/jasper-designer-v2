name: "Simple Build"

# è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° main åˆ†æ”¯æˆ–æ‰‹åŠ¨è§¦å‘
on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  WORKING_DIR: v2-tauri

jobs:
  # ===============================================
  # å¿«é€Ÿæ„å»º - åªæ„å»º Windows ç‰ˆæœ¬
  # ===============================================
  build-quick:
    name: "Quick Build (Windows)"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v3

      - name: "ğŸ“¦ å®‰è£… Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: ${{ env.WORKING_DIR }}/package-lock.json

      - name: "ğŸ¦€ å®‰è£… Rust"
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: x86_64-pc-windows-gnu

      - name: "ğŸ”§ å®‰è£…ç³»ç»Ÿä¾èµ–"
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc-mingw-w64-x86-64

      - name: "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–"
        working-directory: ${{ env.WORKING_DIR }}
        run: npm ci

      - name: "ğŸ”¨ æ„å»ºåº”ç”¨"
        working-directory: ${{ env.WORKING_DIR }}
        run: npm run tauri build -- --target x86_64-pc-windows-gnu

      - name: "ğŸ“ åˆ—å‡ºæ„å»ºæ–‡ä»¶"
        working-directory: ${{ env.WORKING_DIR }}/src-tauri/target/x86_64-pc-windows-gnu/release
        run: |
          echo "=== æ„å»ºäº§ç‰© ==="
          ls -la *.exe || echo "æ²¡æœ‰æ‰¾åˆ° exe æ–‡ä»¶"
          ls -la *.dll || echo "æ²¡æœ‰æ‰¾åˆ° dll æ–‡ä»¶"

      - name: "ğŸš€ ä¸Šä¼ æ„å»ºäº§ç‰©"
        uses: actions/upload-artifact@v3
        with:
          name: jasper-designer-windows
          path: |
            ${{ env.WORKING_DIR }}/src-tauri/target/x86_64-pc-windows-gnu/release/*.exe
            ${{ env.WORKING_DIR }}/src-tauri/target/x86_64-pc-windows-gnu/release/*.dll
          retention-days: 7

      - name: "âœ… æ„å»ºå®Œæˆé€šçŸ¥"
        run: |
          echo "ğŸ‰ æ„å»ºå®Œæˆï¼"
          echo "ğŸ“¦ æ„å»ºäº§ç‰©å·²ä¸Šä¼ ï¼Œå¯åœ¨ Actions é¡µé¢ä¸‹è½½"