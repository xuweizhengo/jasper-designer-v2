name: "Code Quality Check"

# æ¯æ¬¡æ¨é€å’Œ PR éƒ½è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  WORKING_DIR: v2-tauri

jobs:
  # ===============================================
  # ä»£ç è´¨é‡æ£€æŸ¥
  # ===============================================
  quality-check:
    name: "è´¨é‡æ£€æŸ¥"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v3

      - name: "ğŸ“¦ å®‰è£… Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: ${{ env.WORKING_DIR }}/package-lock.json

      - name: "ğŸ¦€ å®‰è£… Rust"
        uses: dtolnay/rust-toolchain@stable
        with:
          components: rustfmt, clippy

      - name: "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–"
        working-directory: ${{ env.WORKING_DIR }}
        run: npm ci

      - name: "ğŸ” TypeScript ç±»å‹æ£€æŸ¥"
        working-directory: ${{ env.WORKING_DIR }}
        run: npx tsc --noEmit

      - name: "ğŸ” å‰ç«¯æ„å»ºæ£€æŸ¥"
        working-directory: ${{ env.WORKING_DIR }}
        run: npm run build

      - name: "ğŸ” Rust ä»£ç æ ¼å¼æ£€æŸ¥"
        working-directory: ${{ env.WORKING_DIR }}/src-tauri
        run: cargo fmt --check

      - name: "ğŸ” Rust ä»£ç è´¨é‡æ£€æŸ¥"
        working-directory: ${{ env.WORKING_DIR }}/src-tauri
        run: cargo clippy -- -D warnings

      - name: "ğŸ§ª Rust å•å…ƒæµ‹è¯•"
        working-directory: ${{ env.WORKING_DIR }}/src-tauri
        run: cargo test

      - name: "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡"
        run: echo "ğŸ‰ ä»£ç è´¨é‡æ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼"