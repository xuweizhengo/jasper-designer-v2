# 🧪 M2核心交互功能 - 测试指南

**版本**: v2.0.0-final  
**测试日期**: 2025-08-08  
**测试状态**: ✅ 完整功能已实现

## 📋 测试清单

### ✅ 基础功能测试

#### 1. 元素创建
- [ ] 从组件库拖拽文本元素到画布
- [ ] 从组件库拖拽矩形元素到画布
- [ ] 从组件库拖拽线条元素到画布
- [ ] 元素在正确位置显示
- [ ] 元素保持正确的尺寸

#### 2. 单元素选择
- [ ] 点击元素能正确选中
- [ ] 选中状态有蓝色边框显示
- [ ] 点击空白区域清除选择
- [ ] 只能选中一个元素

#### 3. 单元素拖拽
- [ ] 拖拽选中的元素能正常移动
- [ ] 拖拽时显示半透明效果
- [ ] 拖拽结束后元素在新位置
- [ ] 拖拽时不会触发框选

### 🎯 高级功能测试

#### 4. 框选多元素
- [ ] 在空白区域拖拽显示蓝色选择矩形
- [ ] 选择矩形能包围多个元素
- [ ] 释放鼠标后矩形内所有元素被选中
- [ ] 多选元素都显示选中状态

#### 5. Ctrl/Shift多选
- [ ] Ctrl+点击未选中元素：添加到选择
- [ ] Ctrl+点击已选中元素：从选择中移除
- [ ] Shift+点击元素：添加到当前选择
- [ ] 多选状态正确显示

#### 6. 多元素拖拽
- [ ] 选中多个元素后拖拽任意一个
- [ ] 所有选中元素同时移动
- [ ] 保持元素间相对位置不变
- [ ] 移动后所有元素位置正确更新

### 🔧 交互测试

#### 7. 无冲突操作
- [ ] 拖拽元素时不显示框选矩形
- [ ] 框选时不触发元素拖拽
- [ ] Ctrl操作时不会误触发框选
- [ ] 快速操作无冲突

#### 8. 状态持久化
- [ ] 选择状态在操作间保持
- [ ] 多选状态正确同步
- [ ] 前后端状态一致
- [ ] 无意外的状态重置

## 🎮 测试步骤

### 基础测试流程

1. **启动应用**
   ```bash
   ./builds/windows/jasper-designer.exe
   ```

2. **创建测试元素**
   - 拖拽2-3个不同类型的元素到画布
   - 确保元素位置不重叠

3. **单选测试**
   - 逐个点击元素验证选择功能
   - 点击空白区域验证清除选择

4. **框选测试**
   - 在空白区域拖拽框选多个元素
   - 验证选择矩形显示和多选结果

5. **多选测试**
   - 使用Ctrl+点击添加/移除元素
   - 使用Shift+点击扩展选择

6. **拖拽测试**
   - 拖拽单个元素验证移动
   - 拖拽多个元素验证批量移动

### 进阶测试场景

#### 场景1: 混合选择操作
```
1. 框选选择2个元素
2. Ctrl+点击添加第3个元素
3. Ctrl+点击移除第1个元素
4. 拖拽移动剩余选中元素
```

#### 场景2: 快速操作测试
```
1. 快速连续点击不同元素
2. 快速拖拽然后立即框选
3. 连续Ctrl+点击多个元素
4. 验证所有操作响应正常
```

#### 场景3: 边界情况测试
```
1. 选择元素后拖拽到画布边缘
2. 框选时包含部分重叠的元素
3. 在元素边缘进行精确点击
4. 验证边界处理正确
```

## 📊 预期行为

### 正确的日志输出
```javascript
// 单选
✅ Element selected successfully: element-123

// 多选
🔄 Toggling selection: element-456
➕ Adding to selection: element-789

// 框选
🔲 Starting selection rectangle at: 100, 150
🔲 Selection finished, found elements: 3
✅ Multi-select completed: ["id1", "id2", "id3"]

// 拖拽
🎯 Starting drag for multiple elements: element-123
📍 Updating element-123 to position: 200, 250
✅ All elements updated successfully
```

### 视觉反馈检查
- 🔵 选择矩形：蓝色虚线，半透明填充
- 🟦 选中元素：蓝色实线边框
- 👻 拖拽元素：70%透明度
- 🎯 鼠标指针：move cursor on selected elements

## ❌ 错误情况排查

### 常见问题

1. **拖拽时出现框选矩形**
   - 检查：event.stopPropagation() 是否正确调用
   - 检查：dragOperation 状态是否正确设置

2. **多选不工作**
   - 检查：后端命令是否正确注册
   - 检查：前端是否正确调用 toggleSelection/addToSelection

3. **选择状态丢失**
   - 检查：loadAppState 是否过度调用
   - 检查：前后端状态同步是否正常

4. **性能问题**
   - 检查：是否有不必要的重新渲染
   - 检查：状态更新频率是否合理

### 调试工具

1. **开发者工具**
   - F12打开DevTools
   - 查看Console日志
   - 检查网络请求

2. **状态检查**
   ```javascript
   // 在控制台查看当前状态
   console.log('Selected IDs:', state.selected_ids);
   console.log('Elements:', state.elements);
   console.log('Drag Operation:', dragOperation());
   ```

## 🎯 通过标准

### M2功能完成标准
- ✅ 所有基础测试项目通过
- ✅ 所有高级功能测试通过  
- ✅ 无明显性能问题
- ✅ 日志输出符合预期
- ✅ 视觉反馈正确
- ✅ 边界情况处理良好

### 质量要求
- 🚀 响应时间 < 100ms
- 🎯 操作准确率 100%
- 💪 连续操作稳定性
- 🔄 状态一致性保证

---

## 📝 测试记录

**测试人员**: ___________  
**测试日期**: ___________  
**版本号**: v2.0.0-final  

### 测试结果
- [ ] 全部通过
- [ ] 部分通过 (说明问题: _______)
- [ ] 未通过 (说明原因: _______)

### 备注
_________________________________
_________________________________
_________________________________

**M2测试完成后即可进入M3高级编辑功能开发! 🚀**