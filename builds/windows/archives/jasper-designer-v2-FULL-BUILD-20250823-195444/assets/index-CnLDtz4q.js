var on=Object.defineProperty;var sn=(e,t,i)=>t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Me=(e,t,i)=>sn(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const rn=!1,an=(e,t)=>e===t,Te=Symbol("solid-proxy"),ut=Symbol("solid-track"),Je={equals:an};let At=Mt;const Ae=1,Qe=2,zt={owned:null,cleanups:null,context:null,owner:null};var Q=null;let ct=null,cn=null,ae=null,de=null,we=null,rt=0;function Ze(e,t){const i=ae,n=Q,o=e.length===0,l=t===void 0?n:t,s=o?zt:{owned:null,cleanups:null,context:l?l.context:null,owner:l},r=o?e:()=>e(()=>ye(()=>Ve(s)));Q=s,ae=null;try{return Fe(r,!0)}finally{ae=i,Q=n}}function J(e,t){t=t?Object.assign({},Je,t):Je;const i={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=o=>(typeof o=="function"&&(o=o(i.value)),Tt(i,o));return[Lt.bind(i),n]}function M(e,t,i){const n=mt(e,t,!1,Ae);We(n)}function dn(e,t,i){At=yn;const n=mt(e,t,!1,Ae);n.user=!0,we?we.push(n):We(n)}function oe(e,t,i){i=i?Object.assign({},Je,i):Je;const n=mt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=i.equals||void 0,We(n),Lt.bind(n)}function un(e){return Fe(e,!1)}function ye(e){if(ae===null)return e();const t=ae;ae=null;try{return e()}finally{ae=t}}function Re(e){dn(()=>ye(e))}function at(e){return Q===null||(Q.cleanups===null?Q.cleanups=[e]:Q.cleanups.push(e)),e}function ht(){return ae}function hn(e,t){const i=Symbol("context");return{id:i,Provider:pn(i),defaultValue:e}}function gn(e){let t;return Q&&Q.context&&(t=Q.context[e.id])!==void 0?t:e.defaultValue}function Pt(e){const t=oe(e),i=oe(()=>gt(t()));return i.toArray=()=>{const n=i();return Array.isArray(n)?n:n!=null?[n]:[]},i}function Lt(){if(this.sources&&this.state)if(this.state===Ae)We(this);else{const e=de;de=null,Fe(()=>tt(this),!1),de=e}if(ae){const e=this.observers?this.observers.length:0;ae.sources?(ae.sources.push(this),ae.sourceSlots.push(e)):(ae.sources=[this],ae.sourceSlots=[e]),this.observers?(this.observers.push(ae),this.observerSlots.push(ae.sources.length-1)):(this.observers=[ae],this.observerSlots=[ae.sources.length-1])}return this.value}function Tt(e,t,i){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&Fe(()=>{for(let o=0;o<e.observers.length;o+=1){const l=e.observers[o],s=ct&&ct.running;s&&ct.disposed.has(l),(s?!l.tState:!l.state)&&(l.pure?de.push(l):we.push(l),l.observers&&Dt(l)),s||(l.state=Ae)}if(de.length>1e6)throw de=[],new Error},!1)),t}function We(e){if(!e.fn)return;Ve(e);const t=rt;fn(e,e.value,t)}function fn(e,t,i){let n;const o=Q,l=ae;ae=Q=e;try{n=e.fn(t)}catch(s){return e.pure&&(e.state=Ae,e.owned&&e.owned.forEach(Ve),e.owned=null),e.updatedAt=i+1,Ut(s)}finally{ae=l,Q=o}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?Tt(e,n):e.value=n,e.updatedAt=i)}function mt(e,t,i,n=Ae,o){const l={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Q,context:Q?Q.context:null,pure:i};return Q===null||Q!==zt&&(Q.owned?Q.owned.push(l):Q.owned=[l]),l}function et(e){if(e.state===0)return;if(e.state===Qe)return tt(e);if(e.suspense&&ye(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<rt);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===Ae)We(e);else if(e.state===Qe){const n=de;de=null,Fe(()=>tt(e,t[0]),!1),de=n}}function Fe(e,t){if(de)return e();let i=!1;t||(de=[]),we?i=!0:we=[],rt++;try{const n=e();return vn(i),n}catch(n){i||(we=null),de=null,Ut(n)}}function vn(e){if(de&&(Mt(de),de=null),e)return;const t=we;we=null,t.length&&Fe(()=>At(t),!1)}function Mt(e){for(let t=0;t<e.length;t++)et(e[t])}function yn(e){let t,i=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[i++]=n:et(n)}for(t=0;t<i;t++)et(e[t])}function tt(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const n=e.sources[i];if(n.sources){const o=n.state;o===Ae?n!==t&&(!n.updatedAt||n.updatedAt<rt)&&et(n):o===Qe&&tt(n,t)}}}function Dt(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=Qe,i.pure?de.push(i):we.push(i),i.observers&&Dt(i))}}function Ve(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),n=e.sourceSlots.pop(),o=i.observers;if(o&&o.length){const l=o.pop(),s=i.observerSlots.pop();n<o.length&&(l.sourceSlots[s]=n,o[n]=l,i.observerSlots[n]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ve(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ve(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function mn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ut(e,t=Q){throw mn(e)}function gt(e){if(typeof e=="function"&&!e.length)return gt(e());if(Array.isArray(e)){const t=[];for(let i=0;i<e.length;i++){const n=gt(e[i]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function pn(e,t){return function(n){let o;return M(()=>o=ye(()=>(Q.context={...Q.context,[e]:n.value},Pt(()=>n.children))),void 0),o}}const bn=Symbol("fallback");function bt(e){for(let t=0;t<e.length;t++)e[t]()}function xn(e,t,i={}){let n=[],o=[],l=[],s=0,r=t.length>1?[]:null;return at(()=>bt(l)),()=>{let c=e()||[],a=c.length,u,d;return c[ut],ye(()=>{let p,b,$,j,z,L,A,I,R;if(a===0)s!==0&&(bt(l),l=[],n=[],o=[],s=0,r&&(r=[])),i.fallback&&(n=[bn],o[0]=Ze(U=>(l[0]=U,i.fallback())),s=1);else if(s===0){for(o=new Array(a),d=0;d<a;d++)n[d]=c[d],o[d]=Ze(f);s=a}else{for($=new Array(a),j=new Array(a),r&&(z=new Array(a)),L=0,A=Math.min(s,a);L<A&&n[L]===c[L];L++);for(A=s-1,I=a-1;A>=L&&I>=L&&n[A]===c[I];A--,I--)$[I]=o[A],j[I]=l[A],r&&(z[I]=r[A]);for(p=new Map,b=new Array(I+1),d=I;d>=L;d--)R=c[d],u=p.get(R),b[d]=u===void 0?-1:u,p.set(R,d);for(u=L;u<=A;u++)R=n[u],d=p.get(R),d!==void 0&&d!==-1?($[d]=o[u],j[d]=l[u],r&&(z[d]=r[u]),d=b[d],p.set(R,d)):l[u]();for(d=L;d<a;d++)d in $?(o[d]=$[d],l[d]=j[d],r&&(r[d]=z[d],r[d](d))):o[d]=Ze(f);o=o.slice(0,s=a),n=c.slice(0)}return o});function f(p){if(l[d]=p,r){const[b,$]=J(d);return r[d]=$,t(c[d],b)}return t(c[d])}}}function v(e,t){return ye(()=>e(t||{}))}const It=e=>`Stale read from <${e}>.`;function _e(e){const t="fallback"in e&&{fallback:()=>e.fallback};return oe(xn(()=>e.each,e.children,t||void 0))}function ie(e){const t=e.keyed,i=oe(()=>e.when,void 0,void 0),n=t?i:oe(i,void 0,{equals:(o,l)=>!o==!l});return oe(()=>{const o=n();if(o){const l=e.children;return typeof l=="function"&&l.length>0?ye(()=>l(t?o:()=>{if(!ye(n))throw It("Show");return i()})):l}return e.fallback},void 0,void 0)}function wn(e){const t=Pt(()=>e.children),i=oe(()=>{const n=t(),o=Array.isArray(n)?n:[n];let l=()=>{};for(let s=0;s<o.length;s++){const r=s,c=o[s],a=l,u=oe(()=>a()?void 0:c.when,void 0,void 0),d=c.keyed?u:oe(u,void 0,{equals:(f,p)=>!f==!p});l=()=>a()||(d()?[r,u,c]:void 0)}return l});return oe(()=>{const n=i()();if(!n)return e.fallback;const[o,l,s]=n,r=s.children;return typeof r=="function"&&r.length>0?ye(()=>r(s.keyed?l():()=>{var a;if(((a=ye(i)())==null?void 0:a[0])!==o)throw It("Match");return l()})):r},void 0,void 0)}function He(e){return e}const le=e=>oe(()=>e());function _n(e,t,i){let n=i.length,o=t.length,l=n,s=0,r=0,c=t[o-1].nextSibling,a=null;for(;s<o||r<l;){if(t[s]===i[r]){s++,r++;continue}for(;t[o-1]===i[l-1];)o--,l--;if(o===s){const u=l<n?r?i[r-1].nextSibling:i[l-r]:c;for(;r<l;)e.insertBefore(i[r++],u)}else if(l===r)for(;s<o;)(!a||!a.has(t[s]))&&t[s].remove(),s++;else if(t[s]===i[l-1]&&i[r]===t[o-1]){const u=t[--o].nextSibling;e.insertBefore(i[r++],t[s++].nextSibling),e.insertBefore(i[--l],u),t[o]=i[l]}else{if(!a){a=new Map;let d=r;for(;d<l;)a.set(i[d],d++)}const u=a.get(t[s]);if(u!=null)if(r<u&&u<l){let d=s,f=1,p;for(;++d<o&&d<l&&!((p=a.get(t[d]))==null||p!==u+f);)f++;if(f>u-r){const b=t[s];for(;r<u;)e.insertBefore(i[r++],b)}else e.replaceChild(i[r++],t[s++])}else s++;else t[s++].remove()}}}const xt="_$DX_DELEGATE";function $n(e,t,i,n={}){let o;return Ze(l=>{o=l,t===document?e():h(t,e(),t.firstChild?null:void 0,i)},n.owner),()=>{o(),t.textContent=""}}function k(e,t,i,n){let o;const l=()=>{const r=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return r.innerHTML=e,i?r.content.firstChild.firstChild:n?r.firstChild:r.content.firstChild},s=t?()=>ye(()=>document.importNode(o||(o=l()),!0)):()=>(o||(o=l())).cloneNode(!0);return s.cloneNode=s,s}function me(e,t=window.document){const i=t[xt]||(t[xt]=new Set);for(let n=0,o=e.length;n<o;n++){const l=e[n];i.has(l)||(i.add(l),t.addEventListener(l,Sn))}}function _(e,t,i){i==null?e.removeAttribute(t):e.setAttribute(t,i)}function Ee(e,t){t==null?e.removeAttribute("class"):e.className=t}function Ie(e,t,i,n){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function Ot(e,t,i){if(!t)return i?_(e,"style"):t;const n=e.style;if(typeof t=="string")return n.cssText=t;typeof i=="string"&&(n.cssText=i=void 0),i||(i={}),t||(t={});let o,l;for(l in i)t[l]==null&&n.removeProperty(l),delete i[l];for(l in t)o=t[l],o!==i[l]&&(n.setProperty(l,o),i[l]=o);return i}function Rt(e,t,i){return ye(()=>e(t,i))}function h(e,t,i,n){if(i!==void 0&&!n&&(n=[]),typeof t!="function")return nt(e,t,n,i);M(o=>nt(e,t(),o,i),n)}function Sn(e){let t=e.target;const i=`$$${e.type}`,n=e.target,o=e.currentTarget,l=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),s=()=>{const c=t[i];if(c&&!t.disabled){const a=t[`${i}Data`];if(a!==void 0?c.call(t,a,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},r=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();l(c[0]);for(let a=0;a<c.length-2&&(t=c[a],!!s());a++){if(t._$host){t=t._$host,r();break}if(t.parentNode===o)break}}else r();l(n)}function nt(e,t,i,n,o){for(;typeof i=="function";)i=i();if(t===i)return i;const l=typeof t,s=n!==void 0;if(e=s&&i[0]&&i[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===i))return i;if(s){let r=i[0];r&&r.nodeType===3?r.data!==t&&(r.data=t):r=document.createTextNode(t),i=De(e,i,n,r)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||l==="boolean")i=De(e,i,n);else{if(l==="function")return M(()=>{let r=t();for(;typeof r=="function";)r=r();i=nt(e,r,i,n)}),()=>i;if(Array.isArray(t)){const r=[],c=i&&Array.isArray(i);if(ft(r,t,i,o))return M(()=>i=nt(e,r,i,n,!0)),()=>i;if(r.length===0){if(i=De(e,i,n),s)return i}else c?i.length===0?wt(e,r,n):_n(e,i,r):(i&&De(e),wt(e,r));i=r}else if(t.nodeType){if(Array.isArray(i)){if(s)return i=De(e,i,n,t);De(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function ft(e,t,i,n){let o=!1;for(let l=0,s=t.length;l<s;l++){let r=t[l],c=i&&i[e.length],a;if(!(r==null||r===!0||r===!1))if((a=typeof r)=="object"&&r.nodeType)e.push(r);else if(Array.isArray(r))o=ft(e,r,c)||o;else if(a==="function")if(n){for(;typeof r=="function";)r=r();o=ft(e,Array.isArray(r)?r:[r],Array.isArray(c)?c:[c])||o}else e.push(r),o=!0;else{const u=String(r);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return o}function wt(e,t,i=null){for(let n=0,o=t.length;n<o;n++)e.insertBefore(t[n],i)}function De(e,t,i,n){if(i===void 0)return e.textContent="";const o=n||document.createTextNode("");if(t.length){let l=!1;for(let s=t.length-1;s>=0;s--){const r=t[s];if(o!==r){const c=r.parentNode===e;!l&&!s?c?e.replaceChild(o,r):e.insertBefore(o,i):c&&r.remove()}else l=!0}}else e.insertBefore(o,i);return[o]}const vt=Symbol("store-raw"),Oe=Symbol("store-node"),be=Symbol("store-has"),Ft=Symbol("store-self");function Bt(e){let t=e[Te];if(!t&&(Object.defineProperty(e,Te,{value:t=new Proxy(e,En)}),!Array.isArray(e))){const i=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let o=0,l=i.length;o<l;o++){const s=i[o];n[s].get&&Object.defineProperty(e,s,{enumerable:n[s].enumerable,get:n[s].get.bind(t)})}}return t}function it(e){let t;return e!=null&&typeof e=="object"&&(e[Te]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Xe(e,t=new Set){let i,n,o,l;if(i=e!=null&&e[vt])return i;if(!it(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,r=e.length;s<r;s++)o=e[s],(n=Xe(o,t))!==o&&(e[s]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let c=0,a=s.length;c<a;c++)l=s[c],!r[l].get&&(o=e[l],(n=Xe(o,t))!==o&&(e[l]=n))}return e}function lt(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function Ge(e,t,i){if(e[t])return e[t];const[n,o]=J(i,{equals:!1,internal:!0});return n.$=o,e[t]=n}function kn(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return!i||i.get||!i.configurable||t===Te||t===Oe||(delete i.value,delete i.writable,i.get=()=>e[Te][t]),i}function Nt(e){ht()&&Ge(lt(e,Oe),Ft)()}function Cn(e){return Nt(e),Reflect.ownKeys(e)}const En={get(e,t,i){if(t===vt)return e;if(t===Te)return i;if(t===ut)return Nt(e),i;const n=lt(e,Oe),o=n[t];let l=o?o():e[t];if(t===Oe||t===be||t==="__proto__")return l;if(!o){const s=Object.getOwnPropertyDescriptor(e,t);ht()&&(typeof l!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(l=Ge(n,t,l)())}return it(l)?Bt(l):l},has(e,t){return t===vt||t===Te||t===ut||t===Oe||t===be||t==="__proto__"?!0:(ht()&&Ge(lt(e,be),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Cn,getOwnPropertyDescriptor:kn};function ot(e,t,i,n=!1){if(!n&&e[t]===i)return;const o=e[t],l=e.length;i===void 0?(delete e[t],e[be]&&e[be][t]&&o!==void 0&&e[be][t].$()):(e[t]=i,e[be]&&e[be][t]&&o===void 0&&e[be][t].$());let s=lt(e,Oe),r;if((r=Ge(s,t,o))&&r.$(()=>i),Array.isArray(e)&&e.length!==l){for(let c=e.length;c<l;c++)(r=s[c])&&r.$();(r=Ge(s,"length",l))&&r.$(e.length)}(r=s[Ft])&&r.$()}function Ht(e,t){const i=Object.keys(t);for(let n=0;n<i.length;n+=1){const o=i[n];ot(e,o,t[o])}}function An(e,t){if(typeof t=="function"&&(t=t(e)),t=Xe(t),Array.isArray(t)){if(e===t)return;let i=0,n=t.length;for(;i<n;i++){const o=t[i];e[i]!==o&&ot(e,i,o)}ot(e,"length",n)}else Ht(e,t)}function Ke(e,t,i=[]){let n,o=e;if(t.length>1){n=t.shift();const s=typeof n,r=Array.isArray(e);if(Array.isArray(n)){for(let c=0;c<n.length;c++)Ke(e,[n[c]].concat(t),i);return}else if(r&&s==="function"){for(let c=0;c<e.length;c++)n(e[c],c)&&Ke(e,[c].concat(t),i);return}else if(r&&s==="object"){const{from:c=0,to:a=e.length-1,by:u=1}=n;for(let d=c;d<=a;d+=u)Ke(e,[d].concat(t),i);return}else if(t.length>1){Ke(e[n],t,[n].concat(i));return}o=e[n],i=[n].concat(i)}let l=t[0];typeof l=="function"&&(l=l(o,i),l===o)||n===void 0&&l==null||(l=Xe(l),n===void 0||it(o)&&it(l)&&!Array.isArray(l)?Ht(o,l):ot(e,n,l))}function zn(...[e,t]){const i=Xe(e||{}),n=Array.isArray(i),o=Bt(i);function l(...s){un(()=>{n&&s.length===1?An(i,s[0]):Ke(i,s)})}return[o,l]}function Pn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function yt(e,t=!1){const i=Pn(),n=`_${i}`;return Object.defineProperty(window,n,{value:o=>(t&&Reflect.deleteProperty(window,n),e==null?void 0:e(o)),writable:!1,configurable:!0}),i}async function re(e,t={}){return new Promise((i,n)=>{const o=yt(s=>{i(s),Reflect.deleteProperty(window,`_${l}`)},!0),l=yt(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:e,callback:o,error:l,...t})})}const Ln=Object.freeze(Object.defineProperty({__proto__:null,invoke:re,transformCallback:yt},Symbol.toStringTag,{value:"Module"})),jt=hn(),Tn=e=>{const[t,i]=zn({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[n,o]=J(!1),[l,s]=J(null),[r,c]=J(!1),a=async()=>{try{o(!0),console.log("🔄 Loading app state...");const y=await re("get_app_state");console.log("🔄 App state loaded, selected_ids:",y.selected_ids),i(y)}catch(y){console.error("Failed to load app state:",y)}finally{o(!1)}};Re(()=>{a()});const u=async(y,C,D,H={})=>{try{o(!0);const E=await re("create_element",{request:{element_type:y,position:C,size:D,content_data:H}});return await a(),E}catch(E){throw console.error("Failed to create element:",E),E}finally{o(!1)}},d=async(y,C)=>{try{o(!0),await re("update_element",{request:{id:y,updates:C}}),await a()}catch(D){throw console.error("Failed to update element:",D),D}finally{o(!1)}},f=async y=>{try{o(!0),await re("batch_update_positions",{request:{updates:y}}),i(C=>{const D=C.elements.map(H=>{const E=y.find(V=>V.element_id===H.id);return E?{...H,position:E.new_position}:H});return{...C,elements:D,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(C){throw console.error("Failed to batch update positions:",C),await a(),C}finally{o(!1)}},p=async y=>{try{o(!0),await re("delete_element",{elementId:y}),await a()}catch(C){throw console.error("Failed to delete element:",C),C}finally{o(!1)}},b=async y=>{try{console.log("Selecting element:",y),await re("select_element",{elementId:y}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(C){throw console.error("Failed to select element:",C),C}},$=async y=>{try{console.log("Selecting multiple elements:",y),y.length>0?(await re("select_multiple",{elementIds:y}),console.log("✅ Multi-select completed for:",y.length,"elements")):await re("clear_selection"),await a()}catch(C){throw console.error("Failed to select multiple elements:",C),C}},j=async y=>{try{console.log("Adding to selection:",y),await re("add_to_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to add to selection:",C),C}},z=async y=>{try{console.log("Removing from selection:",y),await re("remove_from_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to remove from selection:",C),C}},L=async y=>{try{console.log("Toggling selection:",y),await re("toggle_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to toggle selection:",C),C}},A=async()=>{try{await re("clear_selection"),await a()}catch(y){throw console.error("Failed to clear selection:",y),y}},I=async()=>{try{await re("copy_selected")}catch(y){throw console.error("Failed to copy selected elements:",y),y}},B={state:t,createElement:u,updateElement:d,batchUpdatePositions:f,deleteElement:p,selectElement:b,selectMultiple:$,addToSelection:j,removeFromSelection:z,toggleSelection:L,clearSelection:A,copySelected:I,copySelectedElements:async()=>I(),pasteElements:async(y,C)=>{try{o(!0);const D=await re("paste_elements",{offsetX:y,offsetY:C});return await a(),D}catch(D){throw console.error("Failed to paste elements:",D),D}finally{o(!1)}},deleteElements:async y=>{try{o(!0);for(const C of y)await re("delete_element",{elementId:C});await a()}catch(C){throw console.error("Failed to delete elements:",C),C}finally{o(!1)}},selectAllElements:async()=>{try{const y=t.elements.map(C=>C.id);await $(y)}catch(y){throw console.error("Failed to select all elements:",y),y}},moveElements:async(y,C,D)=>{try{o(!0);const H=t.elements.filter(E=>y.includes(E.id)).map(E=>({element_id:E.id,new_position:{x:E.position.x+C,y:E.position.y+D}}));H.length>0&&await f(H)}catch(H){throw console.error("Failed to move elements:",H),H}finally{o(!1)}},undo:async()=>{try{o(!0),await re("undo"),await a()}catch(y){throw console.error("Failed to undo:",y),y}finally{o(!1)}},redo:async()=>{try{o(!0),await re("redo"),await a()}catch(y){throw console.error("Failed to redo:",y),y}finally{o(!1)}},updateCanvasConfig:async y=>{try{o(!0),await re("update_canvas_config",{request:y}),await a()}catch(C){throw console.error("Failed to update canvas config:",C),C}finally{o(!1)}},getElementsAtPoint:async(y,C)=>{try{return await re("get_elements_at_point",{x:y,y:C})}catch(D){return console.error("Failed to get elements at point:",D),[]}},isLoading:n,setLoading:o,dragOperation:l,setDragOperation:s,resizeOperation:r,setResizeOperation:c};return v(jt.Provider,{value:B,get children(){return e.children}})},Se=()=>{const e=gn(jt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var Mn=k("<span class=text-warning>●"),Dn=k("<span class=ml-2> 个元素"),Un=k('<span class="ml-2 text-primary">已选择 <!> 个'),In=k('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button><button class=toolbar-btn title=数据源管理><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg><span>数据源</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const On=e=>{const{state:t,undo:i,redo:n,updateCanvasConfig:o}=Se(),[l,s]=J(t.canvas_config.zoom*100),r=async p=>{const b=p/100;s(p);try{await o({zoom:b})}catch($){console.error("Failed to update zoom:",$)}},c=()=>{const p=Math.min(l()+25,500);r(p)},a=()=>{const p=Math.max(l()-25,25);r(p)},u=async()=>{try{await o({show_grid:!t.canvas_config.show_grid})}catch(p){console.error("Failed to toggle grid:",p)}},d=async()=>{try{await o({show_rulers:!t.canvas_config.show_rulers})}catch(p){console.error("Failed to toggle rulers:",p)}},f=async()=>{try{await re("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(p){console.error("Failed to toggle DevTools:",p)}};return(()=>{var p=In(),b=p.firstChild,$=b.firstChild,j=$.nextSibling,z=j.nextSibling,L=z.nextSibling,A=L.nextSibling,I=A.nextSibling,R=b.nextSibling,U=R.firstChild,K=U.nextSibling,T=K.nextSibling,Z=T.nextSibling,F=Z.nextSibling,O=F.nextSibling,S=O.nextSibling,Y=S.nextSibling,B=Y.nextSibling,y=B.nextSibling,C=y.nextSibling,D=R.nextSibling,H=D.firstChild;return Ie(I,"click",e.onOpenDataSources),Ie(U,"click",i),Ie(K,"click",n),Z.$$click=a,F.addEventListener("change",E=>{const V=E.target.value;if(V==="fit")console.log("Fit to window");else{const te=parseInt(V.replace("%",""));r(te)}}),O.$$click=c,Y.$$click=u,B.$$click=d,C.$$click=f,h(D,v(ie,{get when(){return t.dirty},get children(){return Mn()}}),H),h(H,()=>t.template_name||"未命名模板"),h(D,v(ie,{get when(){return t.elements.length>0},get children(){var E=Dn(),V=E.firstChild;return h(E,()=>t.elements.length,V),E}}),null),h(D,v(ie,{get when(){return t.selected_ids.length>0},get children(){var E=Un(),V=E.firstChild,te=V.nextSibling;return te.nextSibling,h(E,()=>t.selected_ids.length,te),E}}),null),M(E=>{var V=`toolbar-btn-icon ${t.can_undo?"":"opacity-50 cursor-not-allowed"}`,te=!t.can_undo,se=`撤销${t.undo_description?` (${t.undo_description})`:""} (Ctrl+Z)`,N=`toolbar-btn-icon ${t.can_redo?"":"opacity-50 cursor-not-allowed"}`,ce=!t.can_redo,he=`重做${t.redo_description?` (${t.redo_description})`:""} (Ctrl+Y)`,ge=`toolbar-btn-icon ${t.canvas_config.show_grid?"active":""}`,fe=`toolbar-btn-icon ${t.canvas_config.show_rulers?"active":""}`;return V!==E.e&&Ee(U,E.e=V),te!==E.t&&(U.disabled=E.t=te),se!==E.a&&_(U,"title",E.a=se),N!==E.o&&Ee(K,E.o=N),ce!==E.i&&(K.disabled=E.i=ce),he!==E.n&&_(K,"title",E.n=he),ge!==E.s&&Ee(Y,E.s=ge),fe!==E.h&&Ee(B,E.h=fe),E},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),M(()=>F.value=`${Math.round(l())}%`),p})()};me(["click"]);var Rn=k('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),Fn=k('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const Bn=()=>{const{createElement:e}=Se(),[t,i]=J(""),n=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"图片"})}],o=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],l=[...n,...o],s=()=>{const a=t().toLowerCase();return a?l.filter(u=>u.name.toLowerCase().includes(a)||u.description.toLowerCase().includes(a)):l},r=(a,u)=>{if(console.log("Starting drag for component:",a.id),u.dataTransfer){u.dataTransfer.effectAllowed="copy",u.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const d=document.createElement("div");d.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,d.style.position="absolute",d.style.top="-1000px",document.body.appendChild(d),u.dataTransfer.setDragImage(d,50,20),setTimeout(()=>{document.body.removeChild(d)},0)}},c=async a=>{try{const u=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",u)}catch(u){console.error("Failed to create element:",u)}};return(()=>{var a=Rn(),u=a.firstChild,d=u.firstChild,f=d.nextSibling,p=u.nextSibling,b=p.firstChild,$=b.firstChild,j=$.firstChild,z=j.nextSibling,L=$.nextSibling,A=L.firstChild,I=A.nextSibling,R=L.nextSibling,U=R.firstChild,K=U.nextSibling;return f.$$input=T=>i(T.target.value),h(z,v(_e,{get each(){return s().filter(T=>T.category==="basic")},children:T=>v(dt,{component:T,onDrag:Z=>r(T,Z),onClick:()=>c(T)})})),h(I,v(_e,{get each(){return s().filter(T=>T.category==="data")},children:T=>v(dt,{component:T,onDrag:Z=>r(T,Z),onClick:()=>c(T)})})),h(K,v(_e,{get each(){return s().filter(T=>T.category==="bank")},children:T=>v(dt,{component:T,onDrag:Z=>r(T,Z),onClick:()=>c(T)})})),M(()=>f.value=t()),a})()},dt=e=>(()=>{var t=Fn(),i=t.firstChild,n=i.firstChild,o=n.nextSibling;return Ie(t,"click",e.onClick),t.addEventListener("dragstart",l=>e.onDrag(l)),_(t,"draggable",!0),h(n,()=>e.component.icon),h(o,()=>e.component.name),M(()=>_(t,"title",e.component.description)),t})();me(["input","click"]);const Nn="modulepreload",Hn=function(e){return"/"+e},_t={},Kt=function(t,i,n){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(i.map(c=>{if(c=Hn(c),c in _t)return;_t[c]=!0;const a=c.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Nn,a||(d.as="script"),d.crossOrigin="",d.href=c,r&&d.setAttribute("nonce",r),document.head.appendChild(d),a)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&l(r.reason);return t().catch(l)})};class jn{constructor(){Me(this,"styles",new Map);Me(this,"elementStyleMap",new Map);Me(this,"observers",new Set);Me(this,"initialized",!1);console.log("🎨 TextStyleManager 初始化中...")}async initialize(){if(!this.initialized)try{await this.loadSystemStyles(),await this.loadUserStyles(),this.initialized=!0,console.log(`✅ TextStyleManager 初始化完成，加载了 ${this.styles.size} 个样式`)}catch(t){throw console.error("❌ TextStyleManager 初始化失败:",t),t}}createStyle(t){const i=`style_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={...t,id:i,metadata:{createdAt:new Date,lastModified:new Date,author:"user",usageCount:0,isSystemStyle:!1,tags:[]}};return this.styles.set(i,n),this.notifyObservers("style-created",i),this.saveUserStyles(),console.log(`🎨 创建新样式: ${n.name} (${i})`),i}getStyle(t){return this.styles.get(t)||null}updateStyle(t,i){const n=this.styles.get(t);if(!n)return console.warn(`⚠️ 样式 ${t} 不存在`),!1;if(n.metadata.isSystemStyle)return console.warn(`⚠️ 无法修改系统预设样式 ${t}`),!1;const o={...n,style:{...n.style,...i},metadata:{...n.metadata,lastModified:new Date}};return this.styles.set(t,o),this.syncAllStyleInstances(t),this.saveUserStyles(),this.notifyObservers("style-updated",t),console.log(`🔄 样式已更新: ${n.name} (${t})`),!0}deleteStyle(t){const i=this.styles.get(t);if(!i)return!1;if(i.metadata.isSystemStyle)return console.warn(`⚠️ 无法删除系统预设样式 ${t}`),!1;const n=Array.from(this.elementStyleMap.entries()).filter(([o,l])=>l===t).map(([o,l])=>o);return n.length>0?(console.warn(`⚠️ 无法删除样式 ${t}，仍有 ${n.length} 个元素在使用`),!1):(this.styles.delete(t),this.saveUserStyles(),this.notifyObservers("style-deleted",t),console.log(`🗑️ 样式已删除: ${i.name} (${t})`),!0)}applyStyleToElement(t,i){const n=this.styles.get(i);if(!n)return{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:`样式 ${i} 不存在`};try{const o=this.elementStyleMap.get(t);if(this.elementStyleMap.set(t,i),n.metadata.usageCount++,o&&o!==i){const l=this.styles.get(o);l&&(l.metadata.usageCount=Math.max(0,l.metadata.usageCount-1))}return this.applyStyleToDOM(t,n.style),this.notifyObservers("style-applied",{elementId:t,styleId:i}),console.log(`🎯 应用样式: ${n.name} → 元素 ${t}`),{success:!0,elementId:t,styleId:i,appliedAt:new Date}}catch(o){return console.error(`❌ 应用样式失败: ${o}`),{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:o instanceof Error?o.message:String(o)}}}getElementStyleId(t){return this.elementStyleMap.get(t)||null}removeElementStyle(t){const i=this.elementStyleMap.get(t);if(i){this.elementStyleMap.delete(t);const n=this.styles.get(i);n&&(n.metadata.usageCount=Math.max(0,n.metadata.usageCount-1)),console.log(`🔗 移除元素样式映射: 元素 ${t}`)}}getStylesByCategory(t){const i=Array.from(this.styles.values());return(t?i.filter(o=>o.category===t):i).sort((o,l)=>o.metadata.isSystemStyle!==l.metadata.isSystemStyle?o.metadata.isSystemStyle?-1:1:l.metadata.usageCount-o.metadata.usageCount)}searchStyles(t,i){const n=this.getStylesByCategory(i),o=t.toLowerCase().trim();return o?n.filter(l=>l.name.toLowerCase().includes(o)||l.description.toLowerCase().includes(o)||l.metadata.tags.some(s=>s.toLowerCase().includes(o))):n}getStyleUsageStats(){const t=[];for(const[i,n]of this.styles){const o=Array.from(this.elementStyleMap.entries()).filter(([l,s])=>s===i).map(([l,s])=>l);t.push({styleId:i,usageCount:o.length,elements:o,lastUsed:n.metadata.lastModified})}return t.sort((i,n)=>n.usageCount-i.usageCount)}cleanupUnusedStyles(){const t=new Set(this.elementStyleMap.values()),i=[];for(const[n,o]of this.styles)!t.has(n)&&!o.metadata.isSystemStyle&&(this.styles.delete(n),i.push(n),console.log(`🧹 清理未使用样式: ${o.name} (${n})`));return i.length>0&&this.saveUserStyles(),i}exportStyles(t){const i=t?t.map(o=>this.styles.get(o)).filter(Boolean):Array.from(this.styles.values()),n=new Set(i.map(o=>o.category));return{version:"2.0.0",exportedAt:new Date,styles:i,metadata:{totalStyles:i.length,categories:Array.from(n),author:"user"}}}async importStyles(t){const i=[];for(const n of t.styles){if(Array.from(this.styles.values()).find(s=>s.name===n.name&&s.category===n.category)){console.warn(`⚠️ 跳过已存在的样式: ${n.name}`);continue}const l=this.createStyle({name:n.name,description:n.description,category:n.category,style:n.style,...n.inheritance&&{inheritance:n.inheritance}});i.push(l)}return console.log(`📦 导入完成，共导入 ${i.length} 个样式`),i}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}syncAllStyleInstances(t){const i=this.styles.get(t);if(!i)return;const n=[];for(const[o,l]of this.elementStyleMap)l===t&&(this.applyStyleToDOM(o,i.style),n.push(o));this.notifyObservers("styles-synced",{styleId:t,affectedElements:n}),console.log(`🔄 样式同步完成: ${t} → ${n.length} 个元素`)}applyStyleToDOM(t,i){console.log(`🎨 应用样式到DOM: 元素 ${t}`,{font_family:i.font_family,font_size:i.font_size,typography:i.typography})}async loadSystemStyles(){try{const{BANK_TEXT_STYLES:t}=await Kt(async()=>{const{BANK_TEXT_STYLES:i}=await import("./bank-text-styles-BtzE7aIi.js");return{BANK_TEXT_STYLES:i}},[]);for(const i of t)this.styles.set(i.id,i);console.log(`🏦 加载了 ${t.length} 个银行预设样式`)}catch(t){console.warn("⚠️ 加载系统样式失败:",t)}}async loadUserStyles(){try{const t=localStorage.getItem("jasper-text-styles");if(t){const i=JSON.parse(t);for(const n of i)n.metadata.createdAt=new Date(n.metadata.createdAt),n.metadata.lastModified=new Date(n.metadata.lastModified),this.styles.set(n.id,n);console.log(`👤 加载了 ${i.length} 个用户自定义样式`)}}catch(t){console.warn("⚠️ 加载用户样式失败:",t)}}saveUserStyles(){try{const t=Array.from(this.styles.values()).filter(i=>!i.metadata.isSystemStyle);localStorage.setItem("jasper-text-styles",JSON.stringify(t)),console.log(`💾 保存了 ${t.length} 个用户自定义样式`)}catch(t){console.error("❌ 保存用户样式失败:",t)}}notifyObservers(t,i){for(const n of this.observers)try{n.onStyleChange(t,i)}catch(o){console.error("❌ 观察者通知失败:",o)}}}const ue=new jn;class Kn{calculateUnifiedBounds(t,i,n){const o=this.calculateFontMetrics(i),l=this.measureTextContent(t,i,n.width),s=this.calculateContainerHeight(l,o,n.height),r=this.calculateTextPositioning(i,n,s,o),c={containerBounds:{x:0,y:0,width:n.width,height:s},contentBounds:l.bounds,fontMetrics:o,positioning:r};return l.wrappedLines&&(c.textLayout={wrappedLines:l.wrappedLines,isWrapped:!0,originalLineCount:t.split(`
`).length,wrappedLineCount:l.wrappedLines.length}),c}calculateFontMetrics(t){const i=t.font_size,n=1.2,o=.75,l=.25,s=i*o,r=i*l;return{fontSize:i,lineHeight:i*n,ascender:s,descender:r,baseline:s}}getCharacterWidth(t,i){const n=i.font_size,o=i.font_family,l=/[\u4e00-\u9fa5]/.test(t),s={"Courier New":{chinese:.6,english:.6},Monaco:{chinese:.6,english:.6},Consolas:{chinese:.6,english:.6},SimSun:{chinese:1,english:.5},SimHei:{chinese:1,english:.5},KaiTi:{chinese:1.1,english:.6},FangSong:{chinese:1,english:.55},Arial:{chinese:1,english:.55},Helvetica:{chinese:1,english:.55},"Times New Roman":{chinese:1,english:.5},"Microsoft YaHei":{chinese:1,english:.52},"PingFang SC":{chinese:1,english:.52},"Noto Sans":{chinese:1,english:.53},default:{chinese:1,english:.55}},r=o.toLowerCase();let c=s.default;for(const[u,d]of Object.entries(s))if(r.includes(u.toLowerCase())||u.toLowerCase().includes(r)){c=d;break}const a=l?c.chinese:c.english;return n*a}calculateTextWidth(t,i){let n=0;for(const o of t)o!==`
`&&(n+=this.getCharacterWidth(o,i));return n}measureTextContent(t,i,n=0){const o=t.split(`
`),l=o.length;let s=0;for(const a of o){const u=this.calculateTextWidth(a,i);s=Math.max(s,u)}if(n>0&&s>n)return this.calculateWrappedText(t,i,n);const r=n>0?Math.min(s,n):s,c=l*i.font_size*1.2;return{bounds:{x:0,y:0,width:r,height:c},lineCount:l,actualHeight:c}}calculateWrappedText(t,i,n){const o=this.getCharacterWidth("测",i);if(Math.floor(n/o)<1||n<o)return{bounds:{x:0,y:0,width:n,height:i.font_size*1.2},lineCount:1,actualHeight:i.font_size*1.2,wrappedLines:["..."]};const s=this.smartSegmentation(t);let r=[],c="",a=0;for(const d of s){const f=this.calculateTextWidth(d,i),p=a+f;if(p>n)if(c.trim())r.push(c.trim()),c=d,a=f;else{const{truncated:b,remaining:$}=this.forceTruncateSegment(d,n,i);r.push(b),c=$,a=this.calculateTextWidth($,i)}else c+=d,a=p}c.trim()&&r.push(c.trim());const u=r.length*i.font_size*1.2;return{bounds:{x:0,y:0,width:n,height:u},lineCount:r.length,actualHeight:u,wrappedLines:r}}forceTruncateSegment(t,i,n){let o="",l=0,s=0;for(s=0;s<t.length;s++){const c=t[s];if(!c)break;const a=this.getCharacterWidth(c,n);if(l+a>i)break;o+=c,l+=a}const r=t.substring(s);return{truncated:o,remaining:r}}smartSegmentation(t){const i=[];let n="";for(let o=0;o<t.length;o++){const l=t[o];l&&(/[\u4e00-\u9fa5]/.test(l)?(n&&(i.push(n),n=""),i.push(l)):l===`
`?(n&&(i.push(n),n=""),i.push(`
`)):l===" "?n?(i.push(n+" "),n=""):i.push(" "):n+=l)}return n&&i.push(n),i.filter(o=>o.length>0)}calculateContainerHeight(t,i,n){const o=i.lineHeight*t.lineCount,l=i.ascender+i.descender,s=i.lineHeight,r=Math.max(o,l,s);return Math.max(r,n)}calculateTextPositioning(t,i,n,o){var u;const l=this.calculateHorizontalAnchor(t.align,i.width),s=o.baseline,r=((u=t.background)==null?void 0:u.padding)||0,c=-r,a=-r;return{textAnchorX:l,textAnchorY:s,backgroundX:c,backgroundY:a}}calculateHorizontalAnchor(t,i){switch(t){case"Left":return 0;case"Center":return i/2;case"Right":return i;default:return 0}}getTextAnchor(t){switch(t){case"Left":return"start";case"Center":return"middle";case"Right":return"end";default:return"start"}}debugBounds(t,i){}}const Ue=new Kn;class Vn{constructor(){Me(this,"initialized",!1);this.initialize()}async initialize(){if(!this.initialized)try{await ue.initialize(),this.initialized=!0,console.log("🎨 ProfessionalTextRenderer 已初始化")}catch(t){console.error("❌ ProfessionalTextRenderer 初始化失败:",t)}}isElementUsingProfessionalStyle(t){return ue.getElementStyleId(t)!==null}adaptLegacyTextStyle(t){return{...t,font_weight:t.font_weight,typography:{letterSpacing:0,lineHeight:1.2,paragraphSpacing:0,textIndent:0,decoration:{underline:!1,strikethrough:!1,overline:!1,decorationStyle:"solid"},textTransform:"none",whiteSpace:"normal"},fills:[{type:"solid",enabled:!0,opacity:1,solid:{color:t.color}}],effects:[]}}renderProfessionalText(t,i=!1){if(t.content.type!=="Text"&&t.content.type!=="DataField")return null;const n=ue.getElementStyleId(t.id);let o;if(n){const r=ue.getStyle(n);if(!r)return console.warn(`⚠️ 找不到样式定义: ${n}`),null;o=r.style,console.log(`🎨 使用专业样式渲染: ${r.name} (${n})`)}else{const r=t.content.type==="Text"||t.content.type==="DataField"?t.content.style:null;if(!r)return null;o=this.adaptLegacyTextStyle(r),console.log("🔄 适配传统样式到专业排版系统")}const l=this.calculateEnhancedBounds(t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",o,t.size);return{element:this.createProfessionalTextElement(l,t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",o,!1),bounds:l,style:o}}calculateEnhancedBounds(t,i,n){const o=Ue.calculateUnifiedBounds(t,i,n),l=i.typography,s=this.calculateLetterSpacingEffect(t,l.letterSpacing),r=this.calculateLineHeightEffect(t,i.font_size,l.lineHeight),c=this.calculateParagraphSpacingEffect(t,l.paragraphSpacing);return{containerBounds:o.containerBounds,positioning:o.positioning,fontMetrics:o.fontMetrics,typography:{adjustedWidth:o.containerBounds.width+s.widthIncrease,adjustedHeight:o.containerBounds.height+r.heightIncrease+c.heightIncrease,letterSpacingData:s,lineHeightData:r,paragraphData:c}}}calculateLetterSpacingEffect(t,i){const n=t.split(`
`),o=n.reduce((s,r)=>s+r.length,0),l=Math.max(0,o-n.length);return{spacingValue:i,totalSpaces:l,widthIncrease:l*i,charPositions:[]}}calculateLineHeightEffect(t,i,n){const l=t.split(`
`).length,s=i*n,r=i*1.2,c=s-r;return{lineHeightRatio:n,actualLineHeight:s,lineCount:l,heightIncrease:c*Math.max(0,l-1),baselinePositions:[]}}calculateParagraphSpacingEffect(t,i){const o=t.split(`

`).length;return{spacing:i,paragraphCount:o,heightIncrease:i*Math.max(0,o-1),paragraphPositions:[]}}createProfessionalTextElement(t,i,n,o){const l=document.createElementNS("http://www.w3.org/2000/svg","g");return l.setAttribute("class","professional-text-container"),this.renderMultipleFills(l,t,n.fills),this.renderEffects(l,t,n.effects),this.renderTypographyText(l,t,i,n),this.renderTextDecorations(l,t,i,n.typography.decoration),l}renderMultipleFills(t,i,n){if(n&&n.length>0&&n[0].enabled){const o=n[0];o.type==="solid"&&o.solid&&console.log("🎨 应用纯色填充:",o.solid.color)}}renderEffects(t,i,n){if(!n||n.length===0)return;const o=document.createElementNS("http://www.w3.org/2000/svg","defs"),l=document.createElementNS("http://www.w3.org/2000/svg","filter"),s=`text-effects-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;l.id=s;for(const r of n)if(r.enabled&&r.type==="drop-shadow"&&r.dropShadow){const c=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");c.setAttribute("dx",r.dropShadow.offsetX.toString()),c.setAttribute("dy",r.dropShadow.offsetY.toString()),c.setAttribute("stdDeviation",r.dropShadow.blur.toString()),c.setAttribute("flood-color",r.dropShadow.color),c.setAttribute("flood-opacity",r.dropShadow.opacity.toString()),l.appendChild(c),console.log("✨ 应用投影效果")}l.children.length>0&&(o.appendChild(l),t.appendChild(o),t.setAttribute("filter",`url(#${s})`))}renderTypographyText(t,i,n,o){var c,a;const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("font-family",o.font_family),l.setAttribute("font-size",o.font_size.toString()),l.setAttribute("font-weight",o.font_weight),l.setAttribute("fill",((a=(c=o.fills[0])==null?void 0:c.solid)==null?void 0:a.color)||o.color),l.setAttribute("text-anchor",this.getTextAnchor(o.align));const s=n.split(`
`),r=o.typography;s.forEach((u,d)=>{const f=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.letterSpacing!==0&&f.setAttribute("letter-spacing",`${r.letterSpacing}px`);const p=i.positioning.textAnchorY+d*i.typography.lineHeightData.actualLineHeight;if(f.setAttribute("x",i.positioning.textAnchorX.toString()),f.setAttribute("y",p.toString()),d===0&&r.textIndent!==0){const b=i.positioning.textAnchorX+r.textIndent;f.setAttribute("x",b.toString())}r.textTransform&&r.textTransform!=="none"?f.textContent=this.applyTextTransform(u,r.textTransform):f.textContent=u,l.appendChild(f)}),t.appendChild(l)}renderTextDecorations(t,i,n,o){if(!o.underline&&!o.strikethrough&&!o.overline)return;const l=n.split(`
`),s=o.decorationColor||"#000000",r=o.decorationThickness||1,c=o.decorationStyle==="dashed"?"4,2":o.decorationStyle==="dotted"?"1,1":"none";l.forEach((a,u)=>{if(!a.trim())return;const d=i.positioning.textAnchorY+u*i.typography.lineHeightData.actualLineHeight,f=a.length*i.fontMetrics.fontSize*.6,p=i.positioning.textAnchorX,b=p+f;if(o.underline){const $=d+i.fontMetrics.fontSize*.1;this.createDecorationLine(t,p,$,b,$,s,r,c,"underline")}if(o.strikethrough){const $=d-i.fontMetrics.fontSize*.3;this.createDecorationLine(t,p,$,b,$,s,r,c,"strikethrough")}if(o.overline){const $=d-i.fontMetrics.fontSize*.8;this.createDecorationLine(t,p,$,b,$,s,r,c,"overline")}})}createDecorationLine(t,i,n,o,l,s,r,c,a){const u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",i.toString()),u.setAttribute("y1",n.toString()),u.setAttribute("x2",o.toString()),u.setAttribute("y2",l.toString()),u.setAttribute("stroke",s),u.setAttribute("stroke-width",r.toString()),u.setAttribute("stroke-dasharray",c),u.setAttribute("class",`text-decoration-${a}`),t.appendChild(u)}getTextAnchor(t){switch(t){case"Center":return"middle";case"Right":return"end";case"Left":default:return"start"}}applyTextTransform(t,i){switch(i){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();default:return t}}}const Xn=new Vn;var Gn=k("<button class=search-clear title=清除搜索>✕"),Wn=k('<div class=style-picker-container><div class=style-categories></div><div class=style-search><div class=search-input-container><span class=search-icon>🔍</span><input type=text placeholder=搜索样式... class=search-input></div></div><div class=style-grid><div class="style-card create-style-card"><div class=create-style-content><div class=create-style-icon>➕</div><div class=create-style-label>新建样式</div></div></div></div><div class=style-stats><span class=stats-text> 个样式'),Yn=k("<button><span class=category-icon></span><span class=category-label>"),qn=k("<div><div class=style-preview></div><div class=style-info><div class=style-name></div><div class=style-meta><span class=style-category></span></div></div><div class=style-actions>"),Zn=k("<span class=usage-count>"),Jn=k("<button class=edit-button title=编辑样式>✏️"),Qn=k("<span class=system-badge title=系统预设样式>🔒"),ei=k("<div class=selection-indicator>✓");const ti=e=>{const[t,i]=J("bank-special"),[n,o]=J(""),[l,s]=J([]);(async()=>{await ue.initialize();const f=ue.getStylesByCategory();s(f)})();const c=oe(()=>{let f=l();t()&&(f=f.filter(b=>b.category===t()));const p=n().toLowerCase().trim();return p&&(f=f.filter(b=>b.name.toLowerCase().includes(p)||b.description.toLowerCase().includes(p)||b.metadata.tags.some($=>$.toLowerCase().includes(p)))),f}),a=[{key:"bank-special",label:"银行专用",icon:"🏦"},{key:"heading",label:"标题",icon:"📰"},{key:"body",label:"正文",icon:"📝"},{key:"caption",label:"说明",icon:"💬"},{key:"custom",label:"自定义",icon:"⚙️"}],u=f=>{console.log("🎯 选择样式:",f),e.onStyleSelect(f)},d=f=>{i(f),console.log("📂 切换分类:",f)};return(()=>{var f=Wn(),p=f.firstChild,b=p.nextSibling,$=b.firstChild,j=$.firstChild,z=j.nextSibling,L=b.nextSibling,A=L.firstChild,I=L.nextSibling,R=I.firstChild,U=R.firstChild;return h(p,v(_e,{each:a,children:K=>(()=>{var T=Yn(),Z=T.firstChild,F=Z.nextSibling;return T.$$click=()=>d(K.key),h(Z,()=>K.icon),h(F,()=>K.label),M(O=>{var S=`category-button ${t()===K.key?"active":""}`,Y=K.label;return S!==O.e&&Ee(T,O.e=S),Y!==O.t&&_(T,"title",O.t=Y),O},{e:void 0,t:void 0}),T})()})),z.$$input=K=>o(K.target.value),h($,v(ie,{get when(){return n()},get children(){var K=Gn();return K.$$click=()=>o(""),K}}),null),h(L,v(_e,{get each(){return c()},children:K=>v(ni,{style:K,get selected(){return e.selectedStyleId===K.id},onClick:()=>u(K.id),onEdit:()=>e.onStyleEdit(K.id)})}),A),Ie(A,"click",e.onStyleCreate),h(R,()=>c().length,U),h(R,(()=>{var K=le(()=>!!n());return()=>K()&&` (搜索: "${n()}")`})(),null),M(()=>z.value=n()),f})()},ni=e=>{const t=()=>{switch(e.style.category){case"bank-special":return e.style.id.includes("amount")?"¥123,456.78":e.style.id.includes("account")?"6222 0012 3456 7890":e.style.id.includes("institution")?e.style.name:e.style.id.includes("date")?"2025-08-19":e.style.name;case"heading":return e.style.name;case"body":return"正文示例文字 Abc";case"caption":return"说明文字";default:return e.style.name}},i=oe(()=>{var s,r,c,a,u,d,f,p;const l=e.style.style;return{fontFamily:l.font_family,fontSize:`${Math.min(l.font_size,14)}px`,fontWeight:l.font_weight,color:((c=(r=(s=l.fills)==null?void 0:s[0])==null?void 0:r.solid)==null?void 0:c.color)||l.color,textAlign:l.align.toLowerCase(),letterSpacing:`${((a=l.typography)==null?void 0:a.letterSpacing)||0}px`,textDecoration:(d=(u=l.typography)==null?void 0:u.decoration)!=null&&d.underline?"underline":(p=(f=l.typography)==null?void 0:f.decoration)!=null&&p.strikethrough?"line-through":"none"}}),n=l=>{l.preventDefault(),e.onClick()},o=l=>{l.preventDefault(),l.stopPropagation(),e.onEdit()};return(()=>{var l=qn(),s=l.firstChild,r=s.nextSibling,c=r.firstChild,a=c.nextSibling,u=a.firstChild,d=r.nextSibling;return l.$$click=n,h(s,t),h(c,()=>e.style.name),h(u,()=>ii(e.style.category)),h(a,(()=>{var f=le(()=>e.style.metadata.usageCount>0);return()=>f()&&(()=>{var p=Zn();return h(p,()=>e.style.metadata.usageCount),M(()=>_(p,"title",`使用次数: ${e.style.metadata.usageCount}`)),p})()})(),null),h(d,(()=>{var f=le(()=>!e.style.metadata.isSystemStyle);return()=>f()&&(()=>{var p=Jn();return p.$$click=o,p})()})(),null),h(d,(()=>{var f=le(()=>!!e.style.metadata.isSystemStyle);return()=>f()&&Qn()})(),null),h(l,(()=>{var f=le(()=>!!e.selected);return()=>f()&&ei()})(),null),M(f=>{var p=`style-card ${e.selected?"selected":""} ${e.style.metadata.isSystemStyle?"system-style":"user-style"}`,b=i();return p!==f.e&&Ee(l,f.e=p),f.t=Ot(s,b,f.t),f},{e:void 0,t:void 0}),l})()};function ii(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}me(["input","click"]);var li=k("<button class=style-picker-toggle>"),oi=k("<button class=style-reload-btn title=重新加载样式系统>🔄"),si=k("<div class=initialization-fallback><div class=fallback-content><span class=fallback-icon>⏳</span><span class=fallback-text>专业样式系统加载中...</span><div class=fallback-actions><button class=retry-btn>重试加载"),ri=k("<div class=quick-style-actions><button class=apply-style-btn><span class=btn-icon>🎨</span><span class=btn-text>选择样式</span></button><button class=create-style-btn title=基于当前设置创建新样式><span class=btn-icon>➕</span><span class=btn-text>新建"),ai=k("<div class=style-picker-panel>"),ci=k("<div class=property-group><div class=property-group-title><span>📐</span><span>排版控制</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=typography-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>⚙️</span><span class=placeholder-text>高级排版控制功能</span><span class=placeholder-subtitle>字间距、行高、装饰等"),di=k("<div class=property-group><div class=property-group-title><span>✨</span><span>视觉效果</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=effects-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>🌈</span><span class=placeholder-text>多重填充 & 阴影效果</span><span class=placeholder-subtitle>渐变、投影、发光等"),ui=k('<div class="property-group debug-panel"><div class=property-group-title><span>🔧</span><span>调试信息</span></div><div class=property-group-content><div class=debug-info><div class=debug-item><span class=debug-label>元素ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>当前样式ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>可用样式:</span><span class=debug-value> 个</span></div><div class=debug-item><span class=debug-label>使用专业渲染:</span><span class=debug-value>'),hi=k("<div class=professional-text-properties><div class=property-group><div class=property-group-title><span>🎨</span><span>专业文字样式</span><div class=property-group-actions></div></div><div class=property-group-content>"),gi=k('<div class=current-style-info><div class=current-style-preview><div class=style-preview-badge><span class=style-name></span><span class=style-category></span></div><div class=style-actions><button class="style-action-btn edit-btn"title=编辑样式>✏️</button><button class="style-action-btn remove-btn"title=移除样式>🗑️');const $t=e=>{const[t,i]=J(null),[n,o]=J(!1),[l,s]=J([]),[r,c]=J(!1);Re(async()=>{try{await ue.initialize();const z=ue.getElementStyleId(e.element.id);i(z);const L=ue.getStylesByCategory();s(L),c(!0),console.log("🎨 ProfessionalTextPropertiesPanel 初始化完成")}catch(z){console.error("❌ 专业文字属性面板初始化失败:",z)}});const a=oe(()=>{const z=t();return z?ue.getStyle(z):null}),u=oe(()=>e.element.content.type==="Text"||e.element.content.type==="DataField"),d=async z=>{try{const L=await ue.applyStyleToElement(e.element.id,z);if(L.success){i(z);const A=ue.getStyle(z);if(A){const I=f(A.style);e.onUpdate(e.element.id,"content",{...e.element.content,style:I})}console.log("✅ 样式应用成功:",L)}else console.error("❌ 样式应用失败:",L.error)}catch(L){console.error("❌ 样式选择处理失败:",L)}},f=z=>{var L,A,I;return{font_family:z.font_family,font_size:z.font_size,font_weight:z.font_weight,color:((I=(A=(L=z.fills)==null?void 0:L[0])==null?void 0:A.solid)==null?void 0:I.color)||z.color,align:z.align}},p=()=>{console.log("🆕 创建新样式")},b=z=>{console.log("✏️ 编辑样式:",z)},$=()=>{o(!n())},j=()=>{t()&&(ue.removeElementStyle(e.element.id),i(null),console.log("🗑️ 移除元素样式"))};return u()?(()=>{var z=hi(),L=z.firstChild,A=L.firstChild,I=A.firstChild,R=I.nextSibling,U=R.nextSibling,K=A.nextSibling;return h(U,v(ie,{get when(){return r()},get children(){var T=li();return T.$$click=$,h(T,()=>n()?"📝":"📚"),M(()=>_(T,"title",n()?"隐藏样式库":"显示样式库")),T}}),null),h(U,v(ie,{get when(){return!r()},get children(){var T=oi();return T.$$click=()=>window.location.reload(),T}}),null),h(K,v(ie,{get when(){return!r()},get children(){var T=si(),Z=T.firstChild,F=Z.firstChild,O=F.nextSibling,S=O.nextSibling,Y=S.firstChild;return Y.$$click=async()=>{try{await ue.initialize();const B=ue.getStylesByCategory();s(B),c(!0),console.log("🔄 样式系统重新初始化成功")}catch(B){console.error("❌ 重新初始化失败:",B)}},T}}),null),h(K,v(ie,{get when(){return r()},get children(){return[v(ie,{get when(){return a()},children:T=>(()=>{var Z=gi(),F=Z.firstChild,O=F.firstChild,S=O.firstChild,Y=S.nextSibling,B=O.nextSibling,y=B.firstChild,C=y.nextSibling;return h(S,()=>T().name),h(Y,()=>fi(T().category)),y.$$click=()=>b(T().id),C.$$click=j,Z})()}),v(ie,{get when(){return!a()},get children(){var T=ri(),Z=T.firstChild,F=Z.nextSibling;return Z.$$click=$,F.$$click=p,T}}),v(ie,{get when(){return n()},get children(){var T=ai();return h(T,v(ti,{get selectedStyleId(){return t()},onStyleSelect:d,onStyleCreate:p,onStyleEdit:b})),T}})]}}),null),h(z,v(ie,{get when(){return a()},get children(){return ci()}}),null),h(z,v(ie,{get when(){return a()},get children(){return di()}}),null),h(z,v(ie,{get when(){return!1},get children(){var T=ui(),Z=T.firstChild,F=Z.nextSibling,O=F.firstChild,S=O.firstChild,Y=S.firstChild,B=Y.nextSibling,y=S.nextSibling,C=y.firstChild,D=C.nextSibling,H=y.nextSibling,E=H.firstChild,V=E.nextSibling,te=V.firstChild,se=H.nextSibling,N=se.firstChild,ce=N.nextSibling;return h(B,()=>e.element.id),h(D,()=>t()||"无"),h(V,()=>l().length,te),h(ce,()=>Xn.isElementUsingProfessionalStyle(e.element.id)?"是":"否"),T}}),null),z})():null};function fi(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}me(["click"]);var vi=k('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),yi=k('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),mi=k("<span class=property-value>"),pi=k('<span class="property-value text-xs text-muted">'),st=k("<div class=space-y-2>"),je=k("<input type=number class=property-input>"),bi=k('<div class="grid grid-cols-2 gap-2">'),St=k("<input type=checkbox class=property-checkbox>"),xi=k('<div class="p-4 space-y-4">'),kt=k("<div>"),wi=k("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),_i=k("<div class=property-field><label class=property-label>"),$i=k("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),Vt=k('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Xt=k("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),Si=k('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Gt=k("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),ki=k('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),Wt=k('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),Yt=k('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),Ci=k('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Ei=k("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),Ct=k("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Ai=k('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),zi=k("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),Pi=k("<input type=text class=property-input placeholder=图片描述文字>"),Li=k("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),Ti=k("<div class=space-y-3>"),Mi=k("<img class=property-image>"),Di=k("<input type=text class=property-input placeholder=${fieldName}>"),Ui=k("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),Ii=k("<div class=space-y-4>"),Oi=k('<div class=flex><input type=number class="property-input flex-1">'),Ri=k("<span class=property-unit>"),Fi=k('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),Bi=k("<div class=property-alignment-group>"),Ni=k("<button>");const Hi=()=>{const{state:e,updateElement:t}=Se(),i=oe(()=>{const l=new Set(e.selected_ids);return e.elements.filter(s=>l.has(s.id))}),n=oe(()=>i()[0]),o=async(l,s,r)=>{try{await t(l,{[s]:r})}catch(c){console.error("Failed to update element property:",c)}};return(()=>{var l=vi(),s=l.firstChild,r=s.nextSibling;return h(r,v(ie,{get when(){return n()},get fallback(){return yi()},get children(){return v(ji,{get element(){return n()},onUpdate:o})}})),l})()},ji=e=>{const t=(n,o)=>{const l={...e.element.position,[n]:o};e.onUpdate(e.element.id,"position",l)},i=(n,o)=>{const l={...e.element.size,[n]:Math.max(1,o)};e.onUpdate(e.element.id,"size",l)};return(()=>{var n=xi();return h(n,v($e,{title:"元素信息",icon:"ℹ️",get children(){var o=st();return h(o,v(W,{label:"类型",get children(){var l=mi();return h(l,()=>e.element.content.type),l}}),null),h(o,v(W,{label:"ID",get children(){var l=pi();return h(l,()=>e.element.id),l}}),null),o}}),null),h(n,v($e,{title:"位置和大小",icon:"📐",get children(){var o=bi();return h(o,v(W,{label:"X",get children(){var l=je();return l.$$input=s=>t("x",parseFloat(s.target.value)||0),M(()=>l.value=e.element.position.x),l}}),null),h(o,v(W,{label:"Y",get children(){var l=je();return l.$$input=s=>t("y",parseFloat(s.target.value)||0),M(()=>l.value=e.element.position.y),l}}),null),h(o,v(W,{label:"宽度",get children(){var l=je();return l.$$input=s=>i("width",parseFloat(s.target.value)||1),M(()=>l.value=e.element.size.width),l}}),null),h(o,v(W,{label:"高度",get children(){var l=je();return l.$$input=s=>i("height",parseFloat(s.target.value)||1),M(()=>l.value=e.element.size.height),l}}),null),o}}),null),h(n,v($e,{title:"状态",icon:"👁️",get children(){var o=st();return h(o,v(W,{label:"可见",get children(){var l=St();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"visible",s.target.checked)),M(()=>l.checked=e.element.visible),l}}),null),h(o,v(W,{label:"锁定",get children(){var l=St();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"locked",s.target.checked)),M(()=>l.checked=e.element.locked),l}}),null),h(o,v(W,{label:"层级",get children(){var l=je();return l.$$input=s=>e.onUpdate(e.element.id,"z_index",parseInt(s.target.value)||0),M(()=>l.value=e.element.z_index),l}}),null),o}}),null),h(n,v(wn,{get children(){return[v(He,{get when(){return e.element.content.type==="Text"&&e.element.content},children:o=>(()=>{var l=kt();return h(l,v($t,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,v(Ki,{get content(){return o()},onUpdate:s=>{console.log("Text content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),l})()}),v(He,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:o=>v(Vi,{get content(){return o()},onUpdate:l=>{console.log("Rectangle content update:",l),e.onUpdate(e.element.id,"content",l)}})}),v(He,{get when(){return e.element.content.type==="Line"&&e.element.content},children:o=>v(Xi,{get content(){return o()},onUpdate:l=>{console.log("Line content update:",l),e.onUpdate(e.element.id,"content",l)}})}),v(He,{get when(){return e.element.content.type==="Image"&&e.element.content},children:o=>v(Gi,{get content(){return o()},onUpdate:l=>{console.log("Image content update:",l),e.onUpdate(e.element.id,"content",l)}})}),v(He,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:o=>(()=>{var l=kt();return h(l,v($t,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,v(Wi,{get content(){return o()},onUpdate:s=>{console.log("DataField content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),l})()})]}}),null),n})()},$e=e=>(()=>{var t=wi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling,l=i.nextSibling;return h(n,()=>e.icon),h(o,()=>e.title),h(l,()=>e.children),t})(),W=e=>(()=>{var t=_i(),i=t.firstChild;return h(i,()=>e.label),h(t,()=>e.children,null),t})(),Ki=e=>v($e,{title:"文字样式",icon:"🔤",get children(){var t=Wt(),i=t.firstChild,n=i.nextSibling;return h(t,v(W,{label:"内容",get children(){var o=$i();return o.$$input=l=>e.onUpdate({content:l.target.value}),M(()=>o.value=e.content.content),o}}),i),h(i,v(W,{label:"字体",get children(){var o=Vt();return o.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_family:l.target.value}})),M(()=>o.value=e.content.style.font_family),o}}),null),h(i,v(W,{label:"大小",get children(){return v(xe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:o=>e.onUpdate({style:{...e.content.style,font_size:o}})})}}),null),h(n,v(W,{label:"字重",get children(){var o=Xt();return o.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_weight:l.target.value}})),M(()=>o.value=e.content.style.font_weight),o}}),null),h(n,v(W,{label:"对齐",get children(){return v(qt,{get value(){return e.content.style.align},onUpdate:o=>e.onUpdate({style:{...e.content.style,align:o}})})}}),null),h(t,v(W,{label:"颜色",get children(){return v(Le,{get value(){return e.content.style.color},onUpdate:o=>e.onUpdate({style:{...e.content.style,color:o}})})}}),null),h(t,v(W,{label:"背景",get children(){var o=Si(),l=o.firstChild;return h(o,v(Le,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.color)||"transparent"},onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:s}}})}),l),h(l,v(W,{label:"透明度",get children(){return v(xe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.opacity)||1},min:0,max:1,step:.1,onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:s}}})})}}),null),h(l,v(W,{label:"内边距",get children(){return v(xe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:s}}})})}}),null),o}}),null),h(t,v(W,{label:"边框",get children(){var o=ki(),l=o.firstChild;return h(o,v(Le,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.color)||"#000000"},onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:s}}})}),l),h(l,v(W,{label:"宽度",get children(){return v(xe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:s}}})})}}),null),h(l,v(W,{label:"样式",get children(){var s=Gt();return s.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:r.target.value}}})),M(()=>{var r;return s.value=((r=e.content.style.border)==null?void 0:r.style)||"Solid"}),s}}),null),h(l,v(W,{label:"圆角",get children(){return v(xe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:s}}})})}}),null),o}}),null),t}}),Vi=e=>v($e,{title:"矩形样式",icon:"▭",get children(){var t=Ci(),i=t.firstChild,n=i.firstChild;return h(t,v(W,{label:"填充颜色",get children(){return v(Le,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:o=>e.onUpdate({fill_color:o})})}}),i),h(i,v(W,{label:"边框",get children(){var o=st();return h(o,v(Le,{get value(){var l;return((l=e.content.border)==null?void 0:l.color)||"#000000"},onUpdate:l=>e.onUpdate({border:{...e.content.border,color:l}})})),o}}),n),h(n,v(W,{label:"宽度",get children(){return v(xe,{get value(){var o;return((o=e.content.border)==null?void 0:o.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:o=>e.onUpdate({border:{...e.content.border,width:o}})})}}),null),h(n,v(W,{label:"样式",get children(){var o=Gt();return o.addEventListener("change",l=>e.onUpdate({border:{...e.content.border,style:l.target.value}})),M(()=>{var l;return o.value=((l=e.content.border)==null?void 0:l.style)||"Solid"}),o}}),null),h(t,v(W,{label:"圆角半径",get children(){return v(xe,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:o=>e.onUpdate({corner_radius:o})})}}),null),h(t,v(W,{label:"透明度",get children(){var o=Yt(),l=o.firstChild,s=l.nextSibling,r=s.firstChild;return l.$$input=c=>e.onUpdate({opacity:parseFloat(c.target.value)/100}),h(s,()=>Math.round((e.content.opacity||1)*100),r),M(()=>l.value=(e.content.opacity||1)*100),o}}),null),t}}),Xi=e=>v($e,{title:"线条样式",icon:"━",get children(){var t=Ai(),i=t.firstChild;return h(t,v(W,{label:"颜色",get children(){return v(Le,{get value(){return e.content.color},onUpdate:n=>e.onUpdate({color:n})})}}),i),h(t,v(W,{label:"宽度",get children(){return v(xe,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:n=>e.onUpdate({width:n})})}}),i),h(t,v(W,{label:"样式",get children(){var n=Ei();return n.addEventListener("change",o=>e.onUpdate({line_style:o.target.value})),M(()=>n.value=e.content.line_style||"Solid"),n}}),i),h(i,v(W,{label:"起点",get children(){var n=Ct();return n.addEventListener("change",o=>e.onUpdate({start_cap:o.target.value})),M(()=>n.value=e.content.start_cap||"None"),n}}),null),h(i,v(W,{label:"终点",get children(){var n=Ct();return n.addEventListener("change",o=>e.onUpdate({end_cap:o.target.value})),M(()=>n.value=e.content.end_cap||"None"),n}}),null),h(t,v(W,{label:"透明度",get children(){var n=Yt(),o=n.firstChild,l=o.nextSibling,s=l.firstChild;return o.$$input=r=>e.onUpdate({opacity:parseFloat(r.target.value)/100}),h(l,()=>Math.round((e.content.opacity||1)*100),s),M(()=>o.value=(e.content.opacity||1)*100),n}}),null),t}}),Gi=e=>v($e,{title:"图片属性",icon:"🖼️",get children(){var t=Ti();return h(t,v(W,{label:"图片地址",get children(){var i=zi();return i.$$input=n=>e.onUpdate({src:n.target.value}),M(()=>i.value=e.content.src),i}}),null),h(t,v(W,{label:"替代文本",get children(){var i=Pi();return i.$$input=n=>e.onUpdate({alt:n.target.value}),M(()=>i.value=e.content.alt||""),i}}),null),h(t,v(W,{label:"预览",get children(){var i=Li(),n=i.firstChild;return h(i,(()=>{var o=le(()=>!!e.content.src);return()=>o()?(()=>{var l=Mi();return l.addEventListener("load",s=>{const r=s.target,c=r.nextElementSibling;r&&(r.style.display="block"),c&&(c.style.display="none")}),l.addEventListener("error",s=>{const r=s.target,c=r.nextElementSibling;r&&(r.style.display="none"),c&&(c.style.display="flex")}),M(s=>{var r=e.content.src,c=e.content.alt||"图片预览";return r!==s.e&&_(l,"src",s.e=r),c!==s.t&&_(l,"alt",s.t=c),s},{e:void 0,t:void 0}),l})():null})(),n),M(o=>(o=e.content.src?"none":"flex")!=null?n.style.setProperty("display",o):n.style.removeProperty("display")),i}}),null),t}}),Wi=e=>(()=>{var t=Ii();return h(t,v($e,{title:"数据字段",icon:"🔗",get children(){var i=st();return h(i,v(W,{label:"表达式",get children(){var n=Di();return n.$$input=o=>e.onUpdate({expression:o.target.value}),M(()=>n.value=e.content.expression),n}}),null),h(i,v(W,{label:"格式",get children(){var n=Ui();return n.addEventListener("change",o=>e.onUpdate({format:o.target.value==="default"?void 0:o.target.value})),M(()=>n.value=e.content.format||"default"),n}}),null),i}}),null),h(t,v($e,{title:"字段样式",icon:"🎨",get children(){var i=Wt(),n=i.firstChild,o=n.nextSibling;return h(n,v(W,{label:"字体",get children(){var l=Vt();return l.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_family:s.target.value}})),M(()=>l.value=e.content.style.font_family),l}}),null),h(n,v(W,{label:"大小",get children(){return v(xe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),h(o,v(W,{label:"字重",get children(){var l=Xt();return l.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_weight:s.target.value}})),M(()=>l.value=e.content.style.font_weight),l}}),null),h(o,v(W,{label:"对齐",get children(){return v(qt,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),h(i,v(W,{label:"颜色",get children(){return v(Le,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),i}}),null),t})(),xe=e=>(()=>{var t=Oi(),i=t.firstChild;return i.addEventListener("blur",n=>{const o=parseFloat(n.target.value)||e.value,l=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));l!==o&&(n.target.value=l.toString(),e.onUpdate(l))}),i.$$input=n=>{const o=parseFloat(n.target.value);if(!isNaN(o)){const l=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));e.onUpdate(l)}},h(t,(()=>{var n=le(()=>!!e.unit);return()=>n()&&(()=>{var o=Ri();return h(o,()=>e.unit),o})()})(),null),M(n=>{var o=e.min,l=e.max,s=e.step||1;return o!==n.e&&_(i,"min",n.e=o),l!==n.t&&_(i,"max",n.t=l),s!==n.a&&_(i,"step",n.a=s),n},{e:void 0,t:void 0,a:void 0}),M(()=>i.value=e.value),t})(),Le=e=>(()=>{var t=Fi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling,l=i.nextSibling;return n.$$input=s=>e.onUpdate(s.target.value),l.$$input=s=>{const r=s.target.value;(/^#[0-9A-Fa-f]{6}$/.test(r)||/^#[0-9A-Fa-f]{3}$/.test(r))&&e.onUpdate(r)},M(s=>(s=e.value)!=null?o.style.setProperty("background-color",s):o.style.removeProperty("background-color")),M(()=>n.value=e.value),M(()=>l.value=e.value),t})(),qt=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var i=Bi();return h(i,()=>t.map(n=>(()=>{var o=Ni();return o.$$click=()=>e.onUpdate(n.value),h(o,()=>n.icon),M(l=>{var s=`property-alignment-btn ${e.value===n.value?"active":""}`,r=n.label;return s!==l.e&&Ee(o,l.e=s),r!==l.t&&_(o,"title",l.t=r),l},{e:void 0,t:void 0}),o})())),i})()};me(["input","click"]);var Yi=k("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),qi=k("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const Zi=e=>v(ie,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Yi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling;return M(l=>{var s=e.config.grid_size,r=e.config.grid_size,c=e.config.grid_size,a=e.config.grid_size,u=e.config.grid_size,d=e.config.grid_size,f=e.config.grid_size,p=e.config.grid_size;return s!==l.e&&_(i,"width",l.e=s),r!==l.t&&_(i,"height",l.t=r),c!==l.a&&_(n,"x1",l.a=c),a!==l.o&&_(n,"x2",l.o=a),u!==l.i&&_(n,"y2",l.i=u),d!==l.n&&_(o,"y1",l.n=d),f!==l.s&&_(o,"x2",l.s=f),p!==l.h&&_(o,"y2",l.h=p),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=qi();return M(i=>{var n=e.config.width,o=e.config.height;return n!==i.e&&_(t,"width",i.e=n),o!==i.t&&_(t,"height",i.t=o),i},{e:void 0,t:void 0}),t})()]}});var Ji=k("<svg><g class=text-element-unified-container data-bounds-version=unified-v2><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=text-content-unified></svg>",!1,!0,!1),Et=k("<svg><rect class=text-selection-unified></svg>",!1,!0,!1),Qi=k("<svg><rect class=text-background-unified></svg>",!1,!0,!1),el=k("<svg><rect fill=none class=text-border-unified></svg>",!1,!0,!1),tl=k("<svg><tspan class=text-line-wrapped></svg>",!1,!0,!1),nl=k("<svg><tspan class=text-line-original></svg>",!1,!0,!1),il=k("<svg><rect x=0 y=0></svg>",!1,!0,!1),ll=k("<svg><line x1=0></svg>",!1,!0,!1),ol=k("<svg><g class=datafield-element-unified-container><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=datafield-content-unified></svg>",!1,!0,!1),sl=k("<svg><tspan class=datafield-line-wrapped></svg>",!1,!0,!1),rl=k("<svg><tspan dy=0></svg>",!1,!0,!1),al=k("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),cl=k("<svg><g></svg>",!1,!0,!1);const dl=e=>{const t=oe(()=>{const{position:n}=e.element;return{transform:`translate(${n.x}px, ${n.y}px)`,opacity:e.element.visible?1:.5}}),i=()=>{const{content:n,size:o}=e.element;if(n.type==="Text"&&n.content&&n.style){const l=Ue.calculateUnifiedBounds(n.content,n.style,o),s=Ue.getTextAnchor(n.style.align);return(()=>{var r=Ji(),c=r.firstChild;return h(r,(()=>{var a=le(()=>!!e.selected);return()=>a()&&(()=>{var u=Et();return M(d=>{var f=l.containerBounds.x,p=l.containerBounds.y,b=l.containerBounds.width,$=l.containerBounds.height;return f!==d.e&&_(u,"x",d.e=f),p!==d.t&&_(u,"y",d.t=p),b!==d.a&&_(u,"width",d.a=b),$!==d.o&&_(u,"height",d.o=$),d},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),c),h(r,(()=>{var a=le(()=>!!n.style.background);return()=>a()&&(()=>{var u=Qi();return M(d=>{var I,R;var f=l.positioning.backgroundX,p=l.positioning.backgroundY,b=l.containerBounds.width+(n.style.background.padding||0)*2,$=l.containerBounds.height+(n.style.background.padding||0)*2,j=n.style.background.color,z=n.style.background.opacity||1,L=((I=n.style.border)==null?void 0:I.radius)||0,A=((R=n.style.border)==null?void 0:R.radius)||0;return f!==d.e&&_(u,"x",d.e=f),p!==d.t&&_(u,"y",d.t=p),b!==d.a&&_(u,"width",d.a=b),$!==d.o&&_(u,"height",d.o=$),j!==d.i&&_(u,"fill",d.i=j),z!==d.n&&_(u,"fill-opacity",d.n=z),L!==d.s&&_(u,"rx",d.s=L),A!==d.h&&_(u,"ry",d.h=A),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()})(),c),h(r,(()=>{var a=le(()=>!!n.style.border);return()=>a()&&(()=>{var u=el();return M(d=>{var R,U;var f=l.positioning.backgroundX,p=l.positioning.backgroundY,b=l.containerBounds.width+(((R=n.style.background)==null?void 0:R.padding)||0)*2,$=l.containerBounds.height+(((U=n.style.background)==null?void 0:U.padding)||0)*2,j=n.style.border.color,z=n.style.border.width,L=n.style.border.style==="Dashed"?"5,5":n.style.border.style==="Dotted"?"2,2":"none",A=n.style.border.radius||0,I=n.style.border.radius||0;return f!==d.e&&_(u,"x",d.e=f),p!==d.t&&_(u,"y",d.t=p),b!==d.a&&_(u,"width",d.a=b),$!==d.o&&_(u,"height",d.o=$),j!==d.i&&_(u,"stroke",d.i=j),z!==d.n&&_(u,"stroke-width",d.n=z),L!==d.s&&_(u,"stroke-dasharray",d.s=L),A!==d.h&&_(u,"rx",d.h=A),I!==d.r&&_(u,"ry",d.r=I),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),u})()})(),c),_(c,"text-anchor",s),h(c,(()=>{var a=le(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,d)=>(()=>{var f=tl();return h(f,u),M(p=>{var b=l.positioning.textAnchorX,$=d===0?0:l.fontMetrics.lineHeight;return b!==p.e&&_(f,"x",p.e=b),$!==p.t&&_(f,"dy",p.t=$),p},{e:void 0,t:void 0}),f})()):n.content.split(`
`).map((u,d)=>(()=>{var f=nl();return h(f,u),M(p=>{var b=l.positioning.textAnchorX,$=d===0?0:l.fontMetrics.lineHeight;return b!==p.e&&_(f,"x",p.e=b),$!==p.t&&_(f,"dy",p.t=$),p},{e:void 0,t:void 0}),f})())})()),M(a=>{var u=l.positioning.textAnchorX,d=l.positioning.textAnchorY,f=n.style.font_family,p=n.style.font_size.toString(),b=n.style.font_weight,$=n.style.color;return u!==a.e&&_(c,"x",a.e=u),d!==a.t&&_(c,"y",a.t=d),f!==a.a&&_(c,"font-family",a.a=f),p!==a.o&&_(c,"font-size",a.o=p),b!==a.i&&_(c,"font-weight",a.i=b),$!==a.n&&_(c,"fill",a.n=$),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}if(n.type==="Rectangle"){const l=n.opacity!==void 0?n.opacity:1,s=n.corner_radius||0;return(()=>{var r=il();return _(r,"rx",s),_(r,"ry",s),_(r,"fill-opacity",l),_(r,"stroke-opacity",l),M(c=>{var $,j,z,L;var a=o.width,u=o.height,d=n.fill_color||"transparent",f=(($=n.border)==null?void 0:$.color)||"#000000",p=((j=n.border)==null?void 0:j.width)||1,b=((z=n.border)==null?void 0:z.style)==="Dashed"?"5,5":((L=n.border)==null?void 0:L.style)==="Dotted"?"2,2":"none";return a!==c.e&&_(r,"width",c.e=a),u!==c.t&&_(r,"height",c.t=u),d!==c.a&&_(r,"fill",c.a=d),f!==c.o&&_(r,"stroke",c.o=f),p!==c.i&&_(r,"stroke-width",c.i=p),b!==c.n&&_(r,"stroke-dasharray",c.n=b),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}if(n.type==="Line"){const l=n.opacity!==void 0?n.opacity:1,s=n.line_style||"Solid",r=s==="Dashed"?"8,4":s==="Dotted"?"2,2":s==="DashDot"?"8,4,2,4":"none";return(()=>{var c=ll();return _(c,"stroke-opacity",l),_(c,"stroke-dasharray",r),M(a=>{var u=o.height/2,d=o.width,f=o.height/2,p=n.color,b=n.width;return u!==a.e&&_(c,"y1",a.e=u),d!==a.t&&_(c,"x2",a.t=d),f!==a.a&&_(c,"y2",a.a=f),p!==a.o&&_(c,"stroke",a.o=p),b!==a.i&&_(c,"stroke-width",a.i=b),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c})()}if(n.type==="DataField"&&n.style){const l=Ue.calculateUnifiedBounds(n.expression||"[数据字段]",n.style,o),s=Ue.getTextAnchor(n.style.align);return(()=>{var r=ol(),c=r.firstChild;return h(r,(()=>{var a=le(()=>!!e.selected);return()=>a()&&(()=>{var u=Et();return M(d=>{var f=l.containerBounds.x,p=l.containerBounds.y,b=l.containerBounds.width,$=l.containerBounds.height;return f!==d.e&&_(u,"x",d.e=f),p!==d.t&&_(u,"y",d.t=p),b!==d.a&&_(u,"width",d.a=b),$!==d.o&&_(u,"height",d.o=$),d},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),c),_(c,"text-anchor",s),h(c,(()=>{var a=le(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,d)=>(()=>{var f=sl();return h(f,u),M(p=>{var b=l.positioning.textAnchorX,$=d===0?0:l.fontMetrics.lineHeight;return b!==p.e&&_(f,"x",p.e=b),$!==p.t&&_(f,"dy",p.t=$),p},{e:void 0,t:void 0}),f})()):(()=>{var u=rl();return h(u,()=>n.expression||"[数据字段]"),M(()=>_(u,"x",l.positioning.textAnchorX)),u})()})()),M(a=>{var u=l.positioning.textAnchorX,d=l.positioning.textAnchorY,f=n.style.font_family,p=n.style.font_size.toString(),b=n.style.font_weight,$=n.style.color;return u!==a.e&&_(c,"x",a.e=u),d!==a.t&&_(c,"y",a.t=d),f!==a.a&&_(c,"font-family",a.a=f),p!==a.o&&_(c,"font-size",a.o=p),b!==a.i&&_(c,"font-weight",a.i=b),$!==a.n&&_(c,"fill",a.n=$),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}return(()=>{var l=al();return M(s=>{var r=o.width,c=o.height;return r!==s.e&&_(l,"width",s.e=r),c!==s.t&&_(l,"height",s.t=c),s},{e:void 0,t:void 0}),l})()};return(()=>{var n=cl();return h(n,i),M(o=>{var l=`element ${e.selected&&e.element.content.type!=="Text"&&e.element.content.type!=="DataField"?"element-selected":""}`,s=t(),r=e.element.id,c=e.element.content.type;return l!==o.e&&_(n,"class",o.e=l),o.t=Ot(n,s,o.t),r!==o.a&&_(n,"data-element-id",o.a=r),c!==o.o&&_(n,"data-element-type",o.o=c),o},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};var ul=k("<svg><g class=resize-handles></svg>",!1,!0,!1),hl=k("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const gl=e=>{const{updateElement:t,setResizeOperation:i}=Se(),[n,o]=J(!1),[l,s]=J(null),[r,c]=J({x:0,y:0}),[a,u]=J({width:0,height:0}),[d,f]=J({x:0,y:0}),[p,b]=J({width:0,height:0}),[$,j]=J({x:0,y:0}),[z,L]=J(!1),A=oe(()=>{const{position:F,size:O,content:S}=e.element,B=8/2;let y={x:F.x,y:F.y,width:O.width,height:O.height};if((S.type==="Text"||S.type==="DataField")&&S.style){const se=S.type==="Text"?S.content:S.expression||"[数据字段]",N=Ue.calculateUnifiedBounds(se,S.style,O);y={x:F.x+N.containerBounds.x,y:F.y+N.containerBounds.y,width:N.containerBounds.width,height:N.containerBounds.height}}const C=y.x,D=y.y,H=y.x+y.width,E=y.y+y.height,V=y.x+y.width/2,te=y.y+y.height/2;return[{position:"nw",cursor:"nw-resize",x:C-B,y:D-B},{position:"ne",cursor:"ne-resize",x:H-B,y:D-B},{position:"sw",cursor:"sw-resize",x:C-B,y:E-B},{position:"se",cursor:"se-resize",x:H-B,y:E-B},{position:"n",cursor:"n-resize",x:V-B,y:D-B},{position:"s",cursor:"s-resize",x:V-B,y:E-B},{position:"w",cursor:"w-resize",x:C-B,y:te-B},{position:"e",cursor:"e-resize",x:H-B,y:te-B}]}),I=(F,O,S,Y=!1,B=!1)=>{const y=a(),C=d();let D=y.width,H=y.height,E=C.x,V=C.y;switch(F){case"nw":D=y.width-O,H=y.height-S,E=C.x+O,V=C.y+S;break;case"ne":D=y.width+O,H=y.height-S,V=C.y+S;break;case"sw":D=y.width-O,H=y.height+S,E=C.x+O;break;case"se":D=y.width+O,H=y.height+S;break;case"n":H=y.height-S,V=C.y+S;break;case"s":H=y.height+S;break;case"w":D=y.width-O,E=C.x+O;break;case"e":D=y.width+O;break}if(Y&&(F==="nw"||F==="ne"||F==="sw"||F==="se")){const se=y.width/y.height;D/H>se?(D=H*se,(F==="nw"||F==="sw")&&(E=C.x+(y.width-D))):(H=D/se,(F==="nw"||F==="ne")&&(V=C.y+(y.height-H)))}if(B){const se=C.x+y.width/2,N=C.y+y.height/2;E=se-D/2,V=N-H/2}const te=20;return D=Math.max(te,D),H=Math.max(te,H),{size:{width:D,height:H},position:{x:E,y:V}}},R=F=>(F.preventDefault(),F.stopPropagation(),F.stopImmediatePropagation(),!1),U=(F,O)=>{var S;i(!0),document.addEventListener("click",R,{capture:!0}),o(!0),s(F),c({x:O.clientX,y:O.clientY}),u({width:e.element.size.width,height:e.element.size.height}),f({x:e.element.position.x,y:e.element.position.y}),b(e.element.size),j(e.element.position),L(!1),document.addEventListener("mousemove",T),document.addEventListener("mouseup",Z),document.body.style.cursor=((S=A().find(Y=>Y.position===F))==null?void 0:S.cursor)||"default"};let K=0;const T=F=>{if(!n())return;const O=l();if(!O)return;const S=r(),Y=F.clientX-S.x,B=F.clientY-S.y,y=I(O,Y,B,F.shiftKey,F.altKey);b(y.size),j(y.position),L(Math.abs(Y)>2||Math.abs(B)>2);const C=Date.now();if(C-K>50)try{t(e.element.id,{size:y.size,position:y.position}),K=C}catch{}},Z=()=>{if(!n()||!l())return;const O=()=>{document.removeEventListener("click",R,{capture:!0}),i(!1),o(!1),s(null),document.body.style.cursor="default",document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",Z)};if(z()){const S=p(),Y=$();t(e.element.id,{size:S,position:Y}).catch(B=>{t(e.element.id,{size:a(),position:d()}).catch(y=>{})})}O()};return at(()=>{i(!1),document.removeEventListener("click",R,{capture:!0}),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",Z),document.body.style.cursor="default"}),(()=>{var F=ul();return h(F,()=>A().map(O=>(()=>{var S=hl(),Y=S.firstChild,B=Y.nextSibling;return B.addEventListener("mouseleave",y=>{n()||(document.body.style.cursor="default")}),B.addEventListener("mouseenter",y=>{n()||(document.body.style.cursor=O.cursor)}),B.$$mousedown=y=>{y.stopPropagation(),y.preventDefault(),U(O.position,y)},B.style.setProperty("pointer-events","all"),M(y=>{var C=O.x+4,D=O.y+4,H=O.x,E=O.y,V=O.cursor;return C!==y.e&&_(Y,"cx",y.e=C),D!==y.t&&_(Y,"cy",y.t=D),H!==y.a&&_(B,"x",y.a=H),E!==y.o&&_(B,"y",y.o=E),V!==y.i&&((y.i=V)!=null?B.style.setProperty("cursor",V):B.style.removeProperty("cursor")),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),S})())),F})()};me(["mousedown"]);var ve=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(ve||{});const fl={dragThreshold:3,updateThrottle:16};var vl=k("<div tabindex=0>"),yl=k("<div>"),ml=k("<div><div>🎯 修复版交互层</div><div>模式: </div><div>选中: </div><div>光标: "),pl=k("<div>拖拽: <!>个元素"),bl=k("<div>[<!>]");const xl=e=>{const{resizeOperation:t,setResizeOperation:i}=Se(),n=fl;let o;const[l,s]=J(ve.IDLE),[r,c]=J([]),[a,u]=J(null),[d,f]=J(null),[p,b]=J(null),$=(g,m)=>Math.sqrt(Math.pow(g.x-m.x,2)+Math.pow(g.y-m.y,2)),j=(g,m)=>g.length===m.length&&g.every((w,x)=>w===m[x]),z=()=>{b(null)},[L,A]=J(null);let I="default";const R=(g,m)=>{!o||I===g||(o.style.cursor=g,I=g)},U=(g,...m)=>{console.log(`🎯 [InteractionLayer] ${g}`,...m)},K=g=>{if(!o)return{x:0,y:0};const m=o.getBoundingClientRect();return{x:g.clientX-m.left,y:g.clientY-m.top}},T=(g,m)=>g.x>=m.position.x&&g.x<=m.position.x+m.size.width&&g.y>=m.position.y&&g.y<=m.position.y+m.size.height,Z=g=>{var w;const m=F(g);return m.length>0&&(w=m[0])!=null?w:null},F=g=>{const m=e.getAllElements();return m.filter(x=>x&&x.visible&&T(g,x)).sort((x,P)=>{var ee,ne;const X=(ee=x.z_index)!=null?ee:m.indexOf(x);return((ne=P.z_index)!=null?ne:m.indexOf(P))-X})},O=g=>{const m=r();if(m.length===0)return null;const w=e.getAllElements();for(const x of m){const P=w.find(Ce=>Ce.id===x);if(!P||!P.visible)continue;const X=8,G=X/2,ee=P.position.x,ne=P.position.y,q=P.position.x+P.size.width,Pe=P.position.y+P.size.height,pe=P.position.x+P.size.width/2,Ne=P.position.y+P.size.height/2,ln=[{direction:"nw",cursor:"nw-resize",x:ee-G,y:ne-G},{direction:"ne",cursor:"ne-resize",x:q-G,y:ne-G},{direction:"sw",cursor:"sw-resize",x:ee-G,y:Pe-G},{direction:"se",cursor:"se-resize",x:q-G,y:Pe-G},{direction:"n",cursor:"n-resize",x:pe-G,y:ne-G},{direction:"s",cursor:"s-resize",x:pe-G,y:Pe-G},{direction:"w",cursor:"w-resize",x:ee-G,y:Ne-G},{direction:"e",cursor:"e-resize",x:q-G,y:Ne-G}];for(const Ce of ln)if(g.x>=Ce.x&&g.x<Ce.x+X&&g.y>=Ce.y&&g.y<Ce.y+X)return{elementId:P.id,direction:Ce.direction,cursor:Ce.cursor}}return null},S=g=>e.getAllElements().filter(w=>{if(!w.visible)return!1;const x={x:w.position.x,y:w.position.y,width:w.size.width,height:w.size.height};return!(x.x>g.x+g.width||x.x+x.width<g.x||x.y>g.y+g.height||x.y+x.height<g.y)}),Y=(g,m)=>{var x,P,X;const w=F(g);return U("重叠选择检测",{elementsCount:w.length,isCtrlClick:m,elementIds:w.map(G=>G.id)}),w.length===0?null:w.length===1?(z(),((x=w[0])==null?void 0:x.id)||null):m?B(g,w):(z(),U("普通点击选中最上层",{elementId:(P=w[0])==null?void 0:P.id}),((X=w[0])==null?void 0:X.id)||null)},B=(g,m)=>{var X,G,ee,ne;const w=p(),x=Date.now();if(U("循环选择开始",{hasContext:!!w,elementIds:m.map(q=>q.id)}),!w||$(g,w.clickPoint)>5||x-w.lastClickTime>3e3||!j(m.map(q=>q.id),w.overlappingElements.map(q=>q.id))){const q=m.length>1?1:0;return b({clickPoint:g,overlappingElements:m,currentSelectedIndex:q,lastClickTime:x}),U("循环选择重置",{selectedIndex:q,selectedId:(X=m[q])==null?void 0:X.id,reason:w?$(g,w.clickPoint)>5?"position_changed":x-w.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),y(q+1,m.length,g),((G=m[q])==null?void 0:G.id)||null}else{const q=(w.currentSelectedIndex+1)%m.length;return b({...w,currentSelectedIndex:q,lastClickTime:x}),U("循环选择继续",{selectedIndex:q,selectedId:(ee=m[q])==null?void 0:ee.id}),y(q+1,m.length,g),((ne=m[q])==null?void 0:ne.id)||null}},y=(g,m,w)=>{const x=document.querySelector(".overlap-indicator");x!=null&&x.parentNode&&x.parentNode.removeChild(x);const P=document.createElement("div");P.className="overlap-indicator",P.textContent=`${g}/${m}`,Object.assign(P.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${w.x+10}px`,top:`${w.y-20}px`}),document.body.appendChild(P),U("显示重叠指示器",{current:g,total:m,point:w}),setTimeout(()=>{P.parentNode&&(P.parentNode.removeChild(P),U("移除重叠指示器"))},1500)},C=g=>{var w;const m=K(g);if(L()){Zt(m);return}if(l()===ve.DRAGGING){Ye(m);return}if(l()===ve.SELECTING){qe(m);return}if(l()===ve.IDLE&&a()&&!((w=a())!=null&&w.isDragging)){ge(m);return}l()===ve.IDLE&&!a()&&!L()&&D(m)},D=g=>{const m=O(g);if(m){R(m.cursor);return}const w=Z(g);if(w){const P=r().includes(w.id)?"grab":"pointer";R(P);return}R("default")},H=g=>{const m=K(g),w=O(m);if(w){U("点击ResizeHandle",{elementId:w.elementId,direction:w.direction}),E(w,m);return}if(t()){U("调整大小操作进行中，跳过交互处理");return}const x=Y(m,g.ctrlKey);if(U("鼠标按下",{point:m,selectedElementId:x,currentMode:l(),isCtrlClick:g.ctrlKey}),x){const P=e.getAllElements().find(X=>X.id===x);P&&V(P,m,g)}else te(m)},E=(g,m,w)=>{const x=e.getAllElements().find(P=>P.id===g.elementId);x&&(U("开始resize操作",{elementId:g.elementId,direction:g.direction}),i(!0),A({elementId:g.elementId,handlePosition:g.direction,startPoint:m,initialSize:{width:x.size.width,height:x.size.height},initialPosition:{x:x.position.x,y:x.position.y},cursor:g.cursor}),R(g.cursor),U("resize状态已设置",L()))},V=(g,m,w)=>{const x=r().includes(g.id),P=r(),X=!!p();U("元素点击",{elementId:g.id,isSelected:x,currentlySelected:P,ctrlKey:w.ctrlKey,shiftKey:w.shiftKey,hasOverlapContext:X}),w.ctrlKey&&!X?se(g.id):w.shiftKey&&r().length>0?N(g.id):x?(U("点击已选中元素，准备拖拽",{selectedCount:P.length}),he(P,m)):ce(g.id,m)},te=(g,m)=>{var w;U("开始框选",{point:g}),c([]),(w=e.onElementsSelect)==null||w.call(e,[]),z(),s(ve.SELECTING),R("crosshair"),f({startPoint:g,currentPoint:g,selectedIds:[]})},se=g=>{var x;const m=r(),w=m.includes(g)?m.filter(P=>P!==g):[...m,g];U("切换选择",{elementId:g,newSelection:w}),c(w),(x=e.onElementsSelect)==null||x.call(e,w)},N=g=>{var w;const m=r();if(!m.includes(g)){const x=[...m,g];U("添加到选择",{elementId:g,newSelection:x}),c(x),(w=e.onElementsSelect)==null||w.call(e,x)}},ce=(g,m,w)=>{var x;U("选择并准备拖拽",{elementId:g,point:m}),c([g]),(x=e.onElementsSelect)==null||x.call(e,[g]),he([g],m)},he=(g,m,w)=>{U("准备拖拽操作",{elementIds:g,startPoint:m});const x=e.getAllElements(),P=new Map;g.forEach(X=>{const G=x.find(ee=>ee.id===X);G&&P.set(X,{x:G.position.x,y:G.position.y})}),u({elementIds:g,startPoint:m,startPositions:P,currentOffset:{x:0,y:0},isDragging:!1})},ge=g=>{const m=a();if(!m)return;const w=Math.sqrt(Math.pow(g.x-m.startPoint.x,2)+Math.pow(g.y-m.startPoint.y,2));w>n.dragThreshold&&(U("开始拖拽",{distance:w,threshold:n.dragThreshold}),s(ve.DRAGGING),R("grabbing"),u({...m,isDragging:!0}))};let fe=!1,ze=0;const ke=(g,m=!1)=>{if(m){g();return}Date.now()-ze>=n.updateThrottle&&!fe&&(fe=!0,requestAnimationFrame(()=>{g(),fe=!1,ze=Date.now()}))},Ye=g=>{const m=a();if(!m)return;const w={x:g.x-m.startPoint.x,y:g.y-m.startPoint.y};u({...m,currentOffset:w}),ke(()=>{if(e.onBatchUpdatePositions&&m.elementIds.length>1){const x=m.elementIds.map(P=>{const X=m.startPositions.get(P);return X?{element_id:P,new_position:{x:X.x+w.x,y:X.y+w.y}}:null}).filter(Boolean);x.length>0&&e.onBatchUpdatePositions(x).catch(()=>{})}else if(e.onElementMove){const x=m.elementIds.map(P=>{const X=m.startPositions.get(P);if(X)return e.onElementMove(P,{x:X.x+w.x,y:X.y+w.y})}).filter(Boolean);Promise.allSettled(x).catch(()=>{})}})},qe=g=>{const m=d();if(!m)return;const w={...m,currentPoint:g};f(w);const x={x:Math.min(m.startPoint.x,g.x),y:Math.min(m.startPoint.y,g.y),width:Math.abs(g.x-m.startPoint.x),height:Math.abs(g.y-m.startPoint.y)},X=S(x).map(G=>G.id);f({...w,selectedIds:X}),c(X)},Zt=g=>{const m=L();if(!m)return;const w=g.x-m.startPoint.x,x=g.y-m.startPoint.y,P=Jt(m.handlePosition,w,x,m.initialSize,m.initialPosition);ke(()=>{e.onElementResize&&e.onElementResize(m.elementId,P.size,P.position)})},Jt=(g,m,w,x,P)=>{let X=x.width,G=x.height,ee=P.x,ne=P.y;switch(g){case"nw":X=x.width-m,G=x.height-w,ee=P.x+m,ne=P.y+w;break;case"ne":X=x.width+m,G=x.height-w,ne=P.y+w;break;case"sw":X=x.width-m,G=x.height+w,ee=P.x+m;break;case"se":X=x.width+m,G=x.height+w;break;case"n":G=x.height-w,ne=P.y+w;break;case"s":G=x.height+w;break;case"w":X=x.width-m,ee=P.x+m;break;case"e":X=x.width+m;break}const q=10;return X=Math.max(q,X),G=Math.max(q,G),{size:{width:X,height:G},position:{x:ee,y:ne}}},pt=()=>{const g=l();if(U("鼠标释放",{currentMode:g,hasResizeState:!!L()}),L()){tn();return}g===ve.DRAGGING?Qt():g===ve.SELECTING&&en(),nn()},Qt=()=>{const g=a();if(!g||!g.isDragging&&g.currentOffset.x===0&&g.currentOffset.y===0){U("拖拽完成，无实际移动");return}if(e.onBatchUpdatePositions&&g.elementIds.length>1){const m=g.elementIds.map(w=>{const x=g.startPositions.get(w);return x?{element_id:w,new_position:{x:x.x+g.currentOffset.x,y:x.y+g.currentOffset.y}}:null}).filter(Boolean);m.length>0&&(U("拖拽完成 - 批量更新",{elementCount:m.length}),e.onBatchUpdatePositions(m).catch(w=>{console.warn("批量更新最终位置失败:",w)}))}},en=()=>{const g=d();g&&(U("框选完成",{selectedCount:g.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(g.selectedIds))},tn=()=>{const g=L();g&&(U("完成resize操作",{elementId:g.elementId}),i(!1),A(null))},nn=()=>{s(ve.IDLE),R("default"),u(null),f(null),A(null),i(!1),z(),U("状态重置完成")};Re(async()=>{document.addEventListener("mousemove",C),document.addEventListener("mouseup",pt),U("修复版交互层已初始化")}),at(()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",pt),U("修复版交互层已清理")});const Be=()=>{const g=d();if(!g||l()!==ve.SELECTING)return null;const{startPoint:m,currentPoint:w}=g;return{x:Math.min(m.x,w.x),y:Math.min(m.y,w.y),width:Math.abs(w.x-m.x),height:Math.abs(w.y-m.y)}};return(()=>{var g=vl();g.$$mousedown=H;var m=o;return typeof m=="function"?Rt(m,g):o=g,g.style.setProperty("position","absolute"),g.style.setProperty("top","0"),g.style.setProperty("left","0"),g.style.setProperty("width","100%"),g.style.setProperty("height","100%"),g.style.setProperty("z-index","10"),g.style.setProperty("pointer-events","all"),g.style.setProperty("background","transparent"),g.style.setProperty("user-select","none"),h(g,(()=>{var w=le(()=>!!Be());return()=>w()&&(()=>{var x=yl();return x.style.setProperty("position","absolute"),x.style.setProperty("border","1px dashed #007acc"),x.style.setProperty("background","rgba(0, 122, 204, 0.1)"),x.style.setProperty("pointer-events","none"),M(P=>{var X=`${Be().x}px`,G=`${Be().y}px`,ee=`${Be().width}px`,ne=`${Be().height}px`;return X!==P.e&&((P.e=X)!=null?x.style.setProperty("left",X):x.style.removeProperty("left")),G!==P.t&&((P.t=G)!=null?x.style.setProperty("top",G):x.style.removeProperty("top")),ee!==P.a&&((P.a=ee)!=null?x.style.setProperty("width",ee):x.style.removeProperty("width")),ne!==P.o&&((P.o=ne)!=null?x.style.setProperty("height",ne):x.style.removeProperty("height")),P},{e:void 0,t:void 0,a:void 0,o:void 0}),x})()})(),null),h(g,(()=>{var w=le(()=>!!e.enableDebugMode);return()=>w()&&(()=>{var x=ml(),P=x.firstChild,X=P.nextSibling;X.firstChild;var G=X.nextSibling;G.firstChild;var ee=G.nextSibling;return ee.firstChild,x.style.setProperty("position","fixed"),x.style.setProperty("top","10px"),x.style.setProperty("right","10px"),x.style.setProperty("padding","8px"),x.style.setProperty("background","rgba(0, 0, 0, 0.8)"),x.style.setProperty("color","white"),x.style.setProperty("font-family","monospace"),x.style.setProperty("font-size","12px"),x.style.setProperty("border-radius","4px"),x.style.setProperty("z-index","9999"),x.style.setProperty("pointer-events","none"),h(X,l,null),h(G,()=>r().length,null),h(ee,I,null),h(x,(()=>{var ne=le(()=>{var q;return!!((q=a())!=null&&q.isDragging)});return()=>ne()&&(()=>{var q=pl(),Pe=q.firstChild,pe=Pe.nextSibling;return pe.nextSibling,q.style.setProperty("color","#ffeb3b"),h(q,()=>{var Ne;return(Ne=a())==null?void 0:Ne.elementIds.length},pe),q})()})(),null),h(x,(()=>{var ne=le(()=>r().length>0);return()=>ne()&&(()=>{var q=bl(),Pe=q.firstChild,pe=Pe.nextSibling;return pe.nextSibling,q.style.setProperty("font-size","10px"),q.style.setProperty("color","#ccc"),h(q,()=>r().slice(0,3).join(", "),pe),h(q,()=>r().length>3&&"...",pe),q})()})(),null),x})()})(),null),g})()};me(["mousedown"]);var wl=k("<div class=toolbar-section><div class=section-title>智能建议</div><button class=smart-align-button><div class=smart-icon>🎯</div><div class=smart-text></div></button><div class=smart-reason>"),_l=k("<div class=toolbar-status><div class=status-text>选择至少2个元素以使用对齐功能"),$l=k('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>正在执行对齐操作...'),Sl=k('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>对齐</div><div class=button-group><button class="align-button left"title=左对齐><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=水平居中对齐><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=右对齐><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>垂直对齐</div><div class=button-group><button class="align-button top"title=顶部对齐><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=垂直居中对齐><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=底部对齐><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>分布</div><div class=button-group><button class="align-button distribute-h"title=水平均匀分布><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=垂直均匀分布><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const kl=(e,t)=>{if(e.length<2)return[];const i=e.map(n=>({x:n.position.x,y:n.position.y,width:n.size.width,height:n.size.height}));return i.map((n,o)=>{let l=n.x,s=n.y;switch(t){case"left":l=Math.min(...i.map(d=>d.x));break;case"right":l=Math.max(...i.map(d=>d.x+d.width))-n.width;break;case"top":s=Math.min(...i.map(d=>d.y));break;case"bottom":s=Math.max(...i.map(d=>d.y+d.height))-n.height;break;case"h_center":l=i.reduce((d,f)=>d+f.x+f.width/2,0)/i.length-n.width/2;break;case"v_center":s=i.reduce((d,f)=>d+f.y+f.height/2,0)/i.length-n.height/2;break}return{element_id:e[o].id,new_position:{x:l,y:s}}})},Cl=e=>{const{batchUpdatePositions:t,state:i}=Se(),[n,o]=J(!1),l=()=>e.selectedElementIds().length>=2,s=()=>{const u=e.selectedElementIds();return i.elements.filter(d=>u.includes(d.id))},r=async u=>{const d=s();if(d.length<2){console.warn("对齐功能需要至少2个元素");return}try{o(!0),console.log(`🎯 执行${u}对齐:`,d.length,"个元素");const f=kl(d,u);await t(f),console.log("✅ 对齐操作完成"),e.onAlignmentComplete&&e.onAlignmentComplete(f)}catch(f){console.error("❌ 对齐操作失败:",f)}finally{o(!1)}},c=()=>s().length<2?null:{recommended:"left",reason:"建议左对齐",results:[]},a=()=>c();return(()=>{var u=Sl(),d=u.firstChild,f=d.firstChild,p=f.nextSibling,b=p.firstChild,$=b.nextSibling,j=$.nextSibling,z=d.nextSibling,L=z.firstChild,A=L.nextSibling,I=A.firstChild,R=I.nextSibling,U=R.nextSibling,K=z.nextSibling,T=K.firstChild,Z=T.nextSibling,F=Z.firstChild,O=F.nextSibling;return b.$$click=()=>r("left"),$.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"h_center")}),$.$$click=()=>r("h_center"),j.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"right")}),j.$$click=()=>r("right"),I.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"top")}),I.$$click=()=>r("top"),R.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"v_center")}),R.$$click=()=>r("v_center"),U.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"bottom")}),U.$$click=()=>r("bottom"),F.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"distribute_h")}),F.$$click=()=>r("distribute_h"),O.addEventListener("mouseenter",()=>{var S;return(S=e.onAlignmentPreview)==null?void 0:S.call(e,"distribute_v")}),O.$$click=()=>r("distribute_v"),h(u,v(ie,{get when(){return le(()=>!!l())()&&a()},get children(){var S=wl(),Y=S.firstChild,B=Y.nextSibling,y=B.firstChild,C=y.nextSibling,D=B.nextSibling;return B.$$click=()=>r(a().recommended),h(C,()=>a().recommended==="left"&&"左对齐",null),h(C,()=>a().recommended==="right"&&"右对齐",null),h(C,()=>a().recommended==="top"&&"顶对齐",null),h(C,()=>a().recommended==="bottom"&&"底对齐",null),h(C,()=>a().recommended==="h_center"&&"水平居中",null),h(C,()=>a().recommended==="v_center"&&"垂直居中",null),h(D,()=>a().reason),M(H=>{var E=n(),V=a().reason;return E!==H.e&&(B.disabled=H.e=E),V!==H.t&&_(B,"title",H.t=V),H},{e:void 0,t:void 0}),S}}),null),h(u,v(ie,{get when(){return!l()},get children(){var S=_l(),Y=S.firstChild;return Y.firstChild,h(Y,()=>e.selectedElementIds().length<3&&"，至少3个元素以使用分布功能",null),S}}),null),h(u,v(ie,{get when(){return n()},get children(){return $l()}}),null),M(S=>{var Y=!l()||n(),B=!l()||n(),y=!l()||n(),C=!l()||n(),D=!l()||n(),H=!l()||n(),E=e.selectedElementIds().length<3||n(),V=e.selectedElementIds().length<3||n();return Y!==S.e&&(b.disabled=S.e=Y),B!==S.t&&($.disabled=S.t=B),y!==S.a&&(j.disabled=S.a=y),C!==S.o&&(I.disabled=S.o=C),D!==S.i&&(R.disabled=S.i=D),H!==S.n&&(U.disabled=S.n=H),E!==S.s&&(F.disabled=S.s=E),V!==S.h&&(O.disabled=S.h=V),S},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()},El=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=El,document.head.appendChild(e)}me(["click"]);var Al=k("<div>"),zl=k('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),Pl=k("<span class=ml-2>Zoom: <!>%");const Ll=()=>{const{state:e,selectElement:t,clearSelection:i,createElement:n,selectMultiple:o,updateElement:l,batchUpdatePositions:s}=Se();let r;const[c,a]=J([]),u=oe(()=>e.elements.filter(A=>A.visible)),d=(A,I)=>{if(!r)return{x:0,y:0};const R=r.getBoundingClientRect(),U=(A-R.left)/e.canvas_config.zoom,K=(I-R.top)/e.canvas_config.zoom;return{x:U,y:K}},f=async A=>{console.log("🎯 选择元素",A),a([...A]);try{A.length===0?await i():A.length===1?await t(A[0]):await o([...A])}catch(I){console.error("❌ 选择元素失败:",I)}},p=async A=>{try{await s(A)}catch(I){console.error("❌ 批量更新位置失败:",I)}},b=async(A,I)=>{try{await l(A,{position:{x:I.x,y:I.y}})}catch(R){console.error("❌ 移动元素失败:",R)}},$=async(A,I,R)=>{try{await l(A,{size:I,position:R})}catch(U){console.error("❌ 调整大小失败:",U)}},j=async A=>{console.log("🖱️ 画布点击",A)},z=async A=>{var I;A.preventDefault();try{const R=(I=A.dataTransfer)==null?void 0:I.getData("application/json");if(!R)return;const{type:U,component:K}=JSON.parse(R);if(U==="component"){const{x:T,y:Z}=d(A.clientX,A.clientY),F=Math.max(0,T-K.default_size.width/2),O=Math.max(0,Z-K.default_size.height/2);console.log("🎯 通过拖放创建组件:",K.name,"at",F,O);const S=await n(K.id,{x:F,y:O},K.default_size,K.create_content());console.log("✅ 通过拖放创建元素成功:",S),a([S]),await t(S)}}catch(R){console.error("拖放处理失败:",R)}};Re(()=>{a([...e.selected_ids])}),oe(()=>{a([...e.selected_ids])});const L=oe(()=>{const{width:A,height:I}=e.canvas_config;return`0 0 ${A} ${I}`});return(()=>{var A=zl(),I=A.firstChild,R=I.firstChild,U=R.firstChild,K=U.nextSibling,T=K.nextSibling,Z=T.nextSibling,F=Z.nextSibling,O=F.nextSibling,S=O.firstChild,Y=S.nextSibling;Y.nextSibling;var B=I.nextSibling,y=B.firstChild,C=y.firstChild,D=C.firstChild,H=D.firstChild,E=H.nextSibling,V=E.nextSibling,te=V.nextSibling;h(R,()=>e.canvas_config.width,K),h(R,()=>e.canvas_config.height,Z),h(R,(()=>{var N=le(()=>e.canvas_config.zoom!==1);return()=>N()&&(()=>{var ce=Pl(),he=ce.firstChild,ge=he.nextSibling;return ge.nextSibling,h(ce,()=>Math.round(e.canvas_config.zoom*100),ge),ce})()})(),O),h(O,()=>e.elements.length,Y),h(O,()=>c().length,null),C.style.setProperty("position","relative"),D.addEventListener("drop",z),D.addEventListener("dragover",N=>{N.preventDefault(),N.dataTransfer.dropEffect="copy"}),D.$$contextmenu=N=>N.preventDefault();var se=r;return typeof se=="function"?Rt(se,D):r=D,h(D,v(Zi,{get config(){return e.canvas_config}}),E),h(V,v(_e,{get each(){return u()},children:N=>v(dl,{element:N,get selected(){return c().includes(N.id)}})})),h(te,v(_e,{get each(){return u().filter(N=>c().includes(N.id))},children:N=>v(gl,{element:N})})),h(C,v(xl,{canvasRef:r,getAllElements:()=>[...e.elements],onElementsSelect:f,onElementMove:b,onBatchUpdatePositions:p,onElementResize:$,onCanvasClick:j,get enableDebugMode(){return!1}}),null),h(C,v(ie,{get when(){return c().length>=2},get children(){var N=Al();return N.style.setProperty("position","fixed"),N.style.setProperty("top","80px"),N.style.setProperty("right","20px"),N.style.setProperty("z-index","1000"),N.style.setProperty("background","white"),N.style.setProperty("border-radius","8px"),N.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),N.style.setProperty("border","1px solid #e5e7eb"),h(N,v(Cl,{selectedElementIds:c,onAlignmentComplete:ce=>{console.log("✅ 对齐操作完成:",ce)},onAlignmentPreview:ce=>{console.log("👁️ 对齐预览:",ce)},onPreviewCancel:()=>{console.log("❌ 取消对齐预览")}})),N}}),null),M(N=>{var ce=e.canvas_config.width*e.canvas_config.zoom,he=e.canvas_config.height*e.canvas_config.zoom,ge=L(),fe=e.canvas_config.width,ze=e.canvas_config.height,ke=e.canvas_config.background_color,Ye=e.canvas_config.width,qe=e.canvas_config.height;return ce!==N.e&&_(D,"width",N.e=ce),he!==N.t&&_(D,"height",N.t=he),ge!==N.a&&_(D,"viewBox",N.a=ge),fe!==N.o&&_(H,"width",N.o=fe),ze!==N.i&&_(H,"height",N.i=ze),ke!==N.n&&_(H,"fill",N.n=ke),Ye!==N.s&&_(E,"width",N.s=Ye),qe!==N.h&&_(E,"height",N.h=qe),N},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),A})()};me(["contextmenu"]);var Tl=k('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),Ml=k('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Dl=k('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),Ul=k('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Il=k('<div class="text-xs text-gray-500 p-2">暂无元素');const Ol=()=>{const{state:e,createElement:t,selectElement:i,clearSelection:n}=Se(),[o,l]=J(!1),s=[{name:"创建文字元素",action:async()=>{const u=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",u),u}},{name:"创建矩形元素",action:async()=>{const u=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",u),u}},{name:"创建线条元素",action:async()=>{const u=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",u),u}},{name:"创建数据字段",action:async()=>{const u=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",u),u}}],r=async u=>{try{console.log(`🧪 开始测试: ${u.name}`);const d=await u.action();await i(d),console.log(`✅ 测试完成: ${u.name}, 元素ID: ${d}`)}catch(d){console.error(`❌ 测试失败: ${u.name}`,d)}},c=async()=>{console.log("🚀 开始运行所有测试案例..."),await n();for(const u of s)await r(u),await new Promise(d=>setTimeout(d,500));console.log("🎉 所有测试案例运行完成!")},a=async()=>{try{console.log("🧹 清理所有测试元素..."),await n(),console.log("✅ 清理完成")}catch(u){console.error("❌ 清理失败:",u)}};return[(()=>{var u=Tl();return u.$$click=()=>l(!o()),u})(),le(()=>le(()=>!!o())()&&(()=>{var u=Ml(),d=u.firstChild,f=d.firstChild,p=f.nextSibling,b=d.nextSibling,$=b.firstChild,j=$.firstChild,z=j.firstChild,L=z.nextSibling,A=j.nextSibling,I=A.firstChild,R=I.nextSibling,U=A.nextSibling,K=U.firstChild,T=K.nextSibling,Z=U.nextSibling,F=Z.firstChild,O=F.nextSibling,S=b.nextSibling,Y=S.firstChild,B=Y.nextSibling,y=S.nextSibling;y.firstChild;var C=y.nextSibling,D=C.firstChild,H=D.nextSibling;return p.$$click=()=>l(!1),h(L,()=>e.elements.length),h(R,()=>e.selected_ids.length),h(T,()=>e.can_undo?"是":"否"),h(O,()=>e.can_redo?"是":"否"),Y.$$click=c,B.$$click=a,h(y,v(_e,{each:s,children:E=>(()=>{var V=Dl();return V.$$click=()=>r(E),h(V,()=>E.name),V})()}),null),h(H,v(_e,{get each(){return e.elements},children:E=>(()=>{var V=Ul(),te=V.firstChild,se=te.nextSibling,N=se.firstChild,ce=N.nextSibling;ce.nextSibling;var he=se.nextSibling,ge=he.firstChild,fe=ge.nextSibling,ze=fe.nextSibling,ke=ze.nextSibling;return ke.nextSibling,V.$$click=()=>i(E.id),h(te,()=>E.content.type),h(se,()=>E.id.slice(0,8),ce),h(he,()=>Math.round(E.position.x),fe),h(he,()=>Math.round(E.position.y),ke),M(()=>Ee(V,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(E.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),V})()}),null),h(H,(()=>{var E=le(()=>e.elements.length===0);return()=>E()&&Il()})(),null),u})())]};me(["click"]);var Rl=k('<div class=error-message style="margin:10px 0;">'),Fl=k("<div class=data-sources-panel><div class=panel-header><h2>数据源管理 (安全测试版)</h2><button class=close-btn>×</button></div><div class=panel-content><div style=padding:20px;><p></p><div style=margin-top:20px;><button class=add-btn>🧪 测试数据源连接</button></div><div style=margin-top:20px;font-size:12px;color:#666;><p>这是数据源模块的安全测试版本。</p><p>如果测试成功，说明后端连接正常。</p><p>如果测试失败，请检查控制台错误信息。");function Bl(e){const[t,i]=J(null),[n,o]=J("数据源模块正在初始化..."),l=async()=>{try{o("正在测试Tauri连接..."),console.log("🧪 测试Tauri连接...");const{invoke:s}=await Kt(async()=>{const{invoke:c}=await Promise.resolve().then(()=>Ln);return{invoke:c}},void 0);o("正在测试数据源API...");const r=await s("get_available_data_source_types");console.log("✅ 数据源类型获取成功:",r),o(`✅ 测试成功！找到 ${Array.isArray(r)?r.length:0} 种数据源类型`)}catch(s){console.error("❌ 测试失败:",s),i(`测试失败: ${s}`),o("❌ 测试失败，请查看控制台")}};return v(ie,{get when(){return e.isOpen},get children(){var s=Fl(),r=s.firstChild,c=r.firstChild,a=c.nextSibling,u=r.nextSibling,d=u.firstChild,f=d.firstChild,p=f.nextSibling,b=p.firstChild;return Ie(a,"click",e.onClose),h(f,n),h(d,v(ie,{get when(){return t()},get children(){var $=Rl();return h($,t),$}}),p),b.$$click=l,s}})}me(["click"]);var Nl=k('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const Hl=()=>{const[e,t]=J(!1),i=()=>t(!0),n=()=>t(!1);return(()=>{var o=Nl(),l=o.firstChild,s=l.firstChild,r=s.nextSibling,c=r.nextSibling;return h(o,v(On,{onOpenDataSources:i}),l),h(s,v(Bn,{})),h(r,v(Ll,{})),h(c,v(Hi,{})),h(o,v(Ol,{}),null),h(o,v(Bl,{get isOpen(){return e()},onClose:n}),null),o})()},jl={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},Kl=()=>{const{state:e,copySelectedElements:t,pasteElements:i,deleteElements:n,undo:o,redo:l,selectAllElements:s,clearSelection:r,moveElements:c}=Se(),a=(b,$)=>{const j=b.key.toLowerCase()===$.key.toLowerCase()||b.key===$.key,z=!!$.ctrl===(b.ctrlKey||b.metaKey),L=!!$.alt===b.altKey,A=!!$.shift===b.shiftKey;return j&&z&&L&&A},u=async b=>{console.log("🎯 执行快捷键:",b);try{switch(b){case"copy":e.selected_ids.length>0&&(await t(),f("复制成功","✅"));break;case"paste":const $={x:20,y:20},j=await i($.x,$.y);j.length>0&&f(`粘贴 ${j.length} 个元素`,"📋");break;case"cut":e.selected_ids.length>0&&(await t(),await n([...e.selected_ids]),f("剪切成功","✂️"));break;case"delete":if(e.selected_ids.length>0){const z=e.selected_ids.length;await n([...e.selected_ids]),f(`删除 ${z} 个元素`,"🗑️")}break;case"undo":await o(),f("撤销","↶");break;case"redo":await l(),f("重做","↷");break;case"selectAll":await s(),f(`全选 ${e.elements.length} 个元素`,"🎯");break;case"clearSelection":e.selected_ids.length>0&&(r(),f("清除选择","⭕"));break;case"duplicate":if(e.selected_ids.length>0){await t();const z=await i(20,20);f(`复制 ${z.length} 个元素`,"📄")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await d(b);break;default:console.warn("未知的快捷键动作:",b)}}catch($){console.error("快捷键执行失败:",$),f("操作失败","❌")}},d=async b=>{if(e.selected_ids.length===0)return;const $=b.includes("Fast"),j=$?10:1;let z=0,L=0;switch(b){case"moveUp":case"moveFastUp":L=-j;break;case"moveDown":case"moveFastDown":L=j;break;case"moveLeft":case"moveFastLeft":z=-j;break;case"moveRight":case"moveFastRight":z=j;break}(z!==0||L!==0)&&(await c([...e.selected_ids],z,L),$&&f(`快速移动 ${j}px`,"🔄"))},f=(b,$)=>{const j=document.createElement("div");j.className="keyboard-feedback",j.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${$}</span>
        <span class="feedback-text">${b}</span>
      </div>
    `,document.body.appendChild(j),setTimeout(()=>{j.parentNode&&j.parentNode.removeChild(j)},2e3)},p=b=>{const $=b.target;if(!($.tagName==="INPUT"||$.tagName==="TEXTAREA"||$.contentEditable==="true")){for(const[z,L]of Object.entries(jl))if(a(b,L.combination)){b.preventDefault(),b.stopPropagation(),console.log("🎹 快捷键触发:",z,L.action),u(L.action);return}}};return Re(()=>{if(document.addEventListener("keydown",p,!0),console.log("🎹 键盘快捷键管理器已启动"),!document.getElementById("keyboard-feedback-styles")){const b=document.createElement("style");b.id="keyboard-feedback-styles",b.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(b)}}),at(()=>{document.removeEventListener("keydown",p,!0),console.log("🎹 键盘快捷键管理器已停止")}),null},Vl=()=>(Re(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),v(Tn,{get children(){return[v(Kl,{}),v(Hl,{})]}})),Xl=document.getElementById("root");$n(()=>v(Vl,{}),Xl);
