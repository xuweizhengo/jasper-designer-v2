var rn=Object.defineProperty;var on=(e,t,i)=>t in e?rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Ue=(e,t,i)=>on(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();const an=!1,cn=(e,t)=>e===t,Le=Symbol("solid-proxy"),ht=Symbol("solid-track"),Qe={equals:cn};let Pt=Mt;const Pe=1,et=2,zt={owned:null,cleanups:null,context:null,owner:null};var ne=null;let dt=null,dn=null,ae=null,de=null,$e=null,at=0;function Ze(e,t){const i=ae,n=ne,s=e.length===0,l=t===void 0?n:t,r=s?zt:{owned:null,cleanups:null,context:l?l.context:null,owner:l},o=s?e:()=>e(()=>be(()=>Xe(r)));ne=r,ae=null;try{return Be(o,!0)}finally{ae=i,ne=n}}function J(e,t){t=t?Object.assign({},Qe,t):Qe;const i={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=s=>(typeof s=="function"&&(s=s(i.value)),Lt(i,s));return[Tt.bind(i),n]}function I(e,t,i){const n=mt(e,t,!1,Pe);Ye(n)}function un(e,t,i){Pt=mn;const n=mt(e,t,!1,Pe);n.user=!0,$e?$e.push(n):Ye(n)}function re(e,t,i){i=i?Object.assign({},Qe,i):Qe;const n=mt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=i.equals||void 0,Ye(n),Tt.bind(n)}function hn(e){return Be(e,!1)}function be(e){if(ae===null)return e();const t=ae;ae=null;try{return e()}finally{ae=t}}function Me(e){un(()=>be(e))}function ct(e){return ne===null||(ne.cleanups===null?ne.cleanups=[e]:ne.cleanups.push(e)),e}function gt(){return ae}function gn(e,t){const i=Symbol("context");return{id:i,Provider:pn(i),defaultValue:e}}function fn(e){let t;return ne&&ne.context&&(t=ne.context[e.id])!==void 0?t:e.defaultValue}function Dt(e){const t=re(e),i=re(()=>ft(t()));return i.toArray=()=>{const n=i();return Array.isArray(n)?n:n!=null?[n]:[]},i}function Tt(){if(this.sources&&this.state)if(this.state===Pe)Ye(this);else{const e=de;de=null,Be(()=>nt(this),!1),de=e}if(ae){const e=this.observers?this.observers.length:0;ae.sources?(ae.sources.push(this),ae.sourceSlots.push(e)):(ae.sources=[this],ae.sourceSlots=[e]),this.observers?(this.observers.push(ae),this.observerSlots.push(ae.sources.length-1)):(this.observers=[ae],this.observerSlots=[ae.sources.length-1])}return this.value}function Lt(e,t,i){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&Be(()=>{for(let s=0;s<e.observers.length;s+=1){const l=e.observers[s],r=dt&&dt.running;r&&dt.disposed.has(l),(r?!l.tState:!l.state)&&(l.pure?de.push(l):$e.push(l),l.observers&&Ut(l)),r||(l.state=Pe)}if(de.length>1e6)throw de=[],new Error},!1)),t}function Ye(e){if(!e.fn)return;Xe(e);const t=at;vn(e,e.value,t)}function vn(e,t,i){let n;const s=ne,l=ae;ae=ne=e;try{n=e.fn(t)}catch(r){return e.pure&&(e.state=Pe,e.owned&&e.owned.forEach(Xe),e.owned=null),e.updatedAt=i+1,It(r)}finally{ae=l,ne=s}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?Lt(e,n):e.value=n,e.updatedAt=i)}function mt(e,t,i,n=Pe,s){const l={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:ne,context:ne?ne.context:null,pure:i};return ne===null||ne!==zt&&(ne.owned?ne.owned.push(l):ne.owned=[l]),l}function tt(e){if(e.state===0)return;if(e.state===et)return nt(e);if(e.suspense&&be(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<at);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===Pe)Ye(e);else if(e.state===et){const n=de;de=null,Be(()=>nt(e,t[0]),!1),de=n}}function Be(e,t){if(de)return e();let i=!1;t||(de=[]),$e?i=!0:$e=[],at++;try{const n=e();return yn(i),n}catch(n){i||($e=null),de=null,It(n)}}function yn(e){if(de&&(Mt(de),de=null),e)return;const t=$e;$e=null,t.length&&Be(()=>Pt(t),!1)}function Mt(e){for(let t=0;t<e.length;t++)tt(e[t])}function mn(e){let t,i=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[i++]=n:tt(n)}for(t=0;t<i;t++)tt(e[t])}function nt(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const n=e.sources[i];if(n.sources){const s=n.state;s===Pe?n!==t&&(!n.updatedAt||n.updatedAt<at)&&tt(n):s===et&&nt(n,t)}}}function Ut(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=et,i.pure?de.push(i):$e.push(i),i.observers&&Ut(i))}}function Xe(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),n=e.sourceSlots.pop(),s=i.observers;if(s&&s.length){const l=s.pop(),r=i.observerSlots.pop();n<s.length&&(l.sourceSlots[r]=n,s[n]=l,i.observerSlots[n]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Xe(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Xe(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function bn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function It(e,t=ne){throw bn(e)}function ft(e){if(typeof e=="function"&&!e.length)return ft(e());if(Array.isArray(e)){const t=[];for(let i=0;i<e.length;i++){const n=ft(e[i]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function pn(e,t){return function(n){let s;return I(()=>s=be(()=>(ne.context={...ne.context,[e]:n.value},Dt(()=>n.children))),void 0),s}}const xn=Symbol("fallback");function pt(e){for(let t=0;t<e.length;t++)e[t]()}function wn(e,t,i={}){let n=[],s=[],l=[],r=0,o=t.length>1?[]:null;return ct(()=>pt(l)),()=>{let d=e()||[],a=d.length,u,c;return d[ht],be(()=>{let y,b,x,O,P,z,A,R,B;if(a===0)r!==0&&(pt(l),l=[],n=[],s=[],r=0,o&&(o=[])),i.fallback&&(n=[xn],s[0]=Ze(k=>(l[0]=k,i.fallback())),r=1);else if(r===0){for(s=new Array(a),c=0;c<a;c++)n[c]=d[c],s[c]=Ze(g);r=a}else{for(x=new Array(a),O=new Array(a),o&&(P=new Array(a)),z=0,A=Math.min(r,a);z<A&&n[z]===d[z];z++);for(A=r-1,R=a-1;A>=z&&R>=z&&n[A]===d[R];A--,R--)x[R]=s[A],O[R]=l[A],o&&(P[R]=o[A]);for(y=new Map,b=new Array(R+1),c=R;c>=z;c--)B=d[c],u=y.get(B),b[c]=u===void 0?-1:u,y.set(B,c);for(u=z;u<=A;u++)B=n[u],c=y.get(B),c!==void 0&&c!==-1?(x[c]=s[u],O[c]=l[u],o&&(P[c]=o[u]),c=b[c],y.set(B,c)):l[u]();for(c=z;c<a;c++)c in x?(s[c]=x[c],l[c]=O[c],o&&(o[c]=P[c],o[c](c))):s[c]=Ze(g);s=s.slice(0,r=a),n=d.slice(0)}return s});function g(y){if(l[c]=y,o){const[b,x]=J(c);return o[c]=x,t(d[c],b)}return t(d[c])}}}function f(e,t){return be(()=>e(t||{}))}const Ot=e=>`Stale read from <${e}>.`;function ge(e){const t="fallback"in e&&{fallback:()=>e.fallback};return re(wn(()=>e.each,e.children,t||void 0))}function ee(e){const t=e.keyed,i=re(()=>e.when,void 0,void 0),n=t?i:re(i,void 0,{equals:(s,l)=>!s==!l});return re(()=>{const s=n();if(s){const l=e.children;return typeof l=="function"&&l.length>0?be(()=>l(t?s:()=>{if(!be(n))throw Ot("Show");return i()})):l}return e.fallback},void 0,void 0)}function _n(e){const t=Dt(()=>e.children),i=re(()=>{const n=t(),s=Array.isArray(n)?n:[n];let l=()=>{};for(let r=0;r<s.length;r++){const o=r,d=s[r],a=l,u=re(()=>a()?void 0:d.when,void 0,void 0),c=d.keyed?u:re(u,void 0,{equals:(g,y)=>!g==!y});l=()=>a()||(c()?[o,u,d]:void 0)}return l});return re(()=>{const n=i()();if(!n)return e.fallback;const[s,l,r]=n,o=r.children;return typeof o=="function"&&o.length>0?be(()=>o(r.keyed?l():()=>{var a;if(((a=be(i)())==null?void 0:a[0])!==s)throw Ot("Match");return l()})):o},void 0,void 0)}function je(e){return e}const te=e=>re(()=>e());function $n(e,t,i){let n=i.length,s=t.length,l=n,r=0,o=0,d=t[s-1].nextSibling,a=null;for(;r<s||o<l;){if(t[r]===i[o]){r++,o++;continue}for(;t[s-1]===i[l-1];)s--,l--;if(s===r){const u=l<n?o?i[o-1].nextSibling:i[l-o]:d;for(;o<l;)e.insertBefore(i[o++],u)}else if(l===o)for(;r<s;)(!a||!a.has(t[r]))&&t[r].remove(),r++;else if(t[r]===i[l-1]&&i[o]===t[s-1]){const u=t[--s].nextSibling;e.insertBefore(i[o++],t[r++].nextSibling),e.insertBefore(i[--l],u),t[s]=i[l]}else{if(!a){a=new Map;let c=o;for(;c<l;)a.set(i[c],c++)}const u=a.get(t[r]);if(u!=null)if(o<u&&u<l){let c=r,g=1,y;for(;++c<s&&c<l&&!((y=a.get(t[c]))==null||y!==u+g);)g++;if(g>u-o){const b=t[r];for(;o<u;)e.insertBefore(i[o++],b)}else e.replaceChild(i[o++],t[r++])}else r++;else t[r++].remove()}}}const xt="_$DX_DELEGATE";function Sn(e,t,i,n={}){let s;return Ze(l=>{s=l,t===document?e():h(t,e(),t.firstChild?null:void 0,i)},n.owner),()=>{s(),t.textContent=""}}function _(e,t,i,n){let s;const l=()=>{const o=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return o.innerHTML=e,i?o.content.firstChild.firstChild:n?o.firstChild:o.content.firstChild},r=t?()=>be(()=>document.importNode(s||(s=l()),!0)):()=>(s||(s=l())).cloneNode(!0);return r.cloneNode=r,r}function pe(e,t=window.document){const i=t[xt]||(t[xt]=new Set);for(let n=0,s=e.length;n<s;n++){const l=e[n];i.has(l)||(i.add(l),t.addEventListener(l,Cn))}}function S(e,t,i){i==null?e.removeAttribute(t):e.setAttribute(t,i)}function Ae(e,t){t==null?e.removeAttribute("class"):e.className=t}function fe(e,t,i,n){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function Rt(e,t,i){if(!t)return i?S(e,"style"):t;const n=e.style;if(typeof t=="string")return n.cssText=t;typeof i=="string"&&(n.cssText=i=void 0),i||(i={}),t||(t={});let s,l;for(l in i)t[l]==null&&n.removeProperty(l),delete i[l];for(l in t)s=t[l],s!==i[l]&&(n.setProperty(l,s),i[l]=s);return i}function Ft(e,t,i){return be(()=>e(t,i))}function h(e,t,i,n){if(i!==void 0&&!n&&(n=[]),typeof t!="function")return it(e,t,n,i);I(s=>it(e,t(),s,i),n)}function Cn(e){let t=e.target;const i=`$$${e.type}`,n=e.target,s=e.currentTarget,l=d=>Object.defineProperty(e,"target",{configurable:!0,value:d}),r=()=>{const d=t[i];if(d&&!t.disabled){const a=t[`${i}Data`];if(a!==void 0?d.call(t,a,e):d.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},o=()=>{for(;r()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const d=e.composedPath();l(d[0]);for(let a=0;a<d.length-2&&(t=d[a],!!r());a++){if(t._$host){t=t._$host,o();break}if(t.parentNode===s)break}}else o();l(n)}function it(e,t,i,n,s){for(;typeof i=="function";)i=i();if(t===i)return i;const l=typeof t,r=n!==void 0;if(e=r&&i[0]&&i[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===i))return i;if(r){let o=i[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),i=Ie(e,i,n,o)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||l==="boolean")i=Ie(e,i,n);else{if(l==="function")return I(()=>{let o=t();for(;typeof o=="function";)o=o();i=it(e,o,i,n)}),()=>i;if(Array.isArray(t)){const o=[],d=i&&Array.isArray(i);if(vt(o,t,i,s))return I(()=>i=it(e,o,i,n,!0)),()=>i;if(o.length===0){if(i=Ie(e,i,n),r)return i}else d?i.length===0?wt(e,o,n):$n(e,i,o):(i&&Ie(e),wt(e,o));i=o}else if(t.nodeType){if(Array.isArray(i)){if(r)return i=Ie(e,i,n,t);Ie(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function vt(e,t,i,n){let s=!1;for(let l=0,r=t.length;l<r;l++){let o=t[l],d=i&&i[e.length],a;if(!(o==null||o===!0||o===!1))if((a=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))s=vt(e,o,d)||s;else if(a==="function")if(n){for(;typeof o=="function";)o=o();s=vt(e,Array.isArray(o)?o:[o],Array.isArray(d)?d:[d])||s}else e.push(o),s=!0;else{const u=String(o);d&&d.nodeType===3&&d.data===u?e.push(d):e.push(document.createTextNode(u))}}return s}function wt(e,t,i=null){for(let n=0,s=t.length;n<s;n++)e.insertBefore(t[n],i)}function Ie(e,t,i,n){if(i===void 0)return e.textContent="";const s=n||document.createTextNode("");if(t.length){let l=!1;for(let r=t.length-1;r>=0;r--){const o=t[r];if(s!==o){const d=o.parentNode===e;!l&&!r?d?e.replaceChild(s,o):e.insertBefore(s,i):d&&o.remove()}else l=!0}}else e.insertBefore(s,i);return[s]}const yt=Symbol("store-raw"),Fe=Symbol("store-node"),we=Symbol("store-has"),Bt=Symbol("store-self");function Nt(e){let t=e[Le];if(!t&&(Object.defineProperty(e,Le,{value:t=new Proxy(e,An)}),!Array.isArray(e))){const i=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let s=0,l=i.length;s<l;s++){const r=i[s];n[r].get&&Object.defineProperty(e,r,{enumerable:n[r].enumerable,get:n[r].get.bind(t)})}}return t}function lt(e){let t;return e!=null&&typeof e=="object"&&(e[Le]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ge(e,t=new Set){let i,n,s,l;if(i=e!=null&&e[yt])return i;if(!lt(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let r=0,o=e.length;r<o;r++)s=e[r],(n=Ge(s,t))!==s&&(e[r]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const r=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let d=0,a=r.length;d<a;d++)l=r[d],!o[l].get&&(s=e[l],(n=Ge(s,t))!==s&&(e[l]=n))}return e}function st(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function We(e,t,i){if(e[t])return e[t];const[n,s]=J(i,{equals:!1,internal:!0});return n.$=s,e[t]=n}function kn(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return!i||i.get||!i.configurable||t===Le||t===Fe||(delete i.value,delete i.writable,i.get=()=>e[Le][t]),i}function Ht(e){gt()&&We(st(e,Fe),Bt)()}function En(e){return Ht(e),Reflect.ownKeys(e)}const An={get(e,t,i){if(t===yt)return e;if(t===Le)return i;if(t===ht)return Ht(e),i;const n=st(e,Fe),s=n[t];let l=s?s():e[t];if(t===Fe||t===we||t==="__proto__")return l;if(!s){const r=Object.getOwnPropertyDescriptor(e,t);gt()&&(typeof l!="function"||e.hasOwnProperty(t))&&!(r&&r.get)&&(l=We(n,t,l)())}return lt(l)?Nt(l):l},has(e,t){return t===yt||t===Le||t===ht||t===Fe||t===we||t==="__proto__"?!0:(gt()&&We(st(e,we),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:En,getOwnPropertyDescriptor:kn};function rt(e,t,i,n=!1){if(!n&&e[t]===i)return;const s=e[t],l=e.length;i===void 0?(delete e[t],e[we]&&e[we][t]&&s!==void 0&&e[we][t].$()):(e[t]=i,e[we]&&e[we][t]&&s===void 0&&e[we][t].$());let r=st(e,Fe),o;if((o=We(r,t,s))&&o.$(()=>i),Array.isArray(e)&&e.length!==l){for(let d=e.length;d<l;d++)(o=r[d])&&o.$();(o=We(r,"length",l))&&o.$(e.length)}(o=r[Bt])&&o.$()}function jt(e,t){const i=Object.keys(t);for(let n=0;n<i.length;n+=1){const s=i[n];rt(e,s,t[s])}}function Pn(e,t){if(typeof t=="function"&&(t=t(e)),t=Ge(t),Array.isArray(t)){if(e===t)return;let i=0,n=t.length;for(;i<n;i++){const s=t[i];e[i]!==s&&rt(e,i,s)}rt(e,"length",n)}else jt(e,t)}function Ve(e,t,i=[]){let n,s=e;if(t.length>1){n=t.shift();const r=typeof n,o=Array.isArray(e);if(Array.isArray(n)){for(let d=0;d<n.length;d++)Ve(e,[n[d]].concat(t),i);return}else if(o&&r==="function"){for(let d=0;d<e.length;d++)n(e[d],d)&&Ve(e,[d].concat(t),i);return}else if(o&&r==="object"){const{from:d=0,to:a=e.length-1,by:u=1}=n;for(let c=d;c<=a;c+=u)Ve(e,[c].concat(t),i);return}else if(t.length>1){Ve(e[n],t,[n].concat(i));return}s=e[n],i=[n].concat(i)}let l=t[0];typeof l=="function"&&(l=l(s,i),l===s)||n===void 0&&l==null||(l=Ge(l),n===void 0||lt(s)&&lt(l)&&!Array.isArray(l)?jt(s,l):rt(e,n,l))}function zn(...[e,t]){const i=Ge(e||{}),n=Array.isArray(i),s=Nt(i);function l(...r){hn(()=>{n&&r.length===1?Pn(i,r[0]):Ve(i,r)})}return[s,l]}function Dn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function _t(e,t=!1){const i=Dn(),n=`_${i}`;return Object.defineProperty(window,n,{value:s=>(t&&Reflect.deleteProperty(window,n),e==null?void 0:e(s)),writable:!1,configurable:!0}),i}async function Q(e,t={}){return new Promise((i,n)=>{const s=_t(r=>{i(r),Reflect.deleteProperty(window,`_${l}`)},!0),l=_t(r=>{n(r),Reflect.deleteProperty(window,`_${s}`)},!0);window.__TAURI_IPC__({cmd:e,callback:s,error:l,...t})})}const Kt=gn(),Tn=e=>{const[t,i]=zn({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[n,s]=J(!1),[l,r]=J(null),[o,d]=J(!1),a=async()=>{try{s(!0),console.log("🔄 Loading app state...");const m=await Q("get_app_state");console.log("🔄 App state loaded, selected_ids:",m.selected_ids),i(m)}catch(m){console.error("Failed to load app state:",m)}finally{s(!1)}};Me(()=>{a()});const u=async(m,E,F,j={})=>{try{s(!0);const D=await Q("create_element",{request:{element_type:m,position:E,size:F,content_data:j}});return await a(),D}catch(D){throw console.error("Failed to create element:",D),D}finally{s(!1)}},c=async(m,E)=>{try{s(!0),await Q("update_element",{request:{id:m,updates:E}}),await a()}catch(F){throw console.error("Failed to update element:",F),F}finally{s(!1)}},g=async m=>{try{s(!0),await Q("batch_update_positions",{request:{updates:m}}),i(E=>{const F=E.elements.map(j=>{const D=m.find(X=>X.element_id===j.id);return D?{...j,position:D.new_position}:j});return{...E,elements:F,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(E){throw console.error("Failed to batch update positions:",E),await a(),E}finally{s(!1)}},y=async m=>{try{s(!0),await Q("delete_element",{elementId:m}),await a()}catch(E){throw console.error("Failed to delete element:",E),E}finally{s(!1)}},b=async m=>{try{console.log("Selecting element:",m),await Q("select_element",{elementId:m}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(E){throw console.error("Failed to select element:",E),E}},x=async m=>{try{console.log("Selecting multiple elements:",m),m.length>0?(await Q("select_multiple",{elementIds:m}),console.log("✅ Multi-select completed for:",m.length,"elements")):await Q("clear_selection"),await a()}catch(E){throw console.error("Failed to select multiple elements:",E),E}},O=async m=>{try{console.log("Adding to selection:",m),await Q("add_to_selection",{elementId:m}),await a()}catch(E){throw console.error("Failed to add to selection:",E),E}},P=async m=>{try{console.log("Removing from selection:",m),await Q("remove_from_selection",{elementId:m}),await a()}catch(E){throw console.error("Failed to remove from selection:",E),E}},z=async m=>{try{console.log("Toggling selection:",m),await Q("toggle_selection",{elementId:m}),await a()}catch(E){throw console.error("Failed to toggle selection:",E),E}},A=async()=>{try{await Q("clear_selection"),await a()}catch(m){throw console.error("Failed to clear selection:",m),m}},R=async()=>{try{await Q("copy_selected")}catch(m){throw console.error("Failed to copy selected elements:",m),m}},H={state:t,createElement:u,updateElement:c,batchUpdatePositions:g,deleteElement:y,selectElement:b,selectMultiple:x,addToSelection:O,removeFromSelection:P,toggleSelection:z,clearSelection:A,copySelected:R,copySelectedElements:async()=>R(),pasteElements:async(m,E)=>{try{s(!0);const F=await Q("paste_elements",{offsetX:m,offsetY:E});return await a(),F}catch(F){throw console.error("Failed to paste elements:",F),F}finally{s(!1)}},deleteElements:async m=>{try{s(!0);for(const E of m)await Q("delete_element",{elementId:E});await a()}catch(E){throw console.error("Failed to delete elements:",E),E}finally{s(!1)}},selectAllElements:async()=>{try{const m=t.elements.map(E=>E.id);await x(m)}catch(m){throw console.error("Failed to select all elements:",m),m}},moveElements:async(m,E,F)=>{try{s(!0);const j=t.elements.filter(D=>m.includes(D.id)).map(D=>({element_id:D.id,new_position:{x:D.position.x+E,y:D.position.y+F}}));j.length>0&&await g(j)}catch(j){throw console.error("Failed to move elements:",j),j}finally{s(!1)}},undo:async()=>{try{s(!0),await Q("undo"),await a()}catch(m){throw console.error("Failed to undo:",m),m}finally{s(!1)}},redo:async()=>{try{s(!0),await Q("redo"),await a()}catch(m){throw console.error("Failed to redo:",m),m}finally{s(!1)}},updateCanvasConfig:async m=>{try{s(!0),await Q("update_canvas_config",{request:m}),await a()}catch(E){throw console.error("Failed to update canvas config:",E),E}finally{s(!1)}},getElementsAtPoint:async(m,E)=>{try{return await Q("get_elements_at_point",{x:m,y:E})}catch(F){return console.error("Failed to get elements at point:",F),[]}},isLoading:n,setLoading:s,dragOperation:l,setDragOperation:r,resizeOperation:o,setResizeOperation:d};return f(Kt.Provider,{value:H,get children(){return e.children}})},Ce=()=>{const e=fn(Kt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var Ln=_("<span class=text-warning>●"),Mn=_("<span class=ml-2> 个元素"),Un=_('<span class="ml-2 text-primary">已选择 <!> 个'),In=_('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button><button class=toolbar-btn title=数据源管理><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg><span>数据源</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const On=e=>{const{state:t,undo:i,redo:n,updateCanvasConfig:s}=Ce(),[l,r]=J(t.canvas_config.zoom*100),o=async y=>{const b=y/100;r(y);try{await s({zoom:b})}catch(x){console.error("Failed to update zoom:",x)}},d=()=>{const y=Math.min(l()+25,500);o(y)},a=()=>{const y=Math.max(l()-25,25);o(y)},u=async()=>{try{await s({show_grid:!t.canvas_config.show_grid})}catch(y){console.error("Failed to toggle grid:",y)}},c=async()=>{try{await s({show_rulers:!t.canvas_config.show_rulers})}catch(y){console.error("Failed to toggle rulers:",y)}},g=async()=>{try{await Q("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(y){console.error("Failed to toggle DevTools:",y)}};return(()=>{var y=In(),b=y.firstChild,x=b.firstChild,O=x.nextSibling,P=O.nextSibling,z=P.nextSibling,A=z.nextSibling,R=A.nextSibling,B=b.nextSibling,k=B.firstChild,N=k.nextSibling,U=N.nextSibling,Y=U.nextSibling,T=Y.nextSibling,L=T.nextSibling,$=L.nextSibling,V=$.nextSibling,H=V.nextSibling,m=H.nextSibling,E=m.nextSibling,F=B.nextSibling,j=F.firstChild;return fe(R,"click",e.onOpenDataSources),fe(k,"click",i),fe(N,"click",n),Y.$$click=a,T.addEventListener("change",D=>{const X=D.target.value;if(X==="fit")console.log("Fit to window");else{const le=parseInt(X.replace("%",""));o(le)}}),L.$$click=d,V.$$click=u,H.$$click=c,E.$$click=g,h(F,f(ee,{get when(){return t.dirty},get children(){return Ln()}}),j),h(j,()=>t.template_name||"未命名模板"),h(F,f(ee,{get when(){return t.elements.length>0},get children(){var D=Mn(),X=D.firstChild;return h(D,()=>t.elements.length,X),D}}),null),h(F,f(ee,{get when(){return t.selected_ids.length>0},get children(){var D=Un(),X=D.firstChild,le=X.nextSibling;return le.nextSibling,h(D,()=>t.selected_ids.length,le),D}}),null),I(D=>{var X=`toolbar-btn-icon ${t.can_undo?"":"opacity-50 cursor-not-allowed"}`,le=!t.can_undo,oe=`撤销${t.undo_description?` (${t.undo_description})`:""} (Ctrl+Z)`,K=`toolbar-btn-icon ${t.can_redo?"":"opacity-50 cursor-not-allowed"}`,ce=!t.can_redo,he=`重做${t.redo_description?` (${t.redo_description})`:""} (Ctrl+Y)`,ve=`toolbar-btn-icon ${t.canvas_config.show_grid?"active":""}`,ye=`toolbar-btn-icon ${t.canvas_config.show_rulers?"active":""}`;return X!==D.e&&Ae(k,D.e=X),le!==D.t&&(k.disabled=D.t=le),oe!==D.a&&S(k,"title",D.a=oe),K!==D.o&&Ae(N,D.o=K),ce!==D.i&&(N.disabled=D.i=ce),he!==D.n&&S(N,"title",D.n=he),ve!==D.s&&Ae(V,D.s=ve),ye!==D.h&&Ae(H,D.h=ye),D},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),I(()=>T.value=`${Math.round(l())}%`),y})()};pe(["click"]);var Rn=_('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),Fn=_('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const Bn=()=>{const{createElement:e}=Ce(),[t,i]=J(""),n=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"图片"})}],s=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],l=[...n,...s],r=()=>{const a=t().toLowerCase();return a?l.filter(u=>u.name.toLowerCase().includes(a)||u.description.toLowerCase().includes(a)):l},o=(a,u)=>{if(console.log("Starting drag for component:",a.id),u.dataTransfer){u.dataTransfer.effectAllowed="copy",u.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const c=document.createElement("div");c.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,c.style.position="absolute",c.style.top="-1000px",document.body.appendChild(c),u.dataTransfer.setDragImage(c,50,20),setTimeout(()=>{document.body.removeChild(c)},0)}},d=async a=>{try{const u=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",u)}catch(u){console.error("Failed to create element:",u)}};return(()=>{var a=Rn(),u=a.firstChild,c=u.firstChild,g=c.nextSibling,y=u.nextSibling,b=y.firstChild,x=b.firstChild,O=x.firstChild,P=O.nextSibling,z=x.nextSibling,A=z.firstChild,R=A.nextSibling,B=z.nextSibling,k=B.firstChild,N=k.nextSibling;return g.$$input=U=>i(U.target.value),h(P,f(ge,{get each(){return r().filter(U=>U.category==="basic")},children:U=>f(ut,{component:U,onDrag:Y=>o(U,Y),onClick:()=>d(U)})})),h(R,f(ge,{get each(){return r().filter(U=>U.category==="data")},children:U=>f(ut,{component:U,onDrag:Y=>o(U,Y),onClick:()=>d(U)})})),h(N,f(ge,{get each(){return r().filter(U=>U.category==="bank")},children:U=>f(ut,{component:U,onDrag:Y=>o(U,Y),onClick:()=>d(U)})})),I(()=>g.value=t()),a})()},ut=e=>(()=>{var t=Fn(),i=t.firstChild,n=i.firstChild,s=n.nextSibling;return fe(t,"click",e.onClick),t.addEventListener("dragstart",l=>e.onDrag(l)),S(t,"draggable",!0),h(n,()=>e.component.icon),h(s,()=>e.component.name),I(()=>S(t,"title",e.component.description)),t})();pe(["input","click"]);const Nn="modulepreload",Hn=function(e){return"/"+e},$t={},jn=function(t,i,n){let s=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(i.map(d=>{if(d=Hn(d),d in $t)return;$t[d]=!0;const a=d.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":Nn,a||(c.as="script"),c.crossOrigin="",c.href=d,o&&c.setAttribute("nonce",o),document.head.appendChild(c),a)return new Promise((g,y)=>{c.addEventListener("load",g),c.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return s.then(r=>{for(const o of r||[])o.status==="rejected"&&l(o.reason);return t().catch(l)})};class Kn{constructor(){Ue(this,"styles",new Map);Ue(this,"elementStyleMap",new Map);Ue(this,"observers",new Set);Ue(this,"initialized",!1);console.log("🎨 TextStyleManager 初始化中...")}async initialize(){if(!this.initialized)try{await this.loadSystemStyles(),await this.loadUserStyles(),this.initialized=!0,console.log(`✅ TextStyleManager 初始化完成，加载了 ${this.styles.size} 个样式`)}catch(t){throw console.error("❌ TextStyleManager 初始化失败:",t),t}}createStyle(t){const i=`style_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={...t,id:i,metadata:{createdAt:new Date,lastModified:new Date,author:"user",usageCount:0,isSystemStyle:!1,tags:[]}};return this.styles.set(i,n),this.notifyObservers("style-created",i),this.saveUserStyles(),console.log(`🎨 创建新样式: ${n.name} (${i})`),i}getStyle(t){return this.styles.get(t)||null}updateStyle(t,i){const n=this.styles.get(t);if(!n)return console.warn(`⚠️ 样式 ${t} 不存在`),!1;if(n.metadata.isSystemStyle)return console.warn(`⚠️ 无法修改系统预设样式 ${t}`),!1;const s={...n,style:{...n.style,...i},metadata:{...n.metadata,lastModified:new Date}};return this.styles.set(t,s),this.syncAllStyleInstances(t),this.saveUserStyles(),this.notifyObservers("style-updated",t),console.log(`🔄 样式已更新: ${n.name} (${t})`),!0}deleteStyle(t){const i=this.styles.get(t);if(!i)return!1;if(i.metadata.isSystemStyle)return console.warn(`⚠️ 无法删除系统预设样式 ${t}`),!1;const n=Array.from(this.elementStyleMap.entries()).filter(([s,l])=>l===t).map(([s,l])=>s);return n.length>0?(console.warn(`⚠️ 无法删除样式 ${t}，仍有 ${n.length} 个元素在使用`),!1):(this.styles.delete(t),this.saveUserStyles(),this.notifyObservers("style-deleted",t),console.log(`🗑️ 样式已删除: ${i.name} (${t})`),!0)}applyStyleToElement(t,i){const n=this.styles.get(i);if(!n)return{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:`样式 ${i} 不存在`};try{const s=this.elementStyleMap.get(t);if(this.elementStyleMap.set(t,i),n.metadata.usageCount++,s&&s!==i){const l=this.styles.get(s);l&&(l.metadata.usageCount=Math.max(0,l.metadata.usageCount-1))}return this.applyStyleToDOM(t,n.style),this.notifyObservers("style-applied",{elementId:t,styleId:i}),console.log(`🎯 应用样式: ${n.name} → 元素 ${t}`),{success:!0,elementId:t,styleId:i,appliedAt:new Date}}catch(s){return console.error(`❌ 应用样式失败: ${s}`),{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:s instanceof Error?s.message:String(s)}}}getElementStyleId(t){return this.elementStyleMap.get(t)||null}removeElementStyle(t){const i=this.elementStyleMap.get(t);if(i){this.elementStyleMap.delete(t);const n=this.styles.get(i);n&&(n.metadata.usageCount=Math.max(0,n.metadata.usageCount-1)),console.log(`🔗 移除元素样式映射: 元素 ${t}`)}}getStylesByCategory(t){const i=Array.from(this.styles.values());return(t?i.filter(s=>s.category===t):i).sort((s,l)=>s.metadata.isSystemStyle!==l.metadata.isSystemStyle?s.metadata.isSystemStyle?-1:1:l.metadata.usageCount-s.metadata.usageCount)}searchStyles(t,i){const n=this.getStylesByCategory(i),s=t.toLowerCase().trim();return s?n.filter(l=>l.name.toLowerCase().includes(s)||l.description.toLowerCase().includes(s)||l.metadata.tags.some(r=>r.toLowerCase().includes(s))):n}getStyleUsageStats(){const t=[];for(const[i,n]of this.styles){const s=Array.from(this.elementStyleMap.entries()).filter(([l,r])=>r===i).map(([l,r])=>l);t.push({styleId:i,usageCount:s.length,elements:s,lastUsed:n.metadata.lastModified})}return t.sort((i,n)=>n.usageCount-i.usageCount)}cleanupUnusedStyles(){const t=new Set(this.elementStyleMap.values()),i=[];for(const[n,s]of this.styles)!t.has(n)&&!s.metadata.isSystemStyle&&(this.styles.delete(n),i.push(n),console.log(`🧹 清理未使用样式: ${s.name} (${n})`));return i.length>0&&this.saveUserStyles(),i}exportStyles(t){const i=t?t.map(s=>this.styles.get(s)).filter(Boolean):Array.from(this.styles.values()),n=new Set(i.map(s=>s.category));return{version:"2.0.0",exportedAt:new Date,styles:i,metadata:{totalStyles:i.length,categories:Array.from(n),author:"user"}}}async importStyles(t){const i=[];for(const n of t.styles){if(Array.from(this.styles.values()).find(r=>r.name===n.name&&r.category===n.category)){console.warn(`⚠️ 跳过已存在的样式: ${n.name}`);continue}const l=this.createStyle({name:n.name,description:n.description,category:n.category,style:n.style,...n.inheritance&&{inheritance:n.inheritance}});i.push(l)}return console.log(`📦 导入完成，共导入 ${i.length} 个样式`),i}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}syncAllStyleInstances(t){const i=this.styles.get(t);if(!i)return;const n=[];for(const[s,l]of this.elementStyleMap)l===t&&(this.applyStyleToDOM(s,i.style),n.push(s));this.notifyObservers("styles-synced",{styleId:t,affectedElements:n}),console.log(`🔄 样式同步完成: ${t} → ${n.length} 个元素`)}applyStyleToDOM(t,i){console.log(`🎨 应用样式到DOM: 元素 ${t}`,{font_family:i.font_family,font_size:i.font_size,typography:i.typography})}async loadSystemStyles(){try{const{BANK_TEXT_STYLES:t}=await jn(async()=>{const{BANK_TEXT_STYLES:i}=await import("./bank-text-styles-BtzE7aIi.js");return{BANK_TEXT_STYLES:i}},[]);for(const i of t)this.styles.set(i.id,i);console.log(`🏦 加载了 ${t.length} 个银行预设样式`)}catch(t){console.warn("⚠️ 加载系统样式失败:",t)}}async loadUserStyles(){try{const t=localStorage.getItem("jasper-text-styles");if(t){const i=JSON.parse(t);for(const n of i)n.metadata.createdAt=new Date(n.metadata.createdAt),n.metadata.lastModified=new Date(n.metadata.lastModified),this.styles.set(n.id,n);console.log(`👤 加载了 ${i.length} 个用户自定义样式`)}}catch(t){console.warn("⚠️ 加载用户样式失败:",t)}}saveUserStyles(){try{const t=Array.from(this.styles.values()).filter(i=>!i.metadata.isSystemStyle);localStorage.setItem("jasper-text-styles",JSON.stringify(t)),console.log(`💾 保存了 ${t.length} 个用户自定义样式`)}catch(t){console.error("❌ 保存用户样式失败:",t)}}notifyObservers(t,i){for(const n of this.observers)try{n.onStyleChange(t,i)}catch(s){console.error("❌ 观察者通知失败:",s)}}}const ue=new Kn;class Vn{calculateUnifiedBounds(t,i,n){const s=this.calculateFontMetrics(i),l=this.measureTextContent(t,i,n.width),r=this.calculateContainerHeight(l,s,n.height),o=this.calculateTextPositioning(i,n,r,s),d={containerBounds:{x:0,y:0,width:n.width,height:r},contentBounds:l.bounds,fontMetrics:s,positioning:o};return l.wrappedLines&&(d.textLayout={wrappedLines:l.wrappedLines,isWrapped:!0,originalLineCount:t.split(`
`).length,wrappedLineCount:l.wrappedLines.length}),d}calculateFontMetrics(t){const i=t.font_size,n=1.2,s=.75,l=.25,r=i*s,o=i*l;return{fontSize:i,lineHeight:i*n,ascender:r,descender:o,baseline:r}}getCharacterWidth(t,i){const n=i.font_size,s=i.font_family,l=/[\u4e00-\u9fa5]/.test(t),r={"Courier New":{chinese:.6,english:.6},Monaco:{chinese:.6,english:.6},Consolas:{chinese:.6,english:.6},SimSun:{chinese:1,english:.5},SimHei:{chinese:1,english:.5},KaiTi:{chinese:1.1,english:.6},FangSong:{chinese:1,english:.55},Arial:{chinese:1,english:.55},Helvetica:{chinese:1,english:.55},"Times New Roman":{chinese:1,english:.5},"Microsoft YaHei":{chinese:1,english:.52},"PingFang SC":{chinese:1,english:.52},"Noto Sans":{chinese:1,english:.53},default:{chinese:1,english:.55}},o=s.toLowerCase();let d=r.default;for(const[u,c]of Object.entries(r))if(o.includes(u.toLowerCase())||u.toLowerCase().includes(o)){d=c;break}const a=l?d.chinese:d.english;return n*a}calculateTextWidth(t,i){let n=0;for(const s of t)s!==`
`&&(n+=this.getCharacterWidth(s,i));return n}measureTextContent(t,i,n=0){const s=t.split(`
`),l=s.length;let r=0;for(const a of s){const u=this.calculateTextWidth(a,i);r=Math.max(r,u)}if(n>0&&r>n)return this.calculateWrappedText(t,i,n);const o=n>0?Math.min(r,n):r,d=l*i.font_size*1.2;return{bounds:{x:0,y:0,width:o,height:d},lineCount:l,actualHeight:d}}calculateWrappedText(t,i,n){const s=this.getCharacterWidth("测",i);if(Math.floor(n/s)<1||n<s)return{bounds:{x:0,y:0,width:n,height:i.font_size*1.2},lineCount:1,actualHeight:i.font_size*1.2,wrappedLines:["..."]};const r=this.smartSegmentation(t);let o=[],d="",a=0;for(const c of r){const g=this.calculateTextWidth(c,i),y=a+g;if(y>n)if(d.trim())o.push(d.trim()),d=c,a=g;else{const{truncated:b,remaining:x}=this.forceTruncateSegment(c,n,i);o.push(b),d=x,a=this.calculateTextWidth(x,i)}else d+=c,a=y}d.trim()&&o.push(d.trim());const u=o.length*i.font_size*1.2;return{bounds:{x:0,y:0,width:n,height:u},lineCount:o.length,actualHeight:u,wrappedLines:o}}forceTruncateSegment(t,i,n){let s="",l=0,r=0;for(r=0;r<t.length;r++){const d=t[r];if(!d)break;const a=this.getCharacterWidth(d,n);if(l+a>i)break;s+=d,l+=a}const o=t.substring(r);return{truncated:s,remaining:o}}smartSegmentation(t){const i=[];let n="";for(let s=0;s<t.length;s++){const l=t[s];l&&(/[\u4e00-\u9fa5]/.test(l)?(n&&(i.push(n),n=""),i.push(l)):l===`
`?(n&&(i.push(n),n=""),i.push(`
`)):l===" "?n?(i.push(n+" "),n=""):i.push(" "):n+=l)}return n&&i.push(n),i.filter(s=>s.length>0)}calculateContainerHeight(t,i,n){const s=i.lineHeight*t.lineCount,l=i.ascender+i.descender,r=i.lineHeight,o=Math.max(s,l,r);return Math.max(o,n)}calculateTextPositioning(t,i,n,s){var u;const l=this.calculateHorizontalAnchor(t.align,i.width),r=s.baseline,o=((u=t.background)==null?void 0:u.padding)||0,d=-o,a=-o;return{textAnchorX:l,textAnchorY:r,backgroundX:d,backgroundY:a}}calculateHorizontalAnchor(t,i){switch(t){case"Left":return 0;case"Center":return i/2;case"Right":return i;default:return 0}}getTextAnchor(t){switch(t){case"Left":return"start";case"Center":return"middle";case"Right":return"end";default:return"start"}}debugBounds(t,i){}}const Oe=new Vn;class Xn{constructor(){Ue(this,"initialized",!1);this.initialize()}async initialize(){if(!this.initialized)try{await ue.initialize(),this.initialized=!0,console.log("🎨 ProfessionalTextRenderer 已初始化")}catch(t){console.error("❌ ProfessionalTextRenderer 初始化失败:",t)}}isElementUsingProfessionalStyle(t){return ue.getElementStyleId(t)!==null}adaptLegacyTextStyle(t){return{...t,font_weight:t.font_weight,typography:{letterSpacing:0,lineHeight:1.2,paragraphSpacing:0,textIndent:0,decoration:{underline:!1,strikethrough:!1,overline:!1,decorationStyle:"solid"},textTransform:"none",whiteSpace:"normal"},fills:[{type:"solid",enabled:!0,opacity:1,solid:{color:t.color}}],effects:[]}}renderProfessionalText(t,i=!1){if(t.content.type!=="Text"&&t.content.type!=="DataField")return null;const n=ue.getElementStyleId(t.id);let s;if(n){const o=ue.getStyle(n);if(!o)return console.warn(`⚠️ 找不到样式定义: ${n}`),null;s=o.style,console.log(`🎨 使用专业样式渲染: ${o.name} (${n})`)}else{const o=t.content.type==="Text"||t.content.type==="DataField"?t.content.style:null;if(!o)return null;s=this.adaptLegacyTextStyle(o),console.log("🔄 适配传统样式到专业排版系统")}const l=this.calculateEnhancedBounds(t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",s,t.size);return{element:this.createProfessionalTextElement(l,t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",s,!1),bounds:l,style:s}}calculateEnhancedBounds(t,i,n){const s=Oe.calculateUnifiedBounds(t,i,n),l=i.typography,r=this.calculateLetterSpacingEffect(t,l.letterSpacing),o=this.calculateLineHeightEffect(t,i.font_size,l.lineHeight),d=this.calculateParagraphSpacingEffect(t,l.paragraphSpacing);return{containerBounds:s.containerBounds,positioning:s.positioning,fontMetrics:s.fontMetrics,typography:{adjustedWidth:s.containerBounds.width+r.widthIncrease,adjustedHeight:s.containerBounds.height+o.heightIncrease+d.heightIncrease,letterSpacingData:r,lineHeightData:o,paragraphData:d}}}calculateLetterSpacingEffect(t,i){const n=t.split(`
`),s=n.reduce((r,o)=>r+o.length,0),l=Math.max(0,s-n.length);return{spacingValue:i,totalSpaces:l,widthIncrease:l*i,charPositions:[]}}calculateLineHeightEffect(t,i,n){const l=t.split(`
`).length,r=i*n,o=i*1.2,d=r-o;return{lineHeightRatio:n,actualLineHeight:r,lineCount:l,heightIncrease:d*Math.max(0,l-1),baselinePositions:[]}}calculateParagraphSpacingEffect(t,i){const s=t.split(`

`).length;return{spacing:i,paragraphCount:s,heightIncrease:i*Math.max(0,s-1),paragraphPositions:[]}}createProfessionalTextElement(t,i,n,s){const l=document.createElementNS("http://www.w3.org/2000/svg","g");return l.setAttribute("class","professional-text-container"),this.renderMultipleFills(l,t,n.fills),this.renderEffects(l,t,n.effects),this.renderTypographyText(l,t,i,n),this.renderTextDecorations(l,t,i,n.typography.decoration),l}renderMultipleFills(t,i,n){if(n&&n.length>0&&n[0].enabled){const s=n[0];s.type==="solid"&&s.solid&&console.log("🎨 应用纯色填充:",s.solid.color)}}renderEffects(t,i,n){if(!n||n.length===0)return;const s=document.createElementNS("http://www.w3.org/2000/svg","defs"),l=document.createElementNS("http://www.w3.org/2000/svg","filter"),r=`text-effects-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;l.id=r;for(const o of n)if(o.enabled&&o.type==="drop-shadow"&&o.dropShadow){const d=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");d.setAttribute("dx",o.dropShadow.offsetX.toString()),d.setAttribute("dy",o.dropShadow.offsetY.toString()),d.setAttribute("stdDeviation",o.dropShadow.blur.toString()),d.setAttribute("flood-color",o.dropShadow.color),d.setAttribute("flood-opacity",o.dropShadow.opacity.toString()),l.appendChild(d),console.log("✨ 应用投影效果")}l.children.length>0&&(s.appendChild(l),t.appendChild(s),t.setAttribute("filter",`url(#${r})`))}renderTypographyText(t,i,n,s){var d,a;const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("font-family",s.font_family),l.setAttribute("font-size",s.font_size.toString()),l.setAttribute("font-weight",s.font_weight),l.setAttribute("fill",((a=(d=s.fills[0])==null?void 0:d.solid)==null?void 0:a.color)||s.color),l.setAttribute("text-anchor",this.getTextAnchor(s.align));const r=n.split(`
`),o=s.typography;r.forEach((u,c)=>{const g=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.letterSpacing!==0&&g.setAttribute("letter-spacing",`${o.letterSpacing}px`);const y=i.positioning.textAnchorY+c*i.typography.lineHeightData.actualLineHeight;if(g.setAttribute("x",i.positioning.textAnchorX.toString()),g.setAttribute("y",y.toString()),c===0&&o.textIndent!==0){const b=i.positioning.textAnchorX+o.textIndent;g.setAttribute("x",b.toString())}o.textTransform&&o.textTransform!=="none"?g.textContent=this.applyTextTransform(u,o.textTransform):g.textContent=u,l.appendChild(g)}),t.appendChild(l)}renderTextDecorations(t,i,n,s){if(!s.underline&&!s.strikethrough&&!s.overline)return;const l=n.split(`
`),r=s.decorationColor||"#000000",o=s.decorationThickness||1,d=s.decorationStyle==="dashed"?"4,2":s.decorationStyle==="dotted"?"1,1":"none";l.forEach((a,u)=>{if(!a.trim())return;const c=i.positioning.textAnchorY+u*i.typography.lineHeightData.actualLineHeight,g=a.length*i.fontMetrics.fontSize*.6,y=i.positioning.textAnchorX,b=y+g;if(s.underline){const x=c+i.fontMetrics.fontSize*.1;this.createDecorationLine(t,y,x,b,x,r,o,d,"underline")}if(s.strikethrough){const x=c-i.fontMetrics.fontSize*.3;this.createDecorationLine(t,y,x,b,x,r,o,d,"strikethrough")}if(s.overline){const x=c-i.fontMetrics.fontSize*.8;this.createDecorationLine(t,y,x,b,x,r,o,d,"overline")}})}createDecorationLine(t,i,n,s,l,r,o,d,a){const u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",i.toString()),u.setAttribute("y1",n.toString()),u.setAttribute("x2",s.toString()),u.setAttribute("y2",l.toString()),u.setAttribute("stroke",r),u.setAttribute("stroke-width",o.toString()),u.setAttribute("stroke-dasharray",d),u.setAttribute("class",`text-decoration-${a}`),t.appendChild(u)}getTextAnchor(t){switch(t){case"Center":return"middle";case"Right":return"end";case"Left":default:return"start"}}applyTextTransform(t,i){switch(i){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();default:return t}}}const Gn=new Xn;var Wn=_("<button class=search-clear title=清除搜索>✕"),Yn=_('<div class=style-picker-container><div class=style-categories></div><div class=style-search><div class=search-input-container><span class=search-icon>🔍</span><input type=text placeholder=搜索样式... class=search-input></div></div><div class=style-grid><div class="style-card create-style-card"><div class=create-style-content><div class=create-style-icon>➕</div><div class=create-style-label>新建样式</div></div></div></div><div class=style-stats><span class=stats-text> 个样式'),qn=_("<button><span class=category-icon></span><span class=category-label>"),Jn=_("<div><div class=style-preview></div><div class=style-info><div class=style-name></div><div class=style-meta><span class=style-category></span></div></div><div class=style-actions>"),Zn=_("<span class=usage-count>"),Qn=_("<button class=edit-button title=编辑样式>✏️"),ei=_("<span class=system-badge title=系统预设样式>🔒"),ti=_("<div class=selection-indicator>✓");const ni=e=>{const[t,i]=J("bank-special"),[n,s]=J(""),[l,r]=J([]);(async()=>{await ue.initialize();const g=ue.getStylesByCategory();r(g)})();const d=re(()=>{let g=l();t()&&(g=g.filter(b=>b.category===t()));const y=n().toLowerCase().trim();return y&&(g=g.filter(b=>b.name.toLowerCase().includes(y)||b.description.toLowerCase().includes(y)||b.metadata.tags.some(x=>x.toLowerCase().includes(y)))),g}),a=[{key:"bank-special",label:"银行专用",icon:"🏦"},{key:"heading",label:"标题",icon:"📰"},{key:"body",label:"正文",icon:"📝"},{key:"caption",label:"说明",icon:"💬"},{key:"custom",label:"自定义",icon:"⚙️"}],u=g=>{console.log("🎯 选择样式:",g),e.onStyleSelect(g)},c=g=>{i(g),console.log("📂 切换分类:",g)};return(()=>{var g=Yn(),y=g.firstChild,b=y.nextSibling,x=b.firstChild,O=x.firstChild,P=O.nextSibling,z=b.nextSibling,A=z.firstChild,R=z.nextSibling,B=R.firstChild,k=B.firstChild;return h(y,f(ge,{each:a,children:N=>(()=>{var U=qn(),Y=U.firstChild,T=Y.nextSibling;return U.$$click=()=>c(N.key),h(Y,()=>N.icon),h(T,()=>N.label),I(L=>{var $=`category-button ${t()===N.key?"active":""}`,V=N.label;return $!==L.e&&Ae(U,L.e=$),V!==L.t&&S(U,"title",L.t=V),L},{e:void 0,t:void 0}),U})()})),P.$$input=N=>s(N.target.value),h(x,f(ee,{get when(){return n()},get children(){var N=Wn();return N.$$click=()=>s(""),N}}),null),h(z,f(ge,{get each(){return d()},children:N=>f(ii,{style:N,get selected(){return e.selectedStyleId===N.id},onClick:()=>u(N.id),onEdit:()=>e.onStyleEdit(N.id)})}),A),fe(A,"click",e.onStyleCreate),h(B,()=>d().length,k),h(B,(()=>{var N=te(()=>!!n());return()=>N()&&` (搜索: "${n()}")`})(),null),I(()=>P.value=n()),g})()},ii=e=>{const t=()=>{switch(e.style.category){case"bank-special":return e.style.id.includes("amount")?"¥123,456.78":e.style.id.includes("account")?"6222 0012 3456 7890":e.style.id.includes("institution")?e.style.name:e.style.id.includes("date")?"2025-08-19":e.style.name;case"heading":return e.style.name;case"body":return"正文示例文字 Abc";case"caption":return"说明文字";default:return e.style.name}},i=re(()=>{var r,o,d,a,u,c,g,y;const l=e.style.style;return{fontFamily:l.font_family,fontSize:`${Math.min(l.font_size,14)}px`,fontWeight:l.font_weight,color:((d=(o=(r=l.fills)==null?void 0:r[0])==null?void 0:o.solid)==null?void 0:d.color)||l.color,textAlign:l.align.toLowerCase(),letterSpacing:`${((a=l.typography)==null?void 0:a.letterSpacing)||0}px`,textDecoration:(c=(u=l.typography)==null?void 0:u.decoration)!=null&&c.underline?"underline":(y=(g=l.typography)==null?void 0:g.decoration)!=null&&y.strikethrough?"line-through":"none"}}),n=l=>{l.preventDefault(),e.onClick()},s=l=>{l.preventDefault(),l.stopPropagation(),e.onEdit()};return(()=>{var l=Jn(),r=l.firstChild,o=r.nextSibling,d=o.firstChild,a=d.nextSibling,u=a.firstChild,c=o.nextSibling;return l.$$click=n,h(r,t),h(d,()=>e.style.name),h(u,()=>li(e.style.category)),h(a,(()=>{var g=te(()=>e.style.metadata.usageCount>0);return()=>g()&&(()=>{var y=Zn();return h(y,()=>e.style.metadata.usageCount),I(()=>S(y,"title",`使用次数: ${e.style.metadata.usageCount}`)),y})()})(),null),h(c,(()=>{var g=te(()=>!e.style.metadata.isSystemStyle);return()=>g()&&(()=>{var y=Qn();return y.$$click=s,y})()})(),null),h(c,(()=>{var g=te(()=>!!e.style.metadata.isSystemStyle);return()=>g()&&ei()})(),null),h(l,(()=>{var g=te(()=>!!e.selected);return()=>g()&&ti()})(),null),I(g=>{var y=`style-card ${e.selected?"selected":""} ${e.style.metadata.isSystemStyle?"system-style":"user-style"}`,b=i();return y!==g.e&&Ae(l,g.e=y),g.t=Rt(r,b,g.t),g},{e:void 0,t:void 0}),l})()};function li(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}pe(["input","click"]);var si=_("<button class=style-picker-toggle>"),ri=_("<button class=style-reload-btn title=重新加载样式系统>🔄"),oi=_("<div class=initialization-fallback><div class=fallback-content><span class=fallback-icon>⏳</span><span class=fallback-text>专业样式系统加载中...</span><div class=fallback-actions><button class=retry-btn>重试加载"),ai=_("<div class=quick-style-actions><button class=apply-style-btn><span class=btn-icon>🎨</span><span class=btn-text>选择样式</span></button><button class=create-style-btn title=基于当前设置创建新样式><span class=btn-icon>➕</span><span class=btn-text>新建"),ci=_("<div class=style-picker-panel>"),di=_("<div class=property-group><div class=property-group-title><span>📐</span><span>排版控制</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=typography-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>⚙️</span><span class=placeholder-text>高级排版控制功能</span><span class=placeholder-subtitle>字间距、行高、装饰等"),ui=_("<div class=property-group><div class=property-group-title><span>✨</span><span>视觉效果</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=effects-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>🌈</span><span class=placeholder-text>多重填充 & 阴影效果</span><span class=placeholder-subtitle>渐变、投影、发光等"),hi=_('<div class="property-group debug-panel"><div class=property-group-title><span>🔧</span><span>调试信息</span></div><div class=property-group-content><div class=debug-info><div class=debug-item><span class=debug-label>元素ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>当前样式ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>可用样式:</span><span class=debug-value> 个</span></div><div class=debug-item><span class=debug-label>使用专业渲染:</span><span class=debug-value>'),gi=_("<div class=professional-text-properties><div class=property-group><div class=property-group-title><span>🎨</span><span>专业文字样式</span><div class=property-group-actions></div></div><div class=property-group-content>"),fi=_('<div class=current-style-info><div class=current-style-preview><div class=style-preview-badge><span class=style-name></span><span class=style-category></span></div><div class=style-actions><button class="style-action-btn edit-btn"title=编辑样式>✏️</button><button class="style-action-btn remove-btn"title=移除样式>🗑️');const St=e=>{const[t,i]=J(null),[n,s]=J(!1),[l,r]=J([]),[o,d]=J(!1);Me(async()=>{try{await ue.initialize();const P=ue.getElementStyleId(e.element.id);i(P);const z=ue.getStylesByCategory();r(z),d(!0),console.log("🎨 ProfessionalTextPropertiesPanel 初始化完成")}catch(P){console.error("❌ 专业文字属性面板初始化失败:",P)}});const a=re(()=>{const P=t();return P?ue.getStyle(P):null}),u=re(()=>e.element.content.type==="Text"||e.element.content.type==="DataField"),c=async P=>{try{const z=await ue.applyStyleToElement(e.element.id,P);if(z.success){i(P);const A=ue.getStyle(P);if(A){const R=g(A.style);e.onUpdate(e.element.id,"content",{...e.element.content,style:R})}console.log("✅ 样式应用成功:",z)}else console.error("❌ 样式应用失败:",z.error)}catch(z){console.error("❌ 样式选择处理失败:",z)}},g=P=>{var z,A,R;return{font_family:P.font_family,font_size:P.font_size,font_weight:P.font_weight,color:((R=(A=(z=P.fills)==null?void 0:z[0])==null?void 0:A.solid)==null?void 0:R.color)||P.color,align:P.align}},y=()=>{console.log("🆕 创建新样式")},b=P=>{console.log("✏️ 编辑样式:",P)},x=()=>{s(!n())},O=()=>{t()&&(ue.removeElementStyle(e.element.id),i(null),console.log("🗑️ 移除元素样式"))};return u()?(()=>{var P=gi(),z=P.firstChild,A=z.firstChild,R=A.firstChild,B=R.nextSibling,k=B.nextSibling,N=A.nextSibling;return h(k,f(ee,{get when(){return o()},get children(){var U=si();return U.$$click=x,h(U,()=>n()?"📝":"📚"),I(()=>S(U,"title",n()?"隐藏样式库":"显示样式库")),U}}),null),h(k,f(ee,{get when(){return!o()},get children(){var U=ri();return U.$$click=()=>window.location.reload(),U}}),null),h(N,f(ee,{get when(){return!o()},get children(){var U=oi(),Y=U.firstChild,T=Y.firstChild,L=T.nextSibling,$=L.nextSibling,V=$.firstChild;return V.$$click=async()=>{try{await ue.initialize();const H=ue.getStylesByCategory();r(H),d(!0),console.log("🔄 样式系统重新初始化成功")}catch(H){console.error("❌ 重新初始化失败:",H)}},U}}),null),h(N,f(ee,{get when(){return o()},get children(){return[f(ee,{get when(){return a()},children:U=>(()=>{var Y=fi(),T=Y.firstChild,L=T.firstChild,$=L.firstChild,V=$.nextSibling,H=L.nextSibling,m=H.firstChild,E=m.nextSibling;return h($,()=>U().name),h(V,()=>vi(U().category)),m.$$click=()=>b(U().id),E.$$click=O,Y})()}),f(ee,{get when(){return!a()},get children(){var U=ai(),Y=U.firstChild,T=Y.nextSibling;return Y.$$click=x,T.$$click=y,U}}),f(ee,{get when(){return n()},get children(){var U=ci();return h(U,f(ni,{get selectedStyleId(){return t()},onStyleSelect:c,onStyleCreate:y,onStyleEdit:b})),U}})]}}),null),h(P,f(ee,{get when(){return a()},get children(){return di()}}),null),h(P,f(ee,{get when(){return a()},get children(){return ui()}}),null),h(P,f(ee,{get when(){return!1},get children(){var U=hi(),Y=U.firstChild,T=Y.nextSibling,L=T.firstChild,$=L.firstChild,V=$.firstChild,H=V.nextSibling,m=$.nextSibling,E=m.firstChild,F=E.nextSibling,j=m.nextSibling,D=j.firstChild,X=D.nextSibling,le=X.firstChild,oe=j.nextSibling,K=oe.firstChild,ce=K.nextSibling;return h(H,()=>e.element.id),h(F,()=>t()||"无"),h(X,()=>l().length,le),h(ce,()=>Gn.isElementUsingProfessionalStyle(e.element.id)?"是":"否"),U}}),null),P})():null};function vi(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}pe(["click"]);var yi=_('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),mi=_('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),bi=_("<span class=property-value>"),pi=_('<span class="property-value text-xs text-muted">'),ot=_("<div class=space-y-2>"),Ke=_("<input type=number class=property-input>"),xi=_('<div class="grid grid-cols-2 gap-2">'),Ct=_("<input type=checkbox class=property-checkbox>"),wi=_('<div class="p-4 space-y-4">'),kt=_("<div>"),_i=_("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),$i=_("<div class=property-field><label class=property-label>"),Si=_("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),Vt=_('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Xt=_("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),Ci=_('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Gt=_("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),ki=_('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),Wt=_('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),Yt=_('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),Ei=_('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Ai=_("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),Et=_("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Pi=_('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),zi=_("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),Di=_("<input type=text class=property-input placeholder=图片描述文字>"),Ti=_("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),Li=_("<div class=space-y-3>"),Mi=_("<img class=property-image>"),Ui=_("<input type=text class=property-input placeholder=${fieldName}>"),Ii=_("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),Oi=_("<div class=space-y-4>"),Ri=_('<div class=flex><input type=number class="property-input flex-1">'),Fi=_("<span class=property-unit>"),Bi=_('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),Ni=_("<div class=property-alignment-group>"),Hi=_("<button>");const ji=()=>{const{state:e,updateElement:t}=Ce(),i=re(()=>{const l=new Set(e.selected_ids);return e.elements.filter(r=>l.has(r.id))}),n=re(()=>i()[0]),s=async(l,r,o)=>{try{await t(l,{[r]:o})}catch(d){console.error("Failed to update element property:",d)}};return(()=>{var l=yi(),r=l.firstChild,o=r.nextSibling;return h(o,f(ee,{get when(){return n()},get fallback(){return mi()},get children(){return f(Ki,{get element(){return n()},onUpdate:s})}})),l})()},Ki=e=>{const t=(n,s)=>{const l={...e.element.position,[n]:s};e.onUpdate(e.element.id,"position",l)},i=(n,s)=>{const l={...e.element.size,[n]:Math.max(1,s)};e.onUpdate(e.element.id,"size",l)};return(()=>{var n=wi();return h(n,f(Se,{title:"元素信息",icon:"ℹ️",get children(){var s=ot();return h(s,f(q,{label:"类型",get children(){var l=bi();return h(l,()=>e.element.content.type),l}}),null),h(s,f(q,{label:"ID",get children(){var l=pi();return h(l,()=>e.element.id),l}}),null),s}}),null),h(n,f(Se,{title:"位置和大小",icon:"📐",get children(){var s=xi();return h(s,f(q,{label:"X",get children(){var l=Ke();return l.$$input=r=>t("x",parseFloat(r.target.value)||0),I(()=>l.value=e.element.position.x),l}}),null),h(s,f(q,{label:"Y",get children(){var l=Ke();return l.$$input=r=>t("y",parseFloat(r.target.value)||0),I(()=>l.value=e.element.position.y),l}}),null),h(s,f(q,{label:"宽度",get children(){var l=Ke();return l.$$input=r=>i("width",parseFloat(r.target.value)||1),I(()=>l.value=e.element.size.width),l}}),null),h(s,f(q,{label:"高度",get children(){var l=Ke();return l.$$input=r=>i("height",parseFloat(r.target.value)||1),I(()=>l.value=e.element.size.height),l}}),null),s}}),null),h(n,f(Se,{title:"状态",icon:"👁️",get children(){var s=ot();return h(s,f(q,{label:"可见",get children(){var l=Ct();return l.addEventListener("change",r=>e.onUpdate(e.element.id,"visible",r.target.checked)),I(()=>l.checked=e.element.visible),l}}),null),h(s,f(q,{label:"锁定",get children(){var l=Ct();return l.addEventListener("change",r=>e.onUpdate(e.element.id,"locked",r.target.checked)),I(()=>l.checked=e.element.locked),l}}),null),h(s,f(q,{label:"层级",get children(){var l=Ke();return l.$$input=r=>e.onUpdate(e.element.id,"z_index",parseInt(r.target.value)||0),I(()=>l.value=e.element.z_index),l}}),null),s}}),null),h(n,f(_n,{get children(){return[f(je,{get when(){return e.element.content.type==="Text"&&e.element.content},children:s=>(()=>{var l=kt();return h(l,f(St,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,f(Vi,{get content(){return s()},onUpdate:r=>{console.log("Text content update:",r),e.onUpdate(e.element.id,"content",r)}}),null),l})()}),f(je,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:s=>f(Xi,{get content(){return s()},onUpdate:l=>{console.log("Rectangle content update:",l),e.onUpdate(e.element.id,"content",l)}})}),f(je,{get when(){return e.element.content.type==="Line"&&e.element.content},children:s=>f(Gi,{get content(){return s()},onUpdate:l=>{console.log("Line content update:",l),e.onUpdate(e.element.id,"content",l)}})}),f(je,{get when(){return e.element.content.type==="Image"&&e.element.content},children:s=>f(Wi,{get content(){return s()},onUpdate:l=>{console.log("Image content update:",l),e.onUpdate(e.element.id,"content",l)}})}),f(je,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:s=>(()=>{var l=kt();return h(l,f(St,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,f(Yi,{get content(){return s()},onUpdate:r=>{console.log("DataField content update:",r),e.onUpdate(e.element.id,"content",r)}}),null),l})()})]}}),null),n})()},Se=e=>(()=>{var t=_i(),i=t.firstChild,n=i.firstChild,s=n.nextSibling,l=i.nextSibling;return h(n,()=>e.icon),h(s,()=>e.title),h(l,()=>e.children),t})(),q=e=>(()=>{var t=$i(),i=t.firstChild;return h(i,()=>e.label),h(t,()=>e.children,null),t})(),Vi=e=>f(Se,{title:"文字样式",icon:"🔤",get children(){var t=Wt(),i=t.firstChild,n=i.nextSibling;return h(t,f(q,{label:"内容",get children(){var s=Si();return s.$$input=l=>e.onUpdate({content:l.target.value}),I(()=>s.value=e.content.content),s}}),i),h(i,f(q,{label:"字体",get children(){var s=Vt();return s.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_family:l.target.value}})),I(()=>s.value=e.content.style.font_family),s}}),null),h(i,f(q,{label:"大小",get children(){return f(_e,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,font_size:s}})})}}),null),h(n,f(q,{label:"字重",get children(){var s=Xt();return s.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_weight:l.target.value}})),I(()=>s.value=e.content.style.font_weight),s}}),null),h(n,f(q,{label:"对齐",get children(){return f(qt,{get value(){return e.content.style.align},onUpdate:s=>e.onUpdate({style:{...e.content.style,align:s}})})}}),null),h(t,f(q,{label:"颜色",get children(){return f(Te,{get value(){return e.content.style.color},onUpdate:s=>e.onUpdate({style:{...e.content.style,color:s}})})}}),null),h(t,f(q,{label:"背景",get children(){var s=Ci(),l=s.firstChild;return h(s,f(Te,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.color)||"transparent"},onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:r}}})}),l),h(l,f(q,{label:"透明度",get children(){return f(_e,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.opacity)||1},min:0,max:1,step:.1,onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:r}}})})}}),null),h(l,f(q,{label:"内边距",get children(){return f(_e,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:r}}})})}}),null),s}}),null),h(t,f(q,{label:"边框",get children(){var s=ki(),l=s.firstChild;return h(s,f(Te,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.color)||"#000000"},onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:r}}})}),l),h(l,f(q,{label:"宽度",get children(){return f(_e,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:r}}})})}}),null),h(l,f(q,{label:"样式",get children(){var r=Gt();return r.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:o.target.value}}})),I(()=>{var o;return r.value=((o=e.content.style.border)==null?void 0:o.style)||"Solid"}),r}}),null),h(l,f(q,{label:"圆角",get children(){return f(_e,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:r}}})})}}),null),s}}),null),t}}),Xi=e=>f(Se,{title:"矩形样式",icon:"▭",get children(){var t=Ei(),i=t.firstChild,n=i.firstChild;return h(t,f(q,{label:"填充颜色",get children(){return f(Te,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:s=>e.onUpdate({fill_color:s})})}}),i),h(i,f(q,{label:"边框",get children(){var s=ot();return h(s,f(Te,{get value(){var l;return((l=e.content.border)==null?void 0:l.color)||"#000000"},onUpdate:l=>e.onUpdate({border:{...e.content.border,color:l}})})),s}}),n),h(n,f(q,{label:"宽度",get children(){return f(_e,{get value(){var s;return((s=e.content.border)==null?void 0:s.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:s=>e.onUpdate({border:{...e.content.border,width:s}})})}}),null),h(n,f(q,{label:"样式",get children(){var s=Gt();return s.addEventListener("change",l=>e.onUpdate({border:{...e.content.border,style:l.target.value}})),I(()=>{var l;return s.value=((l=e.content.border)==null?void 0:l.style)||"Solid"}),s}}),null),h(t,f(q,{label:"圆角半径",get children(){return f(_e,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:s=>e.onUpdate({corner_radius:s})})}}),null),h(t,f(q,{label:"透明度",get children(){var s=Yt(),l=s.firstChild,r=l.nextSibling,o=r.firstChild;return l.$$input=d=>e.onUpdate({opacity:parseFloat(d.target.value)/100}),h(r,()=>Math.round((e.content.opacity||1)*100),o),I(()=>l.value=(e.content.opacity||1)*100),s}}),null),t}}),Gi=e=>f(Se,{title:"线条样式",icon:"━",get children(){var t=Pi(),i=t.firstChild;return h(t,f(q,{label:"颜色",get children(){return f(Te,{get value(){return e.content.color},onUpdate:n=>e.onUpdate({color:n})})}}),i),h(t,f(q,{label:"宽度",get children(){return f(_e,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:n=>e.onUpdate({width:n})})}}),i),h(t,f(q,{label:"样式",get children(){var n=Ai();return n.addEventListener("change",s=>e.onUpdate({line_style:s.target.value})),I(()=>n.value=e.content.line_style||"Solid"),n}}),i),h(i,f(q,{label:"起点",get children(){var n=Et();return n.addEventListener("change",s=>e.onUpdate({start_cap:s.target.value})),I(()=>n.value=e.content.start_cap||"None"),n}}),null),h(i,f(q,{label:"终点",get children(){var n=Et();return n.addEventListener("change",s=>e.onUpdate({end_cap:s.target.value})),I(()=>n.value=e.content.end_cap||"None"),n}}),null),h(t,f(q,{label:"透明度",get children(){var n=Yt(),s=n.firstChild,l=s.nextSibling,r=l.firstChild;return s.$$input=o=>e.onUpdate({opacity:parseFloat(o.target.value)/100}),h(l,()=>Math.round((e.content.opacity||1)*100),r),I(()=>s.value=(e.content.opacity||1)*100),n}}),null),t}}),Wi=e=>f(Se,{title:"图片属性",icon:"🖼️",get children(){var t=Li();return h(t,f(q,{label:"图片地址",get children(){var i=zi();return i.$$input=n=>e.onUpdate({src:n.target.value}),I(()=>i.value=e.content.src),i}}),null),h(t,f(q,{label:"替代文本",get children(){var i=Di();return i.$$input=n=>e.onUpdate({alt:n.target.value}),I(()=>i.value=e.content.alt||""),i}}),null),h(t,f(q,{label:"预览",get children(){var i=Ti(),n=i.firstChild;return h(i,(()=>{var s=te(()=>!!e.content.src);return()=>s()?(()=>{var l=Mi();return l.addEventListener("load",r=>{const o=r.target,d=o.nextElementSibling;o&&(o.style.display="block"),d&&(d.style.display="none")}),l.addEventListener("error",r=>{const o=r.target,d=o.nextElementSibling;o&&(o.style.display="none"),d&&(d.style.display="flex")}),I(r=>{var o=e.content.src,d=e.content.alt||"图片预览";return o!==r.e&&S(l,"src",r.e=o),d!==r.t&&S(l,"alt",r.t=d),r},{e:void 0,t:void 0}),l})():null})(),n),I(s=>(s=e.content.src?"none":"flex")!=null?n.style.setProperty("display",s):n.style.removeProperty("display")),i}}),null),t}}),Yi=e=>(()=>{var t=Oi();return h(t,f(Se,{title:"数据字段",icon:"🔗",get children(){var i=ot();return h(i,f(q,{label:"表达式",get children(){var n=Ui();return n.$$input=s=>e.onUpdate({expression:s.target.value}),I(()=>n.value=e.content.expression),n}}),null),h(i,f(q,{label:"格式",get children(){var n=Ii();return n.addEventListener("change",s=>e.onUpdate({format:s.target.value==="default"?void 0:s.target.value})),I(()=>n.value=e.content.format||"default"),n}}),null),i}}),null),h(t,f(Se,{title:"字段样式",icon:"🎨",get children(){var i=Wt(),n=i.firstChild,s=n.nextSibling;return h(n,f(q,{label:"字体",get children(){var l=Vt();return l.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_family:r.target.value}})),I(()=>l.value=e.content.style.font_family),l}}),null),h(n,f(q,{label:"大小",get children(){return f(_e,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),h(s,f(q,{label:"字重",get children(){var l=Xt();return l.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_weight:r.target.value}})),I(()=>l.value=e.content.style.font_weight),l}}),null),h(s,f(q,{label:"对齐",get children(){return f(qt,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),h(i,f(q,{label:"颜色",get children(){return f(Te,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),i}}),null),t})(),_e=e=>(()=>{var t=Ri(),i=t.firstChild;return i.addEventListener("blur",n=>{const s=parseFloat(n.target.value)||e.value,l=Math.max(e.min||-1/0,Math.min(e.max||1/0,s));l!==s&&(n.target.value=l.toString(),e.onUpdate(l))}),i.$$input=n=>{const s=parseFloat(n.target.value);if(!isNaN(s)){const l=Math.max(e.min||-1/0,Math.min(e.max||1/0,s));e.onUpdate(l)}},h(t,(()=>{var n=te(()=>!!e.unit);return()=>n()&&(()=>{var s=Fi();return h(s,()=>e.unit),s})()})(),null),I(n=>{var s=e.min,l=e.max,r=e.step||1;return s!==n.e&&S(i,"min",n.e=s),l!==n.t&&S(i,"max",n.t=l),r!==n.a&&S(i,"step",n.a=r),n},{e:void 0,t:void 0,a:void 0}),I(()=>i.value=e.value),t})(),Te=e=>(()=>{var t=Bi(),i=t.firstChild,n=i.firstChild,s=n.nextSibling,l=i.nextSibling;return n.$$input=r=>e.onUpdate(r.target.value),l.$$input=r=>{const o=r.target.value;(/^#[0-9A-Fa-f]{6}$/.test(o)||/^#[0-9A-Fa-f]{3}$/.test(o))&&e.onUpdate(o)},I(r=>(r=e.value)!=null?s.style.setProperty("background-color",r):s.style.removeProperty("background-color")),I(()=>n.value=e.value),I(()=>l.value=e.value),t})(),qt=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var i=Ni();return h(i,()=>t.map(n=>(()=>{var s=Hi();return s.$$click=()=>e.onUpdate(n.value),h(s,()=>n.icon),I(l=>{var r=`property-alignment-btn ${e.value===n.value?"active":""}`,o=n.label;return r!==l.e&&Ae(s,l.e=r),o!==l.t&&S(s,"title",l.t=o),l},{e:void 0,t:void 0}),s})())),i})()};pe(["input","click"]);var qi=_("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),Ji=_("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const Zi=e=>f(ee,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=qi(),i=t.firstChild,n=i.firstChild,s=n.nextSibling;return I(l=>{var r=e.config.grid_size,o=e.config.grid_size,d=e.config.grid_size,a=e.config.grid_size,u=e.config.grid_size,c=e.config.grid_size,g=e.config.grid_size,y=e.config.grid_size;return r!==l.e&&S(i,"width",l.e=r),o!==l.t&&S(i,"height",l.t=o),d!==l.a&&S(n,"x1",l.a=d),a!==l.o&&S(n,"x2",l.o=a),u!==l.i&&S(n,"y2",l.i=u),c!==l.n&&S(s,"y1",l.n=c),g!==l.s&&S(s,"x2",l.s=g),y!==l.h&&S(s,"y2",l.h=y),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=Ji();return I(i=>{var n=e.config.width,s=e.config.height;return n!==i.e&&S(t,"width",i.e=n),s!==i.t&&S(t,"height",i.t=s),i},{e:void 0,t:void 0}),t})()]}});var Qi=_("<svg><g class=text-element-unified-container data-bounds-version=unified-v2><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=text-content-unified></svg>",!1,!0,!1),At=_("<svg><rect class=text-selection-unified></svg>",!1,!0,!1),el=_("<svg><rect class=text-background-unified></svg>",!1,!0,!1),tl=_("<svg><rect fill=none class=text-border-unified></svg>",!1,!0,!1),nl=_("<svg><tspan class=text-line-wrapped></svg>",!1,!0,!1),il=_("<svg><tspan class=text-line-original></svg>",!1,!0,!1),ll=_("<svg><rect x=0 y=0></svg>",!1,!0,!1),sl=_("<svg><line x1=0></svg>",!1,!0,!1),rl=_("<svg><g class=datafield-element-unified-container><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=datafield-content-unified></svg>",!1,!0,!1),ol=_("<svg><tspan class=datafield-line-wrapped></svg>",!1,!0,!1),al=_("<svg><tspan dy=0></svg>",!1,!0,!1),cl=_("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),dl=_("<svg><g></svg>",!1,!0,!1);const ul=e=>{const t=re(()=>{const{position:n}=e.element;return{transform:`translate(${n.x}px, ${n.y}px)`,opacity:e.element.visible?1:.5}}),i=()=>{const{content:n,size:s}=e.element;if(n.type==="Text"&&n.content&&n.style){const l=Oe.calculateUnifiedBounds(n.content,n.style,s),r=Oe.getTextAnchor(n.style.align);return(()=>{var o=Qi(),d=o.firstChild;return h(o,(()=>{var a=te(()=>!!e.selected);return()=>a()&&(()=>{var u=At();return I(c=>{var g=l.containerBounds.x,y=l.containerBounds.y,b=l.containerBounds.width,x=l.containerBounds.height;return g!==c.e&&S(u,"x",c.e=g),y!==c.t&&S(u,"y",c.t=y),b!==c.a&&S(u,"width",c.a=b),x!==c.o&&S(u,"height",c.o=x),c},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),d),h(o,(()=>{var a=te(()=>!!n.style.background);return()=>a()&&(()=>{var u=el();return I(c=>{var R,B;var g=l.positioning.backgroundX,y=l.positioning.backgroundY,b=l.containerBounds.width+(n.style.background.padding||0)*2,x=l.containerBounds.height+(n.style.background.padding||0)*2,O=n.style.background.color,P=n.style.background.opacity||1,z=((R=n.style.border)==null?void 0:R.radius)||0,A=((B=n.style.border)==null?void 0:B.radius)||0;return g!==c.e&&S(u,"x",c.e=g),y!==c.t&&S(u,"y",c.t=y),b!==c.a&&S(u,"width",c.a=b),x!==c.o&&S(u,"height",c.o=x),O!==c.i&&S(u,"fill",c.i=O),P!==c.n&&S(u,"fill-opacity",c.n=P),z!==c.s&&S(u,"rx",c.s=z),A!==c.h&&S(u,"ry",c.h=A),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()})(),d),h(o,(()=>{var a=te(()=>!!n.style.border);return()=>a()&&(()=>{var u=tl();return I(c=>{var B,k;var g=l.positioning.backgroundX,y=l.positioning.backgroundY,b=l.containerBounds.width+(((B=n.style.background)==null?void 0:B.padding)||0)*2,x=l.containerBounds.height+(((k=n.style.background)==null?void 0:k.padding)||0)*2,O=n.style.border.color,P=n.style.border.width,z=n.style.border.style==="Dashed"?"5,5":n.style.border.style==="Dotted"?"2,2":"none",A=n.style.border.radius||0,R=n.style.border.radius||0;return g!==c.e&&S(u,"x",c.e=g),y!==c.t&&S(u,"y",c.t=y),b!==c.a&&S(u,"width",c.a=b),x!==c.o&&S(u,"height",c.o=x),O!==c.i&&S(u,"stroke",c.i=O),P!==c.n&&S(u,"stroke-width",c.n=P),z!==c.s&&S(u,"stroke-dasharray",c.s=z),A!==c.h&&S(u,"rx",c.h=A),R!==c.r&&S(u,"ry",c.r=R),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),u})()})(),d),S(d,"text-anchor",r),h(d,(()=>{var a=te(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,c)=>(()=>{var g=nl();return h(g,u),I(y=>{var b=l.positioning.textAnchorX,x=c===0?0:l.fontMetrics.lineHeight;return b!==y.e&&S(g,"x",y.e=b),x!==y.t&&S(g,"dy",y.t=x),y},{e:void 0,t:void 0}),g})()):n.content.split(`
`).map((u,c)=>(()=>{var g=il();return h(g,u),I(y=>{var b=l.positioning.textAnchorX,x=c===0?0:l.fontMetrics.lineHeight;return b!==y.e&&S(g,"x",y.e=b),x!==y.t&&S(g,"dy",y.t=x),y},{e:void 0,t:void 0}),g})())})()),I(a=>{var u=l.positioning.textAnchorX,c=l.positioning.textAnchorY,g=n.style.font_family,y=n.style.font_size.toString(),b=n.style.font_weight,x=n.style.color;return u!==a.e&&S(d,"x",a.e=u),c!==a.t&&S(d,"y",a.t=c),g!==a.a&&S(d,"font-family",a.a=g),y!==a.o&&S(d,"font-size",a.o=y),b!==a.i&&S(d,"font-weight",a.i=b),x!==a.n&&S(d,"fill",a.n=x),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()}if(n.type==="Rectangle"){const l=n.opacity!==void 0?n.opacity:1,r=n.corner_radius||0;return(()=>{var o=ll();return S(o,"rx",r),S(o,"ry",r),S(o,"fill-opacity",l),S(o,"stroke-opacity",l),I(d=>{var x,O,P,z;var a=s.width,u=s.height,c=n.fill_color||"transparent",g=((x=n.border)==null?void 0:x.color)||"#000000",y=((O=n.border)==null?void 0:O.width)||1,b=((P=n.border)==null?void 0:P.style)==="Dashed"?"5,5":((z=n.border)==null?void 0:z.style)==="Dotted"?"2,2":"none";return a!==d.e&&S(o,"width",d.e=a),u!==d.t&&S(o,"height",d.t=u),c!==d.a&&S(o,"fill",d.a=c),g!==d.o&&S(o,"stroke",d.o=g),y!==d.i&&S(o,"stroke-width",d.i=y),b!==d.n&&S(o,"stroke-dasharray",d.n=b),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()}if(n.type==="Line"){const l=n.opacity!==void 0?n.opacity:1,r=n.line_style||"Solid",o=r==="Dashed"?"8,4":r==="Dotted"?"2,2":r==="DashDot"?"8,4,2,4":"none";return(()=>{var d=sl();return S(d,"stroke-opacity",l),S(d,"stroke-dasharray",o),I(a=>{var u=s.height/2,c=s.width,g=s.height/2,y=n.color,b=n.width;return u!==a.e&&S(d,"y1",a.e=u),c!==a.t&&S(d,"x2",a.t=c),g!==a.a&&S(d,"y2",a.a=g),y!==a.o&&S(d,"stroke",a.o=y),b!==a.i&&S(d,"stroke-width",a.i=b),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),d})()}if(n.type==="DataField"&&n.style){const l=Oe.calculateUnifiedBounds(n.expression||"[数据字段]",n.style,s),r=Oe.getTextAnchor(n.style.align);return(()=>{var o=rl(),d=o.firstChild;return h(o,(()=>{var a=te(()=>!!e.selected);return()=>a()&&(()=>{var u=At();return I(c=>{var g=l.containerBounds.x,y=l.containerBounds.y,b=l.containerBounds.width,x=l.containerBounds.height;return g!==c.e&&S(u,"x",c.e=g),y!==c.t&&S(u,"y",c.t=y),b!==c.a&&S(u,"width",c.a=b),x!==c.o&&S(u,"height",c.o=x),c},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),d),S(d,"text-anchor",r),h(d,(()=>{var a=te(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,c)=>(()=>{var g=ol();return h(g,u),I(y=>{var b=l.positioning.textAnchorX,x=c===0?0:l.fontMetrics.lineHeight;return b!==y.e&&S(g,"x",y.e=b),x!==y.t&&S(g,"dy",y.t=x),y},{e:void 0,t:void 0}),g})()):(()=>{var u=al();return h(u,()=>n.expression||"[数据字段]"),I(()=>S(u,"x",l.positioning.textAnchorX)),u})()})()),I(a=>{var u=l.positioning.textAnchorX,c=l.positioning.textAnchorY,g=n.style.font_family,y=n.style.font_size.toString(),b=n.style.font_weight,x=n.style.color;return u!==a.e&&S(d,"x",a.e=u),c!==a.t&&S(d,"y",a.t=c),g!==a.a&&S(d,"font-family",a.a=g),y!==a.o&&S(d,"font-size",a.o=y),b!==a.i&&S(d,"font-weight",a.i=b),x!==a.n&&S(d,"fill",a.n=x),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()}return(()=>{var l=cl();return I(r=>{var o=s.width,d=s.height;return o!==r.e&&S(l,"width",r.e=o),d!==r.t&&S(l,"height",r.t=d),r},{e:void 0,t:void 0}),l})()};return(()=>{var n=dl();return h(n,i),I(s=>{var l=`element ${e.selected&&e.element.content.type!=="Text"&&e.element.content.type!=="DataField"?"element-selected":""}`,r=t(),o=e.element.id,d=e.element.content.type;return l!==s.e&&S(n,"class",s.e=l),s.t=Rt(n,r,s.t),o!==s.a&&S(n,"data-element-id",s.a=o),d!==s.o&&S(n,"data-element-type",s.o=d),s},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};var hl=_("<svg><g class=resize-handles></svg>",!1,!0,!1),gl=_("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const fl=e=>{const{updateElement:t,setResizeOperation:i}=Ce(),[n,s]=J(!1),[l,r]=J(null),[o,d]=J({x:0,y:0}),[a,u]=J({width:0,height:0}),[c,g]=J({x:0,y:0}),[y,b]=J({width:0,height:0}),[x,O]=J({x:0,y:0}),[P,z]=J(!1),A=re(()=>{const{position:T,size:L,content:$}=e.element,H=8/2;let m={x:T.x,y:T.y,width:L.width,height:L.height};if(($.type==="Text"||$.type==="DataField")&&$.style){const oe=$.type==="Text"?$.content:$.expression||"[数据字段]",K=Oe.calculateUnifiedBounds(oe,$.style,L);m={x:T.x+K.containerBounds.x,y:T.y+K.containerBounds.y,width:K.containerBounds.width,height:K.containerBounds.height}}const E=m.x,F=m.y,j=m.x+m.width,D=m.y+m.height,X=m.x+m.width/2,le=m.y+m.height/2;return[{position:"nw",cursor:"nw-resize",x:E-H,y:F-H},{position:"ne",cursor:"ne-resize",x:j-H,y:F-H},{position:"sw",cursor:"sw-resize",x:E-H,y:D-H},{position:"se",cursor:"se-resize",x:j-H,y:D-H},{position:"n",cursor:"n-resize",x:X-H,y:F-H},{position:"s",cursor:"s-resize",x:X-H,y:D-H},{position:"w",cursor:"w-resize",x:E-H,y:le-H},{position:"e",cursor:"e-resize",x:j-H,y:le-H}]}),R=(T,L,$,V=!1,H=!1)=>{const m=a(),E=c();let F=m.width,j=m.height,D=E.x,X=E.y;switch(T){case"nw":F=m.width-L,j=m.height-$,D=E.x+L,X=E.y+$;break;case"ne":F=m.width+L,j=m.height-$,X=E.y+$;break;case"sw":F=m.width-L,j=m.height+$,D=E.x+L;break;case"se":F=m.width+L,j=m.height+$;break;case"n":j=m.height-$,X=E.y+$;break;case"s":j=m.height+$;break;case"w":F=m.width-L,D=E.x+L;break;case"e":F=m.width+L;break}if(V&&(T==="nw"||T==="ne"||T==="sw"||T==="se")){const oe=m.width/m.height;F/j>oe?(F=j*oe,(T==="nw"||T==="sw")&&(D=E.x+(m.width-F))):(j=F/oe,(T==="nw"||T==="ne")&&(X=E.y+(m.height-j)))}if(H){const oe=E.x+m.width/2,K=E.y+m.height/2;D=oe-F/2,X=K-j/2}const le=20;return F=Math.max(le,F),j=Math.max(le,j),{size:{width:F,height:j},position:{x:D,y:X}}},B=T=>(T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation(),!1),k=(T,L)=>{var $;i(!0),document.addEventListener("click",B,{capture:!0}),s(!0),r(T),d({x:L.clientX,y:L.clientY}),u({width:e.element.size.width,height:e.element.size.height}),g({x:e.element.position.x,y:e.element.position.y}),b(e.element.size),O(e.element.position),z(!1),document.addEventListener("mousemove",U),document.addEventListener("mouseup",Y),document.body.style.cursor=(($=A().find(V=>V.position===T))==null?void 0:$.cursor)||"default"};let N=0;const U=T=>{if(!n())return;const L=l();if(!L)return;const $=o(),V=T.clientX-$.x,H=T.clientY-$.y,m=R(L,V,H,T.shiftKey,T.altKey);b(m.size),O(m.position),z(Math.abs(V)>2||Math.abs(H)>2);const E=Date.now();if(E-N>50)try{t(e.element.id,{size:m.size,position:m.position}),N=E}catch{}},Y=()=>{if(!n()||!l())return;const L=()=>{document.removeEventListener("click",B,{capture:!0}),i(!1),s(!1),r(null),document.body.style.cursor="default",document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",Y)};if(P()){const $=y(),V=x();t(e.element.id,{size:$,position:V}).catch(H=>{t(e.element.id,{size:a(),position:c()}).catch(m=>{})})}L()};return ct(()=>{i(!1),document.removeEventListener("click",B,{capture:!0}),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",Y),document.body.style.cursor="default"}),(()=>{var T=hl();return h(T,()=>A().map(L=>(()=>{var $=gl(),V=$.firstChild,H=V.nextSibling;return H.addEventListener("mouseleave",m=>{n()||(document.body.style.cursor="default")}),H.addEventListener("mouseenter",m=>{n()||(document.body.style.cursor=L.cursor)}),H.$$mousedown=m=>{m.stopPropagation(),m.preventDefault(),k(L.position,m)},H.style.setProperty("pointer-events","all"),I(m=>{var E=L.x+4,F=L.y+4,j=L.x,D=L.y,X=L.cursor;return E!==m.e&&S(V,"cx",m.e=E),F!==m.t&&S(V,"cy",m.t=F),j!==m.a&&S(H,"x",m.a=j),D!==m.o&&S(H,"y",m.o=D),X!==m.i&&((m.i=X)!=null?H.style.setProperty("cursor",X):H.style.removeProperty("cursor")),m},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),$})())),T})()};pe(["mousedown"]);var me=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(me||{});const vl={dragThreshold:3,updateThrottle:16};var yl=_("<div tabindex=0>"),ml=_("<div>"),bl=_("<div><div>🎯 修复版交互层</div><div>模式: </div><div>选中: </div><div>光标: "),pl=_("<div>拖拽: <!>个元素"),xl=_("<div>[<!>]");const wl=e=>{const{resizeOperation:t,setResizeOperation:i}=Ce(),n=vl;let s;const[l,r]=J(me.IDLE),[o,d]=J([]),[a,u]=J(null),[c,g]=J(null),[y,b]=J(null),x=(v,p)=>Math.sqrt(Math.pow(v.x-p.x,2)+Math.pow(v.y-p.y,2)),O=(v,p)=>v.length===p.length&&v.every((C,w)=>C===p[w]),P=()=>{b(null)},[z,A]=J(null);let R="default";const B=(v,p)=>{!s||R===v||(s.style.cursor=v,R=v)},k=(v,...p)=>{console.log(`🎯 [InteractionLayer] ${v}`,...p)},N=v=>{if(!s)return{x:0,y:0};const p=s.getBoundingClientRect();return{x:v.clientX-p.left,y:v.clientY-p.top}},U=(v,p)=>v.x>=p.position.x&&v.x<=p.position.x+p.size.width&&v.y>=p.position.y&&v.y<=p.position.y+p.size.height,Y=v=>{var C;const p=T(v);return p.length>0&&(C=p[0])!=null?C:null},T=v=>{const p=e.getAllElements();return p.filter(w=>w&&w.visible&&U(v,w)).sort((w,M)=>{var ie,se;const G=(ie=w.z_index)!=null?ie:p.indexOf(w);return((se=M.z_index)!=null?se:p.indexOf(M))-G})},L=v=>{const p=o();if(p.length===0)return null;const C=e.getAllElements();for(const w of p){const M=C.find(Ee=>Ee.id===w);if(!M||!M.visible)continue;const G=8,W=G/2,ie=M.position.x,se=M.position.y,Z=M.position.x+M.size.width,De=M.position.y+M.size.height,xe=M.position.x+M.size.width/2,He=M.position.y+M.size.height/2,sn=[{direction:"nw",cursor:"nw-resize",x:ie-W,y:se-W},{direction:"ne",cursor:"ne-resize",x:Z-W,y:se-W},{direction:"sw",cursor:"sw-resize",x:ie-W,y:De-W},{direction:"se",cursor:"se-resize",x:Z-W,y:De-W},{direction:"n",cursor:"n-resize",x:xe-W,y:se-W},{direction:"s",cursor:"s-resize",x:xe-W,y:De-W},{direction:"w",cursor:"w-resize",x:ie-W,y:He-W},{direction:"e",cursor:"e-resize",x:Z-W,y:He-W}];for(const Ee of sn)if(v.x>=Ee.x&&v.x<Ee.x+G&&v.y>=Ee.y&&v.y<Ee.y+G)return{elementId:M.id,direction:Ee.direction,cursor:Ee.cursor}}return null},$=v=>e.getAllElements().filter(C=>{if(!C.visible)return!1;const w={x:C.position.x,y:C.position.y,width:C.size.width,height:C.size.height};return!(w.x>v.x+v.width||w.x+w.width<v.x||w.y>v.y+v.height||w.y+w.height<v.y)}),V=(v,p)=>{var w,M,G;const C=T(v);return k("重叠选择检测",{elementsCount:C.length,isCtrlClick:p,elementIds:C.map(W=>W.id)}),C.length===0?null:C.length===1?(P(),((w=C[0])==null?void 0:w.id)||null):p?H(v,C):(P(),k("普通点击选中最上层",{elementId:(M=C[0])==null?void 0:M.id}),((G=C[0])==null?void 0:G.id)||null)},H=(v,p)=>{var G,W,ie,se;const C=y(),w=Date.now();if(k("循环选择开始",{hasContext:!!C,elementIds:p.map(Z=>Z.id)}),!C||x(v,C.clickPoint)>5||w-C.lastClickTime>3e3||!O(p.map(Z=>Z.id),C.overlappingElements.map(Z=>Z.id))){const Z=p.length>1?1:0;return b({clickPoint:v,overlappingElements:p,currentSelectedIndex:Z,lastClickTime:w}),k("循环选择重置",{selectedIndex:Z,selectedId:(G=p[Z])==null?void 0:G.id,reason:C?x(v,C.clickPoint)>5?"position_changed":w-C.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),m(Z+1,p.length,v),((W=p[Z])==null?void 0:W.id)||null}else{const Z=(C.currentSelectedIndex+1)%p.length;return b({...C,currentSelectedIndex:Z,lastClickTime:w}),k("循环选择继续",{selectedIndex:Z,selectedId:(ie=p[Z])==null?void 0:ie.id}),m(Z+1,p.length,v),((se=p[Z])==null?void 0:se.id)||null}},m=(v,p,C)=>{const w=document.querySelector(".overlap-indicator");w!=null&&w.parentNode&&w.parentNode.removeChild(w);const M=document.createElement("div");M.className="overlap-indicator",M.textContent=`${v}/${p}`,Object.assign(M.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${C.x+10}px`,top:`${C.y-20}px`}),document.body.appendChild(M),k("显示重叠指示器",{current:v,total:p,point:C}),setTimeout(()=>{M.parentNode&&(M.parentNode.removeChild(M),k("移除重叠指示器"))},1500)},E=v=>{var C;const p=N(v);if(z()){Zt(p);return}if(l()===me.DRAGGING){qe(p);return}if(l()===me.SELECTING){Je(p);return}if(l()===me.IDLE&&a()&&!((C=a())!=null&&C.isDragging)){ve(p);return}l()===me.IDLE&&!a()&&!z()&&F(p)},F=v=>{const p=L(v);if(p){B(p.cursor);return}const C=Y(v);if(C){const M=o().includes(C.id)?"grab":"pointer";B(M);return}B("default")},j=v=>{const p=N(v),C=L(p);if(C){k("点击ResizeHandle",{elementId:C.elementId,direction:C.direction}),D(C,p);return}if(t()){k("调整大小操作进行中，跳过交互处理");return}const w=V(p,v.ctrlKey);if(k("鼠标按下",{point:p,selectedElementId:w,currentMode:l(),isCtrlClick:v.ctrlKey}),w){const M=e.getAllElements().find(G=>G.id===w);M&&X(M,p,v)}else le(p)},D=(v,p,C)=>{const w=e.getAllElements().find(M=>M.id===v.elementId);w&&(k("开始resize操作",{elementId:v.elementId,direction:v.direction}),i(!0),A({elementId:v.elementId,handlePosition:v.direction,startPoint:p,initialSize:{width:w.size.width,height:w.size.height},initialPosition:{x:w.position.x,y:w.position.y},cursor:v.cursor}),B(v.cursor),k("resize状态已设置",z()))},X=(v,p,C)=>{const w=o().includes(v.id),M=o(),G=!!y();k("元素点击",{elementId:v.id,isSelected:w,currentlySelected:M,ctrlKey:C.ctrlKey,shiftKey:C.shiftKey,hasOverlapContext:G}),C.ctrlKey&&!G?oe(v.id):C.shiftKey&&o().length>0?K(v.id):w?(k("点击已选中元素，准备拖拽",{selectedCount:M.length}),he(M,p)):ce(v.id,p)},le=(v,p)=>{var C;k("开始框选",{point:v}),d([]),(C=e.onElementsSelect)==null||C.call(e,[]),P(),r(me.SELECTING),B("crosshair"),g({startPoint:v,currentPoint:v,selectedIds:[]})},oe=v=>{var w;const p=o(),C=p.includes(v)?p.filter(M=>M!==v):[...p,v];k("切换选择",{elementId:v,newSelection:C}),d(C),(w=e.onElementsSelect)==null||w.call(e,C)},K=v=>{var C;const p=o();if(!p.includes(v)){const w=[...p,v];k("添加到选择",{elementId:v,newSelection:w}),d(w),(C=e.onElementsSelect)==null||C.call(e,w)}},ce=(v,p,C)=>{var w;k("选择并准备拖拽",{elementId:v,point:p}),d([v]),(w=e.onElementsSelect)==null||w.call(e,[v]),he([v],p)},he=(v,p,C)=>{k("准备拖拽操作",{elementIds:v,startPoint:p});const w=e.getAllElements(),M=new Map;v.forEach(G=>{const W=w.find(ie=>ie.id===G);W&&M.set(G,{x:W.position.x,y:W.position.y})}),u({elementIds:v,startPoint:p,startPositions:M,currentOffset:{x:0,y:0},isDragging:!1})},ve=v=>{const p=a();if(!p)return;const C=Math.sqrt(Math.pow(v.x-p.startPoint.x,2)+Math.pow(v.y-p.startPoint.y,2));C>n.dragThreshold&&(k("开始拖拽",{distance:C,threshold:n.dragThreshold}),r(me.DRAGGING),B("grabbing"),u({...p,isDragging:!0}))};let ye=!1,ze=0;const ke=(v,p=!1)=>{if(p){v();return}Date.now()-ze>=n.updateThrottle&&!ye&&(ye=!0,requestAnimationFrame(()=>{v(),ye=!1,ze=Date.now()}))},qe=v=>{const p=a();if(!p)return;const C={x:v.x-p.startPoint.x,y:v.y-p.startPoint.y};u({...p,currentOffset:C}),ke(()=>{if(e.onBatchUpdatePositions&&p.elementIds.length>1){const w=p.elementIds.map(M=>{const G=p.startPositions.get(M);return G?{element_id:M,new_position:{x:G.x+C.x,y:G.y+C.y}}:null}).filter(Boolean);w.length>0&&e.onBatchUpdatePositions(w).catch(()=>{})}else if(e.onElementMove){const w=p.elementIds.map(M=>{const G=p.startPositions.get(M);if(G)return e.onElementMove(M,{x:G.x+C.x,y:G.y+C.y})}).filter(Boolean);Promise.allSettled(w).catch(()=>{})}})},Je=v=>{const p=c();if(!p)return;const C={...p,currentPoint:v};g(C);const w={x:Math.min(p.startPoint.x,v.x),y:Math.min(p.startPoint.y,v.y),width:Math.abs(v.x-p.startPoint.x),height:Math.abs(v.y-p.startPoint.y)},G=$(w).map(W=>W.id);g({...C,selectedIds:G}),d(G)},Zt=v=>{const p=z();if(!p)return;const C=v.x-p.startPoint.x,w=v.y-p.startPoint.y,M=Qt(p.handlePosition,C,w,p.initialSize,p.initialPosition);ke(()=>{e.onElementResize&&e.onElementResize(p.elementId,M.size,M.position)})},Qt=(v,p,C,w,M)=>{let G=w.width,W=w.height,ie=M.x,se=M.y;switch(v){case"nw":G=w.width-p,W=w.height-C,ie=M.x+p,se=M.y+C;break;case"ne":G=w.width+p,W=w.height-C,se=M.y+C;break;case"sw":G=w.width-p,W=w.height+C,ie=M.x+p;break;case"se":G=w.width+p,W=w.height+C;break;case"n":W=w.height-C,se=M.y+C;break;case"s":W=w.height+C;break;case"w":G=w.width-p,ie=M.x+p;break;case"e":G=w.width+p;break}const Z=10;return G=Math.max(Z,G),W=Math.max(Z,W),{size:{width:G,height:W},position:{x:ie,y:se}}},bt=()=>{const v=l();if(k("鼠标释放",{currentMode:v,hasResizeState:!!z()}),z()){nn();return}v===me.DRAGGING?en():v===me.SELECTING&&tn(),ln()},en=()=>{const v=a();if(!v||!v.isDragging&&v.currentOffset.x===0&&v.currentOffset.y===0){k("拖拽完成，无实际移动");return}if(e.onBatchUpdatePositions&&v.elementIds.length>1){const p=v.elementIds.map(C=>{const w=v.startPositions.get(C);return w?{element_id:C,new_position:{x:w.x+v.currentOffset.x,y:w.y+v.currentOffset.y}}:null}).filter(Boolean);p.length>0&&(k("拖拽完成 - 批量更新",{elementCount:p.length}),e.onBatchUpdatePositions(p).catch(C=>{console.warn("批量更新最终位置失败:",C)}))}},tn=()=>{const v=c();v&&(k("框选完成",{selectedCount:v.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(v.selectedIds))},nn=()=>{const v=z();v&&(k("完成resize操作",{elementId:v.elementId}),i(!1),A(null))},ln=()=>{r(me.IDLE),B("default"),u(null),g(null),A(null),i(!1),P(),k("状态重置完成")};Me(async()=>{document.addEventListener("mousemove",E),document.addEventListener("mouseup",bt),k("修复版交互层已初始化")}),ct(()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",bt),k("修复版交互层已清理")});const Ne=()=>{const v=c();if(!v||l()!==me.SELECTING)return null;const{startPoint:p,currentPoint:C}=v;return{x:Math.min(p.x,C.x),y:Math.min(p.y,C.y),width:Math.abs(C.x-p.x),height:Math.abs(C.y-p.y)}};return(()=>{var v=yl();v.$$mousedown=j;var p=s;return typeof p=="function"?Ft(p,v):s=v,v.style.setProperty("position","absolute"),v.style.setProperty("top","0"),v.style.setProperty("left","0"),v.style.setProperty("width","100%"),v.style.setProperty("height","100%"),v.style.setProperty("z-index","10"),v.style.setProperty("pointer-events","all"),v.style.setProperty("background","transparent"),v.style.setProperty("user-select","none"),h(v,(()=>{var C=te(()=>!!Ne());return()=>C()&&(()=>{var w=ml();return w.style.setProperty("position","absolute"),w.style.setProperty("border","1px dashed #007acc"),w.style.setProperty("background","rgba(0, 122, 204, 0.1)"),w.style.setProperty("pointer-events","none"),I(M=>{var G=`${Ne().x}px`,W=`${Ne().y}px`,ie=`${Ne().width}px`,se=`${Ne().height}px`;return G!==M.e&&((M.e=G)!=null?w.style.setProperty("left",G):w.style.removeProperty("left")),W!==M.t&&((M.t=W)!=null?w.style.setProperty("top",W):w.style.removeProperty("top")),ie!==M.a&&((M.a=ie)!=null?w.style.setProperty("width",ie):w.style.removeProperty("width")),se!==M.o&&((M.o=se)!=null?w.style.setProperty("height",se):w.style.removeProperty("height")),M},{e:void 0,t:void 0,a:void 0,o:void 0}),w})()})(),null),h(v,(()=>{var C=te(()=>!!e.enableDebugMode);return()=>C()&&(()=>{var w=bl(),M=w.firstChild,G=M.nextSibling;G.firstChild;var W=G.nextSibling;W.firstChild;var ie=W.nextSibling;return ie.firstChild,w.style.setProperty("position","fixed"),w.style.setProperty("top","10px"),w.style.setProperty("right","10px"),w.style.setProperty("padding","8px"),w.style.setProperty("background","rgba(0, 0, 0, 0.8)"),w.style.setProperty("color","white"),w.style.setProperty("font-family","monospace"),w.style.setProperty("font-size","12px"),w.style.setProperty("border-radius","4px"),w.style.setProperty("z-index","9999"),w.style.setProperty("pointer-events","none"),h(G,l,null),h(W,()=>o().length,null),h(ie,R,null),h(w,(()=>{var se=te(()=>{var Z;return!!((Z=a())!=null&&Z.isDragging)});return()=>se()&&(()=>{var Z=pl(),De=Z.firstChild,xe=De.nextSibling;return xe.nextSibling,Z.style.setProperty("color","#ffeb3b"),h(Z,()=>{var He;return(He=a())==null?void 0:He.elementIds.length},xe),Z})()})(),null),h(w,(()=>{var se=te(()=>o().length>0);return()=>se()&&(()=>{var Z=xl(),De=Z.firstChild,xe=De.nextSibling;return xe.nextSibling,Z.style.setProperty("font-size","10px"),Z.style.setProperty("color","#ccc"),h(Z,()=>o().slice(0,3).join(", "),xe),h(Z,()=>o().length>3&&"...",xe),Z})()})(),null),w})()})(),null),v})()};pe(["mousedown"]);var _l=_("<div class=toolbar-section><div class=section-title>智能建议</div><button class=smart-align-button><div class=smart-icon>🎯</div><div class=smart-text></div></button><div class=smart-reason>"),$l=_("<div class=toolbar-status><div class=status-text>选择至少2个元素以使用对齐功能"),Sl=_('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>正在执行对齐操作...'),Cl=_('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>对齐</div><div class=button-group><button class="align-button left"title=左对齐><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=水平居中对齐><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=右对齐><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>垂直对齐</div><div class=button-group><button class="align-button top"title=顶部对齐><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=垂直居中对齐><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=底部对齐><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>分布</div><div class=button-group><button class="align-button distribute-h"title=水平均匀分布><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=垂直均匀分布><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const kl=(e,t)=>{if(e.length<2)return[];const i=e.map(n=>({x:n.position.x,y:n.position.y,width:n.size.width,height:n.size.height}));return i.map((n,s)=>{let l=n.x,r=n.y;switch(t){case"left":l=Math.min(...i.map(c=>c.x));break;case"right":l=Math.max(...i.map(c=>c.x+c.width))-n.width;break;case"top":r=Math.min(...i.map(c=>c.y));break;case"bottom":r=Math.max(...i.map(c=>c.y+c.height))-n.height;break;case"h_center":l=i.reduce((c,g)=>c+g.x+g.width/2,0)/i.length-n.width/2;break;case"v_center":r=i.reduce((c,g)=>c+g.y+g.height/2,0)/i.length-n.height/2;break}return{element_id:e[s].id,new_position:{x:l,y:r}}})},El=e=>{const{batchUpdatePositions:t,state:i}=Ce(),[n,s]=J(!1),l=()=>e.selectedElementIds().length>=2,r=()=>{const u=e.selectedElementIds();return i.elements.filter(c=>u.includes(c.id))},o=async u=>{const c=r();if(c.length<2){console.warn("对齐功能需要至少2个元素");return}try{s(!0),console.log(`🎯 执行${u}对齐:`,c.length,"个元素");const g=kl(c,u);await t(g),console.log("✅ 对齐操作完成"),e.onAlignmentComplete&&e.onAlignmentComplete(g)}catch(g){console.error("❌ 对齐操作失败:",g)}finally{s(!1)}},d=()=>r().length<2?null:{recommended:"left",reason:"建议左对齐",results:[]},a=()=>d();return(()=>{var u=Cl(),c=u.firstChild,g=c.firstChild,y=g.nextSibling,b=y.firstChild,x=b.nextSibling,O=x.nextSibling,P=c.nextSibling,z=P.firstChild,A=z.nextSibling,R=A.firstChild,B=R.nextSibling,k=B.nextSibling,N=P.nextSibling,U=N.firstChild,Y=U.nextSibling,T=Y.firstChild,L=T.nextSibling;return b.$$click=()=>o("left"),x.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"h_center")}),x.$$click=()=>o("h_center"),O.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"right")}),O.$$click=()=>o("right"),R.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"top")}),R.$$click=()=>o("top"),B.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"v_center")}),B.$$click=()=>o("v_center"),k.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"bottom")}),k.$$click=()=>o("bottom"),T.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"distribute_h")}),T.$$click=()=>o("distribute_h"),L.addEventListener("mouseenter",()=>{var $;return($=e.onAlignmentPreview)==null?void 0:$.call(e,"distribute_v")}),L.$$click=()=>o("distribute_v"),h(u,f(ee,{get when(){return te(()=>!!l())()&&a()},get children(){var $=_l(),V=$.firstChild,H=V.nextSibling,m=H.firstChild,E=m.nextSibling,F=H.nextSibling;return H.$$click=()=>o(a().recommended),h(E,()=>a().recommended==="left"&&"左对齐",null),h(E,()=>a().recommended==="right"&&"右对齐",null),h(E,()=>a().recommended==="top"&&"顶对齐",null),h(E,()=>a().recommended==="bottom"&&"底对齐",null),h(E,()=>a().recommended==="h_center"&&"水平居中",null),h(E,()=>a().recommended==="v_center"&&"垂直居中",null),h(F,()=>a().reason),I(j=>{var D=n(),X=a().reason;return D!==j.e&&(H.disabled=j.e=D),X!==j.t&&S(H,"title",j.t=X),j},{e:void 0,t:void 0}),$}}),null),h(u,f(ee,{get when(){return!l()},get children(){var $=$l(),V=$.firstChild;return V.firstChild,h(V,()=>e.selectedElementIds().length<3&&"，至少3个元素以使用分布功能",null),$}}),null),h(u,f(ee,{get when(){return n()},get children(){return Sl()}}),null),I($=>{var V=!l()||n(),H=!l()||n(),m=!l()||n(),E=!l()||n(),F=!l()||n(),j=!l()||n(),D=e.selectedElementIds().length<3||n(),X=e.selectedElementIds().length<3||n();return V!==$.e&&(b.disabled=$.e=V),H!==$.t&&(x.disabled=$.t=H),m!==$.a&&(O.disabled=$.a=m),E!==$.o&&(R.disabled=$.o=E),F!==$.i&&(B.disabled=$.i=F),j!==$.n&&(k.disabled=$.n=j),D!==$.s&&(T.disabled=$.s=D),X!==$.h&&(L.disabled=$.h=X),$},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()},Al=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=Al,document.head.appendChild(e)}pe(["click"]);var Pl=_("<div>"),zl=_('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),Dl=_("<span class=ml-2>Zoom: <!>%");const Tl=()=>{const{state:e,selectElement:t,clearSelection:i,createElement:n,selectMultiple:s,updateElement:l,batchUpdatePositions:r}=Ce();let o;const[d,a]=J([]),u=re(()=>e.elements.filter(A=>A.visible)),c=(A,R)=>{if(!o)return{x:0,y:0};const B=o.getBoundingClientRect(),k=(A-B.left)/e.canvas_config.zoom,N=(R-B.top)/e.canvas_config.zoom;return{x:k,y:N}},g=async A=>{console.log("🎯 选择元素",A),a([...A]);try{A.length===0?await i():A.length===1?await t(A[0]):await s([...A])}catch(R){console.error("❌ 选择元素失败:",R)}},y=async A=>{try{await r(A)}catch(R){console.error("❌ 批量更新位置失败:",R)}},b=async(A,R)=>{try{await l(A,{position:{x:R.x,y:R.y}})}catch(B){console.error("❌ 移动元素失败:",B)}},x=async(A,R,B)=>{try{await l(A,{size:R,position:B})}catch(k){console.error("❌ 调整大小失败:",k)}},O=async A=>{console.log("🖱️ 画布点击",A)},P=async A=>{var R;A.preventDefault();try{const B=(R=A.dataTransfer)==null?void 0:R.getData("application/json");if(!B)return;const{type:k,component:N}=JSON.parse(B);if(k==="component"){const{x:U,y:Y}=c(A.clientX,A.clientY),T=Math.max(0,U-N.default_size.width/2),L=Math.max(0,Y-N.default_size.height/2);console.log("🎯 通过拖放创建组件:",N.name,"at",T,L);const $=await n(N.id,{x:T,y:L},N.default_size,N.create_content());console.log("✅ 通过拖放创建元素成功:",$),a([$]),await t($)}}catch(B){console.error("拖放处理失败:",B)}};Me(()=>{a([...e.selected_ids])}),re(()=>{a([...e.selected_ids])});const z=re(()=>{const{width:A,height:R}=e.canvas_config;return`0 0 ${A} ${R}`});return(()=>{var A=zl(),R=A.firstChild,B=R.firstChild,k=B.firstChild,N=k.nextSibling,U=N.nextSibling,Y=U.nextSibling,T=Y.nextSibling,L=T.nextSibling,$=L.firstChild,V=$.nextSibling;V.nextSibling;var H=R.nextSibling,m=H.firstChild,E=m.firstChild,F=E.firstChild,j=F.firstChild,D=j.nextSibling,X=D.nextSibling,le=X.nextSibling;h(B,()=>e.canvas_config.width,N),h(B,()=>e.canvas_config.height,Y),h(B,(()=>{var K=te(()=>e.canvas_config.zoom!==1);return()=>K()&&(()=>{var ce=Dl(),he=ce.firstChild,ve=he.nextSibling;return ve.nextSibling,h(ce,()=>Math.round(e.canvas_config.zoom*100),ve),ce})()})(),L),h(L,()=>e.elements.length,V),h(L,()=>d().length,null),E.style.setProperty("position","relative"),F.addEventListener("drop",P),F.addEventListener("dragover",K=>{K.preventDefault(),K.dataTransfer.dropEffect="copy"}),F.$$contextmenu=K=>K.preventDefault();var oe=o;return typeof oe=="function"?Ft(oe,F):o=F,h(F,f(Zi,{get config(){return e.canvas_config}}),D),h(X,f(ge,{get each(){return u()},children:K=>f(ul,{element:K,get selected(){return d().includes(K.id)}})})),h(le,f(ge,{get each(){return u().filter(K=>d().includes(K.id))},children:K=>f(fl,{element:K})})),h(E,f(wl,{canvasRef:o,getAllElements:()=>[...e.elements],onElementsSelect:g,onElementMove:b,onBatchUpdatePositions:y,onElementResize:x,onCanvasClick:O,get enableDebugMode(){return!1}}),null),h(E,f(ee,{get when(){return d().length>=2},get children(){var K=Pl();return K.style.setProperty("position","fixed"),K.style.setProperty("top","80px"),K.style.setProperty("right","20px"),K.style.setProperty("z-index","1000"),K.style.setProperty("background","white"),K.style.setProperty("border-radius","8px"),K.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),K.style.setProperty("border","1px solid #e5e7eb"),h(K,f(El,{selectedElementIds:d,onAlignmentComplete:ce=>{console.log("✅ 对齐操作完成:",ce)},onAlignmentPreview:ce=>{console.log("👁️ 对齐预览:",ce)},onPreviewCancel:()=>{console.log("❌ 取消对齐预览")}})),K}}),null),I(K=>{var ce=e.canvas_config.width*e.canvas_config.zoom,he=e.canvas_config.height*e.canvas_config.zoom,ve=z(),ye=e.canvas_config.width,ze=e.canvas_config.height,ke=e.canvas_config.background_color,qe=e.canvas_config.width,Je=e.canvas_config.height;return ce!==K.e&&S(F,"width",K.e=ce),he!==K.t&&S(F,"height",K.t=he),ve!==K.a&&S(F,"viewBox",K.a=ve),ye!==K.o&&S(j,"width",K.o=ye),ze!==K.i&&S(j,"height",K.i=ze),ke!==K.n&&S(j,"fill",K.n=ke),qe!==K.s&&S(D,"width",K.s=qe),Je!==K.h&&S(D,"height",K.h=Je),K},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),A})()};pe(["contextmenu"]);var Ll=_('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),Ml=_('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Ul=_('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),Il=_('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Ol=_('<div class="text-xs text-gray-500 p-2">暂无元素');const Rl=()=>{const{state:e,createElement:t,selectElement:i,clearSelection:n}=Ce(),[s,l]=J(!1),r=[{name:"创建文字元素",action:async()=>{const u=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",u),u}},{name:"创建矩形元素",action:async()=>{const u=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",u),u}},{name:"创建线条元素",action:async()=>{const u=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",u),u}},{name:"创建数据字段",action:async()=>{const u=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",u),u}}],o=async u=>{try{console.log(`🧪 开始测试: ${u.name}`);const c=await u.action();await i(c),console.log(`✅ 测试完成: ${u.name}, 元素ID: ${c}`)}catch(c){console.error(`❌ 测试失败: ${u.name}`,c)}},d=async()=>{console.log("🚀 开始运行所有测试案例..."),await n();for(const u of r)await o(u),await new Promise(c=>setTimeout(c,500));console.log("🎉 所有测试案例运行完成!")},a=async()=>{try{console.log("🧹 清理所有测试元素..."),await n(),console.log("✅ 清理完成")}catch(u){console.error("❌ 清理失败:",u)}};return[(()=>{var u=Ll();return u.$$click=()=>l(!s()),u})(),te(()=>te(()=>!!s())()&&(()=>{var u=Ml(),c=u.firstChild,g=c.firstChild,y=g.nextSibling,b=c.nextSibling,x=b.firstChild,O=x.firstChild,P=O.firstChild,z=P.nextSibling,A=O.nextSibling,R=A.firstChild,B=R.nextSibling,k=A.nextSibling,N=k.firstChild,U=N.nextSibling,Y=k.nextSibling,T=Y.firstChild,L=T.nextSibling,$=b.nextSibling,V=$.firstChild,H=V.nextSibling,m=$.nextSibling;m.firstChild;var E=m.nextSibling,F=E.firstChild,j=F.nextSibling;return y.$$click=()=>l(!1),h(z,()=>e.elements.length),h(B,()=>e.selected_ids.length),h(U,()=>e.can_undo?"是":"否"),h(L,()=>e.can_redo?"是":"否"),V.$$click=d,H.$$click=a,h(m,f(ge,{each:r,children:D=>(()=>{var X=Ul();return X.$$click=()=>o(D),h(X,()=>D.name),X})()}),null),h(j,f(ge,{get each(){return e.elements},children:D=>(()=>{var X=Il(),le=X.firstChild,oe=le.nextSibling,K=oe.firstChild,ce=K.nextSibling;ce.nextSibling;var he=oe.nextSibling,ve=he.firstChild,ye=ve.nextSibling,ze=ye.nextSibling,ke=ze.nextSibling;return ke.nextSibling,X.$$click=()=>i(D.id),h(le,()=>D.content.type),h(oe,()=>D.id.slice(0,8),ce),h(he,()=>Math.round(D.position.x),ye),h(he,()=>Math.round(D.position.y),ke),I(()=>Ae(X,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(D.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),X})()}),null),h(j,(()=>{var D=te(()=>e.elements.length===0);return()=>D()&&Ol()})(),null),u})())]};pe(["click"]);class Re{static async getAvailableTypes(){return Q("get_available_data_source_types")}static async getConfigSchema(t){return Q("get_config_schema",{providerType:t})}static async getDefaultConfig(t){return Q("get_default_config",{providerType:t})}static async getExampleConfigs(t){return Q("get_example_configs",{providerType:t})}static async validateConfig(t,i){return Q("validate_config",{providerType:t,config:i})}static async testConnection(t,i){return Q("test_data_source_connection",{providerType:t,config:i})}static async createDataSource(t,i,n){return Q("create_data_source",{name:t,providerType:i,config:n})}static async listDataSources(){return Q("list_data_sources")}static async deleteDataSource(t){return Q("delete_data_source",{sourceId:t})}static async updateConfig(t,i){return Q("update_data_source_config",{sourceId:t,config:i})}static async getSchema(t){return Q("get_data_source_schema",{sourceId:t})}static async refreshSchema(t){return Q("refresh_data_source_schema",{sourceId:t})}static async discoverSchema(t,i){return Q("discover_schema",{providerType:t,config:i})}static async queryData(t,i){return Q("query_data_source",{sourceId:t,query:i})}static async getPreview(t,i,n){return Q("get_data_preview",{sourceId:t,path:i,limit:n})}static async searchData(t,i,n,s){return Q("search_data",{sourceId:t,searchTerm:i,fields:n,limit:s})}static async evaluateExpression(t,i,n){return Q("evaluate_expression",{sourceId:t,expression:i,context:n})}static async evaluateExpressionsBatch(t,i,n){return Q("evaluate_expressions_batch",{sourceId:t,expressions:i,context:n})}}var Fl=_("<div class=data-sources-panel><div class=panel-header><h2>数据源管理</h2><button class=close-btn>×</button></div><div class=panel-content>"),Jt=_("<div class=error-message>"),Bl=_("<div class=loading-message>加载中..."),Nl=_("<div class=empty-state><p>尚未配置任何数据源</p><button>添加第一个数据源"),Hl=_("<div class=sources-grid>"),jl=_("<div class=data-sources-list><div class=list-header><div class=list-title><h3>已配置的数据源 (<!>)</h3><button class=refresh-btn>🔄 刷新</button></div><button class=add-btn>+ 添加数据源"),Kl=_('<div class=source-card><div class=source-header><div class=source-info><h4></h4><span class=source-type></span></div><div class=source-status></div></div><div class=source-meta><div class=meta-item><span>创建时间:</span><span></span></div><div class=meta-item><span>最后更新:</span><span></span></div></div><div class=source-actions><button class="action-btn preview-btn">👁️ 预览</button><button class="action-btn test-btn">🔌 测试</button><button class="action-btn edit-btn">✏️ 编辑</button><button class="action-btn delete-btn">🗑️ 删除'),Vl=_('<div class=form-group><label>配置</label><textarea rows=10 placeholder="配置参数 (JSON格式)">'),Xl=_("<div class=add-data-source-form><div class=form-header><button class=back-btn>← 返回</button><h3>添加数据源</h3></div><form><div class=form-group><label>数据源名称</label><input type=text placeholder=输入数据源名称 required></div><div class=form-group><label>数据源类型</label><select required><option value>选择数据源类型</option></select></div><div class=form-actions><button type=button>取消</button><button type=submit>"),Gl=_("<option> - "),Wl=_("<div class=edit-data-source-form><div class=form-header><button class=back-btn>← 返回</button><h3>编辑数据源: </h3></div><p>编辑功能待实现"),Yl=_("<div class=data-preview><div class=preview-header><button class=back-btn>← 返回</button><h3>数据预览: </h3><div class=preview-info>共 <!> 行数据，显示前 <!> 行</div></div><div class=preview-table><table><thead><tr></tr></thead><tbody>"),ql=_("<th>"),Jl=_("<tr>"),Zl=_("<td>");function Ql(e){const[t,i]=J([]),[n,s]=J([]),[l,r]=J("list"),[o,d]=J(null),[a,u]=J(null),[c,g]=J(!1),[y,b]=J(null);Me(async()=>{try{await x(),await O()}catch(k){console.error("🚨 DataSourcesPanel初始化失败:",k),b(`数据源模块初始化失败: ${k}`)}});const x=async()=>{try{g(!0),console.log("🔄 开始加载数据源列表...");const k=await Re.listDataSources();console.log("✅ 数据源列表加载成功:",k),i(k),b(null)}catch(k){console.error("❌ 加载数据源失败:",k),b(`加载数据源失败: ${k}`)}finally{g(!1)}},O=async()=>{try{console.log("🔄 开始加载可用数据源类型...");const k=await Re.getAvailableTypes();console.log("✅ 数据源类型加载成功:",k),s(k)}catch(k){console.error("❌ 加载数据源类型失败:",k)}},P=()=>{r("add"),d(null)},z=k=>{d(k),r("edit")},A=async k=>{try{g(!0),d(k);const N=await Re.getPreview(k.id);u(N),r("preview")}catch(N){b(`预览数据失败: ${N}`)}finally{g(!1)}},R=async k=>{if(confirm("确定要删除这个数据源吗？"))try{await Re.deleteDataSource(k),await x()}catch(N){b(`删除数据源失败: ${N}`)}},B=async k=>{console.log("Testing connection for:",k)};return f(ee,{get when(){return e.isOpen},get children(){var k=Fl(),N=k.firstChild,U=N.firstChild,Y=U.nextSibling,T=N.nextSibling;return fe(Y,"click",e.onClose),h(T,f(ee,{get when(){return l()==="list"},get children(){return f(es,{get dataSources(){return t()},get loading(){return c()},get error(){return y()},onAdd:P,onEdit:z,onPreview:A,onDelete:R,onTestConnection:B,onRefresh:x})}}),null),h(T,f(ee,{get when(){return l()==="add"},get children(){return f(ts,{get availableTypes(){return n()},onBack:()=>r("list"),onSuccess:x})}}),null),h(T,f(ee,{get when(){return te(()=>l()==="edit")()&&o()},get children(){return f(ns,{get dataSource(){return o()},onBack:()=>r("list"),onSuccess:x})}}),null),h(T,f(ee,{get when(){return te(()=>!!(l()==="preview"&&o()))()&&a()},get children(){return f(is,{get dataSource(){return o()},get data(){return a()},onBack:()=>r("list")})}}),null),k}})}function es(e){const t=n=>{switch(n){case"active":return"#22c55e";case"error":return"#ef4444";case"disabled":return"#6b7280";default:return"#6b7280"}},i=n=>new Date(n).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(()=>{var n=jl(),s=n.firstChild,l=s.firstChild,r=l.firstChild,o=r.firstChild,d=o.nextSibling;d.nextSibling;var a=r.nextSibling,u=l.nextSibling;return h(r,()=>e.dataSources.length,d),fe(a,"click",e.onRefresh),fe(u,"click",e.onAdd),h(n,f(ee,{get when(){return e.error},get children(){var c=Jt();return h(c,()=>e.error),c}}),null),h(n,f(ee,{get when(){return e.loading},get children(){return Bl()}}),null),h(n,f(ee,{get when(){return!e.loading&&e.dataSources.length===0},get children(){var c=Nl(),g=c.firstChild,y=g.nextSibling;return fe(y,"click",e.onAdd),c}}),null),h(n,f(ee,{get when(){return!e.loading&&e.dataSources.length>0},get children(){var c=Hl();return h(c,f(ge,{get each(){return e.dataSources},children:g=>(()=>{var y=Kl(),b=y.firstChild,x=b.firstChild,O=x.firstChild,P=O.nextSibling,z=x.nextSibling,A=b.nextSibling,R=A.firstChild,B=R.firstChild,k=B.nextSibling,N=R.nextSibling,U=N.firstChild,Y=U.nextSibling,T=A.nextSibling,L=T.firstChild,$=L.nextSibling,V=$.nextSibling,H=V.nextSibling;return h(O,()=>g.name),h(P,()=>g.provider_type),h(k,()=>i(g.created_at)),h(Y,()=>i(g.last_updated)),L.$$click=()=>e.onPreview(g),$.$$click=()=>e.onTestConnection(g.id),V.$$click=()=>e.onEdit(g),H.$$click=()=>e.onDelete(g.id),I(m=>{var E=t(g.status),F=`状态: ${g.status}`,j=g.status!=="active";return E!==m.e&&((m.e=E)!=null?z.style.setProperty("background-color",E):z.style.removeProperty("background-color")),F!==m.t&&S(z,"title",m.t=F),j!==m.a&&(L.disabled=m.a=j),m},{e:void 0,t:void 0,a:void 0}),y})()})),c}}),null),I(()=>a.disabled=e.loading),n})()}function ts(e){const[t,i]=J(""),[n,s]=J(""),[l,r]=J({}),[o,d]=J(!1),[a,u]=J(null),c=async y=>{i(y);try{const b=await Re.getDefaultConfig(y);r(b)}catch(b){console.error("获取默认配置失败:",b)}},g=async y=>{if(y.preventDefault(),!t()||!n().trim()){u("请填写数据源名称并选择类型");return}const b=l();if(b.source_type==="file"){if(!b.file_path||b.file_path.trim()===""){u("选择文件类型时，请指定文件路径");return}}else if(b.source_type==="content"&&(!b.json_content||b.json_content.trim()==="")){u("选择内容类型时，请输入JSON内容");return}try{d(!0),await Re.createDataSource(n(),t(),l()),e.onSuccess(),e.onBack()}catch(x){u(`创建数据源失败: ${x}`)}finally{d(!1)}};return(()=>{var y=Xl(),b=y.firstChild,x=b.firstChild,O=b.nextSibling,P=O.firstChild,z=P.firstChild,A=z.nextSibling,R=P.nextSibling,B=R.firstChild,k=B.nextSibling;k.firstChild;var N=R.nextSibling,U=N.firstChild,Y=U.nextSibling;return fe(x,"click",e.onBack),O.addEventListener("submit",g),A.$$input=T=>s(T.currentTarget.value),k.addEventListener("change",T=>c(T.currentTarget.value)),h(k,f(ge,{get each(){return e.availableTypes},children:T=>(()=>{var L=Gl(),$=L.firstChild;return h(L,()=>T.display_name,$),h(L,()=>T.description,null),I(()=>L.value=T.type_name),L})()}),null),h(O,f(ee,{get when(){return t()},get children(){var T=Vl(),L=T.firstChild,$=L.nextSibling;return $.$$input=V=>{try{r(JSON.parse(V.currentTarget.value)),u(null)}catch{u("配置格式错误，请检查JSON格式")}},I(()=>$.value=JSON.stringify(l(),null,2)),T}}),N),h(O,f(ee,{get when(){return a()},get children(){var T=Jt();return h(T,a),T}}),N),fe(U,"click",e.onBack),h(Y,()=>o()?"创建中...":"创建数据源"),I(()=>Y.disabled=o()),I(()=>A.value=n()),I(()=>k.value=t()),y})()}function ns(e){return(()=>{var t=Wl(),i=t.firstChild,n=i.firstChild,s=n.nextSibling;return s.firstChild,fe(n,"click",e.onBack),h(s,()=>e.dataSource.name,null),t})()}function is(e){return(()=>{var t=Yl(),i=t.firstChild,n=i.firstChild,s=n.nextSibling;s.firstChild;var l=s.nextSibling,r=l.firstChild,o=r.nextSibling,d=o.nextSibling,a=d.nextSibling;a.nextSibling;var u=i.nextSibling,c=u.firstChild,g=c.firstChild,y=g.firstChild,b=g.nextSibling;return fe(n,"click",e.onBack),h(s,()=>e.dataSource.name,null),h(l,()=>e.data.total_rows,o),h(l,()=>e.data.rows.length,a),h(y,f(ge,{get each(){return e.data.columns},children:x=>(()=>{var O=ql();return h(O,x),O})()})),h(b,f(ge,{get each(){return e.data.rows.slice(0,50)},children:x=>(()=>{var O=Jl();return h(O,f(ge,{get each(){return e.data.columns},children:P=>(()=>{var z=Zl();return h(z,(()=>{var A=te(()=>typeof x[P]=="object");return()=>A()?JSON.stringify(x[P]):String(x[P]||"")})()),z})()})),O})()})),t})()}pe(["click","input"]);var ls=_('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const ss=()=>{const[e,t]=J(!1),i=()=>t(!0),n=()=>t(!1);return(()=>{var s=ls(),l=s.firstChild,r=l.firstChild,o=r.nextSibling,d=o.nextSibling;return h(s,f(On,{onOpenDataSources:i}),l),h(r,f(Bn,{})),h(o,f(Tl,{})),h(d,f(ji,{})),h(s,f(Rl,{}),null),h(s,f(Ql,{get isOpen(){return e()},onClose:n}),null),s})()},rs={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},os=()=>{const{state:e,copySelectedElements:t,pasteElements:i,deleteElements:n,undo:s,redo:l,selectAllElements:r,clearSelection:o,moveElements:d}=Ce(),a=(b,x)=>{const O=b.key.toLowerCase()===x.key.toLowerCase()||b.key===x.key,P=!!x.ctrl===(b.ctrlKey||b.metaKey),z=!!x.alt===b.altKey,A=!!x.shift===b.shiftKey;return O&&P&&z&&A},u=async b=>{console.log("🎯 执行快捷键:",b);try{switch(b){case"copy":e.selected_ids.length>0&&(await t(),g("复制成功","✅"));break;case"paste":const x={x:20,y:20},O=await i(x.x,x.y);O.length>0&&g(`粘贴 ${O.length} 个元素`,"📋");break;case"cut":e.selected_ids.length>0&&(await t(),await n([...e.selected_ids]),g("剪切成功","✂️"));break;case"delete":if(e.selected_ids.length>0){const P=e.selected_ids.length;await n([...e.selected_ids]),g(`删除 ${P} 个元素`,"🗑️")}break;case"undo":await s(),g("撤销","↶");break;case"redo":await l(),g("重做","↷");break;case"selectAll":await r(),g(`全选 ${e.elements.length} 个元素`,"🎯");break;case"clearSelection":e.selected_ids.length>0&&(o(),g("清除选择","⭕"));break;case"duplicate":if(e.selected_ids.length>0){await t();const P=await i(20,20);g(`复制 ${P.length} 个元素`,"📄")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await c(b);break;default:console.warn("未知的快捷键动作:",b)}}catch(x){console.error("快捷键执行失败:",x),g("操作失败","❌")}},c=async b=>{if(e.selected_ids.length===0)return;const x=b.includes("Fast"),O=x?10:1;let P=0,z=0;switch(b){case"moveUp":case"moveFastUp":z=-O;break;case"moveDown":case"moveFastDown":z=O;break;case"moveLeft":case"moveFastLeft":P=-O;break;case"moveRight":case"moveFastRight":P=O;break}(P!==0||z!==0)&&(await d([...e.selected_ids],P,z),x&&g(`快速移动 ${O}px`,"🔄"))},g=(b,x)=>{const O=document.createElement("div");O.className="keyboard-feedback",O.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${x}</span>
        <span class="feedback-text">${b}</span>
      </div>
    `,document.body.appendChild(O),setTimeout(()=>{O.parentNode&&O.parentNode.removeChild(O)},2e3)},y=b=>{const x=b.target;if(!(x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.contentEditable==="true")){for(const[P,z]of Object.entries(rs))if(a(b,z.combination)){b.preventDefault(),b.stopPropagation(),console.log("🎹 快捷键触发:",P,z.action),u(z.action);return}}};return Me(()=>{if(document.addEventListener("keydown",y,!0),console.log("🎹 键盘快捷键管理器已启动"),!document.getElementById("keyboard-feedback-styles")){const b=document.createElement("style");b.id="keyboard-feedback-styles",b.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(b)}}),ct(()=>{document.removeEventListener("keydown",y,!0),console.log("🎹 键盘快捷键管理器已停止")}),null},as=()=>(Me(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),f(Tn,{get children(){return[f(os,{}),f(ss,{})]}})),cs=document.getElementById("root");Sn(()=>f(as,{}),cs);
