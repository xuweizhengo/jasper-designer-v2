var fn=Object.defineProperty;var vn=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ce=(e,t,n)=>vn(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();const yn=!1,mn=(e,t)=>e===t,je=Symbol("solid-proxy"),wt=Symbol("solid-track"),rt={equals:mn};let Ft=Kt;const Re=1,st=2,Nt={owned:null,cleanups:null,context:null,owner:null};var ne=null;let pt=null,pn=null,ae=null,ge=null,De=null,ft=0;function lt(e,t){const n=ae,i=ne,l=e.length===0,r=t===void 0?i:t,s=l?Nt:{owned:null,cleanups:null,context:r?r.context:null,owner:r},o=l?e:()=>e(()=>_e(()=>et(s)));ne=s,ae=null;try{return Xe(o,!0)}finally{ae=n,ne=i}}function W(e,t){t=t?Object.assign({},rt,t):rt;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=l=>(typeof l=="function"&&(l=l(n.value)),Wt(n,l));return[Vt.bind(n),i]}function M(e,t,n){const i=Et(e,t,!1,Re);it(i)}function kt(e,t,n){Ft=_n;const i=Et(e,t,!1,Re);i.user=!0,De?De.push(i):it(i)}function ie(e,t,n){n=n?Object.assign({},rt,n):rt;const i=Et(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,it(i),Vt.bind(i)}function bn(e){return Xe(e,!1)}function _e(e){if(ae===null)return e();const t=ae;ae=null;try{return e()}finally{ae=t}}function Ie(e){kt(()=>_e(e))}function vt(e){return ne===null||(ne.cleanups===null?ne.cleanups=[e]:ne.cleanups.push(e)),e}function _t(){return ae}const[Or,Fr]=W(!1);function Bt(e,t){const n=Symbol("context");return{id:n,Provider:Sn(n),defaultValue:e}}function Ht(e){let t;return ne&&ne.context&&(t=ne.context[e.id])!==void 0?t:e.defaultValue}function jt(e){const t=ie(e),n=ie(()=>$t(t()));return n.toArray=()=>{const i=n();return Array.isArray(i)?i:i!=null?[i]:[]},n}function Vt(){if(this.sources&&this.state)if(this.state===Re)it(this);else{const e=ge;ge=null,Xe(()=>at(this),!1),ge=e}if(ae){const e=this.observers?this.observers.length:0;ae.sources?(ae.sources.push(this),ae.sourceSlots.push(e)):(ae.sources=[this],ae.sourceSlots=[e]),this.observers?(this.observers.push(ae),this.observerSlots.push(ae.sources.length-1)):(this.observers=[ae],this.observerSlots=[ae.sources.length-1])}return this.value}function Wt(e,t,n){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Xe(()=>{for(let l=0;l<e.observers.length;l+=1){const r=e.observers[l],s=pt&&pt.running;s&&pt.disposed.has(r),(s?!r.tState:!r.state)&&(r.pure?ge.push(r):De.push(r),r.observers&&qt(r)),s||(r.state=Re)}if(ge.length>1e6)throw ge=[],new Error},!1)),t}function it(e){if(!e.fn)return;et(e);const t=ft;xn(e,e.value,t)}function xn(e,t,n){let i;const l=ne,r=ae;ae=ne=e;try{i=e.fn(t)}catch(s){return e.pure&&(e.state=Re,e.owned&&e.owned.forEach(et),e.owned=null),e.updatedAt=n+1,Xt(s)}finally{ae=r,ne=l}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Wt(e,i):e.value=i,e.updatedAt=n)}function Et(e,t,n,i=Re,l){const r={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:ne,context:ne?ne.context:null,pure:n};return ne===null||ne!==Nt&&(ne.owned?ne.owned.push(r):ne.owned=[r]),r}function ot(e){if(e.state===0)return;if(e.state===st)return at(e);if(e.suspense&&_e(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ft);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===Re)it(e);else if(e.state===st){const i=ge;ge=null,Xe(()=>at(e,t[0]),!1),ge=i}}function Xe(e,t){if(ge)return e();let n=!1;t||(ge=[]),De?n=!0:De=[],ft++;try{const i=e();return wn(n),i}catch(i){n||(De=null),ge=null,Xt(i)}}function wn(e){if(ge&&(Kt(ge),ge=null),e)return;const t=De;De=null,t.length&&Xe(()=>Ft(t),!1)}function Kt(e){for(let t=0;t<e.length;t++)ot(e[t])}function _n(e){let t,n=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[n++]=i:ot(i)}for(t=0;t<n;t++)ot(e[t])}function at(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const i=e.sources[n];if(i.sources){const l=i.state;l===Re?i!==t&&(!i.updatedAt||i.updatedAt<ft)&&ot(i):l===st&&at(i,t)}}}function qt(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=st,n.pure?ge.push(n):De.push(n),n.observers&&qt(n))}}function et(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),i=e.sourceSlots.pop(),l=n.observers;if(l&&l.length){const r=l.pop(),s=n.observerSlots.pop();i<l.length&&(r.sourceSlots[s]=i,l[i]=r,n.observerSlots[i]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)et(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)et(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function $n(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Xt(e,t=ne){throw $n(e)}function $t(e){if(typeof e=="function"&&!e.length)return $t(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const i=$t(e[n]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return e}function Sn(e,t){return function(i){let l;return M(()=>l=_e(()=>(ne.context={...ne.context,[e]:i.value},jt(()=>i.children))),void 0),l}}const Cn=Symbol("fallback");function At(e){for(let t=0;t<e.length;t++)e[t]()}function kn(e,t,n={}){let i=[],l=[],r=[],s=0,o=t.length>1?[]:null;return vt(()=>At(r)),()=>{let c=e()||[],a=c.length,g,u;return c[wt],_e(()=>{let v,f,m,C,_,k,P,L,I;if(a===0)s!==0&&(At(r),r=[],i=[],l=[],s=0,o&&(o=[])),n.fallback&&(i=[Cn],l[0]=lt(z=>(r[0]=z,n.fallback())),s=1);else if(s===0){for(l=new Array(a),u=0;u<a;u++)i[u]=c[u],l[u]=lt(h);s=a}else{for(m=new Array(a),C=new Array(a),o&&(_=new Array(a)),k=0,P=Math.min(s,a);k<P&&i[k]===c[k];k++);for(P=s-1,L=a-1;P>=k&&L>=k&&i[P]===c[L];P--,L--)m[L]=l[P],C[L]=r[P],o&&(_[L]=o[P]);for(v=new Map,f=new Array(L+1),u=L;u>=k;u--)I=c[u],g=v.get(I),f[u]=g===void 0?-1:g,v.set(I,u);for(g=k;g<=P;g++)I=i[g],u=v.get(I),u!==void 0&&u!==-1?(m[u]=l[g],C[u]=r[g],o&&(_[u]=o[g]),u=f[u],v.set(I,u)):r[g]();for(u=k;u<a;u++)u in m?(l[u]=m[u],r[u]=C[u],o&&(o[u]=_[u],o[u](u))):l[u]=lt(h);l=l.slice(0,s=a),i=c.slice(0)}return l});function h(v){if(r[u]=v,o){const[f,m]=W(u);return o[u]=m,t(c[u],f)}return t(c[u])}}}function y(e,t){return _e(()=>e(t||{}))}const Gt=e=>`Stale read from <${e}>.`;function ye(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ie(kn(()=>e.each,e.children,t||void 0))}function J(e){const t=e.keyed,n=ie(()=>e.when,void 0,void 0),i=t?n:ie(n,void 0,{equals:(l,r)=>!l==!r});return ie(()=>{const l=i();if(l){const r=e.children;return typeof r=="function"&&r.length>0?_e(()=>r(t?l:()=>{if(!_e(i))throw Gt("Show");return n()})):r}return e.fallback},void 0,void 0)}function En(e){const t=jt(()=>e.children),n=ie(()=>{const i=t(),l=Array.isArray(i)?i:[i];let r=()=>{};for(let s=0;s<l.length;s++){const o=s,c=l[s],a=r,g=ie(()=>a()?void 0:c.when,void 0,void 0),u=c.keyed?g:ie(g,void 0,{equals:(h,v)=>!h==!v});r=()=>a()||(u()?[o,g,c]:void 0)}return r});return ie(()=>{const i=n()();if(!i)return e.fallback;const[l,r,s]=i,o=s.children;return typeof o=="function"&&o.length>0?_e(()=>o(s.keyed?r():()=>{var a;if(((a=_e(n)())==null?void 0:a[0])!==l)throw Gt("Match");return r()})):o},void 0,void 0)}function Je(e){return e}const te=e=>ie(()=>e());function An(e,t,n){let i=n.length,l=t.length,r=i,s=0,o=0,c=t[l-1].nextSibling,a=null;for(;s<l||o<r;){if(t[s]===n[o]){s++,o++;continue}for(;t[l-1]===n[r-1];)l--,r--;if(l===s){const g=r<i?o?n[o-1].nextSibling:n[r-o]:c;for(;o<r;)e.insertBefore(n[o++],g)}else if(r===o)for(;s<l;)(!a||!a.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[r-1]&&n[o]===t[l-1]){const g=t[--l].nextSibling;e.insertBefore(n[o++],t[s++].nextSibling),e.insertBefore(n[--r],g),t[l]=n[r]}else{if(!a){a=new Map;let u=o;for(;u<r;)a.set(n[u],u++)}const g=a.get(t[s]);if(g!=null)if(o<g&&g<r){let u=s,h=1,v;for(;++u<l&&u<r&&!((v=a.get(t[u]))==null||v!==g+h);)h++;if(h>g-o){const f=t[s];for(;o<g;)e.insertBefore(n[o++],f)}else e.replaceChild(n[o++],t[s++])}else s++;else t[s++].remove()}}}const Pt="_$DX_DELEGATE";function Pn(e,t,n,i={}){let l;return lt(r=>{l=r,t===document?e():d(t,e(),t.firstChild?null:void 0,n)},i.owner),()=>{l(),t.textContent=""}}function w(e,t,n,i){let l;const r=()=>{const o=i?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return o.innerHTML=e,n?o.content.firstChild.firstChild:i?o.firstChild:o.content.firstChild},s=t?()=>_e(()=>document.importNode(l||(l=r()),!0)):()=>(l||(l=r())).cloneNode(!0);return s.cloneNode=s,s}function $e(e,t=window.document){const n=t[Pt]||(t[Pt]=new Set);for(let i=0,l=e.length;i<l;i++){const r=e[i];n.has(r)||(n.add(r),t.addEventListener(r,Dn))}}function S(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function Ue(e,t){t==null?e.removeAttribute("class"):e.className=t}function me(e,t,n,i){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function Yt(e,t,n){if(!t)return n?S(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof n=="string"&&(i.cssText=n=void 0),n||(n={}),t||(t={});let l,r;for(r in n)t[r]==null&&i.removeProperty(r),delete n[r];for(r in t)l=t[r],l!==n[r]&&(i.setProperty(r,l),n[r]=l);return n}function Jt(e,t,n){return _e(()=>e(t,n))}function d(e,t,n,i){if(n!==void 0&&!i&&(i=[]),typeof t!="function")return ct(e,t,i,n);M(l=>ct(e,t(),l,n),i)}function Dn(e){let t=e.target;const n=`$$${e.type}`,i=e.target,l=e.currentTarget,r=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),s=()=>{const c=t[n];if(c&&!t.disabled){const a=t[`${n}Data`];if(a!==void 0?c.call(t,a,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&r(t.host),!0},o=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();r(c[0]);for(let a=0;a<c.length-2&&(t=c[a],!!s());a++){if(t._$host){t=t._$host,o();break}if(t.parentNode===l)break}}else o();r(i)}function ct(e,t,n,i,l){for(;typeof n=="function";)n=n();if(t===n)return n;const r=typeof t,s=i!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,r==="string"||r==="number"){if(r==="number"&&(t=t.toString(),t===n))return n;if(s){let o=n[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),n=Ve(e,n,i,o)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||r==="boolean")n=Ve(e,n,i);else{if(r==="function")return M(()=>{let o=t();for(;typeof o=="function";)o=o();n=ct(e,o,n,i)}),()=>n;if(Array.isArray(t)){const o=[],c=n&&Array.isArray(n);if(St(o,t,n,l))return M(()=>n=ct(e,o,n,i,!0)),()=>n;if(o.length===0){if(n=Ve(e,n,i),s)return n}else c?n.length===0?Dt(e,o,i):An(e,n,o):(n&&Ve(e),Dt(e,o));n=o}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=Ve(e,n,i,t);Ve(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function St(e,t,n,i){let l=!1;for(let r=0,s=t.length;r<s;r++){let o=t[r],c=n&&n[e.length],a;if(!(o==null||o===!0||o===!1))if((a=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))l=St(e,o,c)||l;else if(a==="function")if(i){for(;typeof o=="function";)o=o();l=St(e,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||l}else e.push(o),l=!0;else{const g=String(o);c&&c.nodeType===3&&c.data===g?e.push(c):e.push(document.createTextNode(g))}}return l}function Dt(e,t,n=null){for(let i=0,l=t.length;i<l;i++)e.insertBefore(t[i],n)}function Ve(e,t,n,i){if(n===void 0)return e.textContent="";const l=i||document.createTextNode("");if(t.length){let r=!1;for(let s=t.length-1;s>=0;s--){const o=t[s];if(l!==o){const c=o.parentNode===e;!r&&!s?c?e.replaceChild(l,o):e.insertBefore(l,n):c&&o.remove()}else r=!0}}else e.insertBefore(l,n);return[l]}var zn=w("<div class=preview-toggle-container><div class=current-mode-indicator><span class=mode-icon></span><span class=mode-text></span></div><button class=toggle-button><span class=button-icon></span><span class=button-text>"),Tn=w("<span class=loading-indicator>â³"),Ln=w("<div class=error-indicator>âŒ");const Zt=Bt(),Mn=e=>{const[t,n]=W({mode:"design",loading:!1,error:void 0}),i=g=>{n(u=>({...u,mode:g,error:void 0})),console.log(`ğŸ¯ é¢„è§ˆæ¨¡å¼åˆ‡æ¢: ${g==="design"?"è®¾è®¡æ¨¡å¼":"é¢„è§ˆæ¨¡å¼"}`),window.dispatchEvent(new CustomEvent("preview-mode-changed",{detail:{mode:g,timestamp:Date.now()}}))},a={state:t,actions:{setMode:i,toggleMode:()=>{const u=t().mode==="design"?"preview":"design";i(u)},setLoading:g=>{n(u=>({...u,loading:g}))},setError:g=>{n(u=>({...u,error:g,loading:!1}))},isDesignMode:()=>t().mode==="design",isPreviewMode:()=>t().mode==="preview"}};return y(Zt.Provider,{value:a,get children(){return e.children}})},Qt=()=>{const e=Ht(Zt);if(!e)throw new Error("usePreviewå¿…é¡»åœ¨PreviewProviderå†…ä½¿ç”¨");return e},Un=()=>{const{state:e,actions:t}=Qt(),n=r=>r==="design"?"ğŸ¨":"ğŸ”",i=r=>r==="design"?"è®¾è®¡æ¨¡å¼":"é¢„è§ˆæ¨¡å¼",l=()=>{const s=e().mode==="design"?"preview":"design";return`åˆ‡æ¢åˆ°${i(s)}`};return(()=>{var r=zn(),s=r.firstChild,o=s.firstChild,c=o.nextSibling,a=s.nextSibling,g=a.firstChild,u=g.nextSibling;return d(o,()=>n(e().mode)),d(c,()=>i(e().mode)),d(s,(()=>{var h=te(()=>!!e().loading);return()=>h()&&Tn()})(),null),me(a,"click",t.toggleMode),d(g,()=>e().mode==="design"?"ğŸ”":"ğŸ¨"),d(u,()=>e().mode==="design"?"é¢„è§ˆ":"è®¾è®¡"),d(r,(()=>{var h=te(()=>!!e().error);return()=>h()&&(()=>{var v=Ln();return M(()=>S(v,"title",e().error)),v})()})(),null),M(h=>{var v=e().loading,f=l();return v!==h.e&&(a.disabled=h.e=v),f!==h.t&&S(a,"title",h.t=f),h},{e:void 0,t:void 0}),r})()},zt={getModeDisplayText:e=>e==="design"?"è®¾è®¡æ¨¡å¼":"é¢„è§ˆæ¨¡å¼",getModeIcon:e=>e==="design"?"ğŸ¨":"ğŸ”",shouldShowExpression:e=>e==="design",shouldEvaluateExpression:e=>e==="preview",getModeTransitionClass:e=>`mode-${e}-active`};$e(["click"]);const Ct=Symbol("store-raw"),qe=Symbol("store-node"),Ae=Symbol("store-has"),en=Symbol("store-self");function tn(e){let t=e[je];if(!t&&(Object.defineProperty(e,je,{value:t=new Proxy(e,On)}),!Array.isArray(e))){const n=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let l=0,r=n.length;l<r;l++){const s=n[l];i[s].get&&Object.defineProperty(e,s,{enumerable:i[s].enumerable,get:i[s].get.bind(t)})}}return t}function dt(e){let t;return e!=null&&typeof e=="object"&&(e[je]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function tt(e,t=new Set){let n,i,l,r;if(n=e!=null&&e[Ct])return n;if(!dt(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,o=e.length;s<o;s++)l=e[s],(i=tt(l,t))!==l&&(e[s]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let c=0,a=s.length;c<a;c++)r=s[c],!o[r].get&&(l=e[r],(i=tt(l,t))!==l&&(e[r]=i))}return e}function ut(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function nt(e,t,n){if(e[t])return e[t];const[i,l]=W(n,{equals:!1,internal:!0});return i.$=l,e[t]=i}function Rn(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===je||t===qe||(delete n.value,delete n.writable,n.get=()=>e[je][t]),n}function nn(e){_t()&&nt(ut(e,qe),en)()}function In(e){return nn(e),Reflect.ownKeys(e)}const On={get(e,t,n){if(t===Ct)return e;if(t===je)return n;if(t===wt)return nn(e),n;const i=ut(e,qe),l=i[t];let r=l?l():e[t];if(t===qe||t===Ae||t==="__proto__")return r;if(!l){const s=Object.getOwnPropertyDescriptor(e,t);_t()&&(typeof r!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(r=nt(i,t,r)())}return dt(r)?tn(r):r},has(e,t){return t===Ct||t===je||t===wt||t===qe||t===Ae||t==="__proto__"?!0:(_t()&&nt(ut(e,Ae),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:In,getOwnPropertyDescriptor:Rn};function ht(e,t,n,i=!1){if(!i&&e[t]===n)return;const l=e[t],r=e.length;n===void 0?(delete e[t],e[Ae]&&e[Ae][t]&&l!==void 0&&e[Ae][t].$()):(e[t]=n,e[Ae]&&e[Ae][t]&&l===void 0&&e[Ae][t].$());let s=ut(e,qe),o;if((o=nt(s,t,l))&&o.$(()=>n),Array.isArray(e)&&e.length!==r){for(let c=e.length;c<r;c++)(o=s[c])&&o.$();(o=nt(s,"length",r))&&o.$(e.length)}(o=s[en])&&o.$()}function ln(e,t){const n=Object.keys(t);for(let i=0;i<n.length;i+=1){const l=n[i];ht(e,l,t[l])}}function Fn(e,t){if(typeof t=="function"&&(t=t(e)),t=tt(t),Array.isArray(t)){if(e===t)return;let n=0,i=t.length;for(;n<i;n++){const l=t[n];e[n]!==l&&ht(e,n,l)}ht(e,"length",i)}else ln(e,t)}function Qe(e,t,n=[]){let i,l=e;if(t.length>1){i=t.shift();const s=typeof i,o=Array.isArray(e);if(Array.isArray(i)){for(let c=0;c<i.length;c++)Qe(e,[i[c]].concat(t),n);return}else if(o&&s==="function"){for(let c=0;c<e.length;c++)i(e[c],c)&&Qe(e,[c].concat(t),n);return}else if(o&&s==="object"){const{from:c=0,to:a=e.length-1,by:g=1}=i;for(let u=c;u<=a;u+=g)Qe(e,[u].concat(t),n);return}else if(t.length>1){Qe(e[i],t,[i].concat(n));return}l=e[i],n=[i].concat(n)}let r=t[0];typeof r=="function"&&(r=r(l,n),r===l)||i===void 0&&r==null||(r=tt(r),i===void 0||dt(l)&&dt(r)&&!Array.isArray(r)?ln(l,r):ht(e,i,r))}function Nn(...[e,t]){const n=tt(e||{}),i=Array.isArray(n),l=tn(n);function r(...s){bn(()=>{i&&s.length===1?Fn(n,s[0]):Qe(n,s)})}return[l,r]}function Bn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Tt(e,t=!1){const n=Bn(),i=`_${n}`;return Object.defineProperty(window,i,{value:l=>(t&&Reflect.deleteProperty(window,i),e==null?void 0:e(l)),writable:!1,configurable:!0}),n}async function ee(e,t={}){return new Promise((n,i)=>{const l=Tt(s=>{n(s),Reflect.deleteProperty(window,`_${r}`)},!0),r=Tt(s=>{i(s),Reflect.deleteProperty(window,`_${l}`)},!0);window.__TAURI_IPC__({cmd:e,callback:l,error:r,...t})})}const rn=Bt(),Hn=e=>{const[t,n]=Nn({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[i,l]=W(!1),[r,s]=W(null),[o,c]=W(!1),a=async()=>{try{l(!0),console.log("ğŸ”„ Loading app state...");const b=await ee("get_app_state");console.log("ğŸ”„ App state loaded, selected_ids:",b.selected_ids),n(b)}catch(b){console.error("Failed to load app state:",b)}finally{l(!1)}};Ie(()=>{a()});const g=async(b,D,B,T={})=>{try{l(!0);const V=await ee("create_element",{request:{element_type:b,position:D,size:B,content_data:T}});return await a(),V}catch(V){throw console.error("Failed to create element:",V),V}finally{l(!1)}},u=async(b,D)=>{try{l(!0),await ee("update_element",{request:{id:b,updates:D}}),await a()}catch(B){throw console.error("Failed to update element:",B),B}finally{l(!1)}},h=async b=>{try{l(!0),await ee("batch_update_positions",{request:{updates:b}}),n(D=>{const B=D.elements.map(T=>{const V=b.find(Z=>Z.element_id===T.id);return V?{...T,position:V.new_position}:T});return{...D,elements:B,dirty:!0}}),console.log("ğŸš€ Optimized batch position update completed without full reload")}catch(D){throw console.error("Failed to batch update positions:",D),await a(),D}finally{l(!1)}},v=async b=>{try{l(!0),await ee("delete_element",{elementId:b}),await a()}catch(D){throw console.error("Failed to delete element:",D),D}finally{l(!1)}},f=async b=>{try{console.log("Selecting element:",b),await ee("select_element",{elementId:b}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(D){throw console.error("Failed to select element:",D),D}},m=async b=>{try{console.log("Selecting multiple elements:",b),b.length>0?(await ee("select_multiple",{elementIds:b}),console.log("âœ… Multi-select completed for:",b.length,"elements")):await ee("clear_selection"),await a()}catch(D){throw console.error("Failed to select multiple elements:",D),D}},C=async b=>{try{console.log("Adding to selection:",b),await ee("add_to_selection",{elementId:b}),await a()}catch(D){throw console.error("Failed to add to selection:",D),D}},_=async b=>{try{console.log("Removing from selection:",b),await ee("remove_from_selection",{elementId:b}),await a()}catch(D){throw console.error("Failed to remove from selection:",D),D}},k=async b=>{try{console.log("Toggling selection:",b),await ee("toggle_selection",{elementId:b}),await a()}catch(D){throw console.error("Failed to toggle selection:",D),D}},P=async()=>{try{await ee("clear_selection"),await a()}catch(b){throw console.error("Failed to clear selection:",b),b}},L=async()=>{try{await ee("copy_selected")}catch(b){throw console.error("Failed to copy selected elements:",b),b}},H={state:t,createElement:g,updateElement:u,batchUpdatePositions:h,deleteElement:v,selectElement:f,selectMultiple:m,addToSelection:C,removeFromSelection:_,toggleSelection:k,clearSelection:P,copySelected:L,copySelectedElements:async()=>L(),pasteElements:async(b,D)=>{try{l(!0);const B=await ee("paste_elements",{offsetX:b,offsetY:D});return await a(),B}catch(B){throw console.error("Failed to paste elements:",B),B}finally{l(!1)}},deleteElements:async b=>{try{l(!0);for(const D of b)await ee("delete_element",{elementId:D});await a()}catch(D){throw console.error("Failed to delete elements:",D),D}finally{l(!1)}},selectAllElements:async()=>{try{const b=t.elements.map(D=>D.id);await m(b)}catch(b){throw console.error("Failed to select all elements:",b),b}},moveElements:async(b,D,B)=>{try{l(!0);const T=t.elements.filter(V=>b.includes(V.id)).map(V=>({element_id:V.id,new_position:{x:V.position.x+D,y:V.position.y+B}}));T.length>0&&await h(T)}catch(T){throw console.error("Failed to move elements:",T),T}finally{l(!1)}},undo:async()=>{try{l(!0),await ee("undo"),await a()}catch(b){throw console.error("Failed to undo:",b),b}finally{l(!1)}},redo:async()=>{try{l(!0),await ee("redo"),await a()}catch(b){throw console.error("Failed to redo:",b),b}finally{l(!1)}},updateCanvasConfig:async b=>{try{l(!0),await ee("update_canvas_config",{request:b}),await a()}catch(D){throw console.error("Failed to update canvas config:",D),D}finally{l(!1)}},getElementsAtPoint:async(b,D)=>{try{return await ee("get_elements_at_point",{x:b,y:D})}catch(B){return console.error("Failed to get elements at point:",B),[]}},isLoading:i,setLoading:l,dragOperation:r,setDragOperation:s,resizeOperation:o,setResizeOperation:c};return y(rn.Provider,{value:H,get children(){return e.children}})},Oe=()=>{const e=Ht(rn);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var jn=w("<span class=text-warning>â—"),Vn=w("<span class=ml-2> ä¸ªå…ƒç´ "),Wn=w('<span class="ml-2 text-primary">å·²é€‰æ‹© <!> ä¸ª'),Kn=w('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="æ–°å»º (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>æ–°å»º</span></button><button class=toolbar-btn title="æ‰“å¼€ (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>æ‰“å¼€</span></button><button class=toolbar-btn title="ä¿å­˜ (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>ä¿å­˜</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=æ•°æ®æºç®¡ç†><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg><span>æ•°æ®æº</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="ç¼©å° (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>é€‚åº”çª—å£</option></select><button class=toolbar-btn-icon title="æ”¾å¤§ (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="æ˜¾ç¤ºç½‘æ ¼ (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="æ˜¾ç¤ºæ ‡å°º (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="å¼€å¯/å…³é—­å¼€å‘è€…å·¥å…· (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const qn=e=>{const{state:t,undo:n,redo:i,updateCanvasConfig:l}=Oe(),[r,s]=W(t.canvas_config.zoom*100),o=async v=>{const f=v/100;s(v);try{await l({zoom:f})}catch(m){console.error("Failed to update zoom:",m)}},c=()=>{const v=Math.min(r()+25,500);o(v)},a=()=>{const v=Math.max(r()-25,25);o(v)},g=async()=>{try{await l({show_grid:!t.canvas_config.show_grid})}catch(v){console.error("Failed to toggle grid:",v)}},u=async()=>{try{await l({show_rulers:!t.canvas_config.show_rulers})}catch(v){console.error("Failed to toggle rulers:",v)}},h=async()=>{try{await ee("toggle_devtools"),console.log("ğŸ”§ DevTools toggled")}catch(v){console.error("Failed to toggle DevTools:",v)}};return(()=>{var v=Kn(),f=v.firstChild,m=f.firstChild,C=m.nextSibling,_=C.nextSibling,k=_.nextSibling,P=k.nextSibling,L=f.nextSibling,I=L.firstChild,z=I.nextSibling,N=z.nextSibling,U=N.nextSibling,K=U.nextSibling,R=K.nextSibling,F=R.nextSibling,E=F.nextSibling,q=E.nextSibling,H=q.nextSibling,b=H.nextSibling,D=L.nextSibling,B=D.firstChild;return d(f,y(Un,{}),P),me(P,"click",e.onOpenDataSources),me(I,"click",n),me(z,"click",i),U.$$click=a,K.addEventListener("change",T=>{const V=T.target.value;if(V==="fit")console.log("Fit to window");else{const Z=parseInt(V.replace("%",""));o(Z)}}),R.$$click=c,E.$$click=g,q.$$click=u,b.$$click=h,d(D,y(J,{get when(){return t.dirty},get children(){return jn()}}),B),d(B,()=>t.template_name||"æœªå‘½åæ¨¡æ¿"),d(D,y(J,{get when(){return t.elements.length>0},get children(){var T=Vn(),V=T.firstChild;return d(T,()=>t.elements.length,V),T}}),null),d(D,y(J,{get when(){return t.selected_ids.length>0},get children(){var T=Wn(),V=T.firstChild,Z=V.nextSibling;return Z.nextSibling,d(T,()=>t.selected_ids.length,Z),T}}),null),M(T=>{var V=`toolbar-btn-icon ${t.can_undo?"":"opacity-50 cursor-not-allowed"}`,Z=!t.can_undo,ue=`æ’¤é”€${t.undo_description?` (${t.undo_description})`:""} (Ctrl+Z)`,de=`toolbar-btn-icon ${t.can_redo?"":"opacity-50 cursor-not-allowed"}`,j=!t.can_redo,ce=`é‡åš${t.redo_description?` (${t.redo_description})`:""} (Ctrl+Y)`,xe=`toolbar-btn-icon ${t.canvas_config.show_grid?"active":""}`,pe=`toolbar-btn-icon ${t.canvas_config.show_rulers?"active":""}`;return V!==T.e&&Ue(I,T.e=V),Z!==T.t&&(I.disabled=T.t=Z),ue!==T.a&&S(I,"title",T.a=ue),de!==T.o&&Ue(z,T.o=de),j!==T.i&&(z.disabled=T.i=j),ce!==T.n&&S(z,"title",T.n=ce),xe!==T.s&&Ue(E,T.s=xe),pe!==T.h&&Ue(q,T.h=pe),T},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),M(()=>K.value=`${Math.round(r())}%`),v})()};$e(["click"]);var Xn=w('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">ç»„ä»¶åº“</h2><input type=text placeholder=æœç´¢ç»„ä»¶... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">åŸºç¡€ç»„ä»¶</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">æ•°æ®ç»„ä»¶</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">é“¶è¡Œç»„ä»¶</h3><div class="grid grid-cols-2 gap-2">'),Gn=w('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const Yn=()=>{const{createElement:e}=Oe(),[t,n]=W(""),i=[{id:"text",name:"æ–‡å­—",category:"basic",icon:"ğŸ“",description:"é™æ€æ–‡å­—æ ‡ç­¾",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"æ–‡å­—å†…å®¹",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"æ•°æ®å­—æ®µ",category:"data",icon:"ğŸ”—",description:"åŠ¨æ€æ•°æ®å­—æ®µ",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"çŸ©å½¢",category:"basic",icon:"â–­",description:"çŸ©å½¢æ¡†æ¶",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"çº¿æ¡",category:"basic",icon:"â”",description:"åˆ†éš”çº¿",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"å›¾ç‰‡",category:"basic",icon:"ğŸ–¼ï¸",description:"å›¾ç‰‡å ä½ç¬¦",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"å›¾ç‰‡"})}],l=[{id:"bank_header",name:"é“¶è¡ŒæŠ¬å¤´",category:"bank",icon:"ğŸ¦",description:"é“¶è¡Œæ ‡é¢˜å’ŒLogoåŒºåŸŸ",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"ä¸­å›½å·¥å•†é“¶è¡Œç”µå­å›å•",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"é‡‘é¢å­—æ®µ",category:"bank",icon:"ğŸ’°",description:"æ ¼å¼åŒ–é‡‘é¢æ˜¾ç¤º",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"å®¢æˆ·ä¿¡æ¯",category:"bank",icon:"ğŸ‘¤",description:"å®¢æˆ·å§“åå’Œè´¦å·",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],r=[...i,...l],s=()=>{const a=t().toLowerCase();return a?r.filter(g=>g.name.toLowerCase().includes(a)||g.description.toLowerCase().includes(a)):r},o=(a,g)=>{if(console.log("Starting drag for component:",a.id),g.dataTransfer){g.dataTransfer.effectAllowed="copy",g.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const u=document.createElement("div");u.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,u.style.position="absolute",u.style.top="-1000px",document.body.appendChild(u),g.dataTransfer.setDragImage(u,50,20),setTimeout(()=>{document.body.removeChild(u)},0)}},c=async a=>{try{const g=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",g)}catch(g){console.error("Failed to create element:",g)}};return(()=>{var a=Xn(),g=a.firstChild,u=g.firstChild,h=u.nextSibling,v=g.nextSibling,f=v.firstChild,m=f.firstChild,C=m.firstChild,_=C.nextSibling,k=m.nextSibling,P=k.firstChild,L=P.nextSibling,I=k.nextSibling,z=I.firstChild,N=z.nextSibling;return h.$$input=U=>n(U.target.value),d(_,y(ye,{get each(){return s().filter(U=>U.category==="basic")},children:U=>y(bt,{component:U,onDrag:K=>o(U,K),onClick:()=>c(U)})})),d(L,y(ye,{get each(){return s().filter(U=>U.category==="data")},children:U=>y(bt,{component:U,onDrag:K=>o(U,K),onClick:()=>c(U)})})),d(N,y(ye,{get each(){return s().filter(U=>U.category==="bank")},children:U=>y(bt,{component:U,onDrag:K=>o(U,K),onClick:()=>c(U)})})),M(()=>h.value=t()),a})()},bt=e=>(()=>{var t=Gn(),n=t.firstChild,i=n.firstChild,l=i.nextSibling;return me(t,"click",e.onClick),t.addEventListener("dragstart",r=>e.onDrag(r)),S(t,"draggable",!0),d(i,()=>e.component.icon),d(l,()=>e.component.name),M(()=>S(t,"title",e.component.description)),t})();$e(["input","click"]);class Se{static async getAvailableTypes(){return ee("get_available_data_source_types")}static async getConfigSchema(t){return ee("get_config_schema",{providerType:t})}static async getDefaultConfig(t){return ee("get_default_config",{providerType:t})}static async getExampleConfigs(t){return ee("get_example_configs",{providerType:t})}static async validateConfig(t,n){return ee("validate_config",{providerType:t,config:n})}static async testConnection(t,n){return ee("test_data_source_connection",{providerType:t,config:n})}static async createDataSource(t,n,i){return ee("create_data_source",{name:t,providerType:n,config:i})}static async listDataSources(){return ee("list_data_sources")}static async deleteDataSource(t){return ee("delete_data_source",{sourceId:t})}static async updateConfig(t,n){return ee("update_data_source_config",{sourceId:t,config:n})}static async getSchema(t){return ee("get_data_source_schema",{sourceId:t})}static async refreshSchema(t){return ee("refresh_data_source_schema",{sourceId:t})}static async discoverSchema(t,n){return ee("discover_schema",{providerType:t,config:n})}static async queryData(t,n){return ee("query_data_source",{sourceId:t,query:n})}static async getPreview(t,n,i){return ee("get_data_preview",{sourceId:t,path:n,limit:i})}static async searchData(t,n,i,l){return ee("search_data",{sourceId:t,searchTerm:n,fields:i,limit:l})}static async evaluateExpression(t,n,i){return ee("evaluate_expression",{sourceId:t,expression:n,context:i})}static async evaluateExpressionsBatch(t,n,i){return ee("evaluate_expressions_batch",{sourceId:t,expressions:n,context:i})}}const Jn="modulepreload",Zn=function(e){return"/"+e},Lt={},Qn=function(t,n,i){let l=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));l=Promise.allSettled(n.map(c=>{if(c=Zn(c),c in Lt)return;Lt[c]=!0;const a=c.endsWith(".css"),g=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":Jn,a||(u.as="script"),u.crossOrigin="",u.href=c,o&&u.setAttribute("nonce",o),document.head.appendChild(u),a)return new Promise((h,v)=>{u.addEventListener("load",h),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return l.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return t().catch(r)})};class ei{constructor(){Ce(this,"styles",new Map);Ce(this,"elementStyleMap",new Map);Ce(this,"observers",new Set);Ce(this,"initialized",!1);console.log("ğŸ¨ TextStyleManager åˆå§‹åŒ–ä¸­...")}async initialize(){if(!this.initialized)try{await this.loadSystemStyles(),await this.loadUserStyles(),this.initialized=!0,console.log(`âœ… TextStyleManager åˆå§‹åŒ–å®Œæˆï¼ŒåŠ è½½äº† ${this.styles.size} ä¸ªæ ·å¼`)}catch(t){throw console.error("âŒ TextStyleManager åˆå§‹åŒ–å¤±è´¥:",t),t}}createStyle(t){const n=`style_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...t,id:n,metadata:{createdAt:new Date,lastModified:new Date,author:"user",usageCount:0,isSystemStyle:!1,tags:[]}};return this.styles.set(n,i),this.notifyObservers("style-created",n),this.saveUserStyles(),console.log(`ğŸ¨ åˆ›å»ºæ–°æ ·å¼: ${i.name} (${n})`),n}getStyle(t){return this.styles.get(t)||null}updateStyle(t,n){const i=this.styles.get(t);if(!i)return console.warn(`âš ï¸ æ ·å¼ ${t} ä¸å­˜åœ¨`),!1;if(i.metadata.isSystemStyle)return console.warn(`âš ï¸ æ— æ³•ä¿®æ”¹ç³»ç»Ÿé¢„è®¾æ ·å¼ ${t}`),!1;const l={...i,style:{...i.style,...n},metadata:{...i.metadata,lastModified:new Date}};return this.styles.set(t,l),this.syncAllStyleInstances(t),this.saveUserStyles(),this.notifyObservers("style-updated",t),console.log(`ğŸ”„ æ ·å¼å·²æ›´æ–°: ${i.name} (${t})`),!0}deleteStyle(t){const n=this.styles.get(t);if(!n)return!1;if(n.metadata.isSystemStyle)return console.warn(`âš ï¸ æ— æ³•åˆ é™¤ç³»ç»Ÿé¢„è®¾æ ·å¼ ${t}`),!1;const i=Array.from(this.elementStyleMap.entries()).filter(([l,r])=>r===t).map(([l,r])=>l);return i.length>0?(console.warn(`âš ï¸ æ— æ³•åˆ é™¤æ ·å¼ ${t}ï¼Œä»æœ‰ ${i.length} ä¸ªå…ƒç´ åœ¨ä½¿ç”¨`),!1):(this.styles.delete(t),this.saveUserStyles(),this.notifyObservers("style-deleted",t),console.log(`ğŸ—‘ï¸ æ ·å¼å·²åˆ é™¤: ${n.name} (${t})`),!0)}applyStyleToElement(t,n){const i=this.styles.get(n);if(!i)return{success:!1,elementId:t,styleId:n,appliedAt:new Date,error:`æ ·å¼ ${n} ä¸å­˜åœ¨`};try{const l=this.elementStyleMap.get(t);if(this.elementStyleMap.set(t,n),i.metadata.usageCount++,l&&l!==n){const r=this.styles.get(l);r&&(r.metadata.usageCount=Math.max(0,r.metadata.usageCount-1))}return this.applyStyleToDOM(t,i.style),this.notifyObservers("style-applied",{elementId:t,styleId:n}),console.log(`ğŸ¯ åº”ç”¨æ ·å¼: ${i.name} â†’ å…ƒç´  ${t}`),{success:!0,elementId:t,styleId:n,appliedAt:new Date}}catch(l){return console.error(`âŒ åº”ç”¨æ ·å¼å¤±è´¥: ${l}`),{success:!1,elementId:t,styleId:n,appliedAt:new Date,error:l instanceof Error?l.message:String(l)}}}getElementStyleId(t){return this.elementStyleMap.get(t)||null}removeElementStyle(t){const n=this.elementStyleMap.get(t);if(n){this.elementStyleMap.delete(t);const i=this.styles.get(n);i&&(i.metadata.usageCount=Math.max(0,i.metadata.usageCount-1)),console.log(`ğŸ”— ç§»é™¤å…ƒç´ æ ·å¼æ˜ å°„: å…ƒç´  ${t}`)}}getStylesByCategory(t){const n=Array.from(this.styles.values());return(t?n.filter(l=>l.category===t):n).sort((l,r)=>l.metadata.isSystemStyle!==r.metadata.isSystemStyle?l.metadata.isSystemStyle?-1:1:r.metadata.usageCount-l.metadata.usageCount)}searchStyles(t,n){const i=this.getStylesByCategory(n),l=t.toLowerCase().trim();return l?i.filter(r=>r.name.toLowerCase().includes(l)||r.description.toLowerCase().includes(l)||r.metadata.tags.some(s=>s.toLowerCase().includes(l))):i}getStyleUsageStats(){const t=[];for(const[n,i]of this.styles){const l=Array.from(this.elementStyleMap.entries()).filter(([r,s])=>s===n).map(([r,s])=>r);t.push({styleId:n,usageCount:l.length,elements:l,lastUsed:i.metadata.lastModified})}return t.sort((n,i)=>i.usageCount-n.usageCount)}cleanupUnusedStyles(){const t=new Set(this.elementStyleMap.values()),n=[];for(const[i,l]of this.styles)!t.has(i)&&!l.metadata.isSystemStyle&&(this.styles.delete(i),n.push(i),console.log(`ğŸ§¹ æ¸…ç†æœªä½¿ç”¨æ ·å¼: ${l.name} (${i})`));return n.length>0&&this.saveUserStyles(),n}exportStyles(t){const n=t?t.map(l=>this.styles.get(l)).filter(Boolean):Array.from(this.styles.values()),i=new Set(n.map(l=>l.category));return{version:"2.0.0",exportedAt:new Date,styles:n,metadata:{totalStyles:n.length,categories:Array.from(i),author:"user"}}}async importStyles(t){const n=[];for(const i of t.styles){if(Array.from(this.styles.values()).find(s=>s.name===i.name&&s.category===i.category)){console.warn(`âš ï¸ è·³è¿‡å·²å­˜åœ¨çš„æ ·å¼: ${i.name}`);continue}const r=this.createStyle({name:i.name,description:i.description,category:i.category,style:i.style,...i.inheritance&&{inheritance:i.inheritance}});n.push(r)}return console.log(`ğŸ“¦ å¯¼å…¥å®Œæˆï¼Œå…±å¯¼å…¥ ${n.length} ä¸ªæ ·å¼`),n}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}syncAllStyleInstances(t){const n=this.styles.get(t);if(!n)return;const i=[];for(const[l,r]of this.elementStyleMap)r===t&&(this.applyStyleToDOM(l,n.style),i.push(l));this.notifyObservers("styles-synced",{styleId:t,affectedElements:i}),console.log(`ğŸ”„ æ ·å¼åŒæ­¥å®Œæˆ: ${t} â†’ ${i.length} ä¸ªå…ƒç´ `)}applyStyleToDOM(t,n){console.log(`ğŸ¨ åº”ç”¨æ ·å¼åˆ°DOM: å…ƒç´  ${t}`,{font_family:n.font_family,font_size:n.font_size,typography:n.typography})}async loadSystemStyles(){try{const{BANK_TEXT_STYLES:t}=await Qn(async()=>{const{BANK_TEXT_STYLES:n}=await import("./bank-text-styles-BtzE7aIi.js");return{BANK_TEXT_STYLES:n}},[]);for(const n of t)this.styles.set(n.id,n);console.log(`ğŸ¦ åŠ è½½äº† ${t.length} ä¸ªé“¶è¡Œé¢„è®¾æ ·å¼`)}catch(t){console.warn("âš ï¸ åŠ è½½ç³»ç»Ÿæ ·å¼å¤±è´¥:",t)}}async loadUserStyles(){try{const t=localStorage.getItem("jasper-text-styles");if(t){const n=JSON.parse(t);for(const i of n)i.metadata.createdAt=new Date(i.metadata.createdAt),i.metadata.lastModified=new Date(i.metadata.lastModified),this.styles.set(i.id,i);console.log(`ğŸ‘¤ åŠ è½½äº† ${n.length} ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ ·å¼`)}}catch(t){console.warn("âš ï¸ åŠ è½½ç”¨æˆ·æ ·å¼å¤±è´¥:",t)}}saveUserStyles(){try{const t=Array.from(this.styles.values()).filter(n=>!n.metadata.isSystemStyle);localStorage.setItem("jasper-text-styles",JSON.stringify(t)),console.log(`ğŸ’¾ ä¿å­˜äº† ${t.length} ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ ·å¼`)}catch(t){console.error("âŒ ä¿å­˜ç”¨æˆ·æ ·å¼å¤±è´¥:",t)}}notifyObservers(t,n){for(const i of this.observers)try{i.onStyleChange(t,n)}catch(l){console.error("âŒ è§‚å¯Ÿè€…é€šçŸ¥å¤±è´¥:",l)}}}const ve=new ei;class ti{calculateUnifiedBounds(t,n,i){const l=this.calculateFontMetrics(n),r=this.measureTextContent(t,n,i.width),s=this.calculateContainerHeight(r,l,i.height),o=this.calculateTextPositioning(n,i,s,l),c={containerBounds:{x:0,y:0,width:i.width,height:s},contentBounds:r.bounds,fontMetrics:l,positioning:o};return r.wrappedLines&&(c.textLayout={wrappedLines:r.wrappedLines,isWrapped:!0,originalLineCount:t.split(`
`).length,wrappedLineCount:r.wrappedLines.length}),c}calculateFontMetrics(t){const n=t.font_size,i=1.2,l=.75,r=.25,s=n*l,o=n*r;return{fontSize:n,lineHeight:n*i,ascender:s,descender:o,baseline:s}}getCharacterWidth(t,n){const i=n.font_size,l=n.font_family,r=/[\u4e00-\u9fa5]/.test(t),s={"Courier New":{chinese:.6,english:.6},Monaco:{chinese:.6,english:.6},Consolas:{chinese:.6,english:.6},SimSun:{chinese:1,english:.5},SimHei:{chinese:1,english:.5},KaiTi:{chinese:1.1,english:.6},FangSong:{chinese:1,english:.55},Arial:{chinese:1,english:.55},Helvetica:{chinese:1,english:.55},"Times New Roman":{chinese:1,english:.5},"Microsoft YaHei":{chinese:1,english:.52},"PingFang SC":{chinese:1,english:.52},"Noto Sans":{chinese:1,english:.53},default:{chinese:1,english:.55}},o=l.toLowerCase();let c=s.default;for(const[g,u]of Object.entries(s))if(o.includes(g.toLowerCase())||g.toLowerCase().includes(o)){c=u;break}const a=r?c.chinese:c.english;return i*a}calculateTextWidth(t,n){let i=0;for(const l of t)l!==`
`&&(i+=this.getCharacterWidth(l,n));return i}measureTextContent(t,n,i=0){const l=t.split(`
`),r=l.length;let s=0;for(const a of l){const g=this.calculateTextWidth(a,n);s=Math.max(s,g)}if(i>0&&s>i)return this.calculateWrappedText(t,n,i);const o=i>0?Math.min(s,i):s,c=r*n.font_size*1.2;return{bounds:{x:0,y:0,width:o,height:c},lineCount:r,actualHeight:c}}calculateWrappedText(t,n,i){const l=this.getCharacterWidth("æµ‹",n);if(Math.floor(i/l)<1||i<l)return{bounds:{x:0,y:0,width:i,height:n.font_size*1.2},lineCount:1,actualHeight:n.font_size*1.2,wrappedLines:["..."]};const s=this.smartSegmentation(t);let o=[],c="",a=0;for(const u of s){const h=this.calculateTextWidth(u,n),v=a+h;if(v>i)if(c.trim())o.push(c.trim()),c=u,a=h;else{const{truncated:f,remaining:m}=this.forceTruncateSegment(u,i,n);o.push(f),c=m,a=this.calculateTextWidth(m,n)}else c+=u,a=v}c.trim()&&o.push(c.trim());const g=o.length*n.font_size*1.2;return{bounds:{x:0,y:0,width:i,height:g},lineCount:o.length,actualHeight:g,wrappedLines:o}}forceTruncateSegment(t,n,i){let l="",r=0,s=0;for(s=0;s<t.length;s++){const c=t[s];if(!c)break;const a=this.getCharacterWidth(c,i);if(r+a>n)break;l+=c,r+=a}const o=t.substring(s);return{truncated:l,remaining:o}}smartSegmentation(t){const n=[];let i="";for(let l=0;l<t.length;l++){const r=t[l];r&&(/[\u4e00-\u9fa5]/.test(r)?(i&&(n.push(i),i=""),n.push(r)):r===`
`?(i&&(n.push(i),i=""),n.push(`
`)):r===" "?i?(n.push(i+" "),i=""):n.push(" "):i+=r)}return i&&n.push(i),n.filter(l=>l.length>0)}calculateContainerHeight(t,n,i){const l=n.lineHeight*t.lineCount,r=n.ascender+n.descender,s=n.lineHeight,o=Math.max(l,r,s);return Math.max(o,i)}calculateTextPositioning(t,n,i,l){var g;const r=this.calculateHorizontalAnchor(t.align,n.width),s=l.baseline,o=((g=t.background)==null?void 0:g.padding)||0,c=-o,a=-o;return{textAnchorX:r,textAnchorY:s,backgroundX:c,backgroundY:a}}calculateHorizontalAnchor(t,n){switch(t){case"Left":return 0;case"Center":return n/2;case"Right":return n;default:return 0}}getTextAnchor(t){switch(t){case"Left":return"start";case"Center":return"middle";case"Right":return"end";default:return"start"}}debugBounds(t,n){}}const We=new ti;class ni{constructor(){Ce(this,"initialized",!1);this.initialize()}async initialize(){if(!this.initialized)try{await ve.initialize(),this.initialized=!0,console.log("ğŸ¨ ProfessionalTextRenderer å·²åˆå§‹åŒ–")}catch(t){console.error("âŒ ProfessionalTextRenderer åˆå§‹åŒ–å¤±è´¥:",t)}}isElementUsingProfessionalStyle(t){return ve.getElementStyleId(t)!==null}adaptLegacyTextStyle(t){return{...t,font_weight:t.font_weight,typography:{letterSpacing:0,lineHeight:1.2,paragraphSpacing:0,textIndent:0,decoration:{underline:!1,strikethrough:!1,overline:!1,decorationStyle:"solid"},textTransform:"none",whiteSpace:"normal"},fills:[{type:"solid",enabled:!0,opacity:1,solid:{color:t.color}}],effects:[]}}renderProfessionalText(t,n=!1){if(t.content.type!=="Text"&&t.content.type!=="DataField")return null;const i=ve.getElementStyleId(t.id);let l;if(i){const o=ve.getStyle(i);if(!o)return console.warn(`âš ï¸ æ‰¾ä¸åˆ°æ ·å¼å®šä¹‰: ${i}`),null;l=o.style,console.log(`ğŸ¨ ä½¿ç”¨ä¸“ä¸šæ ·å¼æ¸²æŸ“: ${o.name} (${i})`)}else{const o=t.content.type==="Text"||t.content.type==="DataField"?t.content.style:null;if(!o)return null;l=this.adaptLegacyTextStyle(o),console.log("ğŸ”„ é€‚é…ä¼ ç»Ÿæ ·å¼åˆ°ä¸“ä¸šæ’ç‰ˆç³»ç»Ÿ")}const r=this.calculateEnhancedBounds(t.content.type==="Text"?t.content.content:t.content.expression||"[æ•°æ®å­—æ®µ]",l,t.size);return{element:this.createProfessionalTextElement(r,t.content.type==="Text"?t.content.content:t.content.expression||"[æ•°æ®å­—æ®µ]",l,!1),bounds:r,style:l}}calculateEnhancedBounds(t,n,i){const l=We.calculateUnifiedBounds(t,n,i),r=n.typography,s=this.calculateLetterSpacingEffect(t,r.letterSpacing),o=this.calculateLineHeightEffect(t,n.font_size,r.lineHeight),c=this.calculateParagraphSpacingEffect(t,r.paragraphSpacing);return{containerBounds:l.containerBounds,positioning:l.positioning,fontMetrics:l.fontMetrics,typography:{adjustedWidth:l.containerBounds.width+s.widthIncrease,adjustedHeight:l.containerBounds.height+o.heightIncrease+c.heightIncrease,letterSpacingData:s,lineHeightData:o,paragraphData:c}}}calculateLetterSpacingEffect(t,n){const i=t.split(`
`),l=i.reduce((s,o)=>s+o.length,0),r=Math.max(0,l-i.length);return{spacingValue:n,totalSpaces:r,widthIncrease:r*n,charPositions:[]}}calculateLineHeightEffect(t,n,i){const r=t.split(`
`).length,s=n*i,o=n*1.2,c=s-o;return{lineHeightRatio:i,actualLineHeight:s,lineCount:r,heightIncrease:c*Math.max(0,r-1),baselinePositions:[]}}calculateParagraphSpacingEffect(t,n){const l=t.split(`

`).length;return{spacing:n,paragraphCount:l,heightIncrease:n*Math.max(0,l-1),paragraphPositions:[]}}createProfessionalTextElement(t,n,i,l){const r=document.createElementNS("http://www.w3.org/2000/svg","g");return r.setAttribute("class","professional-text-container"),this.renderMultipleFills(r,t,i.fills),this.renderEffects(r,t,i.effects),this.renderTypographyText(r,t,n,i),this.renderTextDecorations(r,t,n,i.typography.decoration),r}renderMultipleFills(t,n,i){if(i&&i.length>0&&i[0].enabled){const l=i[0];l.type==="solid"&&l.solid&&console.log("ğŸ¨ åº”ç”¨çº¯è‰²å¡«å……:",l.solid.color)}}renderEffects(t,n,i){if(!i||i.length===0)return;const l=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","filter"),s=`text-effects-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;r.id=s;for(const o of i)if(o.enabled&&o.type==="drop-shadow"&&o.dropShadow){const c=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");c.setAttribute("dx",o.dropShadow.offsetX.toString()),c.setAttribute("dy",o.dropShadow.offsetY.toString()),c.setAttribute("stdDeviation",o.dropShadow.blur.toString()),c.setAttribute("flood-color",o.dropShadow.color),c.setAttribute("flood-opacity",o.dropShadow.opacity.toString()),r.appendChild(c),console.log("âœ¨ åº”ç”¨æŠ•å½±æ•ˆæœ")}r.children.length>0&&(l.appendChild(r),t.appendChild(l),t.setAttribute("filter",`url(#${s})`))}renderTypographyText(t,n,i,l){var c,a;const r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("font-family",l.font_family),r.setAttribute("font-size",l.font_size.toString()),r.setAttribute("font-weight",l.font_weight),r.setAttribute("fill",((a=(c=l.fills[0])==null?void 0:c.solid)==null?void 0:a.color)||l.color),r.setAttribute("text-anchor",this.getTextAnchor(l.align));const s=i.split(`
`),o=l.typography;s.forEach((g,u)=>{const h=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.letterSpacing!==0&&h.setAttribute("letter-spacing",`${o.letterSpacing}px`);const v=n.positioning.textAnchorY+u*n.typography.lineHeightData.actualLineHeight;if(h.setAttribute("x",n.positioning.textAnchorX.toString()),h.setAttribute("y",v.toString()),u===0&&o.textIndent!==0){const f=n.positioning.textAnchorX+o.textIndent;h.setAttribute("x",f.toString())}o.textTransform&&o.textTransform!=="none"?h.textContent=this.applyTextTransform(g,o.textTransform):h.textContent=g,r.appendChild(h)}),t.appendChild(r)}renderTextDecorations(t,n,i,l){if(!l.underline&&!l.strikethrough&&!l.overline)return;const r=i.split(`
`),s=l.decorationColor||"#000000",o=l.decorationThickness||1,c=l.decorationStyle==="dashed"?"4,2":l.decorationStyle==="dotted"?"1,1":"none";r.forEach((a,g)=>{if(!a.trim())return;const u=n.positioning.textAnchorY+g*n.typography.lineHeightData.actualLineHeight,h=a.length*n.fontMetrics.fontSize*.6,v=n.positioning.textAnchorX,f=v+h;if(l.underline){const m=u+n.fontMetrics.fontSize*.1;this.createDecorationLine(t,v,m,f,m,s,o,c,"underline")}if(l.strikethrough){const m=u-n.fontMetrics.fontSize*.3;this.createDecorationLine(t,v,m,f,m,s,o,c,"strikethrough")}if(l.overline){const m=u-n.fontMetrics.fontSize*.8;this.createDecorationLine(t,v,m,f,m,s,o,c,"overline")}})}createDecorationLine(t,n,i,l,r,s,o,c,a){const g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",n.toString()),g.setAttribute("y1",i.toString()),g.setAttribute("x2",l.toString()),g.setAttribute("y2",r.toString()),g.setAttribute("stroke",s),g.setAttribute("stroke-width",o.toString()),g.setAttribute("stroke-dasharray",c),g.setAttribute("class",`text-decoration-${a}`),t.appendChild(g)}getTextAnchor(t){switch(t){case"Center":return"middle";case"Right":return"end";case"Left":default:return"start"}}applyTextTransform(t,n){switch(n){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();default:return t}}}const ii=new ni;var li=w("<button class=search-clear title=æ¸…é™¤æœç´¢>âœ•"),ri=w('<div class=style-picker-container><div class=style-categories></div><div class=style-search><div class=search-input-container><span class=search-icon>ğŸ”</span><input type=text placeholder=æœç´¢æ ·å¼... class=search-input></div></div><div class=style-grid><div class="style-card create-style-card"><div class=create-style-content><div class=create-style-icon>â•</div><div class=create-style-label>æ–°å»ºæ ·å¼</div></div></div></div><div class=style-stats><span class=stats-text> ä¸ªæ ·å¼'),si=w("<button><span class=category-icon></span><span class=category-label>"),oi=w("<div><div class=style-preview></div><div class=style-info><div class=style-name></div><div class=style-meta><span class=style-category></span></div></div><div class=style-actions>"),ai=w("<span class=usage-count>"),ci=w("<button class=edit-button title=ç¼–è¾‘æ ·å¼>âœï¸"),di=w("<span class=system-badge title=ç³»ç»Ÿé¢„è®¾æ ·å¼>ğŸ”’"),ui=w("<div class=selection-indicator>âœ“");const hi=e=>{const[t,n]=W("bank-special"),[i,l]=W(""),[r,s]=W([]);(async()=>{await ve.initialize();const h=ve.getStylesByCategory();s(h)})();const c=ie(()=>{let h=r();t()&&(h=h.filter(f=>f.category===t()));const v=i().toLowerCase().trim();return v&&(h=h.filter(f=>f.name.toLowerCase().includes(v)||f.description.toLowerCase().includes(v)||f.metadata.tags.some(m=>m.toLowerCase().includes(v)))),h}),a=[{key:"bank-special",label:"é“¶è¡Œä¸“ç”¨",icon:"ğŸ¦"},{key:"heading",label:"æ ‡é¢˜",icon:"ğŸ“°"},{key:"body",label:"æ­£æ–‡",icon:"ğŸ“"},{key:"caption",label:"è¯´æ˜",icon:"ğŸ’¬"},{key:"custom",label:"è‡ªå®šä¹‰",icon:"âš™ï¸"}],g=h=>{console.log("ğŸ¯ é€‰æ‹©æ ·å¼:",h),e.onStyleSelect(h)},u=h=>{n(h),console.log("ğŸ“‚ åˆ‡æ¢åˆ†ç±»:",h)};return(()=>{var h=ri(),v=h.firstChild,f=v.nextSibling,m=f.firstChild,C=m.firstChild,_=C.nextSibling,k=f.nextSibling,P=k.firstChild,L=k.nextSibling,I=L.firstChild,z=I.firstChild;return d(v,y(ye,{each:a,children:N=>(()=>{var U=si(),K=U.firstChild,R=K.nextSibling;return U.$$click=()=>u(N.key),d(K,()=>N.icon),d(R,()=>N.label),M(F=>{var E=`category-button ${t()===N.key?"active":""}`,q=N.label;return E!==F.e&&Ue(U,F.e=E),q!==F.t&&S(U,"title",F.t=q),F},{e:void 0,t:void 0}),U})()})),_.$$input=N=>l(N.target.value),d(m,y(J,{get when(){return i()},get children(){var N=li();return N.$$click=()=>l(""),N}}),null),d(k,y(ye,{get each(){return c()},children:N=>y(gi,{style:N,get selected(){return e.selectedStyleId===N.id},onClick:()=>g(N.id),onEdit:()=>e.onStyleEdit(N.id)})}),P),me(P,"click",e.onStyleCreate),d(I,()=>c().length,z),d(I,(()=>{var N=te(()=>!!i());return()=>N()&&` (æœç´¢: "${i()}")`})(),null),M(()=>_.value=i()),h})()},gi=e=>{const t=()=>{switch(e.style.category){case"bank-special":return e.style.id.includes("amount")?"Â¥123,456.78":e.style.id.includes("account")?"6222 0012 3456 7890":e.style.id.includes("institution")?e.style.name:e.style.id.includes("date")?"2025-08-19":e.style.name;case"heading":return e.style.name;case"body":return"æ­£æ–‡ç¤ºä¾‹æ–‡å­— Abc";case"caption":return"è¯´æ˜æ–‡å­—";default:return e.style.name}},n=ie(()=>{var s,o,c,a,g,u,h,v;const r=e.style.style;return{fontFamily:r.font_family,fontSize:`${Math.min(r.font_size,14)}px`,fontWeight:r.font_weight,color:((c=(o=(s=r.fills)==null?void 0:s[0])==null?void 0:o.solid)==null?void 0:c.color)||r.color,textAlign:r.align.toLowerCase(),letterSpacing:`${((a=r.typography)==null?void 0:a.letterSpacing)||0}px`,textDecoration:(u=(g=r.typography)==null?void 0:g.decoration)!=null&&u.underline?"underline":(v=(h=r.typography)==null?void 0:h.decoration)!=null&&v.strikethrough?"line-through":"none"}}),i=r=>{r.preventDefault(),e.onClick()},l=r=>{r.preventDefault(),r.stopPropagation(),e.onEdit()};return(()=>{var r=oi(),s=r.firstChild,o=s.nextSibling,c=o.firstChild,a=c.nextSibling,g=a.firstChild,u=o.nextSibling;return r.$$click=i,d(s,t),d(c,()=>e.style.name),d(g,()=>fi(e.style.category)),d(a,(()=>{var h=te(()=>e.style.metadata.usageCount>0);return()=>h()&&(()=>{var v=ai();return d(v,()=>e.style.metadata.usageCount),M(()=>S(v,"title",`ä½¿ç”¨æ¬¡æ•°: ${e.style.metadata.usageCount}`)),v})()})(),null),d(u,(()=>{var h=te(()=>!e.style.metadata.isSystemStyle);return()=>h()&&(()=>{var v=ci();return v.$$click=l,v})()})(),null),d(u,(()=>{var h=te(()=>!!e.style.metadata.isSystemStyle);return()=>h()&&di()})(),null),d(r,(()=>{var h=te(()=>!!e.selected);return()=>h()&&ui()})(),null),M(h=>{var v=`style-card ${e.selected?"selected":""} ${e.style.metadata.isSystemStyle?"system-style":"user-style"}`,f=n();return v!==h.e&&Ue(r,h.e=v),h.t=Yt(s,f,h.t),h},{e:void 0,t:void 0}),r})()};function fi(e){return{"bank-special":"é“¶è¡Œ",heading:"æ ‡é¢˜",body:"æ­£æ–‡",caption:"è¯´æ˜",custom:"è‡ªå®šä¹‰"}[e]||e}$e(["input","click"]);var vi=w("<button class=style-picker-toggle>"),yi=w("<button class=style-reload-btn title=é‡æ–°åŠ è½½æ ·å¼ç³»ç»Ÿ>ğŸ”„"),mi=w("<div class=initialization-fallback><div class=fallback-content><span class=fallback-icon>â³</span><span class=fallback-text>ä¸“ä¸šæ ·å¼ç³»ç»ŸåŠ è½½ä¸­...</span><div class=fallback-actions><button class=retry-btn>é‡è¯•åŠ è½½"),pi=w("<div class=quick-style-actions><button class=apply-style-btn><span class=btn-icon>ğŸ¨</span><span class=btn-text>é€‰æ‹©æ ·å¼</span></button><button class=create-style-btn title=åŸºäºå½“å‰è®¾ç½®åˆ›å»ºæ–°æ ·å¼><span class=btn-icon>â•</span><span class=btn-text>æ–°å»º"),bi=w("<div class=style-picker-panel>"),xi=w("<div class=property-group><div class=property-group-title><span>ğŸ“</span><span>æ’ç‰ˆæ§åˆ¶</span><div class=coming-soon-badge>å³å°†æ¨å‡º</div></div><div class=property-group-content><div class=typography-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>âš™ï¸</span><span class=placeholder-text>é«˜çº§æ’ç‰ˆæ§åˆ¶åŠŸèƒ½</span><span class=placeholder-subtitle>å­—é—´è·ã€è¡Œé«˜ã€è£…é¥°ç­‰"),wi=w("<div class=property-group><div class=property-group-title><span>âœ¨</span><span>è§†è§‰æ•ˆæœ</span><div class=coming-soon-badge>å³å°†æ¨å‡º</div></div><div class=property-group-content><div class=effects-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>ğŸŒˆ</span><span class=placeholder-text>å¤šé‡å¡«å…… & é˜´å½±æ•ˆæœ</span><span class=placeholder-subtitle>æ¸å˜ã€æŠ•å½±ã€å‘å…‰ç­‰"),_i=w('<div class="property-group debug-panel"><div class=property-group-title><span>ğŸ”§</span><span>è°ƒè¯•ä¿¡æ¯</span></div><div class=property-group-content><div class=debug-info><div class=debug-item><span class=debug-label>å…ƒç´ ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>å½“å‰æ ·å¼ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>å¯ç”¨æ ·å¼:</span><span class=debug-value> ä¸ª</span></div><div class=debug-item><span class=debug-label>ä½¿ç”¨ä¸“ä¸šæ¸²æŸ“:</span><span class=debug-value>'),$i=w("<div class=professional-text-properties><div class=property-group><div class=property-group-title><span>ğŸ¨</span><span>ä¸“ä¸šæ–‡å­—æ ·å¼</span><div class=property-group-actions></div></div><div class=property-group-content>"),Si=w('<div class=current-style-info><div class=current-style-preview><div class=style-preview-badge><span class=style-name></span><span class=style-category></span></div><div class=style-actions><button class="style-action-btn edit-btn"title=ç¼–è¾‘æ ·å¼>âœï¸</button><button class="style-action-btn remove-btn"title=ç§»é™¤æ ·å¼>ğŸ—‘ï¸');const Mt=e=>{const[t,n]=W(null),[i,l]=W(!1),[r,s]=W([]),[o,c]=W(!1);Ie(async()=>{try{await ve.initialize();const _=ve.getElementStyleId(e.element.id);n(_);const k=ve.getStylesByCategory();s(k),c(!0),console.log("ğŸ¨ ProfessionalTextPropertiesPanel åˆå§‹åŒ–å®Œæˆ")}catch(_){console.error("âŒ ä¸“ä¸šæ–‡å­—å±æ€§é¢æ¿åˆå§‹åŒ–å¤±è´¥:",_)}});const a=ie(()=>{const _=t();return _?ve.getStyle(_):null}),g=ie(()=>e.element.content.type==="Text"||e.element.content.type==="DataField"),u=async _=>{try{const k=await ve.applyStyleToElement(e.element.id,_);if(k.success){n(_);const P=ve.getStyle(_);if(P){const L=h(P.style);e.onUpdate(e.element.id,"content",{...e.element.content,style:L})}console.log("âœ… æ ·å¼åº”ç”¨æˆåŠŸ:",k)}else console.error("âŒ æ ·å¼åº”ç”¨å¤±è´¥:",k.error)}catch(k){console.error("âŒ æ ·å¼é€‰æ‹©å¤„ç†å¤±è´¥:",k)}},h=_=>{var k,P,L;return{font_family:_.font_family,font_size:_.font_size,font_weight:_.font_weight,color:((L=(P=(k=_.fills)==null?void 0:k[0])==null?void 0:P.solid)==null?void 0:L.color)||_.color,align:_.align}},v=()=>{console.log("ğŸ†• åˆ›å»ºæ–°æ ·å¼")},f=_=>{console.log("âœï¸ ç¼–è¾‘æ ·å¼:",_)},m=()=>{l(!i())},C=()=>{t()&&(ve.removeElementStyle(e.element.id),n(null),console.log("ğŸ—‘ï¸ ç§»é™¤å…ƒç´ æ ·å¼"))};return g()?(()=>{var _=$i(),k=_.firstChild,P=k.firstChild,L=P.firstChild,I=L.nextSibling,z=I.nextSibling,N=P.nextSibling;return d(z,y(J,{get when(){return o()},get children(){var U=vi();return U.$$click=m,d(U,()=>i()?"ğŸ“":"ğŸ“š"),M(()=>S(U,"title",i()?"éšè—æ ·å¼åº“":"æ˜¾ç¤ºæ ·å¼åº“")),U}}),null),d(z,y(J,{get when(){return!o()},get children(){var U=yi();return U.$$click=()=>window.location.reload(),U}}),null),d(N,y(J,{get when(){return!o()},get children(){var U=mi(),K=U.firstChild,R=K.firstChild,F=R.nextSibling,E=F.nextSibling,q=E.firstChild;return q.$$click=async()=>{try{await ve.initialize();const H=ve.getStylesByCategory();s(H),c(!0),console.log("ğŸ”„ æ ·å¼ç³»ç»Ÿé‡æ–°åˆå§‹åŒ–æˆåŠŸ")}catch(H){console.error("âŒ é‡æ–°åˆå§‹åŒ–å¤±è´¥:",H)}},U}}),null),d(N,y(J,{get when(){return o()},get children(){return[y(J,{get when(){return a()},children:U=>(()=>{var K=Si(),R=K.firstChild,F=R.firstChild,E=F.firstChild,q=E.nextSibling,H=F.nextSibling,b=H.firstChild,D=b.nextSibling;return d(E,()=>U().name),d(q,()=>Ci(U().category)),b.$$click=()=>f(U().id),D.$$click=C,K})()}),y(J,{get when(){return!a()},get children(){var U=pi(),K=U.firstChild,R=K.nextSibling;return K.$$click=m,R.$$click=v,U}}),y(J,{get when(){return i()},get children(){var U=bi();return d(U,y(hi,{get selectedStyleId(){return t()},onStyleSelect:u,onStyleCreate:v,onStyleEdit:f})),U}})]}}),null),d(_,y(J,{get when(){return a()},get children(){return xi()}}),null),d(_,y(J,{get when(){return a()},get children(){return wi()}}),null),d(_,y(J,{get when(){return!1},get children(){var U=_i(),K=U.firstChild,R=K.nextSibling,F=R.firstChild,E=F.firstChild,q=E.firstChild,H=q.nextSibling,b=E.nextSibling,D=b.firstChild,B=D.nextSibling,T=b.nextSibling,V=T.firstChild,Z=V.nextSibling,ue=Z.firstChild,de=T.nextSibling,j=de.firstChild,ce=j.nextSibling;return d(H,()=>e.element.id),d(B,()=>t()||"æ— "),d(Z,()=>r().length,ue),d(ce,()=>ii.isElementUsingProfessionalStyle(e.element.id)?"æ˜¯":"å¦"),U}}),null),_})():null};function Ci(e){return{"bank-special":"é“¶è¡Œ",heading:"æ ‡é¢˜",body:"æ­£æ–‡",caption:"è¯´æ˜",custom:"è‡ªå®šä¹‰"}[e]||e}$e(["click"]);var ki=w('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">å±æ€§é¢æ¿</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),Ei=w('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>é€‰æ‹©å…ƒç´ ä»¥æŸ¥çœ‹å±æ€§'),Ai=w("<span class=property-value>"),Pi=w('<span class="property-value text-xs text-muted">'),gt=w("<div class=space-y-2>"),Ze=w("<input type=number class=property-input>"),Di=w('<div class="grid grid-cols-2 gap-2">'),Ut=w("<input type=checkbox class=property-checkbox>"),zi=w('<div class="p-4 space-y-4">'),Rt=w("<div>"),Ti=w("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),Li=w("<div class=property-field><label class=property-label>"),Mi=w("<textarea class=property-textarea rows=2 placeholder=è¾“å…¥æ–‡æœ¬å†…å®¹...>"),sn=w('<select class=property-select><option value=SimSun>å®‹ä½“</option><option value=SimHei>é»‘ä½“</option><option value="Microsoft YaHei">å¾®è½¯é›…é»‘</option><option value=KaiTi>æ¥·ä½“</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),on=w("<select class=property-select><option value=normal>æ­£å¸¸</option><option value=bold>ç²—ä½“</option><option value=lighter>ç»†ä½“</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),Ui=w('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),an=w("<select class=property-select><option value=Solid>å®çº¿</option><option value=Dashed>è™šçº¿</option><option value=Dotted>ç‚¹çº¿"),Ri=w('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),cn=w('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),dn=w('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),Ii=w('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Oi=w("<select class=property-select><option value=Solid>å®çº¿</option><option value=Dashed>è™šçº¿</option><option value=Dotted>ç‚¹çº¿</option><option value=DashDot>ç‚¹åˆ’çº¿"),It=w("<select class=property-select><option value=None>æ— </option><option value=Arrow>ç®­å¤´</option><option value=Circle>åœ†ç‚¹</option><option value=Square>æ–¹å—"),Fi=w('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),Ni=w("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),Bi=w("<input type=text class=property-input placeholder=å›¾ç‰‡æè¿°æ–‡å­—>"),Hi=w("<div class=property-image-preview><div class=property-image-placeholder><span>ğŸ“· æ— å›¾ç‰‡"),ji=w("<div class=space-y-3>"),Vi=w("<img class=property-image>"),Wi=w("<div class=property-loading>åŠ è½½æ•°æ®æº..."),Ki=w('<div class=data-source-info><div class="text-xs text-muted"><div><span class=font-medium>çŠ¶æ€:</span> <span></span></div><div><span class=font-medium>ç±»å‹:</span> </div><div><span class=font-medium>æ›´æ–°:</span> '),qi=w("<input type=text class=property-input>"),Xi=w('<div class="text-xs text-amber-600">ğŸ’¡ æç¤º: ä½¿ç”¨ {fieldName} è¯­æ³•å¼•ç”¨æ•°æ®å­—æ®µï¼Œå¦‚ {name}, {price} ç­‰'),Gi=w("<select class=property-select><option value=default>é»˜è®¤</option><option value=currency>è´§å¸</option><option value=date>æ—¥æœŸ</option><option value=datetime>æ—¥æœŸæ—¶é—´</option><option value=number>æ•°å­—"),Yi=w("<div class=space-y-4>"),Ji=w("<select class=property-select><option value>é€‰æ‹©æ•°æ®æº"),Zi=w("<option> (<!>)"),Qi=w('<div class=flex><input type=number class="property-input flex-1">'),el=w("<span class=property-unit>"),tl=w('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),nl=w("<div class=property-alignment-group>"),il=w("<button>");const ll=()=>{const{state:e,updateElement:t}=Oe(),n=ie(()=>{const r=new Set(e.selected_ids);return e.elements.filter(s=>r.has(s.id))}),i=ie(()=>n()[0]),l=async(r,s,o)=>{try{await t(r,{[s]:o})}catch(c){console.error("Failed to update element property:",c)}};return(()=>{var r=ki(),s=r.firstChild,o=s.nextSibling;return d(o,y(J,{get when(){return i()},get fallback(){return Ei()},get children(){return y(rl,{get element(){return i()},onUpdate:l})}})),r})()},rl=e=>{const t=(i,l)=>{const r={...e.element.position,[i]:l};e.onUpdate(e.element.id,"position",r)},n=(i,l)=>{const r={...e.element.size,[i]:Math.max(1,l)};e.onUpdate(e.element.id,"size",r)};return(()=>{var i=zi();return d(i,y(ze,{title:"å…ƒç´ ä¿¡æ¯",icon:"â„¹ï¸",get children(){var l=gt();return d(l,y(Y,{label:"ç±»å‹",get children(){var r=Ai();return d(r,()=>e.element.content.type),r}}),null),d(l,y(Y,{label:"ID",get children(){var r=Pi();return d(r,()=>e.element.id),r}}),null),l}}),null),d(i,y(ze,{title:"ä½ç½®å’Œå¤§å°",icon:"ğŸ“",get children(){var l=Di();return d(l,y(Y,{label:"X",get children(){var r=Ze();return r.$$input=s=>t("x",parseFloat(s.target.value)||0),M(()=>r.value=e.element.position.x),r}}),null),d(l,y(Y,{label:"Y",get children(){var r=Ze();return r.$$input=s=>t("y",parseFloat(s.target.value)||0),M(()=>r.value=e.element.position.y),r}}),null),d(l,y(Y,{label:"å®½åº¦",get children(){var r=Ze();return r.$$input=s=>n("width",parseFloat(s.target.value)||1),M(()=>r.value=e.element.size.width),r}}),null),d(l,y(Y,{label:"é«˜åº¦",get children(){var r=Ze();return r.$$input=s=>n("height",parseFloat(s.target.value)||1),M(()=>r.value=e.element.size.height),r}}),null),l}}),null),d(i,y(ze,{title:"çŠ¶æ€",icon:"ğŸ‘ï¸",get children(){var l=gt();return d(l,y(Y,{label:"å¯è§",get children(){var r=Ut();return r.addEventListener("change",s=>e.onUpdate(e.element.id,"visible",s.target.checked)),M(()=>r.checked=e.element.visible),r}}),null),d(l,y(Y,{label:"é”å®š",get children(){var r=Ut();return r.addEventListener("change",s=>e.onUpdate(e.element.id,"locked",s.target.checked)),M(()=>r.checked=e.element.locked),r}}),null),d(l,y(Y,{label:"å±‚çº§",get children(){var r=Ze();return r.$$input=s=>e.onUpdate(e.element.id,"z_index",parseInt(s.target.value)||0),M(()=>r.value=e.element.z_index),r}}),null),l}}),null),d(i,y(En,{get children(){return[y(Je,{get when(){return e.element.content.type==="Text"&&e.element.content},children:l=>(()=>{var r=Rt();return d(r,y(Mt,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),d(r,y(sl,{get content(){return l()},onUpdate:s=>{console.log("Text content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),r})()}),y(Je,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:l=>y(ol,{get content(){return l()},onUpdate:r=>{console.log("Rectangle content update:",r),e.onUpdate(e.element.id,"content",r)}})}),y(Je,{get when(){return e.element.content.type==="Line"&&e.element.content},children:l=>y(al,{get content(){return l()},onUpdate:r=>{console.log("Line content update:",r),e.onUpdate(e.element.id,"content",r)}})}),y(Je,{get when(){return e.element.content.type==="Image"&&e.element.content},children:l=>y(cl,{get content(){return l()},onUpdate:r=>{console.log("Image content update:",r),e.onUpdate(e.element.id,"content",r)}})}),y(Je,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:l=>(()=>{var r=Rt();return d(r,y(Mt,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),d(r,y(dl,{get content(){return l()},onUpdate:s=>{console.log("DataField content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),r})()})]}}),null),i})()},ze=e=>(()=>{var t=Ti(),n=t.firstChild,i=n.firstChild,l=i.nextSibling,r=n.nextSibling;return d(i,()=>e.icon),d(l,()=>e.title),d(r,()=>e.children),t})(),Y=e=>(()=>{var t=Li(),n=t.firstChild;return d(n,()=>e.label),d(t,()=>e.children,null),t})(),sl=e=>y(ze,{title:"æ–‡å­—æ ·å¼",icon:"ğŸ”¤",get children(){var t=cn(),n=t.firstChild,i=n.nextSibling;return d(t,y(Y,{label:"å†…å®¹",get children(){var l=Mi();return l.$$input=r=>e.onUpdate({content:r.target.value}),M(()=>l.value=e.content.content),l}}),n),d(n,y(Y,{label:"å­—ä½“",get children(){var l=sn();return l.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_family:r.target.value}})),M(()=>l.value=e.content.style.font_family),l}}),null),d(n,y(Y,{label:"å¤§å°",get children(){return y(Pe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),d(i,y(Y,{label:"å­—é‡",get children(){var l=on();return l.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_weight:r.target.value}})),M(()=>l.value=e.content.style.font_weight),l}}),null),d(i,y(Y,{label:"å¯¹é½",get children(){return y(un,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),d(t,y(Y,{label:"é¢œè‰²",get children(){return y(He,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),d(t,y(Y,{label:"èƒŒæ™¯",get children(){var l=Ui(),r=l.firstChild;return d(l,y(He,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.color)||"transparent"},onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:s}}})}),r),d(r,y(Y,{label:"é€æ˜åº¦",get children(){return y(Pe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.opacity)||1},min:0,max:1,step:.1,onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:s}}})})}}),null),d(r,y(Y,{label:"å†…è¾¹è·",get children(){return y(Pe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:s}}})})}}),null),l}}),null),d(t,y(Y,{label:"è¾¹æ¡†",get children(){var l=Ri(),r=l.firstChild;return d(l,y(He,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.color)||"#000000"},onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:s}}})}),r),d(r,y(Y,{label:"å®½åº¦",get children(){return y(Pe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:s}}})})}}),null),d(r,y(Y,{label:"æ ·å¼",get children(){var s=an();return s.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:o.target.value}}})),M(()=>{var o;return s.value=((o=e.content.style.border)==null?void 0:o.style)||"Solid"}),s}}),null),d(r,y(Y,{label:"åœ†è§’",get children(){return y(Pe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:s}}})})}}),null),l}}),null),t}}),ol=e=>y(ze,{title:"çŸ©å½¢æ ·å¼",icon:"â–­",get children(){var t=Ii(),n=t.firstChild,i=n.firstChild;return d(t,y(Y,{label:"å¡«å……é¢œè‰²",get children(){return y(He,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:l=>e.onUpdate({fill_color:l})})}}),n),d(n,y(Y,{label:"è¾¹æ¡†",get children(){var l=gt();return d(l,y(He,{get value(){var r;return((r=e.content.border)==null?void 0:r.color)||"#000000"},onUpdate:r=>e.onUpdate({border:{...e.content.border,color:r}})})),l}}),i),d(i,y(Y,{label:"å®½åº¦",get children(){return y(Pe,{get value(){var l;return((l=e.content.border)==null?void 0:l.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:l=>e.onUpdate({border:{...e.content.border,width:l}})})}}),null),d(i,y(Y,{label:"æ ·å¼",get children(){var l=an();return l.addEventListener("change",r=>e.onUpdate({border:{...e.content.border,style:r.target.value}})),M(()=>{var r;return l.value=((r=e.content.border)==null?void 0:r.style)||"Solid"}),l}}),null),d(t,y(Y,{label:"åœ†è§’åŠå¾„",get children(){return y(Pe,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:l=>e.onUpdate({corner_radius:l})})}}),null),d(t,y(Y,{label:"é€æ˜åº¦",get children(){var l=dn(),r=l.firstChild,s=r.nextSibling,o=s.firstChild;return r.$$input=c=>e.onUpdate({opacity:parseFloat(c.target.value)/100}),d(s,()=>Math.round((e.content.opacity||1)*100),o),M(()=>r.value=(e.content.opacity||1)*100),l}}),null),t}}),al=e=>y(ze,{title:"çº¿æ¡æ ·å¼",icon:"â”",get children(){var t=Fi(),n=t.firstChild;return d(t,y(Y,{label:"é¢œè‰²",get children(){return y(He,{get value(){return e.content.color},onUpdate:i=>e.onUpdate({color:i})})}}),n),d(t,y(Y,{label:"å®½åº¦",get children(){return y(Pe,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:i=>e.onUpdate({width:i})})}}),n),d(t,y(Y,{label:"æ ·å¼",get children(){var i=Oi();return i.addEventListener("change",l=>e.onUpdate({line_style:l.target.value})),M(()=>i.value=e.content.line_style||"Solid"),i}}),n),d(n,y(Y,{label:"èµ·ç‚¹",get children(){var i=It();return i.addEventListener("change",l=>e.onUpdate({start_cap:l.target.value})),M(()=>i.value=e.content.start_cap||"None"),i}}),null),d(n,y(Y,{label:"ç»ˆç‚¹",get children(){var i=It();return i.addEventListener("change",l=>e.onUpdate({end_cap:l.target.value})),M(()=>i.value=e.content.end_cap||"None"),i}}),null),d(t,y(Y,{label:"é€æ˜åº¦",get children(){var i=dn(),l=i.firstChild,r=l.nextSibling,s=r.firstChild;return l.$$input=o=>e.onUpdate({opacity:parseFloat(o.target.value)/100}),d(r,()=>Math.round((e.content.opacity||1)*100),s),M(()=>l.value=(e.content.opacity||1)*100),i}}),null),t}}),cl=e=>y(ze,{title:"å›¾ç‰‡å±æ€§",icon:"ğŸ–¼ï¸",get children(){var t=ji();return d(t,y(Y,{label:"å›¾ç‰‡åœ°å€",get children(){var n=Ni();return n.$$input=i=>e.onUpdate({src:i.target.value}),M(()=>n.value=e.content.src),n}}),null),d(t,y(Y,{label:"æ›¿ä»£æ–‡æœ¬",get children(){var n=Bi();return n.$$input=i=>e.onUpdate({alt:i.target.value}),M(()=>n.value=e.content.alt||""),n}}),null),d(t,y(Y,{label:"é¢„è§ˆ",get children(){var n=Hi(),i=n.firstChild;return d(n,(()=>{var l=te(()=>!!e.content.src);return()=>l()?(()=>{var r=Vi();return r.addEventListener("load",s=>{const o=s.target,c=o.nextElementSibling;o&&(o.style.display="block"),c&&(c.style.display="none")}),r.addEventListener("error",s=>{const o=s.target,c=o.nextElementSibling;o&&(o.style.display="none"),c&&(c.style.display="flex")}),M(s=>{var o=e.content.src,c=e.content.alt||"å›¾ç‰‡é¢„è§ˆ";return o!==s.e&&S(r,"src",s.e=o),c!==s.t&&S(r,"alt",s.t=c),s},{e:void 0,t:void 0}),r})():null})(),i),M(l=>(l=e.content.src?"none":"flex")!=null?i.style.setProperty("display",l):i.style.removeProperty("display")),n}}),null),t}}),dl=e=>{const[t,n]=W([]),[i,l]=W(!1);Ie(async()=>{try{l(!0);const o=await Se.listDataSources();n(o)}catch(o){console.error("Failed to load data sources:",o)}finally{l(!1)}});const r=o=>{e.onUpdate({data_source_id:o===""?void 0:o})},s=ie(()=>e.content.data_source_id?t().find(o=>o.id===e.content.data_source_id):null);return(()=>{var o=Yi();return d(o,y(ze,{title:"æ•°æ®æºé…ç½®",icon:"ğŸ”—",get children(){var c=gt();return d(c,y(Y,{label:"æ•°æ®æº",get children(){return y(J,{get when(){return i()},get fallback(){return(()=>{var a=Ji();return a.firstChild,a.addEventListener("change",g=>r(g.currentTarget.value)),d(a,y(ye,{get each(){return t()},children:g=>(()=>{var u=Zi(),h=u.firstChild,v=h.nextSibling;return v.nextSibling,d(u,()=>g.name,h),d(u,()=>g.provider_type,v),M(()=>u.value=g.id),u})()}),null),M(()=>a.value=e.content.data_source_id||""),a})()},get children(){return Wi()}})}}),null),d(c,y(J,{get when(){return s()},get children(){var a=Ki(),g=a.firstChild,u=g.firstChild,h=u.firstChild,v=h.nextSibling,f=v.nextSibling,m=u.nextSibling,C=m.firstChild;C.nextSibling;var _=m.nextSibling,k=_.firstChild;return k.nextSibling,d(f,(()=>{var P=te(()=>s().status==="active");return()=>P()?"æ´»è·ƒ":s().status==="error"?"é”™è¯¯":"ç¦ç”¨"})()),d(m,()=>s().provider_type,null),d(_,()=>new Date(s().last_updated).toLocaleString("zh-CN"),null),M(()=>Ue(f,s().status==="active"?"text-green-600":s().status==="error"?"text-red-600":"text-gray-600")),a}}),null),d(c,y(Y,{label:"è¡¨è¾¾å¼",get children(){var a=qi();return a.$$input=g=>e.onUpdate({expression:g.currentTarget.value}),M(g=>{var u=e.content.data_source_id?"{fieldName}":"è¯·å…ˆé€‰æ‹©æ•°æ®æº",h=!e.content.data_source_id;return u!==g.e&&S(a,"placeholder",g.e=u),h!==g.t&&(a.disabled=g.t=h),g},{e:void 0,t:void 0}),M(()=>a.value=e.content.expression),a}}),null),d(c,y(J,{get when(){return e.content.data_source_id&&!e.content.expression},get children(){return Xi()}}),null),d(c,y(Y,{label:"æ ¼å¼",get children(){var a=Gi();return a.addEventListener("change",g=>e.onUpdate({format:g.currentTarget.value==="default"?void 0:g.currentTarget.value})),M(()=>a.value=e.content.format||"default"),a}}),null),c}}),null),d(o,y(ze,{title:"å­—æ®µæ ·å¼",icon:"ğŸ¨",get children(){var c=cn(),a=c.firstChild,g=a.nextSibling;return d(a,y(Y,{label:"å­—ä½“",get children(){var u=sn();return u.addEventListener("change",h=>e.onUpdate({style:{...e.content.style,font_family:h.currentTarget.value}})),M(()=>u.value=e.content.style.font_family),u}}),null),d(a,y(Y,{label:"å¤§å°",get children(){return y(Pe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:u=>e.onUpdate({style:{...e.content.style,font_size:u}})})}}),null),d(g,y(Y,{label:"å­—é‡",get children(){var u=on();return u.addEventListener("change",h=>e.onUpdate({style:{...e.content.style,font_weight:h.currentTarget.value}})),M(()=>u.value=e.content.style.font_weight),u}}),null),d(g,y(Y,{label:"å¯¹é½",get children(){return y(un,{get value(){return e.content.style.align},onUpdate:u=>e.onUpdate({style:{...e.content.style,align:u}})})}}),null),d(c,y(Y,{label:"é¢œè‰²",get children(){return y(He,{get value(){return e.content.style.color},onUpdate:u=>e.onUpdate({style:{...e.content.style,color:u}})})}}),null),c}}),null),o})()},Pe=e=>(()=>{var t=Qi(),n=t.firstChild;return n.addEventListener("blur",i=>{const l=parseFloat(i.target.value)||e.value,r=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));r!==l&&(i.target.value=r.toString(),e.onUpdate(r))}),n.$$input=i=>{const l=parseFloat(i.target.value);if(!isNaN(l)){const r=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));e.onUpdate(r)}},d(t,(()=>{var i=te(()=>!!e.unit);return()=>i()&&(()=>{var l=el();return d(l,()=>e.unit),l})()})(),null),M(i=>{var l=e.min,r=e.max,s=e.step||1;return l!==i.e&&S(n,"min",i.e=l),r!==i.t&&S(n,"max",i.t=r),s!==i.a&&S(n,"step",i.a=s),i},{e:void 0,t:void 0,a:void 0}),M(()=>n.value=e.value),t})(),He=e=>(()=>{var t=tl(),n=t.firstChild,i=n.firstChild,l=i.nextSibling,r=n.nextSibling;return i.$$input=s=>e.onUpdate(s.target.value),r.$$input=s=>{const o=s.target.value;(/^#[0-9A-Fa-f]{6}$/.test(o)||/^#[0-9A-Fa-f]{3}$/.test(o))&&e.onUpdate(o)},M(s=>(s=e.value)!=null?l.style.setProperty("background-color",s):l.style.removeProperty("background-color")),M(()=>i.value=e.value),M(()=>r.value=e.value),t})(),un=e=>{const t=[{value:"Left",icon:"â¬…ï¸",label:"å·¦å¯¹é½"},{value:"Center",icon:"â†”ï¸",label:"å±…ä¸­"},{value:"Right",icon:"â¡ï¸",label:"å³å¯¹é½"}];return(()=>{var n=nl();return d(n,()=>t.map(i=>(()=>{var l=il();return l.$$click=()=>e.onUpdate(i.value),d(l,()=>i.icon),M(r=>{var s=`property-alignment-btn ${e.value===i.value?"active":""}`,o=i.label;return s!==r.e&&Ue(l,r.e=s),o!==r.t&&S(l,"title",r.t=o),r},{e:void 0,t:void 0}),l})())),n})()};$e(["input","click"]);var ul=w("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),hl=w("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const gl=e=>y(J,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=ul(),n=t.firstChild,i=n.firstChild,l=i.nextSibling;return M(r=>{var s=e.config.grid_size,o=e.config.grid_size,c=e.config.grid_size,a=e.config.grid_size,g=e.config.grid_size,u=e.config.grid_size,h=e.config.grid_size,v=e.config.grid_size;return s!==r.e&&S(n,"width",r.e=s),o!==r.t&&S(n,"height",r.t=o),c!==r.a&&S(i,"x1",r.a=c),a!==r.o&&S(i,"x2",r.o=a),g!==r.i&&S(i,"y2",r.i=g),u!==r.n&&S(l,"y1",r.n=u),h!==r.s&&S(l,"x2",r.s=h),v!==r.h&&S(l,"y2",r.h=v),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=hl();return M(n=>{var i=e.config.width,l=e.config.height;return i!==n.e&&S(t,"width",n.e=i),l!==n.t&&S(t,"height",n.t=l),n},{e:void 0,t:void 0}),t})()]}});class fl{constructor(){Ce(this,"expressionCache",new Map);Ce(this,"maxCacheSize",1e3)}async evaluateExpression(t,n){if(!t||!t.trim())return{success:!1,error:"è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º"};if(!n)return{success:!1,error:"æ²¡æœ‰å¯ç”¨çš„æ•°æ®ä¸Šä¸‹æ–‡"};try{const i=this.preprocessExpression(t),l=this.getCompiledExpression(i),r=await this.executeCompiledExpression(l,n);return{success:!0,value:r.value,type:this.inferValueType(r.value)}}catch(i){return{success:!1,error:i instanceof Error?i.message:String(i)}}}validateExpression(t,n){if(!t||!t.trim())return{valid:!1,error:"è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º"};try{const i=this.preprocessExpression(t),l=this.compileExpression(i);return this.staticValidation(l,n)}catch(i){return{valid:!1,error:i instanceof Error?i.message:"è¡¨è¾¾å¼æ ¼å¼é”™è¯¯"}}}getFieldSuggestions(t,n){if(!n)return[];const i=t.toLowerCase().replace(/[{}]/g,""),l=[];if(n.fields.forEach(r=>{r.name.toLowerCase().includes(i)&&l.push(`{${r.name}}`),r.displayName&&r.displayName.toLowerCase().includes(i)&&l.push(`{${r.name}}`)}),n.currentRecord.data){const r=this.getNestedFieldSuggestions(i,n.currentRecord.data,"");l.push(...r)}return Array.from(new Set(l)).sort((r,s)=>{const o=r.replace(/[{}]/g,""),c=s.replace(/[{}]/g,"");return o===i?-1:c===i?1:o.startsWith(i)?-1:c.startsWith(i)?1:o.localeCompare(c)}).slice(0,20)}preprocessExpression(t){let n=t.trim();return!n.startsWith("{")&&!n.endsWith("}")&&(n=`{${n}}`),n=n.replace(/^\{+/,"{").replace(/\}+$/,"}"),n}getCompiledExpression(t){let n=this.expressionCache.get(t);if(!n){if(n=this.compileExpression(t),this.expressionCache.size>=this.maxCacheSize){const i=this.expressionCache.keys().next().value;i&&this.expressionCache.delete(i)}this.expressionCache.set(t,n)}return n}compileExpression(t){const n=t.slice(1,-1),i=this.parsePath(n);return{original:t,path:i,type:this.determineExpressionType(i)}}parsePath(t){const n=[];let i="",l=!1;for(let r=0;r<t.length;r++){const s=t[r];if(s==="["&&!l)i&&(n.push({type:"field",value:i}),i=""),l=!0;else if(s==="]"&&l){const o=parseInt(i,10);if(isNaN(o))throw new Error(`æ— æ•ˆçš„æ•°ç»„ç´¢å¼•: ${i}`);n.push({type:"index",value:o}),i="",l=!1}else s==="."&&!l?i&&(n.push({type:"field",value:i}),i=""):i+=s}if(i){if(l)throw new Error("æœªé—­åˆçš„æ•°ç»„ç´¢å¼•");n.push({type:"field",value:i})}if(n.length===0)throw new Error("ç©ºçš„å­—æ®µè·¯å¾„");return n}async executeCompiledExpression(t,n){let i=n.currentRecord.data;for(const l of t.path){if(i==null)throw new Error("æ— æ³•è®¿é—® null/undefined å€¼çš„å±æ€§");if(l.type==="field"){if(typeof i!="object")throw new Error(`å°è¯•è®¿é—®éå¯¹è±¡ç±»å‹çš„å­—æ®µ: ${l.value}`);if(!(l.value in i))throw new Error(`å­—æ®µä¸å­˜åœ¨: ${l.value}`);i=i[l.value]}else if(l.type==="index"){if(!Array.isArray(i))throw new Error("å°è¯•å¯¹éæ•°ç»„ç±»å‹ä½¿ç”¨ç´¢å¼•è®¿é—®");const r=l.value;if(r<0||r>=i.length)throw new Error(`æ•°ç»„ç´¢å¼•è¶…å‡ºèŒƒå›´: ${r}`);i=i[r]}}return{value:i}}staticValidation(t,n){if(!n)return{valid:!0,warnings:["æ²¡æœ‰æ•°æ®ä¸Šä¸‹æ–‡ï¼Œæ— æ³•éªŒè¯å­—æ®µæ˜¯å¦å­˜åœ¨"]};const i=[],l=t.path[0];if(l&&l.type==="field"){const s=l.value;if(!n.fields.some(c=>c.name===s)){const c=n.fields.filter(a=>a.name.toLowerCase().includes(s.toLowerCase())||this.levenshteinDistance(a.name.toLowerCase(),s.toLowerCase())<=2).map(a=>`{${a.name}}`).slice(0,5);return{valid:!1,error:`å­—æ®µä¸å­˜åœ¨: ${s}`,suggestions:c}}}t.path.length>5&&i.push("è¡¨è¾¾å¼è·¯å¾„è¿‡æ·±ï¼Œå¯èƒ½å½±å“æ€§èƒ½");const r={valid:!0};return i.length>0&&(r.warnings=i),r}getNestedFieldSuggestions(t,n,i){const l=[];if(!n||typeof n!="object")return l;for(const r of Object.keys(n)){const s=i?`${i}.${r}`:r;s.toLowerCase().includes(t)&&l.push(`{${s}}`),i.split(".").length<3&&n[r]&&typeof n[r]=="object"&&l.push(...this.getNestedFieldSuggestions(t,n[r],s))}return l}inferValueType(t){return t==null?"object":typeof t=="string"?"string":typeof t=="number"?"number":typeof t=="boolean"?"boolean":t instanceof Date?"date":typeof t=="object"?"object":"string"}determineExpressionType(t){return t.length===1?"simple":t.length<=3&&t.every(n=>n.type==="field")?"nested":"complex"}levenshteinDistance(t,n){if(t.length===0)return n.length;if(n.length===0)return t.length;const i=new Array(n.length+1);for(let l=0;l<=n.length;l++)i[l]=new Array(t.length+1),i[l][0]=l;for(let l=0;l<=t.length;l++)i[0][l]=l;for(let l=1;l<=n.length;l++)for(let r=1;r<=t.length;r++){const s=t[r-1]===n[l-1]?0:1;i[l][r]=Math.min(i[l-1][r]+1,i[l][r-1]+1,i[l-1][r-1]+s)}return i[n.length][t.length]}clearCache(){this.expressionCache.clear()}getCacheStats(){return{size:this.expressionCache.size,maxSize:this.maxCacheSize,hitRate:0}}}const xt=new fl;class vl{constructor(){Ce(this,"context",W(null));Ce(this,"subscribers",[]);this.context[1](null)}getCurrentContext(){return this.context[0]()}async setActiveDataSource(t){try{const i=(await Se.listDataSources()).find(a=>a.id===t);if(!i)throw new Error(`æ•°æ®æºä¸å­˜åœ¨: ${t}`);console.log("ğŸ” æ‰¾åˆ°æ•°æ®æº:",i);const l=i.provider_type||i.type_name||"json";console.log("ğŸ” æ¨æ–­çš„ providerType:",l);const r=await Se.getPreview(t,void 0,1);console.log("ğŸ” é¢„è§ˆæ•°æ®:",r);const s=await Se.getSchema(t);console.log("ğŸ” Schemaä¿¡æ¯:",s);const o=s.columns.map(a=>({name:a.name,displayName:a.description||a.name,type:this.mapDataType(a.data_type),nullable:a.nullable,sample:a.default_value})),c={dataSource:{id:t,type:this.inferDataSourceType(l),name:i.name,status:this.mapDataSourceStatus(i.status)},currentRecord:{index:0,total:r.total_rows,data:r.rows[0]||{}},fields:o};console.log("âœ… åˆ›å»ºæ–°çš„æ•°æ®ä¸Šä¸‹æ–‡:",c),this.context[1](c),this.notifySubscribers(c)}catch(n){console.error("è®¾ç½®æ•°æ®æºå¤±è´¥:",n);const i={dataSource:{id:t,type:"json",name:"æœªçŸ¥æ•°æ®æº",status:"error"},currentRecord:{index:0,total:0,data:{}},fields:[],error:{type:"system",message:n instanceof Error?n.message:"æ•°æ®æºåŠ è½½å¤±è´¥",details:n}};this.context[1](i),this.notifySubscribers(i)}}async navigateToRecord(t){const n=this.getCurrentContext();if(!n||t<0||t>=n.currentRecord.total)return!1;try{const i=await Se.queryData(n.dataSource.id,{limit:1,offset:t});if(i.rows.length===0)return!1;const l={...n,currentRecord:{...n.currentRecord,index:t,data:i.rows[0]}};return this.context[1](l),this.notifySubscribers(l),!0}catch(i){return console.error("å¯¼èˆªåˆ°è®°å½•å¤±è´¥:",i),!1}}async navigateNext(){const t=this.getCurrentContext();return t?this.navigateToRecord(t.currentRecord.index+1):!1}async navigatePrevious(){const t=this.getCurrentContext();return t?this.navigateToRecord(t.currentRecord.index-1):!1}async evaluateExpression(t){const n=this.getCurrentContext();return await xt.evaluateExpression(t,n)}validateExpression(t){const n=this.getCurrentContext(),i=xt.validateExpression(t,n);return{valid:i.valid,...i.error&&{error:i.error},...i.suggestions&&{suggestions:i.suggestions}}}getFieldSuggestions(t){const n=this.getCurrentContext();return xt.getFieldSuggestions(t,n)}subscribe(t){return this.subscribers.push(t),()=>{const n=this.subscribers.indexOf(t);n>-1&&this.subscribers.splice(n,1)}}destroy(){this.subscribers.length=0,this.context[1](null)}notifySubscribers(t){this.subscribers.forEach(n=>{try{n(t)}catch(i){console.error("æ•°æ®ä¸Šä¸‹æ–‡è®¢é˜…å›è°ƒé”™è¯¯:",i)}})}inferDataSourceType(t){if(!t)return console.warn("providerType is undefined, defaulting to json"),"json";switch(t.toLowerCase()){case"json":return"json";case"excel":return"excel";case"sql":return"sql";case"xml":return"xml";case"csv":return"csv";default:return"json"}}mapDataType(t){switch(t){case"String":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Date":case"DateTime":return"date";case"Array":return"array";case"Object":return"object";default:return"string"}}mapDataSourceStatus(t){if(!t)return console.warn("status is undefined, defaulting to empty"),"empty";switch(t.toLowerCase()){case"active":case"connected":case"ready":return"ready";case"error":case"failed":return"error";case"loading":case"processing":case"connecting":return"loading";case"disabled":case"disconnected":case"inactive":return"empty";default:return console.warn(`Unknown status: ${t}, defaulting to empty`),"empty"}}}const Ke=new vl;var yl=w("<svg><g class=text-element-unified-container data-bounds-version=unified-v2><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=text-content-unified></svg>",!1,!0,!1),Ot=w("<svg><rect class=text-selection-unified></svg>",!1,!0,!1),ml=w("<svg><rect class=text-background-unified></svg>",!1,!0,!1),pl=w("<svg><rect fill=none class=text-border-unified></svg>",!1,!0,!1),bl=w("<svg><tspan class=text-line-wrapped></svg>",!1,!0,!1),xl=w("<svg><tspan class=text-line-original></svg>",!1,!0,!1),wl=w("<svg><rect x=0 y=0></svg>",!1,!0,!1),_l=w("<svg><line x1=0></svg>",!1,!0,!1),$l=w("<svg><g class=datafield-element-unified-container><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto></svg>",!1,!0,!1),Sl=w('<svg><g class=design-mode-indicator><circle r=6 fill="rgba(24, 144, 255, 0.1)"stroke=#1890ff stroke-width=1></circle><text text-anchor=middle dominant-baseline=middle font-size=8 font-weight=bold fill=#1890ff></svg>',!1,!0,!1),Cl=w("<svg><tspan class=datafield-line-wrapped></svg>",!1,!0,!1),kl=w("<svg><tspan dy=0></svg>",!1,!0,!1),El=w("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),Al=w("<svg><g></svg>",!1,!0,!1);const Pl=e=>{const{state:t}=Qt(),[n,i]=W("[æ•°æ®å­—æ®µ]");kt(()=>{if(e.element.content.type==="DataField"){const s=e.element.content.expression||"",o=t().mode;zt.shouldShowExpression(o)?i(s||"[æ•°æ®å­—æ®µ]"):Ke.evaluateExpression(s).then(c=>{c.success?i(String(c.value||"")):i(`[é”™è¯¯: ${c.error}]`)}).catch(c=>{i(`[é”™è¯¯: ${c}]`)})}});const l=ie(()=>{const{position:s}=e.element;return{transform:`translate(${s.x}px, ${s.y}px)`,opacity:e.element.visible?1:.5}}),r=()=>{const{content:s,size:o}=e.element;if(s.type==="Text"&&s.content&&s.style){const c=We.calculateUnifiedBounds(s.content,s.style,o),a=We.getTextAnchor(s.style.align);return(()=>{var g=yl(),u=g.firstChild;return d(g,(()=>{var h=te(()=>!!e.selected);return()=>h()&&(()=>{var v=Ot();return M(f=>{var m=c.containerBounds.x,C=c.containerBounds.y,_=c.containerBounds.width,k=c.containerBounds.height;return m!==f.e&&S(v,"x",f.e=m),C!==f.t&&S(v,"y",f.t=C),_!==f.a&&S(v,"width",f.a=_),k!==f.o&&S(v,"height",f.o=k),f},{e:void 0,t:void 0,a:void 0,o:void 0}),v})()})(),u),d(g,(()=>{var h=te(()=>!!s.style.background);return()=>h()&&(()=>{var v=ml();return M(f=>{var N,U;var m=c.positioning.backgroundX,C=c.positioning.backgroundY,_=c.containerBounds.width+(s.style.background.padding||0)*2,k=c.containerBounds.height+(s.style.background.padding||0)*2,P=s.style.background.color,L=s.style.background.opacity||1,I=((N=s.style.border)==null?void 0:N.radius)||0,z=((U=s.style.border)==null?void 0:U.radius)||0;return m!==f.e&&S(v,"x",f.e=m),C!==f.t&&S(v,"y",f.t=C),_!==f.a&&S(v,"width",f.a=_),k!==f.o&&S(v,"height",f.o=k),P!==f.i&&S(v,"fill",f.i=P),L!==f.n&&S(v,"fill-opacity",f.n=L),I!==f.s&&S(v,"rx",f.s=I),z!==f.h&&S(v,"ry",f.h=z),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),v})()})(),u),d(g,(()=>{var h=te(()=>!!s.style.border);return()=>h()&&(()=>{var v=pl();return M(f=>{var U,K;var m=c.positioning.backgroundX,C=c.positioning.backgroundY,_=c.containerBounds.width+(((U=s.style.background)==null?void 0:U.padding)||0)*2,k=c.containerBounds.height+(((K=s.style.background)==null?void 0:K.padding)||0)*2,P=s.style.border.color,L=s.style.border.width,I=s.style.border.style==="Dashed"?"5,5":s.style.border.style==="Dotted"?"2,2":"none",z=s.style.border.radius||0,N=s.style.border.radius||0;return m!==f.e&&S(v,"x",f.e=m),C!==f.t&&S(v,"y",f.t=C),_!==f.a&&S(v,"width",f.a=_),k!==f.o&&S(v,"height",f.o=k),P!==f.i&&S(v,"stroke",f.i=P),L!==f.n&&S(v,"stroke-width",f.n=L),I!==f.s&&S(v,"stroke-dasharray",f.s=I),z!==f.h&&S(v,"rx",f.h=z),N!==f.r&&S(v,"ry",f.r=N),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),v})()})(),u),S(u,"text-anchor",a),d(u,(()=>{var h=te(()=>{var v;return!!((v=c.textLayout)!=null&&v.isWrapped)});return()=>h()?c.textLayout.wrappedLines.map((v,f)=>(()=>{var m=bl();return d(m,v),M(C=>{var _=c.positioning.textAnchorX,k=f===0?0:c.fontMetrics.lineHeight;return _!==C.e&&S(m,"x",C.e=_),k!==C.t&&S(m,"dy",C.t=k),C},{e:void 0,t:void 0}),m})()):s.content.split(`
`).map((v,f)=>(()=>{var m=xl();return d(m,v),M(C=>{var _=c.positioning.textAnchorX,k=f===0?0:c.fontMetrics.lineHeight;return _!==C.e&&S(m,"x",C.e=_),k!==C.t&&S(m,"dy",C.t=k),C},{e:void 0,t:void 0}),m})())})()),M(h=>{var v=c.positioning.textAnchorX,f=c.positioning.textAnchorY,m=s.style.font_family,C=s.style.font_size.toString(),_=s.style.font_weight,k=s.style.color;return v!==h.e&&S(u,"x",h.e=v),f!==h.t&&S(u,"y",h.t=f),m!==h.a&&S(u,"font-family",h.a=m),C!==h.o&&S(u,"font-size",h.o=C),_!==h.i&&S(u,"font-weight",h.i=_),k!==h.n&&S(u,"fill",h.n=k),h},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),g})()}if(s.type==="Rectangle"){const c=s.opacity!==void 0?s.opacity:1,a=s.corner_radius||0;return(()=>{var g=wl();return S(g,"rx",a),S(g,"ry",a),S(g,"fill-opacity",c),S(g,"stroke-opacity",c),M(u=>{var k,P,L,I;var h=o.width,v=o.height,f=s.fill_color||"transparent",m=((k=s.border)==null?void 0:k.color)||"#000000",C=((P=s.border)==null?void 0:P.width)||1,_=((L=s.border)==null?void 0:L.style)==="Dashed"?"5,5":((I=s.border)==null?void 0:I.style)==="Dotted"?"2,2":"none";return h!==u.e&&S(g,"width",u.e=h),v!==u.t&&S(g,"height",u.t=v),f!==u.a&&S(g,"fill",u.a=f),m!==u.o&&S(g,"stroke",u.o=m),C!==u.i&&S(g,"stroke-width",u.i=C),_!==u.n&&S(g,"stroke-dasharray",u.n=_),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),g})()}if(s.type==="Line"){const c=s.opacity!==void 0?s.opacity:1,a=s.line_style||"Solid",g=a==="Dashed"?"8,4":a==="Dotted"?"2,2":a==="DashDot"?"8,4,2,4":"none";return(()=>{var u=_l();return S(u,"stroke-opacity",c),S(u,"stroke-dasharray",g),M(h=>{var v=o.height/2,f=o.width,m=o.height/2,C=s.color,_=s.width;return v!==h.e&&S(u,"y1",h.e=v),f!==h.t&&S(u,"x2",h.t=f),m!==h.a&&S(u,"y2",h.a=m),C!==h.o&&S(u,"stroke",h.o=C),_!==h.i&&S(u,"stroke-width",h.i=_),h},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),u})()}if(s.type==="DataField"&&s.style){const c=n(),a=We.calculateUnifiedBounds(c,s.style,o),g=We.getTextAnchor(s.style.align);return(()=>{var u=$l(),h=u.firstChild;return d(u,(()=>{var v=te(()=>!!e.selected);return()=>v()&&(()=>{var f=Ot();return M(m=>{var C=a.containerBounds.x,_=a.containerBounds.y,k=a.containerBounds.width,P=a.containerBounds.height;return C!==m.e&&S(f,"x",m.e=C),_!==m.t&&S(f,"y",m.t=_),k!==m.a&&S(f,"width",m.a=k),P!==m.o&&S(f,"height",m.o=P),m},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()})(),h),d(u,(()=>{var v=te(()=>!!zt.shouldShowExpression(t().mode));return()=>v()&&(()=>{var f=Sl(),m=f.firstChild,C=m.nextSibling;return M(_=>{var k=a.containerBounds.x+a.containerBounds.width-8,P=a.containerBounds.y+8,L=a.containerBounds.x+a.containerBounds.width-8,I=a.containerBounds.y+8;return k!==_.e&&S(m,"cx",_.e=k),P!==_.t&&S(m,"cy",_.t=P),L!==_.a&&S(C,"x",_.a=L),I!==_.o&&S(C,"y",_.o=I),_},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()})(),h),S(h,"text-anchor",g),d(h,(()=>{var v=te(()=>{var f;return!!((f=a.textLayout)!=null&&f.isWrapped)});return()=>v()?a.textLayout.wrappedLines.map((f,m)=>(()=>{var C=Cl();return d(C,f),M(_=>{var k=a.positioning.textAnchorX,P=m===0?0:a.fontMetrics.lineHeight;return k!==_.e&&S(C,"x",_.e=k),P!==_.t&&S(C,"dy",_.t=P),_},{e:void 0,t:void 0}),C})()):(()=>{var f=kl();return d(f,c),M(()=>S(f,"x",a.positioning.textAnchorX)),f})()})()),M(v=>{var f=t().mode,m=a.positioning.textAnchorX,C=a.positioning.textAnchorY,_=s.style.font_family,k=s.style.font_size.toString(),P=s.style.font_weight,L=c.startsWith("[é”™è¯¯:")?"#ff4d4f":s.style.color,I=`datafield-content-unified ${t().mode}-mode`;return f!==v.e&&S(u,"data-preview-mode",v.e=f),m!==v.t&&S(h,"x",v.t=m),C!==v.a&&S(h,"y",v.a=C),_!==v.o&&S(h,"font-family",v.o=_),k!==v.i&&S(h,"font-size",v.i=k),P!==v.n&&S(h,"font-weight",v.n=P),L!==v.s&&S(h,"fill",v.s=L),I!==v.h&&S(h,"class",v.h=I),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()}return(()=>{var c=El();return M(a=>{var g=o.width,u=o.height;return g!==a.e&&S(c,"width",a.e=g),u!==a.t&&S(c,"height",a.t=u),a},{e:void 0,t:void 0}),c})()};return(()=>{var s=Al();return d(s,r),M(o=>{var c=`element ${e.selected&&e.element.content.type!=="Text"&&e.element.content.type!=="DataField"?"element-selected":""}`,a=l(),g=e.element.id,u=e.element.content.type;return c!==o.e&&S(s,"class",o.e=c),o.t=Yt(s,a,o.t),g!==o.a&&S(s,"data-element-id",o.a=g),u!==o.o&&S(s,"data-element-type",o.o=u),o},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()};var Dl=w("<svg><g class=resize-handles></svg>",!1,!0,!1),zl=w("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const Tl=e=>{const{updateElement:t,setResizeOperation:n}=Oe(),[i,l]=W(!1),[r,s]=W(null),[o,c]=W({x:0,y:0}),[a,g]=W({width:0,height:0}),[u,h]=W({x:0,y:0}),[v,f]=W({width:0,height:0}),[m,C]=W({x:0,y:0}),[_,k]=W(!1),P=ie(()=>{const{position:R,size:F,content:E}=e.element,H=8/2;let b={x:R.x,y:R.y,width:F.width,height:F.height};if((E.type==="Text"||E.type==="DataField")&&E.style){const de=E.type==="Text"?E.content:E.expression||"[æ•°æ®å­—æ®µ]",j=We.calculateUnifiedBounds(de,E.style,F);b={x:R.x+j.containerBounds.x,y:R.y+j.containerBounds.y,width:j.containerBounds.width,height:j.containerBounds.height}}const D=b.x,B=b.y,T=b.x+b.width,V=b.y+b.height,Z=b.x+b.width/2,ue=b.y+b.height/2;return[{position:"nw",cursor:"nw-resize",x:D-H,y:B-H},{position:"ne",cursor:"ne-resize",x:T-H,y:B-H},{position:"sw",cursor:"sw-resize",x:D-H,y:V-H},{position:"se",cursor:"se-resize",x:T-H,y:V-H},{position:"n",cursor:"n-resize",x:Z-H,y:B-H},{position:"s",cursor:"s-resize",x:Z-H,y:V-H},{position:"w",cursor:"w-resize",x:D-H,y:ue-H},{position:"e",cursor:"e-resize",x:T-H,y:ue-H}]}),L=(R,F,E,q=!1,H=!1)=>{const b=a(),D=u();let B=b.width,T=b.height,V=D.x,Z=D.y;switch(R){case"nw":B=b.width-F,T=b.height-E,V=D.x+F,Z=D.y+E;break;case"ne":B=b.width+F,T=b.height-E,Z=D.y+E;break;case"sw":B=b.width-F,T=b.height+E,V=D.x+F;break;case"se":B=b.width+F,T=b.height+E;break;case"n":T=b.height-E,Z=D.y+E;break;case"s":T=b.height+E;break;case"w":B=b.width-F,V=D.x+F;break;case"e":B=b.width+F;break}if(q&&(R==="nw"||R==="ne"||R==="sw"||R==="se")){const de=b.width/b.height;B/T>de?(B=T*de,(R==="nw"||R==="sw")&&(V=D.x+(b.width-B))):(T=B/de,(R==="nw"||R==="ne")&&(Z=D.y+(b.height-T)))}if(H){const de=D.x+b.width/2,j=D.y+b.height/2;V=de-B/2,Z=j-T/2}const ue=20;return B=Math.max(ue,B),T=Math.max(ue,T),{size:{width:B,height:T},position:{x:V,y:Z}}},I=R=>(R.preventDefault(),R.stopPropagation(),R.stopImmediatePropagation(),!1),z=(R,F)=>{var E;n(!0),document.addEventListener("click",I,{capture:!0}),l(!0),s(R),c({x:F.clientX,y:F.clientY}),g({width:e.element.size.width,height:e.element.size.height}),h({x:e.element.position.x,y:e.element.position.y}),f(e.element.size),C(e.element.position),k(!1),document.addEventListener("mousemove",U),document.addEventListener("mouseup",K),document.body.style.cursor=((E=P().find(q=>q.position===R))==null?void 0:E.cursor)||"default"};let N=0;const U=R=>{if(!i())return;const F=r();if(!F)return;const E=o(),q=R.clientX-E.x,H=R.clientY-E.y,b=L(F,q,H,R.shiftKey,R.altKey);f(b.size),C(b.position),k(Math.abs(q)>2||Math.abs(H)>2);const D=Date.now();if(D-N>50)try{t(e.element.id,{size:b.size,position:b.position}),N=D}catch{}},K=()=>{if(!i()||!r())return;const F=()=>{document.removeEventListener("click",I,{capture:!0}),n(!1),l(!1),s(null),document.body.style.cursor="default",document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",K)};if(_()){const E=v(),q=m();t(e.element.id,{size:E,position:q}).catch(H=>{t(e.element.id,{size:a(),position:u()}).catch(b=>{})})}F()};return vt(()=>{n(!1),document.removeEventListener("click",I,{capture:!0}),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",K),document.body.style.cursor="default"}),(()=>{var R=Dl();return d(R,()=>P().map(F=>(()=>{var E=zl(),q=E.firstChild,H=q.nextSibling;return H.addEventListener("mouseleave",b=>{i()||(document.body.style.cursor="default")}),H.addEventListener("mouseenter",b=>{i()||(document.body.style.cursor=F.cursor)}),H.$$mousedown=b=>{b.stopPropagation(),b.preventDefault(),z(F.position,b)},H.style.setProperty("pointer-events","all"),M(b=>{var D=F.x+4,B=F.y+4,T=F.x,V=F.y,Z=F.cursor;return D!==b.e&&S(q,"cx",b.e=D),B!==b.t&&S(q,"cy",b.t=B),T!==b.a&&S(H,"x",b.a=T),V!==b.o&&S(H,"y",b.o=V),Z!==b.i&&((b.i=Z)!=null?H.style.setProperty("cursor",Z):H.style.removeProperty("cursor")),b},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),E})())),R})()};$e(["mousedown"]);var we=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(we||{});const Ll={dragThreshold:3,updateThrottle:16};var Ml=w("<div tabindex=0>"),Ul=w("<div>"),Rl=w("<div><div>ğŸ¯ ä¿®å¤ç‰ˆäº¤äº’å±‚</div><div>æ¨¡å¼: </div><div>é€‰ä¸­: </div><div>å…‰æ ‡: "),Il=w("<div>æ‹–æ‹½: <!>ä¸ªå…ƒç´ "),Ol=w("<div>[<!>]");const Fl=e=>{const{resizeOperation:t,setResizeOperation:n}=Oe(),i=Ll;let l;const[r,s]=W(we.IDLE),[o,c]=W([]),[a,g]=W(null),[u,h]=W(null),[v,f]=W(null),m=(p,x)=>Math.sqrt(Math.pow(p.x-x.x,2)+Math.pow(p.y-x.y,2)),C=(p,x)=>p.length===x.length&&p.every((A,$)=>A===x[$]),_=()=>{f(null)},[k,P]=W(null);let L="default";const I=(p,x)=>{!l||L===p||(l.style.cursor=p,L=p)},z=(p,...x)=>{console.log(`ğŸ¯ [InteractionLayer] ${p}`,...x)},N=p=>{if(!l)return{x:0,y:0};const x=l.getBoundingClientRect();return{x:p.clientX-x.left,y:p.clientY-x.top}},U=(p,x)=>p.x>=x.position.x&&p.x<=x.position.x+x.size.width&&p.y>=x.position.y&&p.y<=x.position.y+x.size.height,K=p=>{var A;const x=R(p);return x.length>0&&(A=x[0])!=null?A:null},R=p=>{const x=e.getAllElements();return x.filter($=>$&&$.visible&&U(p,$)).sort(($,O)=>{var se,oe;const X=(se=$.z_index)!=null?se:x.indexOf($);return((oe=O.z_index)!=null?oe:x.indexOf(O))-X})},F=p=>{const x=o();if(x.length===0)return null;const A=e.getAllElements();for(const $ of x){const O=A.find(Me=>Me.id===$);if(!O||!O.visible)continue;const X=8,G=X/2,se=O.position.x,oe=O.position.y,Q=O.position.x+O.size.width,Be=O.position.y+O.size.height,Ee=O.position.x+O.size.width/2,Ye=O.position.y+O.size.height/2,gn=[{direction:"nw",cursor:"nw-resize",x:se-G,y:oe-G},{direction:"ne",cursor:"ne-resize",x:Q-G,y:oe-G},{direction:"sw",cursor:"sw-resize",x:se-G,y:Be-G},{direction:"se",cursor:"se-resize",x:Q-G,y:Be-G},{direction:"n",cursor:"n-resize",x:Ee-G,y:oe-G},{direction:"s",cursor:"s-resize",x:Ee-G,y:Be-G},{direction:"w",cursor:"w-resize",x:se-G,y:Ye-G},{direction:"e",cursor:"e-resize",x:Q-G,y:Ye-G}];for(const Me of gn)if(p.x>=Me.x&&p.x<Me.x+X&&p.y>=Me.y&&p.y<Me.y+X)return{elementId:O.id,direction:Me.direction,cursor:Me.cursor}}return null},E=p=>e.getAllElements().filter(A=>{if(!A.visible)return!1;const $={x:A.position.x,y:A.position.y,width:A.size.width,height:A.size.height};return!($.x>p.x+p.width||$.x+$.width<p.x||$.y>p.y+p.height||$.y+$.height<p.y)}),q=(p,x)=>{var $,O,X;const A=R(p);return z("é‡å é€‰æ‹©æ£€æµ‹",{elementsCount:A.length,isCtrlClick:x,elementIds:A.map(G=>G.id)}),A.length===0?null:A.length===1?(_(),(($=A[0])==null?void 0:$.id)||null):x?H(p,A):(_(),z("æ™®é€šç‚¹å‡»é€‰ä¸­æœ€ä¸Šå±‚",{elementId:(O=A[0])==null?void 0:O.id}),((X=A[0])==null?void 0:X.id)||null)},H=(p,x)=>{var X,G,se,oe;const A=v(),$=Date.now();if(z("å¾ªç¯é€‰æ‹©å¼€å§‹",{hasContext:!!A,elementIds:x.map(Q=>Q.id)}),!A||m(p,A.clickPoint)>5||$-A.lastClickTime>3e3||!C(x.map(Q=>Q.id),A.overlappingElements.map(Q=>Q.id))){const Q=x.length>1?1:0;return f({clickPoint:p,overlappingElements:x,currentSelectedIndex:Q,lastClickTime:$}),z("å¾ªç¯é€‰æ‹©é‡ç½®",{selectedIndex:Q,selectedId:(X=x[Q])==null?void 0:X.id,reason:A?m(p,A.clickPoint)>5?"position_changed":$-A.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),b(Q+1,x.length,p),((G=x[Q])==null?void 0:G.id)||null}else{const Q=(A.currentSelectedIndex+1)%x.length;return f({...A,currentSelectedIndex:Q,lastClickTime:$}),z("å¾ªç¯é€‰æ‹©ç»§ç»­",{selectedIndex:Q,selectedId:(se=x[Q])==null?void 0:se.id}),b(Q+1,x.length,p),((oe=x[Q])==null?void 0:oe.id)||null}},b=(p,x,A)=>{const $=document.querySelector(".overlap-indicator");$!=null&&$.parentNode&&$.parentNode.removeChild($);const O=document.createElement("div");O.className="overlap-indicator",O.textContent=`${p}/${x}`,Object.assign(O.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${A.x+10}px`,top:`${A.y-20}px`}),document.body.appendChild(O),z("æ˜¾ç¤ºé‡å æŒ‡ç¤ºå™¨",{current:p,total:x,point:A}),setTimeout(()=>{O.parentNode&&(O.parentNode.removeChild(O),z("ç§»é™¤é‡å æŒ‡ç¤ºå™¨"))},1500)},D=p=>{var A;const x=N(p);if(k()){ke(x);return}if(r()===we.DRAGGING){be(x);return}if(r()===we.SELECTING){fe(x);return}if(r()===we.IDLE&&a()&&!((A=a())!=null&&A.isDragging)){pe(x);return}r()===we.IDLE&&!a()&&!k()&&B(x)},B=p=>{const x=F(p);if(x){I(x.cursor);return}const A=K(p);if(A){const O=o().includes(A.id)?"grab":"pointer";I(O);return}I("default")},T=p=>{const x=N(p),A=F(x);if(A){z("ç‚¹å‡»ResizeHandle",{elementId:A.elementId,direction:A.direction}),V(A,x);return}if(t()){z("è°ƒæ•´å¤§å°æ“ä½œè¿›è¡Œä¸­ï¼Œè·³è¿‡äº¤äº’å¤„ç†");return}const $=q(x,p.ctrlKey);if(z("é¼ æ ‡æŒ‰ä¸‹",{point:x,selectedElementId:$,currentMode:r(),isCtrlClick:p.ctrlKey}),$){const O=e.getAllElements().find(X=>X.id===$);O&&Z(O,x,p)}else ue(x)},V=(p,x,A)=>{const $=e.getAllElements().find(O=>O.id===p.elementId);$&&(z("å¼€å§‹resizeæ“ä½œ",{elementId:p.elementId,direction:p.direction}),n(!0),P({elementId:p.elementId,handlePosition:p.direction,startPoint:x,initialSize:{width:$.size.width,height:$.size.height},initialPosition:{x:$.position.x,y:$.position.y},cursor:p.cursor}),I(p.cursor),z("resizeçŠ¶æ€å·²è®¾ç½®",k()))},Z=(p,x,A)=>{const $=o().includes(p.id),O=o(),X=!!v();z("å…ƒç´ ç‚¹å‡»",{elementId:p.id,isSelected:$,currentlySelected:O,ctrlKey:A.ctrlKey,shiftKey:A.shiftKey,hasOverlapContext:X}),A.ctrlKey&&!X?de(p.id):A.shiftKey&&o().length>0?j(p.id):$?(z("ç‚¹å‡»å·²é€‰ä¸­å…ƒç´ ï¼Œå‡†å¤‡æ‹–æ‹½",{selectedCount:O.length}),xe(O,x)):ce(p.id,x)},ue=(p,x)=>{var A;z("å¼€å§‹æ¡†é€‰",{point:p}),c([]),(A=e.onElementsSelect)==null||A.call(e,[]),_(),s(we.SELECTING),I("crosshair"),h({startPoint:p,currentPoint:p,selectedIds:[]})},de=p=>{var $;const x=o(),A=x.includes(p)?x.filter(O=>O!==p):[...x,p];z("åˆ‡æ¢é€‰æ‹©",{elementId:p,newSelection:A}),c(A),($=e.onElementsSelect)==null||$.call(e,A)},j=p=>{var A;const x=o();if(!x.includes(p)){const $=[...x,p];z("æ·»åŠ åˆ°é€‰æ‹©",{elementId:p,newSelection:$}),c($),(A=e.onElementsSelect)==null||A.call(e,$)}},ce=(p,x,A)=>{var $;z("é€‰æ‹©å¹¶å‡†å¤‡æ‹–æ‹½",{elementId:p,point:x}),c([p]),($=e.onElementsSelect)==null||$.call(e,[p]),xe([p],x)},xe=(p,x,A)=>{z("å‡†å¤‡æ‹–æ‹½æ“ä½œ",{elementIds:p,startPoint:x});const $=e.getAllElements(),O=new Map;p.forEach(X=>{const G=$.find(se=>se.id===X);G&&O.set(X,{x:G.position.x,y:G.position.y})}),g({elementIds:p,startPoint:x,startPositions:O,currentOffset:{x:0,y:0},isDragging:!1})},pe=p=>{const x=a();if(!x)return;const A=Math.sqrt(Math.pow(p.x-x.startPoint.x,2)+Math.pow(p.y-x.startPoint.y,2));A>i.dragThreshold&&(z("å¼€å§‹æ‹–æ‹½",{distance:A,threshold:i.dragThreshold}),s(we.DRAGGING),I("grabbing"),g({...x,isDragging:!0}))};let le=!1,re=0;const he=(p,x=!1)=>{if(x){p();return}Date.now()-re>=i.updateThrottle&&!le&&(le=!0,requestAnimationFrame(()=>{p(),le=!1,re=Date.now()}))},be=p=>{const x=a();if(!x)return;const A={x:p.x-x.startPoint.x,y:p.y-x.startPoint.y};g({...x,currentOffset:A}),he(()=>{if(e.onBatchUpdatePositions&&x.elementIds.length>1){const $=x.elementIds.map(O=>{const X=x.startPositions.get(O);return X?{element_id:O,new_position:{x:X.x+A.x,y:X.y+A.y}}:null}).filter(Boolean);$.length>0&&e.onBatchUpdatePositions($).catch(()=>{})}else if(e.onElementMove){const $=x.elementIds.map(O=>{const X=x.startPositions.get(O);if(X)return e.onElementMove(O,{x:X.x+A.x,y:X.y+A.y})}).filter(Boolean);Promise.allSettled($).catch(()=>{})}})},fe=p=>{const x=u();if(!x)return;const A={...x,currentPoint:p};h(A);const $={x:Math.min(x.startPoint.x,p.x),y:Math.min(x.startPoint.y,p.y),width:Math.abs(p.x-x.startPoint.x),height:Math.abs(p.y-x.startPoint.y)},X=E($).map(G=>G.id);h({...A,selectedIds:X}),c(X)},ke=p=>{const x=k();if(!x)return;const A=p.x-x.startPoint.x,$=p.y-x.startPoint.y,O=Te(x.handlePosition,A,$,x.initialSize,x.initialPosition);he(()=>{e.onElementResize&&e.onElementResize(x.elementId,O.size,O.position)})},Te=(p,x,A,$,O)=>{let X=$.width,G=$.height,se=O.x,oe=O.y;switch(p){case"nw":X=$.width-x,G=$.height-A,se=O.x+x,oe=O.y+A;break;case"ne":X=$.width+x,G=$.height-A,oe=O.y+A;break;case"sw":X=$.width-x,G=$.height+A,se=O.x+x;break;case"se":X=$.width+x,G=$.height+A;break;case"n":G=$.height-A,oe=O.y+A;break;case"s":G=$.height+A;break;case"w":X=$.width-x,se=O.x+x;break;case"e":X=$.width+x;break}const Q=10;return X=Math.max(Q,X),G=Math.max(Q,G),{size:{width:X,height:G},position:{x:se,y:oe}}},Fe=()=>{const p=r();if(z("é¼ æ ‡é‡Šæ”¾",{currentMode:p,hasResizeState:!!k()}),k()){mt();return}p===we.DRAGGING?Ne():p===we.SELECTING&&yt(),Le()},Ne=()=>{const p=a();if(!p||!p.isDragging&&p.currentOffset.x===0&&p.currentOffset.y===0){z("æ‹–æ‹½å®Œæˆï¼Œæ— å®é™…ç§»åŠ¨");return}if(e.onBatchUpdatePositions&&p.elementIds.length>1){const x=p.elementIds.map(A=>{const $=p.startPositions.get(A);return $?{element_id:A,new_position:{x:$.x+p.currentOffset.x,y:$.y+p.currentOffset.y}}:null}).filter(Boolean);x.length>0&&(z("æ‹–æ‹½å®Œæˆ - æ‰¹é‡æ›´æ–°",{elementCount:x.length}),e.onBatchUpdatePositions(x).catch(A=>{console.warn("æ‰¹é‡æ›´æ–°æœ€ç»ˆä½ç½®å¤±è´¥:",A)}))}},yt=()=>{const p=u();p&&(z("æ¡†é€‰å®Œæˆ",{selectedCount:p.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(p.selectedIds))},mt=()=>{const p=k();p&&(z("å®Œæˆresizeæ“ä½œ",{elementId:p.elementId}),n(!1),P(null))},Le=()=>{s(we.IDLE),I("default"),g(null),h(null),P(null),n(!1),_(),z("çŠ¶æ€é‡ç½®å®Œæˆ")};Ie(async()=>{document.addEventListener("mousemove",D),document.addEventListener("mouseup",Fe),z("ä¿®å¤ç‰ˆäº¤äº’å±‚å·²åˆå§‹åŒ–")}),vt(()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",Fe),z("ä¿®å¤ç‰ˆäº¤äº’å±‚å·²æ¸…ç†")});const Ge=()=>{const p=u();if(!p||r()!==we.SELECTING)return null;const{startPoint:x,currentPoint:A}=p;return{x:Math.min(x.x,A.x),y:Math.min(x.y,A.y),width:Math.abs(A.x-x.x),height:Math.abs(A.y-x.y)}};return(()=>{var p=Ml();p.$$mousedown=T;var x=l;return typeof x=="function"?Jt(x,p):l=p,p.style.setProperty("position","absolute"),p.style.setProperty("top","0"),p.style.setProperty("left","0"),p.style.setProperty("width","100%"),p.style.setProperty("height","100%"),p.style.setProperty("z-index","10"),p.style.setProperty("pointer-events","all"),p.style.setProperty("background","transparent"),p.style.setProperty("user-select","none"),d(p,(()=>{var A=te(()=>!!Ge());return()=>A()&&(()=>{var $=Ul();return $.style.setProperty("position","absolute"),$.style.setProperty("border","1px dashed #007acc"),$.style.setProperty("background","rgba(0, 122, 204, 0.1)"),$.style.setProperty("pointer-events","none"),M(O=>{var X=`${Ge().x}px`,G=`${Ge().y}px`,se=`${Ge().width}px`,oe=`${Ge().height}px`;return X!==O.e&&((O.e=X)!=null?$.style.setProperty("left",X):$.style.removeProperty("left")),G!==O.t&&((O.t=G)!=null?$.style.setProperty("top",G):$.style.removeProperty("top")),se!==O.a&&((O.a=se)!=null?$.style.setProperty("width",se):$.style.removeProperty("width")),oe!==O.o&&((O.o=oe)!=null?$.style.setProperty("height",oe):$.style.removeProperty("height")),O},{e:void 0,t:void 0,a:void 0,o:void 0}),$})()})(),null),d(p,(()=>{var A=te(()=>!!e.enableDebugMode);return()=>A()&&(()=>{var $=Rl(),O=$.firstChild,X=O.nextSibling;X.firstChild;var G=X.nextSibling;G.firstChild;var se=G.nextSibling;return se.firstChild,$.style.setProperty("position","fixed"),$.style.setProperty("top","10px"),$.style.setProperty("right","10px"),$.style.setProperty("padding","8px"),$.style.setProperty("background","rgba(0, 0, 0, 0.8)"),$.style.setProperty("color","white"),$.style.setProperty("font-family","monospace"),$.style.setProperty("font-size","12px"),$.style.setProperty("border-radius","4px"),$.style.setProperty("z-index","9999"),$.style.setProperty("pointer-events","none"),d(X,r,null),d(G,()=>o().length,null),d(se,L,null),d($,(()=>{var oe=te(()=>{var Q;return!!((Q=a())!=null&&Q.isDragging)});return()=>oe()&&(()=>{var Q=Il(),Be=Q.firstChild,Ee=Be.nextSibling;return Ee.nextSibling,Q.style.setProperty("color","#ffeb3b"),d(Q,()=>{var Ye;return(Ye=a())==null?void 0:Ye.elementIds.length},Ee),Q})()})(),null),d($,(()=>{var oe=te(()=>o().length>0);return()=>oe()&&(()=>{var Q=Ol(),Be=Q.firstChild,Ee=Be.nextSibling;return Ee.nextSibling,Q.style.setProperty("font-size","10px"),Q.style.setProperty("color","#ccc"),d(Q,()=>o().slice(0,3).join(", "),Ee),d(Q,()=>o().length>3&&"...",Ee),Q})()})(),null),$})()})(),null),p})()};$e(["mousedown"]);var Nl=w("<div class=toolbar-section><div class=section-title>æ™ºèƒ½å»ºè®®</div><button class=smart-align-button><div class=smart-icon>ğŸ¯</div><div class=smart-text></div></button><div class=smart-reason>"),Bl=w("<div class=toolbar-status><div class=status-text>é€‰æ‹©è‡³å°‘2ä¸ªå…ƒç´ ä»¥ä½¿ç”¨å¯¹é½åŠŸèƒ½"),Hl=w('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>æ­£åœ¨æ‰§è¡Œå¯¹é½æ“ä½œ...'),jl=w('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>å¯¹é½</div><div class=button-group><button class="align-button left"title=å·¦å¯¹é½><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=æ°´å¹³å±…ä¸­å¯¹é½><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=å³å¯¹é½><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>å‚ç›´å¯¹é½</div><div class=button-group><button class="align-button top"title=é¡¶éƒ¨å¯¹é½><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=å‚ç›´å±…ä¸­å¯¹é½><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=åº•éƒ¨å¯¹é½><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>åˆ†å¸ƒ</div><div class=button-group><button class="align-button distribute-h"title=æ°´å¹³å‡åŒ€åˆ†å¸ƒ><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=å‚ç›´å‡åŒ€åˆ†å¸ƒ><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const Vl=(e,t)=>{if(e.length<2)return[];const n=e.map(i=>({x:i.position.x,y:i.position.y,width:i.size.width,height:i.size.height}));return n.map((i,l)=>{let r=i.x,s=i.y;switch(t){case"left":r=Math.min(...n.map(u=>u.x));break;case"right":r=Math.max(...n.map(u=>u.x+u.width))-i.width;break;case"top":s=Math.min(...n.map(u=>u.y));break;case"bottom":s=Math.max(...n.map(u=>u.y+u.height))-i.height;break;case"h_center":r=n.reduce((u,h)=>u+h.x+h.width/2,0)/n.length-i.width/2;break;case"v_center":s=n.reduce((u,h)=>u+h.y+h.height/2,0)/n.length-i.height/2;break}return{element_id:e[l].id,new_position:{x:r,y:s}}})},Wl=e=>{const{batchUpdatePositions:t,state:n}=Oe(),[i,l]=W(!1),r=()=>e.selectedElementIds().length>=2,s=()=>{const g=e.selectedElementIds();return n.elements.filter(u=>g.includes(u.id))},o=async g=>{const u=s();if(u.length<2){console.warn("å¯¹é½åŠŸèƒ½éœ€è¦è‡³å°‘2ä¸ªå…ƒç´ ");return}try{l(!0),console.log(`ğŸ¯ æ‰§è¡Œ${g}å¯¹é½:`,u.length,"ä¸ªå…ƒç´ ");const h=Vl(u,g);await t(h),console.log("âœ… å¯¹é½æ“ä½œå®Œæˆ"),e.onAlignmentComplete&&e.onAlignmentComplete(h)}catch(h){console.error("âŒ å¯¹é½æ“ä½œå¤±è´¥:",h)}finally{l(!1)}},c=()=>s().length<2?null:{recommended:"left",reason:"å»ºè®®å·¦å¯¹é½",results:[]},a=()=>c();return(()=>{var g=jl(),u=g.firstChild,h=u.firstChild,v=h.nextSibling,f=v.firstChild,m=f.nextSibling,C=m.nextSibling,_=u.nextSibling,k=_.firstChild,P=k.nextSibling,L=P.firstChild,I=L.nextSibling,z=I.nextSibling,N=_.nextSibling,U=N.firstChild,K=U.nextSibling,R=K.firstChild,F=R.nextSibling;return f.$$click=()=>o("left"),m.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"h_center")}),m.$$click=()=>o("h_center"),C.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"right")}),C.$$click=()=>o("right"),L.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"top")}),L.$$click=()=>o("top"),I.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"v_center")}),I.$$click=()=>o("v_center"),z.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"bottom")}),z.$$click=()=>o("bottom"),R.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"distribute_h")}),R.$$click=()=>o("distribute_h"),F.addEventListener("mouseenter",()=>{var E;return(E=e.onAlignmentPreview)==null?void 0:E.call(e,"distribute_v")}),F.$$click=()=>o("distribute_v"),d(g,y(J,{get when(){return te(()=>!!r())()&&a()},get children(){var E=Nl(),q=E.firstChild,H=q.nextSibling,b=H.firstChild,D=b.nextSibling,B=H.nextSibling;return H.$$click=()=>o(a().recommended),d(D,()=>a().recommended==="left"&&"å·¦å¯¹é½",null),d(D,()=>a().recommended==="right"&&"å³å¯¹é½",null),d(D,()=>a().recommended==="top"&&"é¡¶å¯¹é½",null),d(D,()=>a().recommended==="bottom"&&"åº•å¯¹é½",null),d(D,()=>a().recommended==="h_center"&&"æ°´å¹³å±…ä¸­",null),d(D,()=>a().recommended==="v_center"&&"å‚ç›´å±…ä¸­",null),d(B,()=>a().reason),M(T=>{var V=i(),Z=a().reason;return V!==T.e&&(H.disabled=T.e=V),Z!==T.t&&S(H,"title",T.t=Z),T},{e:void 0,t:void 0}),E}}),null),d(g,y(J,{get when(){return!r()},get children(){var E=Bl(),q=E.firstChild;return q.firstChild,d(q,()=>e.selectedElementIds().length<3&&"ï¼Œè‡³å°‘3ä¸ªå…ƒç´ ä»¥ä½¿ç”¨åˆ†å¸ƒåŠŸèƒ½",null),E}}),null),d(g,y(J,{get when(){return i()},get children(){return Hl()}}),null),M(E=>{var q=!r()||i(),H=!r()||i(),b=!r()||i(),D=!r()||i(),B=!r()||i(),T=!r()||i(),V=e.selectedElementIds().length<3||i(),Z=e.selectedElementIds().length<3||i();return q!==E.e&&(f.disabled=E.e=q),H!==E.t&&(m.disabled=E.t=H),b!==E.a&&(C.disabled=E.a=b),D!==E.o&&(L.disabled=E.o=D),B!==E.i&&(I.disabled=E.i=B),T!==E.n&&(z.disabled=E.n=T),V!==E.s&&(R.disabled=E.s=V),Z!==E.h&&(F.disabled=E.h=Z),E},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),g})()},Kl=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=Kl,document.head.appendChild(e)}$e(["click"]);var ql=w("<div>"),Xl=w('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> Ã— <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">å…ƒç´ : <!> | é€‰ä¸­: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),Gl=w("<span class=ml-2>Zoom: <!>%");const Yl=()=>{const{state:e,selectElement:t,clearSelection:n,createElement:i,selectMultiple:l,updateElement:r,batchUpdatePositions:s}=Oe();let o;const[c,a]=W([]),g=ie(()=>e.elements.filter(P=>P.visible)),u=(P,L)=>{if(!o)return{x:0,y:0};const I=o.getBoundingClientRect(),z=(P-I.left)/e.canvas_config.zoom,N=(L-I.top)/e.canvas_config.zoom;return{x:z,y:N}},h=async P=>{console.log("ğŸ¯ é€‰æ‹©å…ƒç´ ",P),a([...P]);try{P.length===0?await n():P.length===1?await t(P[0]):await l([...P])}catch(L){console.error("âŒ é€‰æ‹©å…ƒç´ å¤±è´¥:",L)}},v=async P=>{try{await s(P)}catch(L){console.error("âŒ æ‰¹é‡æ›´æ–°ä½ç½®å¤±è´¥:",L)}},f=async(P,L)=>{try{await r(P,{position:{x:L.x,y:L.y}})}catch(I){console.error("âŒ ç§»åŠ¨å…ƒç´ å¤±è´¥:",I)}},m=async(P,L,I)=>{try{await r(P,{size:L,position:I})}catch(z){console.error("âŒ è°ƒæ•´å¤§å°å¤±è´¥:",z)}},C=async P=>{console.log("ğŸ–±ï¸ ç”»å¸ƒç‚¹å‡»",P)},_=async P=>{var L;P.preventDefault();try{const I=(L=P.dataTransfer)==null?void 0:L.getData("application/json");if(!I)return;const{type:z,component:N}=JSON.parse(I);if(z==="component"){const{x:U,y:K}=u(P.clientX,P.clientY),R=Math.max(0,U-N.default_size.width/2),F=Math.max(0,K-N.default_size.height/2);console.log("ğŸ¯ é€šè¿‡æ‹–æ”¾åˆ›å»ºç»„ä»¶:",N.name,"at",R,F);const E=await i(N.id,{x:R,y:F},N.default_size,N.create_content());console.log("âœ… é€šè¿‡æ‹–æ”¾åˆ›å»ºå…ƒç´ æˆåŠŸ:",E),a([E]),await t(E)}}catch(I){console.error("æ‹–æ”¾å¤„ç†å¤±è´¥:",I)}};Ie(()=>{a([...e.selected_ids])}),ie(()=>{a([...e.selected_ids])});const k=ie(()=>{const{width:P,height:L}=e.canvas_config;return`0 0 ${P} ${L}`});return(()=>{var P=Xl(),L=P.firstChild,I=L.firstChild,z=I.firstChild,N=z.nextSibling,U=N.nextSibling,K=U.nextSibling,R=K.nextSibling,F=R.nextSibling,E=F.firstChild,q=E.nextSibling;q.nextSibling;var H=L.nextSibling,b=H.firstChild,D=b.firstChild,B=D.firstChild,T=B.firstChild,V=T.nextSibling,Z=V.nextSibling,ue=Z.nextSibling;d(I,()=>e.canvas_config.width,N),d(I,()=>e.canvas_config.height,K),d(I,(()=>{var j=te(()=>e.canvas_config.zoom!==1);return()=>j()&&(()=>{var ce=Gl(),xe=ce.firstChild,pe=xe.nextSibling;return pe.nextSibling,d(ce,()=>Math.round(e.canvas_config.zoom*100),pe),ce})()})(),F),d(F,()=>e.elements.length,q),d(F,()=>c().length,null),D.style.setProperty("position","relative"),B.addEventListener("drop",_),B.addEventListener("dragover",j=>{j.preventDefault(),j.dataTransfer.dropEffect="copy"}),B.$$contextmenu=j=>j.preventDefault();var de=o;return typeof de=="function"?Jt(de,B):o=B,d(B,y(gl,{get config(){return e.canvas_config}}),V),d(Z,y(ye,{get each(){return g()},children:j=>y(Pl,{element:j,get selected(){return c().includes(j.id)}})})),d(ue,y(ye,{get each(){return g().filter(j=>c().includes(j.id))},children:j=>y(Tl,{element:j})})),d(D,y(Fl,{canvasRef:o,getAllElements:()=>[...e.elements],onElementsSelect:h,onElementMove:f,onBatchUpdatePositions:v,onElementResize:m,onCanvasClick:C,get enableDebugMode(){return!1}}),null),d(D,y(J,{get when(){return c().length>=2},get children(){var j=ql();return j.style.setProperty("position","fixed"),j.style.setProperty("top","80px"),j.style.setProperty("right","20px"),j.style.setProperty("z-index","1000"),j.style.setProperty("background","white"),j.style.setProperty("border-radius","8px"),j.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),j.style.setProperty("border","1px solid #e5e7eb"),d(j,y(Wl,{selectedElementIds:c,onAlignmentComplete:ce=>{console.log("âœ… å¯¹é½æ“ä½œå®Œæˆ:",ce)},onAlignmentPreview:ce=>{console.log("ğŸ‘ï¸ å¯¹é½é¢„è§ˆ:",ce)},onPreviewCancel:()=>{console.log("âŒ å–æ¶ˆå¯¹é½é¢„è§ˆ")}})),j}}),null),M(j=>{var ce=e.canvas_config.width*e.canvas_config.zoom,xe=e.canvas_config.height*e.canvas_config.zoom,pe=k(),le=e.canvas_config.width,re=e.canvas_config.height,he=e.canvas_config.background_color,be=e.canvas_config.width,fe=e.canvas_config.height;return ce!==j.e&&S(B,"width",j.e=ce),xe!==j.t&&S(B,"height",j.t=xe),pe!==j.a&&S(B,"viewBox",j.a=pe),le!==j.o&&S(T,"width",j.o=le),re!==j.i&&S(T,"height",j.i=re),he!==j.n&&S(T,"fill",j.n=he),be!==j.s&&S(V,"width",j.s=be),fe!==j.h&&S(V,"height",j.h=fe),j},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),P})()};$e(["contextmenu"]);var Jl=w("<div class=data-sources-panel><div class=panel-header><h2>æ•°æ®æºç®¡ç†</h2><button class=close-btn>Ã—</button></div><div class=panel-content>"),hn=w("<div class=error-message>"),Zl=w("<div class=loading-message>åŠ è½½ä¸­..."),Ql=w("<div class=empty-state><p>å°šæœªé…ç½®ä»»ä½•æ•°æ®æº</p><button>æ·»åŠ ç¬¬ä¸€ä¸ªæ•°æ®æº"),er=w("<div class=sources-grid>"),tr=w("<div class=data-sources-list><div class=list-header><div class=list-title><h3>å·²é…ç½®çš„æ•°æ®æº (<!>)</h3><button class=refresh-btn>ğŸ”„ åˆ·æ–°</button></div><button class=add-btn>+ æ·»åŠ æ•°æ®æº"),nr=w('<div class=source-card><div class=source-header><div class=source-info><h4></h4><span class=source-type></span></div><div class=source-status></div></div><div class=source-meta><div class=meta-item><span>åˆ›å»ºæ—¶é—´:</span><span></span></div><div class=meta-item><span>æœ€åæ›´æ–°:</span><span></span></div></div><div class=source-actions><button class="action-btn preview-btn">ğŸ‘ï¸ é¢„è§ˆ</button><button class="action-btn test-btn">ğŸ”Œ æµ‹è¯•</button><button class="action-btn edit-btn">âœï¸ ç¼–è¾‘</button><button class="action-btn delete-btn">ğŸ—‘ï¸ åˆ é™¤'),ir=w('<div class=form-group><label>é…ç½®</label><textarea rows=10 placeholder="é…ç½®å‚æ•° (JSONæ ¼å¼)">'),lr=w("<div class=add-data-source-form><div class=form-header><button class=back-btn>â† è¿”å›</button><h3>æ·»åŠ æ•°æ®æº</h3></div><form><div class=form-group><label>æ•°æ®æºåç§°</label><input type=text placeholder=è¾“å…¥æ•°æ®æºåç§° required></div><div class=form-group><label>æ•°æ®æºç±»å‹</label><select required><option value>é€‰æ‹©æ•°æ®æºç±»å‹</option></select></div><div class=form-actions><button type=button>å–æ¶ˆ</button><button type=submit>"),rr=w("<option> - "),sr=w("<div class=edit-data-source-form><div class=form-header><button class=back-btn>â† è¿”å›</button><h3>ç¼–è¾‘æ•°æ®æº: </h3></div><p>ç¼–è¾‘åŠŸèƒ½å¾…å®ç°"),or=w("<div class=data-preview><div class=preview-header><button class=back-btn>â† è¿”å›</button><h3>æ•°æ®é¢„è§ˆ: </h3><div class=preview-info>å…± <!> è¡Œæ•°æ®ï¼Œæ˜¾ç¤ºå‰ <!> è¡Œ</div></div><div class=preview-table><table><thead><tr></tr></thead><tbody>"),ar=w("<th>"),cr=w("<tr>"),dr=w("<td>");function ur(e){const[t,n]=W([]),[i,l]=W([]),[r,s]=W("list"),[o,c]=W(null),[a,g]=W(null),[u,h]=W(!1),[v,f]=W(null);Ie(async()=>{try{await m(),await C()}catch(z){console.error("ğŸš¨ DataSourcesPanelåˆå§‹åŒ–å¤±è´¥:",z),f(`æ•°æ®æºæ¨¡å—åˆå§‹åŒ–å¤±è´¥: ${z}`)}});const m=async()=>{try{h(!0),console.log("ğŸ”„ å¼€å§‹åŠ è½½æ•°æ®æºåˆ—è¡¨...");const z=await Se.listDataSources();console.log("âœ… æ•°æ®æºåˆ—è¡¨åŠ è½½æˆåŠŸ:",z),n(z),f(null)}catch(z){console.error("âŒ åŠ è½½æ•°æ®æºå¤±è´¥:",z),f(`åŠ è½½æ•°æ®æºå¤±è´¥: ${z}`)}finally{h(!1)}},C=async()=>{try{console.log("ğŸ”„ å¼€å§‹åŠ è½½å¯ç”¨æ•°æ®æºç±»å‹...");const z=await Se.getAvailableTypes();console.log("âœ… æ•°æ®æºç±»å‹åŠ è½½æˆåŠŸ:",z),l(z)}catch(z){console.error("âŒ åŠ è½½æ•°æ®æºç±»å‹å¤±è´¥:",z)}},_=()=>{s("add"),c(null)},k=z=>{c(z),s("edit")},P=async z=>{try{h(!0),c(z);const N=await Se.getPreview(z.id);g(N),s("preview")}catch(N){f(`é¢„è§ˆæ•°æ®å¤±è´¥: ${N}`)}finally{h(!1)}},L=async z=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ•°æ®æºå—ï¼Ÿ"))try{await Se.deleteDataSource(z),await m()}catch(N){f(`åˆ é™¤æ•°æ®æºå¤±è´¥: ${N}`)}},I=async z=>{console.log("Testing connection for:",z)};return y(J,{get when(){return e.isOpen},get children(){var z=Jl(),N=z.firstChild,U=N.firstChild,K=U.nextSibling,R=N.nextSibling;return me(K,"click",e.onClose),d(R,y(J,{get when(){return r()==="list"},get children(){return y(hr,{get dataSources(){return t()},get loading(){return u()},get error(){return v()},onAdd:_,onEdit:k,onPreview:P,onDelete:L,onTestConnection:I,onRefresh:m})}}),null),d(R,y(J,{get when(){return r()==="add"},get children(){return y(gr,{get availableTypes(){return i()},onBack:()=>s("list"),onSuccess:m})}}),null),d(R,y(J,{get when(){return te(()=>r()==="edit")()&&o()},get children(){return y(fr,{get dataSource(){return o()},onBack:()=>s("list"),onSuccess:m})}}),null),d(R,y(J,{get when(){return te(()=>!!(r()==="preview"&&o()))()&&a()},get children(){return y(vr,{get dataSource(){return o()},get data(){return a()},onBack:()=>s("list")})}}),null),z}})}function hr(e){const t=i=>{switch(i){case"active":return"#22c55e";case"error":return"#ef4444";case"disabled":return"#6b7280";default:return"#6b7280"}},n=i=>new Date(i).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(()=>{var i=tr(),l=i.firstChild,r=l.firstChild,s=r.firstChild,o=s.firstChild,c=o.nextSibling;c.nextSibling;var a=s.nextSibling,g=r.nextSibling;return d(s,()=>e.dataSources.length,c),me(a,"click",e.onRefresh),me(g,"click",e.onAdd),d(i,y(J,{get when(){return e.error},get children(){var u=hn();return d(u,()=>e.error),u}}),null),d(i,y(J,{get when(){return e.loading},get children(){return Zl()}}),null),d(i,y(J,{get when(){return!e.loading&&e.dataSources.length===0},get children(){var u=Ql(),h=u.firstChild,v=h.nextSibling;return me(v,"click",e.onAdd),u}}),null),d(i,y(J,{get when(){return!e.loading&&e.dataSources.length>0},get children(){var u=er();return d(u,y(ye,{get each(){return e.dataSources},children:h=>(()=>{var v=nr(),f=v.firstChild,m=f.firstChild,C=m.firstChild,_=C.nextSibling,k=m.nextSibling,P=f.nextSibling,L=P.firstChild,I=L.firstChild,z=I.nextSibling,N=L.nextSibling,U=N.firstChild,K=U.nextSibling,R=P.nextSibling,F=R.firstChild,E=F.nextSibling,q=E.nextSibling,H=q.nextSibling;return d(C,()=>h.name),d(_,()=>h.provider_type),d(z,()=>n(h.created_at)),d(K,()=>n(h.last_updated)),F.$$click=()=>e.onPreview(h),E.$$click=()=>e.onTestConnection(h.id),q.$$click=()=>e.onEdit(h),H.$$click=()=>e.onDelete(h.id),M(b=>{var D=t(h.status),B=`çŠ¶æ€: ${h.status}`,T=h.status!=="active";return D!==b.e&&((b.e=D)!=null?k.style.setProperty("background-color",D):k.style.removeProperty("background-color")),B!==b.t&&S(k,"title",b.t=B),T!==b.a&&(F.disabled=b.a=T),b},{e:void 0,t:void 0,a:void 0}),v})()})),u}}),null),M(()=>a.disabled=e.loading),i})()}function gr(e){const[t,n]=W(""),[i,l]=W(""),[r,s]=W({}),[o,c]=W(!1),[a,g]=W(null),u=async v=>{n(v);try{const f=await Se.getDefaultConfig(v);s(f)}catch(f){console.error("è·å–é»˜è®¤é…ç½®å¤±è´¥:",f)}},h=async v=>{if(v.preventDefault(),!t()||!i().trim()){g("è¯·å¡«å†™æ•°æ®æºåç§°å¹¶é€‰æ‹©ç±»å‹");return}const f=r();if(f.source_type==="file"){if(!f.file_path||f.file_path.trim()===""){g("é€‰æ‹©æ–‡ä»¶ç±»å‹æ—¶ï¼Œè¯·æŒ‡å®šæ–‡ä»¶è·¯å¾„");return}}else if(f.source_type==="content"&&(!f.json_content||f.json_content.trim()==="")){g("é€‰æ‹©å†…å®¹ç±»å‹æ—¶ï¼Œè¯·è¾“å…¥JSONå†…å®¹");return}try{c(!0);const m=await Se.createDataSource(i(),t(),r());console.log("âœ… æ•°æ®æºåˆ›å»ºæˆåŠŸï¼ŒID:",m);try{await Ke.setActiveDataSource(m),console.log("âœ… æ•°æ®æºè‡ªåŠ¨æ¿€æ´»æˆåŠŸ:",m)}catch(C){console.warn("âš ï¸ æ•°æ®æºæ¿€æ´»å¤±è´¥ï¼Œä½†åˆ›å»ºæˆåŠŸ:",C)}e.onSuccess(),e.onBack()}catch(m){g(`åˆ›å»ºæ•°æ®æºå¤±è´¥: ${m}`)}finally{c(!1)}};return(()=>{var v=lr(),f=v.firstChild,m=f.firstChild,C=f.nextSibling,_=C.firstChild,k=_.firstChild,P=k.nextSibling,L=_.nextSibling,I=L.firstChild,z=I.nextSibling;z.firstChild;var N=L.nextSibling,U=N.firstChild,K=U.nextSibling;return me(m,"click",e.onBack),C.addEventListener("submit",h),P.$$input=R=>l(R.currentTarget.value),z.addEventListener("change",R=>u(R.currentTarget.value)),d(z,y(ye,{get each(){return e.availableTypes},children:R=>(()=>{var F=rr(),E=F.firstChild;return d(F,()=>R.display_name,E),d(F,()=>R.description,null),M(()=>F.value=R.type_name),F})()}),null),d(C,y(J,{get when(){return t()},get children(){var R=ir(),F=R.firstChild,E=F.nextSibling;return E.$$input=q=>{try{s(JSON.parse(q.currentTarget.value)),g(null)}catch{g("é…ç½®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼")}},M(()=>E.value=JSON.stringify(r(),null,2)),R}}),N),d(C,y(J,{get when(){return a()},get children(){var R=hn();return d(R,a),R}}),N),me(U,"click",e.onBack),d(K,()=>o()?"åˆ›å»ºä¸­...":"åˆ›å»ºæ•°æ®æº"),M(()=>K.disabled=o()),M(()=>P.value=i()),M(()=>z.value=t()),v})()}function fr(e){return(()=>{var t=sr(),n=t.firstChild,i=n.firstChild,l=i.nextSibling;return l.firstChild,me(i,"click",e.onBack),d(l,()=>e.dataSource.name,null),t})()}function vr(e){return(()=>{var t=or(),n=t.firstChild,i=n.firstChild,l=i.nextSibling;l.firstChild;var r=l.nextSibling,s=r.firstChild,o=s.nextSibling,c=o.nextSibling,a=c.nextSibling;a.nextSibling;var g=n.nextSibling,u=g.firstChild,h=u.firstChild,v=h.firstChild,f=h.nextSibling;return me(i,"click",e.onBack),d(l,()=>e.dataSource.name,null),d(r,()=>e.data.total_rows,o),d(r,()=>e.data.rows.length,a),d(v,y(ye,{get each(){return e.data.columns},children:m=>(()=>{var C=ar();return d(C,m),C})()})),d(f,y(ye,{get each(){return e.data.rows.slice(0,50)},children:m=>(()=>{var C=cr();return d(C,y(ye,{get each(){return e.data.columns},children:_=>(()=>{var k=dr();return d(k,(()=>{var P=te(()=>typeof m[_]=="object");return()=>P()?JSON.stringify(m[_]):String(m[_]||"")})()),k})()})),C})()})),t})()}$e(["click","input"]);var yr=w("<div class=empty-context><div class=empty-icon>ğŸ“­</div><div class=empty-title>æš‚æ— æ•°æ®æº</div><div class=empty-description>è¯·åœ¨æ•°æ®æºé¢æ¿ä¸­åˆ›å»ºå¹¶é€‰æ‹©ä¸€ä¸ªæ•°æ®æº"),mr=w("<div class=loading-overlay><div class=loading-spinner>â³</div><div class=loading-text>åŠ è½½ä¸­..."),pr=w("<div class=data-context-panel><div class=panel-header><h3 class=panel-title>ğŸ“‹ æ•°æ®ä¸Šä¸‹æ–‡</h3><div class=status-indicator><span class=status-icon></span><span class=status-text>"),br=w("<div class=current-record>"),xr=w("<div class=empty-record>æš‚æ— è®°å½•æ•°æ®"),wr=w("<div class=available-fields>"),_r=w("<div class=no-fields>æš‚æ— å¯ç”¨å­—æ®µ"),$r=w('<div class=context-content><div class=section><div class=section-header><h4 class=section-title>ğŸ—„ï¸ æ•°æ®æºä¿¡æ¯</h4></div><div class=data-source-info><div class=info-item><span class=info-label>åç§°:</span><span class=info-value></span></div><div class=info-item><span class=info-label>ç±»å‹:</span><span class=info-value></span></div><div class=info-item><span class=info-label>ID:</span><span class="info-value info-id"></span></div></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ”¢ è®°å½•å¯¼èˆª</h4></div><div class=navigation-controls><button class=nav-button title=ä¸Šä¸€æ¡è®°å½•>â¬…ï¸</button><span class=record-info> / </span><button class=nav-button title=ä¸‹ä¸€æ¡è®°å½•>â¡ï¸</button></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ“‹ å½“å‰è®°å½•</h4></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ” å¯ç”¨å­—æ®µ</h4><div class=field-count>(<!> ä¸ªå­—æ®µ)'),Sr=w("<div class=record-field><div class=field-key>:</div><div class=field-value>"),Cr=w("<div class=field-display-name>"),kr=w("<div class=field-sample>ç¤ºä¾‹: "),Er=w("<div class=field-item><div class=field-header><span class=field-name></span><span class=field-type>(<!>)</span></div><div class=field-expression>è¡¨è¾¾å¼: <code>"),Ar=w("<details class=error-details><summary>è¯¦ç»†ä¿¡æ¯</summary><pre class=error-details-content>"),Pr=w('<div class="section error-section"><div class=section-header><h4 class="section-title error-title">âŒ é”™è¯¯ä¿¡æ¯</h4></div><div class=error-content><div class=error-type>é”™è¯¯ç±»å‹: </div><div class=error-message>é”™è¯¯æè¿°: ');const Dr=()=>{const[e,t]=W(null),[n,i]=W(!1);kt(()=>{const a=Ke.subscribe(g=>{t(g)});return t(Ke.getCurrentContext()),a});const l=ie(()=>{const a=e();if(!a)return{text:"æœªé€‰æ‹©æ•°æ®æº",color:"#666",icon:"ğŸ“‚"};switch(a.dataSource.status){case"ready":return{text:`æ•°æ®å·²å°±ç»ª - ${a.dataSource.name}`,color:"#52c41a",icon:"âœ…"};case"loading":return{text:"æ­£åœ¨åŠ è½½æ•°æ®...",color:"#1890ff",icon:"â³"};case"error":return{text:"æ•°æ®åŠ è½½å¤±è´¥",color:"#ff4d4f",icon:"âŒ"};case"empty":return{text:"æ•°æ®æºä¸ºç©º",color:"#faad14",icon:"ğŸ“­"};default:return{text:"æœªçŸ¥çŠ¶æ€",color:"#666",icon:"â“"}}}),r=async()=>{i(!0);try{await Ke.navigateNext()}catch(a){console.error("å¯¼èˆªåˆ°ä¸‹ä¸€è®°å½•å¤±è´¥:",a)}finally{i(!1)}},s=async()=>{i(!0);try{await Ke.navigatePrevious()}catch(a){console.error("å¯¼èˆªåˆ°ä¸Šä¸€è®°å½•å¤±è´¥:",a)}finally{i(!1)}},o=a=>a==null?"(ç©º)":typeof a=="string"?`"${a}"`:typeof a=="object"?JSON.stringify(a,null,2):String(a),c=a=>({string:"æ–‡æœ¬",number:"æ•°å­—",boolean:"å¸ƒå°”",date:"æ—¥æœŸ",object:"å¯¹è±¡",array:"æ•°ç»„"})[a]||a;return(()=>{var a=pr(),g=a.firstChild,u=g.firstChild,h=u.nextSibling,v=h.firstChild,f=v.nextSibling;return d(v,()=>l().icon),d(f,()=>l().text),d(a,y(J,{get when(){return e()},children:m=>(()=>{var C=$r(),_=C.firstChild,k=_.firstChild,P=k.nextSibling,L=P.firstChild,I=L.firstChild,z=I.nextSibling,N=L.nextSibling,U=N.firstChild,K=U.nextSibling,R=N.nextSibling,F=R.firstChild,E=F.nextSibling,q=_.nextSibling,H=q.firstChild,b=H.nextSibling,D=b.firstChild,B=D.nextSibling,T=B.firstChild,V=B.nextSibling,Z=q.nextSibling;Z.firstChild;var ue=Z.nextSibling,de=ue.firstChild,j=de.firstChild,ce=j.nextSibling,xe=ce.firstChild,pe=xe.nextSibling;return pe.nextSibling,d(z,()=>m().dataSource.name),d(K,()=>m().dataSource.type.toUpperCase()),d(E,()=>m().dataSource.id),D.$$click=s,d(B,()=>m().currentRecord.index+1,T),d(B,()=>m().currentRecord.total,null),V.$$click=r,d(Z,y(J,{get when(){return Object.keys(m().currentRecord.data).length>0},get children(){var le=br();return d(le,y(ye,{get each(){return Object.entries(m().currentRecord.data)},children:([re,he])=>(()=>{var be=Sr(),fe=be.firstChild,ke=fe.firstChild,Te=fe.nextSibling;return d(fe,re,ke),d(Te,()=>o(he)),be})()})),le}}),null),d(Z,y(J,{get when(){return Object.keys(m().currentRecord.data).length===0},get children(){return xr()}}),null),d(ce,()=>m().fields.length,pe),d(ue,y(J,{get when(){return m().fields.length>0},get children(){var le=wr();return d(le,y(ye,{get each(){return m().fields},children:re=>(()=>{var he=Er(),be=he.firstChild,fe=be.firstChild,ke=fe.nextSibling,Te=ke.firstChild,Fe=Te.nextSibling;Fe.nextSibling;var Ne=be.nextSibling,yt=Ne.firstChild,mt=yt.nextSibling;return d(fe,()=>re.name),d(ke,()=>c(re.type),Fe),d(he,y(J,{get when(){return re.displayName&&re.displayName!==re.name},get children(){var Le=Cr();return d(Le,()=>re.displayName),Le}}),Ne),d(he,y(J,{get when(){return re.sample!==void 0},get children(){var Le=kr();return Le.firstChild,d(Le,()=>o(re.sample),null),Le}}),Ne),d(mt,()=>`{${re.name}}`),he})()})),le}}),null),d(ue,y(J,{get when(){return m().fields.length===0},get children(){return _r()}}),null),d(C,y(J,{get when(){return m().error},children:le=>(()=>{var re=Pr(),he=re.firstChild,be=he.nextSibling,fe=be.firstChild;fe.firstChild;var ke=fe.nextSibling;return ke.firstChild,d(fe,()=>le().type,null),d(ke,()=>le().message,null),d(be,y(J,{get when(){return le().details},get children(){var Te=Ar(),Fe=Te.firstChild,Ne=Fe.nextSibling;return d(Ne,()=>JSON.stringify(le().details,null,2)),Te}}),null),re})()}),null),M(le=>{var re=n()||m().currentRecord.index<=0,he=n()||m().currentRecord.index>=m().currentRecord.total-1;return re!==le.e&&(D.disabled=le.e=re),he!==le.t&&(V.disabled=le.t=he),le},{e:void 0,t:void 0}),C})()}),null),d(a,y(J,{get when(){return!e()},get children(){return yr()}}),null),d(a,y(J,{get when(){return n()},get children(){return mr()}}),null),M(m=>(m=l().color)!=null?f.style.setProperty("color",m):f.style.removeProperty("color")),a})()};$e(["click"]);var zr=w('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col"><div class="flex-1 min-h-0"></div><div class="flex-1 min-h-0 border-t border-default">');const Tr=()=>{const[e,t]=W(!1),n=()=>t(!0),i=()=>t(!1);return y(Mn,{get children(){var l=zr(),r=l.firstChild,s=r.firstChild,o=s.nextSibling,c=o.nextSibling,a=c.firstChild,g=a.nextSibling;return d(l,y(qn,{onOpenDataSources:n}),r),d(s,y(Yn,{})),d(o,y(Yl,{})),d(a,y(ll,{})),d(g,y(Dr,{})),d(l,y(ur,{get isOpen(){return e()},onClose:i}),null),l}})},Lr={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},Mr=()=>{const{state:e,copySelectedElements:t,pasteElements:n,deleteElements:i,undo:l,redo:r,selectAllElements:s,clearSelection:o,moveElements:c}=Oe(),a=(f,m)=>{const C=f.key.toLowerCase()===m.key.toLowerCase()||f.key===m.key,_=!!m.ctrl===(f.ctrlKey||f.metaKey),k=!!m.alt===f.altKey,P=!!m.shift===f.shiftKey;return C&&_&&k&&P},g=async f=>{console.log("ğŸ¯ æ‰§è¡Œå¿«æ·é”®:",f);try{switch(f){case"copy":e.selected_ids.length>0&&(await t(),h("å¤åˆ¶æˆåŠŸ","âœ…"));break;case"paste":const m={x:20,y:20},C=await n(m.x,m.y);C.length>0&&h(`ç²˜è´´ ${C.length} ä¸ªå…ƒç´ `,"ğŸ“‹");break;case"cut":e.selected_ids.length>0&&(await t(),await i([...e.selected_ids]),h("å‰ªåˆ‡æˆåŠŸ","âœ‚ï¸"));break;case"delete":if(e.selected_ids.length>0){const _=e.selected_ids.length;await i([...e.selected_ids]),h(`åˆ é™¤ ${_} ä¸ªå…ƒç´ `,"ğŸ—‘ï¸")}break;case"undo":await l(),h("æ’¤é”€","â†¶");break;case"redo":await r(),h("é‡åš","â†·");break;case"selectAll":await s(),h(`å…¨é€‰ ${e.elements.length} ä¸ªå…ƒç´ `,"ğŸ¯");break;case"clearSelection":e.selected_ids.length>0&&(o(),h("æ¸…é™¤é€‰æ‹©","â­•"));break;case"duplicate":if(e.selected_ids.length>0){await t();const _=await n(20,20);h(`å¤åˆ¶ ${_.length} ä¸ªå…ƒç´ `,"ğŸ“„")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await u(f);break;default:console.warn("æœªçŸ¥çš„å¿«æ·é”®åŠ¨ä½œ:",f)}}catch(m){console.error("å¿«æ·é”®æ‰§è¡Œå¤±è´¥:",m),h("æ“ä½œå¤±è´¥","âŒ")}},u=async f=>{if(e.selected_ids.length===0)return;const m=f.includes("Fast"),C=m?10:1;let _=0,k=0;switch(f){case"moveUp":case"moveFastUp":k=-C;break;case"moveDown":case"moveFastDown":k=C;break;case"moveLeft":case"moveFastLeft":_=-C;break;case"moveRight":case"moveFastRight":_=C;break}(_!==0||k!==0)&&(await c([...e.selected_ids],_,k),m&&h(`å¿«é€Ÿç§»åŠ¨ ${C}px`,"ğŸ”„"))},h=(f,m)=>{const C=document.createElement("div");C.className="keyboard-feedback",C.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${m}</span>
        <span class="feedback-text">${f}</span>
      </div>
    `,document.body.appendChild(C),setTimeout(()=>{C.parentNode&&C.parentNode.removeChild(C)},2e3)},v=f=>{const m=f.target;if(!(m.tagName==="INPUT"||m.tagName==="TEXTAREA"||m.contentEditable==="true")){for(const[_,k]of Object.entries(Lr))if(a(f,k.combination)){f.preventDefault(),f.stopPropagation(),console.log("ğŸ¹ å¿«æ·é”®è§¦å‘:",_,k.action),g(k.action);return}}};return Ie(()=>{if(document.addEventListener("keydown",v,!0),console.log("ğŸ¹ é”®ç›˜å¿«æ·é”®ç®¡ç†å™¨å·²å¯åŠ¨"),!document.getElementById("keyboard-feedback-styles")){const f=document.createElement("style");f.id="keyboard-feedback-styles",f.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(f)}}),vt(()=>{document.removeEventListener("keydown",v,!0),console.log("ğŸ¹ é”®ç›˜å¿«æ·é”®ç®¡ç†å™¨å·²åœæ­¢")}),null},Ur=()=>(Ie(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),y(Hn,{get children(){return[y(Mr,{}),y(Tr,{})]}})),Rr=document.getElementById("root");Pn(()=>y(Ur,{}),Rr);
