var ln=Object.defineProperty;var on=(e,t,i)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Me=(e,t,i)=>on(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const sn=!1,rn=(e,t)=>e===t,Te=Symbol("solid-proxy"),ut=Symbol("solid-track"),Ze={equals:rn};let At=Mt;const Ae=1,Je=2,zt={owned:null,cleanups:null,context:null,owner:null};var Q=null;let ct=null,an=null,le=null,ce=null,we=null,rt=0;function qe(e,t){const i=le,n=Q,o=e.length===0,l=t===void 0?n:t,s=o?zt:{owned:null,cleanups:null,context:l?l.context:null,owner:l},r=o?e:()=>e(()=>ge(()=>Ke(s)));Q=s,le=null;try{return Fe(r,!0)}finally{le=i,Q=n}}function J(e,t){t=t?Object.assign({},Ze,t):Ze;const i={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=o=>(typeof o=="function"&&(o=o(i.value)),Tt(i,o));return[Lt.bind(i),n]}function T(e,t,i){const n=vt(e,t,!1,Ae);We(n)}function cn(e,t,i){At=yn;const n=vt(e,t,!1,Ae);n.user=!0,we?we.push(n):We(n)}function ie(e,t,i){i=i?Object.assign({},Ze,i):Ze;const n=vt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=i.equals||void 0,We(n),Lt.bind(n)}function dn(e){return Fe(e,!1)}function ge(e){if(le===null)return e();const t=le;le=null;try{return e()}finally{le=t}}function Re(e){cn(()=>ge(e))}function at(e){return Q===null||(Q.cleanups===null?Q.cleanups=[e]:Q.cleanups.push(e)),e}function ht(){return le}function un(e,t){const i=Symbol("context");return{id:i,Provider:mn(i),defaultValue:e}}function hn(e){let t;return Q&&Q.context&&(t=Q.context[e.id])!==void 0?t:e.defaultValue}function Pt(e){const t=ie(e),i=ie(()=>gt(t()));return i.toArray=()=>{const n=i();return Array.isArray(n)?n:n!=null?[n]:[]},i}function Lt(){if(this.sources&&this.state)if(this.state===Ae)We(this);else{const e=ce;ce=null,Fe(()=>et(this),!1),ce=e}if(le){const e=this.observers?this.observers.length:0;le.sources?(le.sources.push(this),le.sourceSlots.push(e)):(le.sources=[this],le.sourceSlots=[e]),this.observers?(this.observers.push(le),this.observerSlots.push(le.sources.length-1)):(this.observers=[le],this.observerSlots=[le.sources.length-1])}return this.value}function Tt(e,t,i){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&Fe(()=>{for(let o=0;o<e.observers.length;o+=1){const l=e.observers[o],s=ct&&ct.running;s&&ct.disposed.has(l),(s?!l.tState:!l.state)&&(l.pure?ce.push(l):we.push(l),l.observers&&Dt(l)),s||(l.state=Ae)}if(ce.length>1e6)throw ce=[],new Error},!1)),t}function We(e){if(!e.fn)return;Ke(e);const t=rt;gn(e,e.value,t)}function gn(e,t,i){let n;const o=Q,l=le;le=Q=e;try{n=e.fn(t)}catch(s){return e.pure&&(e.state=Ae,e.owned&&e.owned.forEach(Ke),e.owned=null),e.updatedAt=i+1,Ut(s)}finally{le=l,Q=o}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?Tt(e,n):e.value=n,e.updatedAt=i)}function vt(e,t,i,n=Ae,o){const l={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Q,context:Q?Q.context:null,pure:i};return Q===null||Q!==zt&&(Q.owned?Q.owned.push(l):Q.owned=[l]),l}function Qe(e){if(e.state===0)return;if(e.state===Je)return et(e);if(e.suspense&&ge(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<rt);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===Ae)We(e);else if(e.state===Je){const n=ce;ce=null,Fe(()=>et(e,t[0]),!1),ce=n}}function Fe(e,t){if(ce)return e();let i=!1;t||(ce=[]),we?i=!0:we=[],rt++;try{const n=e();return fn(i),n}catch(n){i||(we=null),ce=null,Ut(n)}}function fn(e){if(ce&&(Mt(ce),ce=null),e)return;const t=we;we=null,t.length&&Fe(()=>At(t),!1)}function Mt(e){for(let t=0;t<e.length;t++)Qe(e[t])}function yn(e){let t,i=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[i++]=n:Qe(n)}for(t=0;t<i;t++)Qe(e[t])}function et(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const n=e.sources[i];if(n.sources){const o=n.state;o===Ae?n!==t&&(!n.updatedAt||n.updatedAt<rt)&&Qe(n):o===Je&&et(n,t)}}}function Dt(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=Je,i.pure?ce.push(i):we.push(i),i.observers&&Dt(i))}}function Ke(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),n=e.sourceSlots.pop(),o=i.observers;if(o&&o.length){const l=o.pop(),s=i.observerSlots.pop();n<o.length&&(l.sourceSlots[s]=n,o[n]=l,i.observerSlots[n]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ke(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ke(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function vn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ut(e,t=Q){throw vn(e)}function gt(e){if(typeof e=="function"&&!e.length)return gt(e());if(Array.isArray(e)){const t=[];for(let i=0;i<e.length;i++){const n=gt(e[i]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function mn(e,t){return function(n){let o;return T(()=>o=ge(()=>(Q.context={...Q.context,[e]:n.value},Pt(()=>n.children))),void 0),o}}const pn=Symbol("fallback");function pt(e){for(let t=0;t<e.length;t++)e[t]()}function bn(e,t,i={}){let n=[],o=[],l=[],s=0,r=t.length>1?[]:null;return at(()=>pt(l)),()=>{let c=e()||[],a=c.length,u,d;return c[ut],ge(()=>{let b,w,S,O,A,P,E,M,B;if(a===0)s!==0&&(pt(l),l=[],n=[],o=[],s=0,r&&(r=[])),i.fallback&&(n=[pn],o[0]=qe(R=>(l[0]=R,i.fallback())),s=1);else if(s===0){for(o=new Array(a),d=0;d<a;d++)n[d]=c[d],o[d]=qe(g);s=a}else{for(S=new Array(a),O=new Array(a),r&&(A=new Array(a)),P=0,E=Math.min(s,a);P<E&&n[P]===c[P];P++);for(E=s-1,M=a-1;E>=P&&M>=P&&n[E]===c[M];E--,M--)S[M]=o[E],O[M]=l[E],r&&(A[M]=r[E]);for(b=new Map,w=new Array(M+1),d=M;d>=P;d--)B=c[d],u=b.get(B),w[d]=u===void 0?-1:u,b.set(B,d);for(u=P;u<=E;u++)B=n[u],d=b.get(B),d!==void 0&&d!==-1?(S[d]=o[u],O[d]=l[u],r&&(A[d]=r[u]),d=w[d],b.set(B,d)):l[u]();for(d=P;d<a;d++)d in S?(o[d]=S[d],l[d]=O[d],r&&(r[d]=A[d],r[d](d))):o[d]=qe(g);o=o.slice(0,s=a),n=c.slice(0)}return o});function g(b){if(l[d]=b,r){const[w,S]=J(d);return r[d]=S,t(c[d],w)}return t(c[d])}}}function m(e,t){return ge(()=>e(t||{}))}const It=e=>`Stale read from <${e}>.`;function _e(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ie(bn(()=>e.each,e.children,t||void 0))}function se(e){const t=e.keyed,i=ie(()=>e.when,void 0,void 0),n=t?i:ie(i,void 0,{equals:(o,l)=>!o==!l});return ie(()=>{const o=n();if(o){const l=e.children;return typeof l=="function"&&l.length>0?ge(()=>l(t?o:()=>{if(!ge(n))throw It("Show");return i()})):l}return e.fallback},void 0,void 0)}function xn(e){const t=Pt(()=>e.children),i=ie(()=>{const n=t(),o=Array.isArray(n)?n:[n];let l=()=>{};for(let s=0;s<o.length;s++){const r=s,c=o[s],a=l,u=ie(()=>a()?void 0:c.when,void 0,void 0),d=c.keyed?u:ie(u,void 0,{equals:(g,b)=>!g==!b});l=()=>a()||(d()?[r,u,c]:void 0)}return l});return ie(()=>{const n=i()();if(!n)return e.fallback;const[o,l,s]=n,r=s.children;return typeof r=="function"&&r.length>0?ge(()=>r(s.keyed?l():()=>{var a;if(((a=ge(i)())==null?void 0:a[0])!==o)throw It("Match");return l()})):r},void 0,void 0)}function Ne(e){return e}const ne=e=>ie(()=>e());function wn(e,t,i){let n=i.length,o=t.length,l=n,s=0,r=0,c=t[o-1].nextSibling,a=null;for(;s<o||r<l;){if(t[s]===i[r]){s++,r++;continue}for(;t[o-1]===i[l-1];)o--,l--;if(o===s){const u=l<n?r?i[r-1].nextSibling:i[l-r]:c;for(;r<l;)e.insertBefore(i[r++],u)}else if(l===r)for(;s<o;)(!a||!a.has(t[s]))&&t[s].remove(),s++;else if(t[s]===i[l-1]&&i[r]===t[o-1]){const u=t[--o].nextSibling;e.insertBefore(i[r++],t[s++].nextSibling),e.insertBefore(i[--l],u),t[o]=i[l]}else{if(!a){a=new Map;let d=r;for(;d<l;)a.set(i[d],d++)}const u=a.get(t[s]);if(u!=null)if(r<u&&u<l){let d=s,g=1,b;for(;++d<o&&d<l&&!((b=a.get(t[d]))==null||b!==u+g);)g++;if(g>u-r){const w=t[s];for(;r<u;)e.insertBefore(i[r++],w)}else e.replaceChild(i[r++],t[s++])}else s++;else t[s++].remove()}}}const bt="_$DX_DELEGATE";function _n(e,t,i,n={}){let o;return qe(l=>{o=l,t===document?e():h(t,e(),t.firstChild?null:void 0,i)},n.owner),()=>{o(),t.textContent=""}}function k(e,t,i,n){let o;const l=()=>{const r=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return r.innerHTML=e,i?r.content.firstChild.firstChild:n?r.firstChild:r.content.firstChild},s=t?()=>ge(()=>document.importNode(o||(o=l()),!0)):()=>(o||(o=l())).cloneNode(!0);return s.cloneNode=s,s}function ye(e,t=window.document){const i=t[bt]||(t[bt]=new Set);for(let n=0,o=e.length;n<o;n++){const l=e[n];i.has(l)||(i.add(l),t.addEventListener(l,$n))}}function $(e,t,i){i==null?e.removeAttribute(t):e.setAttribute(t,i)}function Ee(e,t){t==null?e.removeAttribute("class"):e.className=t}function tt(e,t,i,n){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function Rt(e,t,i){if(!t)return i?$(e,"style"):t;const n=e.style;if(typeof t=="string")return n.cssText=t;typeof i=="string"&&(n.cssText=i=void 0),i||(i={}),t||(t={});let o,l;for(l in i)t[l]==null&&n.removeProperty(l),delete i[l];for(l in t)o=t[l],o!==i[l]&&(n.setProperty(l,o),i[l]=o);return i}function Ft(e,t,i){return ge(()=>e(t,i))}function h(e,t,i,n){if(i!==void 0&&!n&&(n=[]),typeof t!="function")return nt(e,t,n,i);T(o=>nt(e,t(),o,i),n)}function $n(e){let t=e.target;const i=`$$${e.type}`,n=e.target,o=e.currentTarget,l=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),s=()=>{const c=t[i];if(c&&!t.disabled){const a=t[`${i}Data`];if(a!==void 0?c.call(t,a,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},r=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();l(c[0]);for(let a=0;a<c.length-2&&(t=c[a],!!s());a++){if(t._$host){t=t._$host,r();break}if(t.parentNode===o)break}}else r();l(n)}function nt(e,t,i,n,o){for(;typeof i=="function";)i=i();if(t===i)return i;const l=typeof t,s=n!==void 0;if(e=s&&i[0]&&i[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===i))return i;if(s){let r=i[0];r&&r.nodeType===3?r.data!==t&&(r.data=t):r=document.createTextNode(t),i=De(e,i,n,r)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||l==="boolean")i=De(e,i,n);else{if(l==="function")return T(()=>{let r=t();for(;typeof r=="function";)r=r();i=nt(e,r,i,n)}),()=>i;if(Array.isArray(t)){const r=[],c=i&&Array.isArray(i);if(ft(r,t,i,o))return T(()=>i=nt(e,r,i,n,!0)),()=>i;if(r.length===0){if(i=De(e,i,n),s)return i}else c?i.length===0?xt(e,r,n):wn(e,i,r):(i&&De(e),xt(e,r));i=r}else if(t.nodeType){if(Array.isArray(i)){if(s)return i=De(e,i,n,t);De(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function ft(e,t,i,n){let o=!1;for(let l=0,s=t.length;l<s;l++){let r=t[l],c=i&&i[e.length],a;if(!(r==null||r===!0||r===!1))if((a=typeof r)=="object"&&r.nodeType)e.push(r);else if(Array.isArray(r))o=ft(e,r,c)||o;else if(a==="function")if(n){for(;typeof r=="function";)r=r();o=ft(e,Array.isArray(r)?r:[r],Array.isArray(c)?c:[c])||o}else e.push(r),o=!0;else{const u=String(r);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return o}function xt(e,t,i=null){for(let n=0,o=t.length;n<o;n++)e.insertBefore(t[n],i)}function De(e,t,i,n){if(i===void 0)return e.textContent="";const o=n||document.createTextNode("");if(t.length){let l=!1;for(let s=t.length-1;s>=0;s--){const r=t[s];if(o!==r){const c=r.parentNode===e;!l&&!s?c?e.replaceChild(o,r):e.insertBefore(o,i):c&&r.remove()}else l=!0}}else e.insertBefore(o,i);return[o]}const yt=Symbol("store-raw"),Ie=Symbol("store-node"),be=Symbol("store-has"),Ot=Symbol("store-self");function Bt(e){let t=e[Te];if(!t&&(Object.defineProperty(e,Te,{value:t=new Proxy(e,Cn)}),!Array.isArray(e))){const i=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let o=0,l=i.length;o<l;o++){const s=i[o];n[s].get&&Object.defineProperty(e,s,{enumerable:n[s].enumerable,get:n[s].get.bind(t)})}}return t}function it(e){let t;return e!=null&&typeof e=="object"&&(e[Te]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Xe(e,t=new Set){let i,n,o,l;if(i=e!=null&&e[yt])return i;if(!it(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,r=e.length;s<r;s++)o=e[s],(n=Xe(o,t))!==o&&(e[s]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let c=0,a=s.length;c<a;c++)l=s[c],!r[l].get&&(o=e[l],(n=Xe(o,t))!==o&&(e[l]=n))}return e}function lt(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function Ge(e,t,i){if(e[t])return e[t];const[n,o]=J(i,{equals:!1,internal:!0});return n.$=o,e[t]=n}function Sn(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return!i||i.get||!i.configurable||t===Te||t===Ie||(delete i.value,delete i.writable,i.get=()=>e[Te][t]),i}function Nt(e){ht()&&Ge(lt(e,Ie),Ot)()}function kn(e){return Nt(e),Reflect.ownKeys(e)}const Cn={get(e,t,i){if(t===yt)return e;if(t===Te)return i;if(t===ut)return Nt(e),i;const n=lt(e,Ie),o=n[t];let l=o?o():e[t];if(t===Ie||t===be||t==="__proto__")return l;if(!o){const s=Object.getOwnPropertyDescriptor(e,t);ht()&&(typeof l!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(l=Ge(n,t,l)())}return it(l)?Bt(l):l},has(e,t){return t===yt||t===Te||t===ut||t===Ie||t===be||t==="__proto__"?!0:(ht()&&Ge(lt(e,be),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:kn,getOwnPropertyDescriptor:Sn};function ot(e,t,i,n=!1){if(!n&&e[t]===i)return;const o=e[t],l=e.length;i===void 0?(delete e[t],e[be]&&e[be][t]&&o!==void 0&&e[be][t].$()):(e[t]=i,e[be]&&e[be][t]&&o===void 0&&e[be][t].$());let s=lt(e,Ie),r;if((r=Ge(s,t,o))&&r.$(()=>i),Array.isArray(e)&&e.length!==l){for(let c=e.length;c<l;c++)(r=s[c])&&r.$();(r=Ge(s,"length",l))&&r.$(e.length)}(r=s[Ot])&&r.$()}function Ht(e,t){const i=Object.keys(t);for(let n=0;n<i.length;n+=1){const o=i[n];ot(e,o,t[o])}}function En(e,t){if(typeof t=="function"&&(t=t(e)),t=Xe(t),Array.isArray(t)){if(e===t)return;let i=0,n=t.length;for(;i<n;i++){const o=t[i];e[i]!==o&&ot(e,i,o)}ot(e,"length",n)}else Ht(e,t)}function je(e,t,i=[]){let n,o=e;if(t.length>1){n=t.shift();const s=typeof n,r=Array.isArray(e);if(Array.isArray(n)){for(let c=0;c<n.length;c++)je(e,[n[c]].concat(t),i);return}else if(r&&s==="function"){for(let c=0;c<e.length;c++)n(e[c],c)&&je(e,[c].concat(t),i);return}else if(r&&s==="object"){const{from:c=0,to:a=e.length-1,by:u=1}=n;for(let d=c;d<=a;d+=u)je(e,[d].concat(t),i);return}else if(t.length>1){je(e[n],t,[n].concat(i));return}o=e[n],i=[n].concat(i)}let l=t[0];typeof l=="function"&&(l=l(o,i),l===o)||n===void 0&&l==null||(l=Xe(l),n===void 0||it(o)&&it(l)&&!Array.isArray(l)?Ht(o,l):ot(e,n,l))}function An(...[e,t]){const i=Xe(e||{}),n=Array.isArray(i),o=Bt(i);function l(...s){dn(()=>{n&&s.length===1?En(i,s[0]):je(i,s)})}return[o,l]}function zn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function wt(e,t=!1){const i=zn(),n=`_${i}`;return Object.defineProperty(window,n,{value:o=>(t&&Reflect.deleteProperty(window,n),e==null?void 0:e(o)),writable:!1,configurable:!0}),i}async function oe(e,t={}){return new Promise((i,n)=>{const o=wt(s=>{i(s),Reflect.deleteProperty(window,`_${l}`)},!0),l=wt(s=>{n(s),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:e,callback:o,error:l,...t})})}const jt=un(),Pn=e=>{const[t,i]=An({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[n,o]=J(!1),[l,s]=J(null),[r,c]=J(!1),a=async()=>{try{o(!0),console.log("🔄 Loading app state...");const y=await oe("get_app_state");console.log("🔄 App state loaded, selected_ids:",y.selected_ids),i(y)}catch(y){console.error("Failed to load app state:",y)}finally{o(!1)}};Re(()=>{a()});const u=async(y,C,I,N={})=>{try{o(!0);const H=await oe("create_element",{request:{element_type:y,position:C,size:I,content_data:N}});return await a(),H}catch(H){throw console.error("Failed to create element:",H),H}finally{o(!1)}},d=async(y,C)=>{try{o(!0),await oe("update_element",{request:{id:y,updates:C}}),await a()}catch(I){throw console.error("Failed to update element:",I),I}finally{o(!1)}},g=async y=>{try{o(!0),await oe("batch_update_positions",{request:{updates:y}}),i(C=>{const I=C.elements.map(N=>{const H=y.find(V=>V.element_id===N.id);return H?{...N,position:H.new_position}:N});return{...C,elements:I,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(C){throw console.error("Failed to batch update positions:",C),await a(),C}finally{o(!1)}},b=async y=>{try{o(!0),await oe("delete_element",{elementId:y}),await a()}catch(C){throw console.error("Failed to delete element:",C),C}finally{o(!1)}},w=async y=>{try{console.log("Selecting element:",y),await oe("select_element",{elementId:y}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(C){throw console.error("Failed to select element:",C),C}},S=async y=>{try{console.log("Selecting multiple elements:",y),y.length>0?(await oe("select_multiple",{elementIds:y}),console.log("✅ Multi-select completed for:",y.length,"elements")):await oe("clear_selection"),await a()}catch(C){throw console.error("Failed to select multiple elements:",C),C}},O=async y=>{try{console.log("Adding to selection:",y),await oe("add_to_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to add to selection:",C),C}},A=async y=>{try{console.log("Removing from selection:",y),await oe("remove_from_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to remove from selection:",C),C}},P=async y=>{try{console.log("Toggling selection:",y),await oe("toggle_selection",{elementId:y}),await a()}catch(C){throw console.error("Failed to toggle selection:",C),C}},E=async()=>{try{await oe("clear_selection"),await a()}catch(y){throw console.error("Failed to clear selection:",y),y}},M=async()=>{try{await oe("copy_selected")}catch(y){throw console.error("Failed to copy selected elements:",y),y}},D={state:t,createElement:u,updateElement:d,batchUpdatePositions:g,deleteElement:b,selectElement:w,selectMultiple:S,addToSelection:O,removeFromSelection:A,toggleSelection:P,clearSelection:E,copySelected:M,copySelectedElements:async()=>M(),pasteElements:async(y,C)=>{try{o(!0);const I=await oe("paste_elements",{offsetX:y,offsetY:C});return await a(),I}catch(I){throw console.error("Failed to paste elements:",I),I}finally{o(!1)}},deleteElements:async y=>{try{o(!0);for(const C of y)await oe("delete_element",{elementId:C});await a()}catch(C){throw console.error("Failed to delete elements:",C),C}finally{o(!1)}},selectAllElements:async()=>{try{const y=t.elements.map(C=>C.id);await S(y)}catch(y){throw console.error("Failed to select all elements:",y),y}},moveElements:async(y,C,I)=>{try{o(!0);const N=t.elements.filter(H=>y.includes(H.id)).map(H=>({element_id:H.id,new_position:{x:H.position.x+C,y:H.position.y+I}}));N.length>0&&await g(N)}catch(N){throw console.error("Failed to move elements:",N),N}finally{o(!1)}},undo:async()=>{try{o(!0),await oe("undo"),await a()}catch(y){throw console.error("Failed to undo:",y),y}finally{o(!1)}},redo:async()=>{try{o(!0),await oe("redo"),await a()}catch(y){throw console.error("Failed to redo:",y),y}finally{o(!1)}},updateCanvasConfig:async y=>{try{o(!0),await oe("update_canvas_config",{request:y}),await a()}catch(C){throw console.error("Failed to update canvas config:",C),C}finally{o(!1)}},getElementsAtPoint:async(y,C)=>{try{return await oe("get_elements_at_point",{x:y,y:C})}catch(I){return console.error("Failed to get elements at point:",I),[]}},isLoading:n,setLoading:o,dragOperation:l,setDragOperation:s,resizeOperation:r,setResizeOperation:c};return m(jt.Provider,{value:D,get children(){return e.children}})},Se=()=>{const e=hn(jt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var Ln=k("<span class=text-warning>●"),Tn=k("<span class=ml-2> 个元素"),Mn=k('<span class="ml-2 text-primary">已选择 <!> 个'),Dn=k('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const Un=()=>{const{state:e,undo:t,redo:i,updateCanvasConfig:n}=Se(),[o,l]=J(e.canvas_config.zoom*100),s=async g=>{const b=g/100;l(g);try{await n({zoom:b})}catch(w){console.error("Failed to update zoom:",w)}},r=()=>{const g=Math.min(o()+25,500);s(g)},c=()=>{const g=Math.max(o()-25,25);s(g)},a=async()=>{try{await n({show_grid:!e.canvas_config.show_grid})}catch(g){console.error("Failed to toggle grid:",g)}},u=async()=>{try{await n({show_rulers:!e.canvas_config.show_rulers})}catch(g){console.error("Failed to toggle rulers:",g)}},d=async()=>{try{await oe("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(g){console.error("Failed to toggle DevTools:",g)}};return(()=>{var g=Dn(),b=g.firstChild,w=b.nextSibling,S=w.firstChild,O=S.nextSibling,A=O.nextSibling,P=A.nextSibling,E=P.nextSibling,M=E.nextSibling,B=M.nextSibling,R=B.nextSibling,K=R.nextSibling,L=K.nextSibling,Z=L.nextSibling,F=w.nextSibling,U=F.firstChild;return tt(S,"click",t),tt(O,"click",i),P.$$click=c,E.addEventListener("change",p=>{const X=p.target.value;if(X==="fit")console.log("Fit to window");else{const D=parseInt(X.replace("%",""));s(D)}}),M.$$click=r,R.$$click=a,K.$$click=u,Z.$$click=d,h(F,m(se,{get when(){return e.dirty},get children(){return Ln()}}),U),h(U,()=>e.template_name||"未命名模板"),h(F,m(se,{get when(){return e.elements.length>0},get children(){var p=Tn(),X=p.firstChild;return h(p,()=>e.elements.length,X),p}}),null),h(F,m(se,{get when(){return e.selected_ids.length>0},get children(){var p=Mn(),X=p.firstChild,D=X.nextSibling;return D.nextSibling,h(p,()=>e.selected_ids.length,D),p}}),null),T(p=>{var X=`toolbar-btn-icon ${e.can_undo?"":"opacity-50 cursor-not-allowed"}`,D=!e.can_undo,y=`撤销${e.undo_description?` (${e.undo_description})`:""} (Ctrl+Z)`,C=`toolbar-btn-icon ${e.can_redo?"":"opacity-50 cursor-not-allowed"}`,I=!e.can_redo,N=`重做${e.redo_description?` (${e.redo_description})`:""} (Ctrl+Y)`,H=`toolbar-btn-icon ${e.canvas_config.show_grid?"active":""}`,V=`toolbar-btn-icon ${e.canvas_config.show_rulers?"active":""}`;return X!==p.e&&Ee(S,p.e=X),D!==p.t&&(S.disabled=p.t=D),y!==p.a&&$(S,"title",p.a=y),C!==p.o&&Ee(O,p.o=C),I!==p.i&&(O.disabled=p.i=I),N!==p.n&&$(O,"title",p.n=N),H!==p.s&&Ee(R,p.s=H),V!==p.h&&Ee(K,p.h=V),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),T(()=>E.value=`${Math.round(o())}%`),g})()};ye(["click"]);var In=k('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),Rn=k('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const Fn=()=>{const{createElement:e}=Se(),[t,i]=J(""),n=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"图片"})}],o=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],l=[...n,...o],s=()=>{const a=t().toLowerCase();return a?l.filter(u=>u.name.toLowerCase().includes(a)||u.description.toLowerCase().includes(a)):l},r=(a,u)=>{if(console.log("Starting drag for component:",a.id),u.dataTransfer){u.dataTransfer.effectAllowed="copy",u.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const d=document.createElement("div");d.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,d.style.position="absolute",d.style.top="-1000px",document.body.appendChild(d),u.dataTransfer.setDragImage(d,50,20),setTimeout(()=>{document.body.removeChild(d)},0)}},c=async a=>{try{const u=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",u)}catch(u){console.error("Failed to create element:",u)}};return(()=>{var a=In(),u=a.firstChild,d=u.firstChild,g=d.nextSibling,b=u.nextSibling,w=b.firstChild,S=w.firstChild,O=S.firstChild,A=O.nextSibling,P=S.nextSibling,E=P.firstChild,M=E.nextSibling,B=P.nextSibling,R=B.firstChild,K=R.nextSibling;return g.$$input=L=>i(L.target.value),h(A,m(_e,{get each(){return s().filter(L=>L.category==="basic")},children:L=>m(dt,{component:L,onDrag:Z=>r(L,Z),onClick:()=>c(L)})})),h(M,m(_e,{get each(){return s().filter(L=>L.category==="data")},children:L=>m(dt,{component:L,onDrag:Z=>r(L,Z),onClick:()=>c(L)})})),h(K,m(_e,{get each(){return s().filter(L=>L.category==="bank")},children:L=>m(dt,{component:L,onDrag:Z=>r(L,Z),onClick:()=>c(L)})})),T(()=>g.value=t()),a})()},dt=e=>(()=>{var t=Rn(),i=t.firstChild,n=i.firstChild,o=n.nextSibling;return tt(t,"click",e.onClick),t.addEventListener("dragstart",l=>e.onDrag(l)),$(t,"draggable",!0),h(n,()=>e.component.icon),h(o,()=>e.component.name),T(()=>$(t,"title",e.component.description)),t})();ye(["input","click"]);const On="modulepreload",Bn=function(e){return"/"+e},_t={},Nn=function(t,i,n){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(i.map(c=>{if(c=Bn(c),c in _t)return;_t[c]=!0;const a=c.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":On,a||(d.as="script"),d.crossOrigin="",d.href=c,r&&d.setAttribute("nonce",r),document.head.appendChild(d),a)return new Promise((g,b)=>{d.addEventListener("load",g),d.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&l(r.reason);return t().catch(l)})};class Hn{constructor(){Me(this,"styles",new Map);Me(this,"elementStyleMap",new Map);Me(this,"observers",new Set);Me(this,"initialized",!1);console.log("🎨 TextStyleManager 初始化中...")}async initialize(){if(!this.initialized)try{await this.loadSystemStyles(),await this.loadUserStyles(),this.initialized=!0,console.log(`✅ TextStyleManager 初始化完成，加载了 ${this.styles.size} 个样式`)}catch(t){throw console.error("❌ TextStyleManager 初始化失败:",t),t}}createStyle(t){const i=`style_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={...t,id:i,metadata:{createdAt:new Date,lastModified:new Date,author:"user",usageCount:0,isSystemStyle:!1,tags:[]}};return this.styles.set(i,n),this.notifyObservers("style-created",i),this.saveUserStyles(),console.log(`🎨 创建新样式: ${n.name} (${i})`),i}getStyle(t){return this.styles.get(t)||null}updateStyle(t,i){const n=this.styles.get(t);if(!n)return console.warn(`⚠️ 样式 ${t} 不存在`),!1;if(n.metadata.isSystemStyle)return console.warn(`⚠️ 无法修改系统预设样式 ${t}`),!1;const o={...n,style:{...n.style,...i},metadata:{...n.metadata,lastModified:new Date}};return this.styles.set(t,o),this.syncAllStyleInstances(t),this.saveUserStyles(),this.notifyObservers("style-updated",t),console.log(`🔄 样式已更新: ${n.name} (${t})`),!0}deleteStyle(t){const i=this.styles.get(t);if(!i)return!1;if(i.metadata.isSystemStyle)return console.warn(`⚠️ 无法删除系统预设样式 ${t}`),!1;const n=Array.from(this.elementStyleMap.entries()).filter(([o,l])=>l===t).map(([o,l])=>o);return n.length>0?(console.warn(`⚠️ 无法删除样式 ${t}，仍有 ${n.length} 个元素在使用`),!1):(this.styles.delete(t),this.saveUserStyles(),this.notifyObservers("style-deleted",t),console.log(`🗑️ 样式已删除: ${i.name} (${t})`),!0)}applyStyleToElement(t,i){const n=this.styles.get(i);if(!n)return{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:`样式 ${i} 不存在`};try{const o=this.elementStyleMap.get(t);if(this.elementStyleMap.set(t,i),n.metadata.usageCount++,o&&o!==i){const l=this.styles.get(o);l&&(l.metadata.usageCount=Math.max(0,l.metadata.usageCount-1))}return this.applyStyleToDOM(t,n.style),this.notifyObservers("style-applied",{elementId:t,styleId:i}),console.log(`🎯 应用样式: ${n.name} → 元素 ${t}`),{success:!0,elementId:t,styleId:i,appliedAt:new Date}}catch(o){return console.error(`❌ 应用样式失败: ${o}`),{success:!1,elementId:t,styleId:i,appliedAt:new Date,error:o instanceof Error?o.message:String(o)}}}getElementStyleId(t){return this.elementStyleMap.get(t)||null}removeElementStyle(t){const i=this.elementStyleMap.get(t);if(i){this.elementStyleMap.delete(t);const n=this.styles.get(i);n&&(n.metadata.usageCount=Math.max(0,n.metadata.usageCount-1)),console.log(`🔗 移除元素样式映射: 元素 ${t}`)}}getStylesByCategory(t){const i=Array.from(this.styles.values());return(t?i.filter(o=>o.category===t):i).sort((o,l)=>o.metadata.isSystemStyle!==l.metadata.isSystemStyle?o.metadata.isSystemStyle?-1:1:l.metadata.usageCount-o.metadata.usageCount)}searchStyles(t,i){const n=this.getStylesByCategory(i),o=t.toLowerCase().trim();return o?n.filter(l=>l.name.toLowerCase().includes(o)||l.description.toLowerCase().includes(o)||l.metadata.tags.some(s=>s.toLowerCase().includes(o))):n}getStyleUsageStats(){const t=[];for(const[i,n]of this.styles){const o=Array.from(this.elementStyleMap.entries()).filter(([l,s])=>s===i).map(([l,s])=>l);t.push({styleId:i,usageCount:o.length,elements:o,lastUsed:n.metadata.lastModified})}return t.sort((i,n)=>n.usageCount-i.usageCount)}cleanupUnusedStyles(){const t=new Set(this.elementStyleMap.values()),i=[];for(const[n,o]of this.styles)!t.has(n)&&!o.metadata.isSystemStyle&&(this.styles.delete(n),i.push(n),console.log(`🧹 清理未使用样式: ${o.name} (${n})`));return i.length>0&&this.saveUserStyles(),i}exportStyles(t){const i=t?t.map(o=>this.styles.get(o)).filter(Boolean):Array.from(this.styles.values()),n=new Set(i.map(o=>o.category));return{version:"2.0.0",exportedAt:new Date,styles:i,metadata:{totalStyles:i.length,categories:Array.from(n),author:"user"}}}async importStyles(t){const i=[];for(const n of t.styles){if(Array.from(this.styles.values()).find(s=>s.name===n.name&&s.category===n.category)){console.warn(`⚠️ 跳过已存在的样式: ${n.name}`);continue}const l=this.createStyle({name:n.name,description:n.description,category:n.category,style:n.style,...n.inheritance&&{inheritance:n.inheritance}});i.push(l)}return console.log(`📦 导入完成，共导入 ${i.length} 个样式`),i}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}syncAllStyleInstances(t){const i=this.styles.get(t);if(!i)return;const n=[];for(const[o,l]of this.elementStyleMap)l===t&&(this.applyStyleToDOM(o,i.style),n.push(o));this.notifyObservers("styles-synced",{styleId:t,affectedElements:n}),console.log(`🔄 样式同步完成: ${t} → ${n.length} 个元素`)}applyStyleToDOM(t,i){console.log(`🎨 应用样式到DOM: 元素 ${t}`,{font_family:i.font_family,font_size:i.font_size,typography:i.typography})}async loadSystemStyles(){try{const{BANK_TEXT_STYLES:t}=await Nn(async()=>{const{BANK_TEXT_STYLES:i}=await import("./bank-text-styles-BtzE7aIi.js");return{BANK_TEXT_STYLES:i}},[]);for(const i of t)this.styles.set(i.id,i);console.log(`🏦 加载了 ${t.length} 个银行预设样式`)}catch(t){console.warn("⚠️ 加载系统样式失败:",t)}}async loadUserStyles(){try{const t=localStorage.getItem("jasper-text-styles");if(t){const i=JSON.parse(t);for(const n of i)n.metadata.createdAt=new Date(n.metadata.createdAt),n.metadata.lastModified=new Date(n.metadata.lastModified),this.styles.set(n.id,n);console.log(`👤 加载了 ${i.length} 个用户自定义样式`)}}catch(t){console.warn("⚠️ 加载用户样式失败:",t)}}saveUserStyles(){try{const t=Array.from(this.styles.values()).filter(i=>!i.metadata.isSystemStyle);localStorage.setItem("jasper-text-styles",JSON.stringify(t)),console.log(`💾 保存了 ${t.length} 个用户自定义样式`)}catch(t){console.error("❌ 保存用户样式失败:",t)}}notifyObservers(t,i){for(const n of this.observers)try{n.onStyleChange(t,i)}catch(o){console.error("❌ 观察者通知失败:",o)}}}const de=new Hn;class jn{calculateUnifiedBounds(t,i,n){const o=this.calculateFontMetrics(i),l=this.measureTextContent(t,i,n.width),s=this.calculateContainerHeight(l,o,n.height),r=this.calculateTextPositioning(i,n,s,o),c={containerBounds:{x:0,y:0,width:n.width,height:s},contentBounds:l.bounds,fontMetrics:o,positioning:r};return l.wrappedLines&&(c.textLayout={wrappedLines:l.wrappedLines,isWrapped:!0,originalLineCount:t.split(`
`).length,wrappedLineCount:l.wrappedLines.length}),c}calculateFontMetrics(t){const i=t.font_size,n=1.2,o=.75,l=.25,s=i*o,r=i*l;return{fontSize:i,lineHeight:i*n,ascender:s,descender:r,baseline:s}}getCharacterWidth(t,i){const n=i.font_size,o=i.font_family,l=/[\u4e00-\u9fa5]/.test(t),s={"Courier New":{chinese:.6,english:.6},Monaco:{chinese:.6,english:.6},Consolas:{chinese:.6,english:.6},SimSun:{chinese:1,english:.5},SimHei:{chinese:1,english:.5},KaiTi:{chinese:1.1,english:.6},FangSong:{chinese:1,english:.55},Arial:{chinese:1,english:.55},Helvetica:{chinese:1,english:.55},"Times New Roman":{chinese:1,english:.5},"Microsoft YaHei":{chinese:1,english:.52},"PingFang SC":{chinese:1,english:.52},"Noto Sans":{chinese:1,english:.53},default:{chinese:1,english:.55}},r=o.toLowerCase();let c=s.default;for(const[u,d]of Object.entries(s))if(r.includes(u.toLowerCase())||u.toLowerCase().includes(r)){c=d;break}const a=l?c.chinese:c.english;return n*a}calculateTextWidth(t,i){let n=0;for(const o of t)o!==`
`&&(n+=this.getCharacterWidth(o,i));return n}measureTextContent(t,i,n=0){const o=t.split(`
`),l=o.length;let s=0;for(const a of o){const u=this.calculateTextWidth(a,i);s=Math.max(s,u)}if(n>0&&s>n)return this.calculateWrappedText(t,i,n);const r=n>0?Math.min(s,n):s,c=l*i.font_size*1.2;return{bounds:{x:0,y:0,width:r,height:c},lineCount:l,actualHeight:c}}calculateWrappedText(t,i,n){const o=this.getCharacterWidth("测",i);if(Math.floor(n/o)<1||n<o)return{bounds:{x:0,y:0,width:n,height:i.font_size*1.2},lineCount:1,actualHeight:i.font_size*1.2,wrappedLines:["..."]};const s=this.smartSegmentation(t);let r=[],c="",a=0;for(const d of s){const g=this.calculateTextWidth(d,i),b=a+g;if(b>n)if(c.trim())r.push(c.trim()),c=d,a=g;else{const{truncated:w,remaining:S}=this.forceTruncateSegment(d,n,i);r.push(w),c=S,a=this.calculateTextWidth(S,i)}else c+=d,a=b}c.trim()&&r.push(c.trim());const u=r.length*i.font_size*1.2;return{bounds:{x:0,y:0,width:n,height:u},lineCount:r.length,actualHeight:u,wrappedLines:r}}forceTruncateSegment(t,i,n){let o="",l=0,s=0;for(s=0;s<t.length;s++){const c=t[s];if(!c)break;const a=this.getCharacterWidth(c,n);if(l+a>i)break;o+=c,l+=a}const r=t.substring(s);return{truncated:o,remaining:r}}smartSegmentation(t){const i=[];let n="";for(let o=0;o<t.length;o++){const l=t[o];l&&(/[\u4e00-\u9fa5]/.test(l)?(n&&(i.push(n),n=""),i.push(l)):l===`
`?(n&&(i.push(n),n=""),i.push(`
`)):l===" "?n?(i.push(n+" "),n=""):i.push(" "):n+=l)}return n&&i.push(n),i.filter(o=>o.length>0)}calculateContainerHeight(t,i,n){const o=i.lineHeight*t.lineCount,l=i.ascender+i.descender,s=i.lineHeight,r=Math.max(o,l,s);return Math.max(r,n)}calculateTextPositioning(t,i,n,o){var u;const l=this.calculateHorizontalAnchor(t.align,i.width),s=o.baseline,r=((u=t.background)==null?void 0:u.padding)||0,c=-r,a=-r;return{textAnchorX:l,textAnchorY:s,backgroundX:c,backgroundY:a}}calculateHorizontalAnchor(t,i){switch(t){case"Left":return 0;case"Center":return i/2;case"Right":return i;default:return 0}}getTextAnchor(t){switch(t){case"Left":return"start";case"Center":return"middle";case"Right":return"end";default:return"start"}}debugBounds(t,i){}}const Ue=new jn;class Kn{constructor(){Me(this,"initialized",!1);this.initialize()}async initialize(){if(!this.initialized)try{await de.initialize(),this.initialized=!0,console.log("🎨 ProfessionalTextRenderer 已初始化")}catch(t){console.error("❌ ProfessionalTextRenderer 初始化失败:",t)}}isElementUsingProfessionalStyle(t){return de.getElementStyleId(t)!==null}adaptLegacyTextStyle(t){return{...t,font_weight:t.font_weight,typography:{letterSpacing:0,lineHeight:1.2,paragraphSpacing:0,textIndent:0,decoration:{underline:!1,strikethrough:!1,overline:!1,decorationStyle:"solid"},textTransform:"none",whiteSpace:"normal"},fills:[{type:"solid",enabled:!0,opacity:1,solid:{color:t.color}}],effects:[]}}renderProfessionalText(t,i=!1){if(t.content.type!=="Text"&&t.content.type!=="DataField")return null;const n=de.getElementStyleId(t.id);let o;if(n){const r=de.getStyle(n);if(!r)return console.warn(`⚠️ 找不到样式定义: ${n}`),null;o=r.style,console.log(`🎨 使用专业样式渲染: ${r.name} (${n})`)}else{const r=t.content.type==="Text"||t.content.type==="DataField"?t.content.style:null;if(!r)return null;o=this.adaptLegacyTextStyle(r),console.log("🔄 适配传统样式到专业排版系统")}const l=this.calculateEnhancedBounds(t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",o,t.size);return{element:this.createProfessionalTextElement(l,t.content.type==="Text"?t.content.content:t.content.expression||"[数据字段]",o,!1),bounds:l,style:o}}calculateEnhancedBounds(t,i,n){const o=Ue.calculateUnifiedBounds(t,i,n),l=i.typography,s=this.calculateLetterSpacingEffect(t,l.letterSpacing),r=this.calculateLineHeightEffect(t,i.font_size,l.lineHeight),c=this.calculateParagraphSpacingEffect(t,l.paragraphSpacing);return{containerBounds:o.containerBounds,positioning:o.positioning,fontMetrics:o.fontMetrics,typography:{adjustedWidth:o.containerBounds.width+s.widthIncrease,adjustedHeight:o.containerBounds.height+r.heightIncrease+c.heightIncrease,letterSpacingData:s,lineHeightData:r,paragraphData:c}}}calculateLetterSpacingEffect(t,i){const n=t.split(`
`),o=n.reduce((s,r)=>s+r.length,0),l=Math.max(0,o-n.length);return{spacingValue:i,totalSpaces:l,widthIncrease:l*i,charPositions:[]}}calculateLineHeightEffect(t,i,n){const l=t.split(`
`).length,s=i*n,r=i*1.2,c=s-r;return{lineHeightRatio:n,actualLineHeight:s,lineCount:l,heightIncrease:c*Math.max(0,l-1),baselinePositions:[]}}calculateParagraphSpacingEffect(t,i){const o=t.split(`

`).length;return{spacing:i,paragraphCount:o,heightIncrease:i*Math.max(0,o-1),paragraphPositions:[]}}createProfessionalTextElement(t,i,n,o){const l=document.createElementNS("http://www.w3.org/2000/svg","g");return l.setAttribute("class","professional-text-container"),this.renderMultipleFills(l,t,n.fills),this.renderEffects(l,t,n.effects),this.renderTypographyText(l,t,i,n),this.renderTextDecorations(l,t,i,n.typography.decoration),l}renderMultipleFills(t,i,n){if(n&&n.length>0&&n[0].enabled){const o=n[0];o.type==="solid"&&o.solid&&console.log("🎨 应用纯色填充:",o.solid.color)}}renderEffects(t,i,n){if(!n||n.length===0)return;const o=document.createElementNS("http://www.w3.org/2000/svg","defs"),l=document.createElementNS("http://www.w3.org/2000/svg","filter"),s=`text-effects-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;l.id=s;for(const r of n)if(r.enabled&&r.type==="drop-shadow"&&r.dropShadow){const c=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");c.setAttribute("dx",r.dropShadow.offsetX.toString()),c.setAttribute("dy",r.dropShadow.offsetY.toString()),c.setAttribute("stdDeviation",r.dropShadow.blur.toString()),c.setAttribute("flood-color",r.dropShadow.color),c.setAttribute("flood-opacity",r.dropShadow.opacity.toString()),l.appendChild(c),console.log("✨ 应用投影效果")}l.children.length>0&&(o.appendChild(l),t.appendChild(o),t.setAttribute("filter",`url(#${s})`))}renderTypographyText(t,i,n,o){var c,a;const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("font-family",o.font_family),l.setAttribute("font-size",o.font_size.toString()),l.setAttribute("font-weight",o.font_weight),l.setAttribute("fill",((a=(c=o.fills[0])==null?void 0:c.solid)==null?void 0:a.color)||o.color),l.setAttribute("text-anchor",this.getTextAnchor(o.align));const s=n.split(`
`),r=o.typography;s.forEach((u,d)=>{const g=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.letterSpacing!==0&&g.setAttribute("letter-spacing",`${r.letterSpacing}px`);const b=i.positioning.textAnchorY+d*i.typography.lineHeightData.actualLineHeight;if(g.setAttribute("x",i.positioning.textAnchorX.toString()),g.setAttribute("y",b.toString()),d===0&&r.textIndent!==0){const w=i.positioning.textAnchorX+r.textIndent;g.setAttribute("x",w.toString())}r.textTransform&&r.textTransform!=="none"?g.textContent=this.applyTextTransform(u,r.textTransform):g.textContent=u,l.appendChild(g)}),t.appendChild(l)}renderTextDecorations(t,i,n,o){if(!o.underline&&!o.strikethrough&&!o.overline)return;const l=n.split(`
`),s=o.decorationColor||"#000000",r=o.decorationThickness||1,c=o.decorationStyle==="dashed"?"4,2":o.decorationStyle==="dotted"?"1,1":"none";l.forEach((a,u)=>{if(!a.trim())return;const d=i.positioning.textAnchorY+u*i.typography.lineHeightData.actualLineHeight,g=a.length*i.fontMetrics.fontSize*.6,b=i.positioning.textAnchorX,w=b+g;if(o.underline){const S=d+i.fontMetrics.fontSize*.1;this.createDecorationLine(t,b,S,w,S,s,r,c,"underline")}if(o.strikethrough){const S=d-i.fontMetrics.fontSize*.3;this.createDecorationLine(t,b,S,w,S,s,r,c,"strikethrough")}if(o.overline){const S=d-i.fontMetrics.fontSize*.8;this.createDecorationLine(t,b,S,w,S,s,r,c,"overline")}})}createDecorationLine(t,i,n,o,l,s,r,c,a){const u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",i.toString()),u.setAttribute("y1",n.toString()),u.setAttribute("x2",o.toString()),u.setAttribute("y2",l.toString()),u.setAttribute("stroke",s),u.setAttribute("stroke-width",r.toString()),u.setAttribute("stroke-dasharray",c),u.setAttribute("class",`text-decoration-${a}`),t.appendChild(u)}getTextAnchor(t){switch(t){case"Center":return"middle";case"Right":return"end";case"Left":default:return"start"}}applyTextTransform(t,i){switch(i){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();default:return t}}}const Xn=new Kn;var Gn=k("<button class=search-clear title=清除搜索>✕"),Wn=k('<div class=style-picker-container><div class=style-categories></div><div class=style-search><div class=search-input-container><span class=search-icon>🔍</span><input type=text placeholder=搜索样式... class=search-input></div></div><div class=style-grid><div class="style-card create-style-card"><div class=create-style-content><div class=create-style-icon>➕</div><div class=create-style-label>新建样式</div></div></div></div><div class=style-stats><span class=stats-text> 个样式'),Yn=k("<button><span class=category-icon></span><span class=category-label>"),Vn=k("<div><div class=style-preview></div><div class=style-info><div class=style-name></div><div class=style-meta><span class=style-category></span></div></div><div class=style-actions>"),qn=k("<span class=usage-count>"),Zn=k("<button class=edit-button title=编辑样式>✏️"),Jn=k("<span class=system-badge title=系统预设样式>🔒"),Qn=k("<div class=selection-indicator>✓");const ei=e=>{const[t,i]=J("bank-special"),[n,o]=J(""),[l,s]=J([]);(async()=>{await de.initialize();const g=de.getStylesByCategory();s(g)})();const c=ie(()=>{let g=l();t()&&(g=g.filter(w=>w.category===t()));const b=n().toLowerCase().trim();return b&&(g=g.filter(w=>w.name.toLowerCase().includes(b)||w.description.toLowerCase().includes(b)||w.metadata.tags.some(S=>S.toLowerCase().includes(b)))),g}),a=[{key:"bank-special",label:"银行专用",icon:"🏦"},{key:"heading",label:"标题",icon:"📰"},{key:"body",label:"正文",icon:"📝"},{key:"caption",label:"说明",icon:"💬"},{key:"custom",label:"自定义",icon:"⚙️"}],u=g=>{console.log("🎯 选择样式:",g),e.onStyleSelect(g)},d=g=>{i(g),console.log("📂 切换分类:",g)};return(()=>{var g=Wn(),b=g.firstChild,w=b.nextSibling,S=w.firstChild,O=S.firstChild,A=O.nextSibling,P=w.nextSibling,E=P.firstChild,M=P.nextSibling,B=M.firstChild,R=B.firstChild;return h(b,m(_e,{each:a,children:K=>(()=>{var L=Yn(),Z=L.firstChild,F=Z.nextSibling;return L.$$click=()=>d(K.key),h(Z,()=>K.icon),h(F,()=>K.label),T(U=>{var p=`category-button ${t()===K.key?"active":""}`,X=K.label;return p!==U.e&&Ee(L,U.e=p),X!==U.t&&$(L,"title",U.t=X),U},{e:void 0,t:void 0}),L})()})),A.$$input=K=>o(K.target.value),h(S,m(se,{get when(){return n()},get children(){var K=Gn();return K.$$click=()=>o(""),K}}),null),h(P,m(_e,{get each(){return c()},children:K=>m(ti,{style:K,get selected(){return e.selectedStyleId===K.id},onClick:()=>u(K.id),onEdit:()=>e.onStyleEdit(K.id)})}),E),tt(E,"click",e.onStyleCreate),h(B,()=>c().length,R),h(B,(()=>{var K=ne(()=>!!n());return()=>K()&&` (搜索: "${n()}")`})(),null),T(()=>A.value=n()),g})()},ti=e=>{const t=()=>{switch(e.style.category){case"bank-special":return e.style.id.includes("amount")?"¥123,456.78":e.style.id.includes("account")?"6222 0012 3456 7890":e.style.id.includes("institution")?e.style.name:e.style.id.includes("date")?"2025-08-19":e.style.name;case"heading":return e.style.name;case"body":return"正文示例文字 Abc";case"caption":return"说明文字";default:return e.style.name}},i=ie(()=>{var s,r,c,a,u,d,g,b;const l=e.style.style;return{fontFamily:l.font_family,fontSize:`${Math.min(l.font_size,14)}px`,fontWeight:l.font_weight,color:((c=(r=(s=l.fills)==null?void 0:s[0])==null?void 0:r.solid)==null?void 0:c.color)||l.color,textAlign:l.align.toLowerCase(),letterSpacing:`${((a=l.typography)==null?void 0:a.letterSpacing)||0}px`,textDecoration:(d=(u=l.typography)==null?void 0:u.decoration)!=null&&d.underline?"underline":(b=(g=l.typography)==null?void 0:g.decoration)!=null&&b.strikethrough?"line-through":"none"}}),n=l=>{l.preventDefault(),e.onClick()},o=l=>{l.preventDefault(),l.stopPropagation(),e.onEdit()};return(()=>{var l=Vn(),s=l.firstChild,r=s.nextSibling,c=r.firstChild,a=c.nextSibling,u=a.firstChild,d=r.nextSibling;return l.$$click=n,h(s,t),h(c,()=>e.style.name),h(u,()=>ni(e.style.category)),h(a,(()=>{var g=ne(()=>e.style.metadata.usageCount>0);return()=>g()&&(()=>{var b=qn();return h(b,()=>e.style.metadata.usageCount),T(()=>$(b,"title",`使用次数: ${e.style.metadata.usageCount}`)),b})()})(),null),h(d,(()=>{var g=ne(()=>!e.style.metadata.isSystemStyle);return()=>g()&&(()=>{var b=Zn();return b.$$click=o,b})()})(),null),h(d,(()=>{var g=ne(()=>!!e.style.metadata.isSystemStyle);return()=>g()&&Jn()})(),null),h(l,(()=>{var g=ne(()=>!!e.selected);return()=>g()&&Qn()})(),null),T(g=>{var b=`style-card ${e.selected?"selected":""} ${e.style.metadata.isSystemStyle?"system-style":"user-style"}`,w=i();return b!==g.e&&Ee(l,g.e=b),g.t=Rt(s,w,g.t),g},{e:void 0,t:void 0}),l})()};function ni(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}ye(["input","click"]);var ii=k("<button class=style-picker-toggle>"),li=k("<button class=style-reload-btn title=重新加载样式系统>🔄"),oi=k("<div class=initialization-fallback><div class=fallback-content><span class=fallback-icon>⏳</span><span class=fallback-text>专业样式系统加载中...</span><div class=fallback-actions><button class=retry-btn>重试加载"),si=k("<div class=quick-style-actions><button class=apply-style-btn><span class=btn-icon>🎨</span><span class=btn-text>选择样式</span></button><button class=create-style-btn title=基于当前设置创建新样式><span class=btn-icon>➕</span><span class=btn-text>新建"),ri=k("<div class=style-picker-panel>"),ai=k("<div class=property-group><div class=property-group-title><span>📐</span><span>排版控制</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=typography-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>⚙️</span><span class=placeholder-text>高级排版控制功能</span><span class=placeholder-subtitle>字间距、行高、装饰等"),ci=k("<div class=property-group><div class=property-group-title><span>✨</span><span>视觉效果</span><div class=coming-soon-badge>即将推出</div></div><div class=property-group-content><div class=effects-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>🌈</span><span class=placeholder-text>多重填充 & 阴影效果</span><span class=placeholder-subtitle>渐变、投影、发光等"),di=k('<div class="property-group debug-panel"><div class=property-group-title><span>🔧</span><span>调试信息</span></div><div class=property-group-content><div class=debug-info><div class=debug-item><span class=debug-label>元素ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>当前样式ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>可用样式:</span><span class=debug-value> 个</span></div><div class=debug-item><span class=debug-label>使用专业渲染:</span><span class=debug-value>'),ui=k("<div class=professional-text-properties><div class=property-group><div class=property-group-title><span>🎨</span><span>专业文字样式</span><div class=property-group-actions></div></div><div class=property-group-content>"),hi=k('<div class=current-style-info><div class=current-style-preview><div class=style-preview-badge><span class=style-name></span><span class=style-category></span></div><div class=style-actions><button class="style-action-btn edit-btn"title=编辑样式>✏️</button><button class="style-action-btn remove-btn"title=移除样式>🗑️');const $t=e=>{const[t,i]=J(null),[n,o]=J(!1),[l,s]=J([]),[r,c]=J(!1);Re(async()=>{try{await de.initialize();const A=de.getElementStyleId(e.element.id);i(A);const P=de.getStylesByCategory();s(P),c(!0),console.log("🎨 ProfessionalTextPropertiesPanel 初始化完成")}catch(A){console.error("❌ 专业文字属性面板初始化失败:",A)}});const a=ie(()=>{const A=t();return A?de.getStyle(A):null}),u=ie(()=>e.element.content.type==="Text"||e.element.content.type==="DataField"),d=async A=>{try{const P=await de.applyStyleToElement(e.element.id,A);if(P.success){i(A);const E=de.getStyle(A);if(E){const M=g(E.style);e.onUpdate(e.element.id,"content",{...e.element.content,style:M})}console.log("✅ 样式应用成功:",P)}else console.error("❌ 样式应用失败:",P.error)}catch(P){console.error("❌ 样式选择处理失败:",P)}},g=A=>{var P,E,M;return{font_family:A.font_family,font_size:A.font_size,font_weight:A.font_weight,color:((M=(E=(P=A.fills)==null?void 0:P[0])==null?void 0:E.solid)==null?void 0:M.color)||A.color,align:A.align}},b=()=>{console.log("🆕 创建新样式")},w=A=>{console.log("✏️ 编辑样式:",A)},S=()=>{o(!n())},O=()=>{t()&&(de.removeElementStyle(e.element.id),i(null),console.log("🗑️ 移除元素样式"))};return u()?(()=>{var A=ui(),P=A.firstChild,E=P.firstChild,M=E.firstChild,B=M.nextSibling,R=B.nextSibling,K=E.nextSibling;return h(R,m(se,{get when(){return r()},get children(){var L=ii();return L.$$click=S,h(L,()=>n()?"📝":"📚"),T(()=>$(L,"title",n()?"隐藏样式库":"显示样式库")),L}}),null),h(R,m(se,{get when(){return!r()},get children(){var L=li();return L.$$click=()=>window.location.reload(),L}}),null),h(K,m(se,{get when(){return!r()},get children(){var L=oi(),Z=L.firstChild,F=Z.firstChild,U=F.nextSibling,p=U.nextSibling,X=p.firstChild;return X.$$click=async()=>{try{await de.initialize();const D=de.getStylesByCategory();s(D),c(!0),console.log("🔄 样式系统重新初始化成功")}catch(D){console.error("❌ 重新初始化失败:",D)}},L}}),null),h(K,m(se,{get when(){return r()},get children(){return[m(se,{get when(){return a()},children:L=>(()=>{var Z=hi(),F=Z.firstChild,U=F.firstChild,p=U.firstChild,X=p.nextSibling,D=U.nextSibling,y=D.firstChild,C=y.nextSibling;return h(p,()=>L().name),h(X,()=>gi(L().category)),y.$$click=()=>w(L().id),C.$$click=O,Z})()}),m(se,{get when(){return!a()},get children(){var L=si(),Z=L.firstChild,F=Z.nextSibling;return Z.$$click=S,F.$$click=b,L}}),m(se,{get when(){return n()},get children(){var L=ri();return h(L,m(ei,{get selectedStyleId(){return t()},onStyleSelect:d,onStyleCreate:b,onStyleEdit:w})),L}})]}}),null),h(A,m(se,{get when(){return a()},get children(){return ai()}}),null),h(A,m(se,{get when(){return a()},get children(){return ci()}}),null),h(A,m(se,{get when(){return!1},get children(){var L=di(),Z=L.firstChild,F=Z.nextSibling,U=F.firstChild,p=U.firstChild,X=p.firstChild,D=X.nextSibling,y=p.nextSibling,C=y.firstChild,I=C.nextSibling,N=y.nextSibling,H=N.firstChild,V=H.nextSibling,ue=V.firstChild,re=N.nextSibling,j=re.firstChild,ae=j.nextSibling;return h(D,()=>e.element.id),h(I,()=>t()||"无"),h(V,()=>l().length,ue),h(ae,()=>Xn.isElementUsingProfessionalStyle(e.element.id)?"是":"否"),L}}),null),A})():null};function gi(e){return{"bank-special":"银行",heading:"标题",body:"正文",caption:"说明",custom:"自定义"}[e]||e}ye(["click"]);var fi=k('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),yi=k('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),vi=k("<span class=property-value>"),mi=k('<span class="property-value text-xs text-muted">'),st=k("<div class=space-y-2>"),He=k("<input type=number class=property-input>"),pi=k('<div class="grid grid-cols-2 gap-2">'),St=k("<input type=checkbox class=property-checkbox>"),bi=k('<div class="p-4 space-y-4">'),kt=k("<div>"),xi=k("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),wi=k("<div class=property-field><label class=property-label>"),_i=k("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),Kt=k('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Xt=k("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),$i=k('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Gt=k("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),Si=k('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),Wt=k('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),Yt=k('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),ki=k('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Ci=k("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),Ct=k("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Ei=k('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),Ai=k("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),zi=k("<input type=text class=property-input placeholder=图片描述文字>"),Pi=k("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),Li=k("<div class=space-y-3>"),Ti=k("<img class=property-image>"),Mi=k("<input type=text class=property-input placeholder=${fieldName}>"),Di=k("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),Ui=k("<div class=space-y-4>"),Ii=k('<div class=flex><input type=number class="property-input flex-1">'),Ri=k("<span class=property-unit>"),Fi=k('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),Oi=k("<div class=property-alignment-group>"),Bi=k("<button>");const Ni=()=>{const{state:e,updateElement:t}=Se(),i=ie(()=>{const l=new Set(e.selected_ids);return e.elements.filter(s=>l.has(s.id))}),n=ie(()=>i()[0]),o=async(l,s,r)=>{try{await t(l,{[s]:r})}catch(c){console.error("Failed to update element property:",c)}};return(()=>{var l=fi(),s=l.firstChild,r=s.nextSibling;return h(r,m(se,{get when(){return n()},get fallback(){return yi()},get children(){return m(Hi,{get element(){return n()},onUpdate:o})}})),l})()},Hi=e=>{const t=(n,o)=>{const l={...e.element.position,[n]:o};e.onUpdate(e.element.id,"position",l)},i=(n,o)=>{const l={...e.element.size,[n]:Math.max(1,o)};e.onUpdate(e.element.id,"size",l)};return(()=>{var n=bi();return h(n,m($e,{title:"元素信息",icon:"ℹ️",get children(){var o=st();return h(o,m(Y,{label:"类型",get children(){var l=vi();return h(l,()=>e.element.content.type),l}}),null),h(o,m(Y,{label:"ID",get children(){var l=mi();return h(l,()=>e.element.id),l}}),null),o}}),null),h(n,m($e,{title:"位置和大小",icon:"📐",get children(){var o=pi();return h(o,m(Y,{label:"X",get children(){var l=He();return l.$$input=s=>t("x",parseFloat(s.target.value)||0),T(()=>l.value=e.element.position.x),l}}),null),h(o,m(Y,{label:"Y",get children(){var l=He();return l.$$input=s=>t("y",parseFloat(s.target.value)||0),T(()=>l.value=e.element.position.y),l}}),null),h(o,m(Y,{label:"宽度",get children(){var l=He();return l.$$input=s=>i("width",parseFloat(s.target.value)||1),T(()=>l.value=e.element.size.width),l}}),null),h(o,m(Y,{label:"高度",get children(){var l=He();return l.$$input=s=>i("height",parseFloat(s.target.value)||1),T(()=>l.value=e.element.size.height),l}}),null),o}}),null),h(n,m($e,{title:"状态",icon:"👁️",get children(){var o=st();return h(o,m(Y,{label:"可见",get children(){var l=St();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"visible",s.target.checked)),T(()=>l.checked=e.element.visible),l}}),null),h(o,m(Y,{label:"锁定",get children(){var l=St();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"locked",s.target.checked)),T(()=>l.checked=e.element.locked),l}}),null),h(o,m(Y,{label:"层级",get children(){var l=He();return l.$$input=s=>e.onUpdate(e.element.id,"z_index",parseInt(s.target.value)||0),T(()=>l.value=e.element.z_index),l}}),null),o}}),null),h(n,m(xn,{get children(){return[m(Ne,{get when(){return e.element.content.type==="Text"&&e.element.content},children:o=>(()=>{var l=kt();return h(l,m($t,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,m(ji,{get content(){return o()},onUpdate:s=>{console.log("Text content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),l})()}),m(Ne,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:o=>m(Ki,{get content(){return o()},onUpdate:l=>{console.log("Rectangle content update:",l),e.onUpdate(e.element.id,"content",l)}})}),m(Ne,{get when(){return e.element.content.type==="Line"&&e.element.content},children:o=>m(Xi,{get content(){return o()},onUpdate:l=>{console.log("Line content update:",l),e.onUpdate(e.element.id,"content",l)}})}),m(Ne,{get when(){return e.element.content.type==="Image"&&e.element.content},children:o=>m(Gi,{get content(){return o()},onUpdate:l=>{console.log("Image content update:",l),e.onUpdate(e.element.id,"content",l)}})}),m(Ne,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:o=>(()=>{var l=kt();return h(l,m($t,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),h(l,m(Wi,{get content(){return o()},onUpdate:s=>{console.log("DataField content update:",s),e.onUpdate(e.element.id,"content",s)}}),null),l})()})]}}),null),n})()},$e=e=>(()=>{var t=xi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling,l=i.nextSibling;return h(n,()=>e.icon),h(o,()=>e.title),h(l,()=>e.children),t})(),Y=e=>(()=>{var t=wi(),i=t.firstChild;return h(i,()=>e.label),h(t,()=>e.children,null),t})(),ji=e=>m($e,{title:"文字样式",icon:"🔤",get children(){var t=Wt(),i=t.firstChild,n=i.nextSibling;return h(t,m(Y,{label:"内容",get children(){var o=_i();return o.$$input=l=>e.onUpdate({content:l.target.value}),T(()=>o.value=e.content.content),o}}),i),h(i,m(Y,{label:"字体",get children(){var o=Kt();return o.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_family:l.target.value}})),T(()=>o.value=e.content.style.font_family),o}}),null),h(i,m(Y,{label:"大小",get children(){return m(xe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:o=>e.onUpdate({style:{...e.content.style,font_size:o}})})}}),null),h(n,m(Y,{label:"字重",get children(){var o=Xt();return o.addEventListener("change",l=>e.onUpdate({style:{...e.content.style,font_weight:l.target.value}})),T(()=>o.value=e.content.style.font_weight),o}}),null),h(n,m(Y,{label:"对齐",get children(){return m(Vt,{get value(){return e.content.style.align},onUpdate:o=>e.onUpdate({style:{...e.content.style,align:o}})})}}),null),h(t,m(Y,{label:"颜色",get children(){return m(Le,{get value(){return e.content.style.color},onUpdate:o=>e.onUpdate({style:{...e.content.style,color:o}})})}}),null),h(t,m(Y,{label:"背景",get children(){var o=$i(),l=o.firstChild;return h(o,m(Le,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.color)||"transparent"},onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:s}}})}),l),h(l,m(Y,{label:"透明度",get children(){return m(xe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.opacity)||1},min:0,max:1,step:.1,onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:s}}})})}}),null),h(l,m(Y,{label:"内边距",get children(){return m(xe,{get value(){var s;return((s=e.content.style.background)==null?void 0:s.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:s}}})})}}),null),o}}),null),h(t,m(Y,{label:"边框",get children(){var o=Si(),l=o.firstChild;return h(o,m(Le,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.color)||"#000000"},onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:s}}})}),l),h(l,m(Y,{label:"宽度",get children(){return m(xe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:s}}})})}}),null),h(l,m(Y,{label:"样式",get children(){var s=Gt();return s.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:r.target.value}}})),T(()=>{var r;return s.value=((r=e.content.style.border)==null?void 0:r.style)||"Solid"}),s}}),null),h(l,m(Y,{label:"圆角",get children(){return m(xe,{get value(){var s;return((s=e.content.style.border)==null?void 0:s.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:s}}})})}}),null),o}}),null),t}}),Ki=e=>m($e,{title:"矩形样式",icon:"▭",get children(){var t=ki(),i=t.firstChild,n=i.firstChild;return h(t,m(Y,{label:"填充颜色",get children(){return m(Le,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:o=>e.onUpdate({fill_color:o})})}}),i),h(i,m(Y,{label:"边框",get children(){var o=st();return h(o,m(Le,{get value(){var l;return((l=e.content.border)==null?void 0:l.color)||"#000000"},onUpdate:l=>e.onUpdate({border:{...e.content.border,color:l}})})),o}}),n),h(n,m(Y,{label:"宽度",get children(){return m(xe,{get value(){var o;return((o=e.content.border)==null?void 0:o.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:o=>e.onUpdate({border:{...e.content.border,width:o}})})}}),null),h(n,m(Y,{label:"样式",get children(){var o=Gt();return o.addEventListener("change",l=>e.onUpdate({border:{...e.content.border,style:l.target.value}})),T(()=>{var l;return o.value=((l=e.content.border)==null?void 0:l.style)||"Solid"}),o}}),null),h(t,m(Y,{label:"圆角半径",get children(){return m(xe,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:o=>e.onUpdate({corner_radius:o})})}}),null),h(t,m(Y,{label:"透明度",get children(){var o=Yt(),l=o.firstChild,s=l.nextSibling,r=s.firstChild;return l.$$input=c=>e.onUpdate({opacity:parseFloat(c.target.value)/100}),h(s,()=>Math.round((e.content.opacity||1)*100),r),T(()=>l.value=(e.content.opacity||1)*100),o}}),null),t}}),Xi=e=>m($e,{title:"线条样式",icon:"━",get children(){var t=Ei(),i=t.firstChild;return h(t,m(Y,{label:"颜色",get children(){return m(Le,{get value(){return e.content.color},onUpdate:n=>e.onUpdate({color:n})})}}),i),h(t,m(Y,{label:"宽度",get children(){return m(xe,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:n=>e.onUpdate({width:n})})}}),i),h(t,m(Y,{label:"样式",get children(){var n=Ci();return n.addEventListener("change",o=>e.onUpdate({line_style:o.target.value})),T(()=>n.value=e.content.line_style||"Solid"),n}}),i),h(i,m(Y,{label:"起点",get children(){var n=Ct();return n.addEventListener("change",o=>e.onUpdate({start_cap:o.target.value})),T(()=>n.value=e.content.start_cap||"None"),n}}),null),h(i,m(Y,{label:"终点",get children(){var n=Ct();return n.addEventListener("change",o=>e.onUpdate({end_cap:o.target.value})),T(()=>n.value=e.content.end_cap||"None"),n}}),null),h(t,m(Y,{label:"透明度",get children(){var n=Yt(),o=n.firstChild,l=o.nextSibling,s=l.firstChild;return o.$$input=r=>e.onUpdate({opacity:parseFloat(r.target.value)/100}),h(l,()=>Math.round((e.content.opacity||1)*100),s),T(()=>o.value=(e.content.opacity||1)*100),n}}),null),t}}),Gi=e=>m($e,{title:"图片属性",icon:"🖼️",get children(){var t=Li();return h(t,m(Y,{label:"图片地址",get children(){var i=Ai();return i.$$input=n=>e.onUpdate({src:n.target.value}),T(()=>i.value=e.content.src),i}}),null),h(t,m(Y,{label:"替代文本",get children(){var i=zi();return i.$$input=n=>e.onUpdate({alt:n.target.value}),T(()=>i.value=e.content.alt||""),i}}),null),h(t,m(Y,{label:"预览",get children(){var i=Pi(),n=i.firstChild;return h(i,(()=>{var o=ne(()=>!!e.content.src);return()=>o()?(()=>{var l=Ti();return l.addEventListener("load",s=>{const r=s.target,c=r.nextElementSibling;r&&(r.style.display="block"),c&&(c.style.display="none")}),l.addEventListener("error",s=>{const r=s.target,c=r.nextElementSibling;r&&(r.style.display="none"),c&&(c.style.display="flex")}),T(s=>{var r=e.content.src,c=e.content.alt||"图片预览";return r!==s.e&&$(l,"src",s.e=r),c!==s.t&&$(l,"alt",s.t=c),s},{e:void 0,t:void 0}),l})():null})(),n),T(o=>(o=e.content.src?"none":"flex")!=null?n.style.setProperty("display",o):n.style.removeProperty("display")),i}}),null),t}}),Wi=e=>(()=>{var t=Ui();return h(t,m($e,{title:"数据字段",icon:"🔗",get children(){var i=st();return h(i,m(Y,{label:"表达式",get children(){var n=Mi();return n.$$input=o=>e.onUpdate({expression:o.target.value}),T(()=>n.value=e.content.expression),n}}),null),h(i,m(Y,{label:"格式",get children(){var n=Di();return n.addEventListener("change",o=>e.onUpdate({format:o.target.value==="default"?void 0:o.target.value})),T(()=>n.value=e.content.format||"default"),n}}),null),i}}),null),h(t,m($e,{title:"字段样式",icon:"🎨",get children(){var i=Wt(),n=i.firstChild,o=n.nextSibling;return h(n,m(Y,{label:"字体",get children(){var l=Kt();return l.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_family:s.target.value}})),T(()=>l.value=e.content.style.font_family),l}}),null),h(n,m(Y,{label:"大小",get children(){return m(xe,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),h(o,m(Y,{label:"字重",get children(){var l=Xt();return l.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_weight:s.target.value}})),T(()=>l.value=e.content.style.font_weight),l}}),null),h(o,m(Y,{label:"对齐",get children(){return m(Vt,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),h(i,m(Y,{label:"颜色",get children(){return m(Le,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),i}}),null),t})(),xe=e=>(()=>{var t=Ii(),i=t.firstChild;return i.addEventListener("blur",n=>{const o=parseFloat(n.target.value)||e.value,l=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));l!==o&&(n.target.value=l.toString(),e.onUpdate(l))}),i.$$input=n=>{const o=parseFloat(n.target.value);if(!isNaN(o)){const l=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));e.onUpdate(l)}},h(t,(()=>{var n=ne(()=>!!e.unit);return()=>n()&&(()=>{var o=Ri();return h(o,()=>e.unit),o})()})(),null),T(n=>{var o=e.min,l=e.max,s=e.step||1;return o!==n.e&&$(i,"min",n.e=o),l!==n.t&&$(i,"max",n.t=l),s!==n.a&&$(i,"step",n.a=s),n},{e:void 0,t:void 0,a:void 0}),T(()=>i.value=e.value),t})(),Le=e=>(()=>{var t=Fi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling,l=i.nextSibling;return n.$$input=s=>e.onUpdate(s.target.value),l.$$input=s=>{const r=s.target.value;(/^#[0-9A-Fa-f]{6}$/.test(r)||/^#[0-9A-Fa-f]{3}$/.test(r))&&e.onUpdate(r)},T(s=>(s=e.value)!=null?o.style.setProperty("background-color",s):o.style.removeProperty("background-color")),T(()=>n.value=e.value),T(()=>l.value=e.value),t})(),Vt=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var i=Oi();return h(i,()=>t.map(n=>(()=>{var o=Bi();return o.$$click=()=>e.onUpdate(n.value),h(o,()=>n.icon),T(l=>{var s=`property-alignment-btn ${e.value===n.value?"active":""}`,r=n.label;return s!==l.e&&Ee(o,l.e=s),r!==l.t&&$(o,"title",l.t=r),l},{e:void 0,t:void 0}),o})())),i})()};ye(["input","click"]);var Yi=k("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),Vi=k("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const qi=e=>m(se,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Yi(),i=t.firstChild,n=i.firstChild,o=n.nextSibling;return T(l=>{var s=e.config.grid_size,r=e.config.grid_size,c=e.config.grid_size,a=e.config.grid_size,u=e.config.grid_size,d=e.config.grid_size,g=e.config.grid_size,b=e.config.grid_size;return s!==l.e&&$(i,"width",l.e=s),r!==l.t&&$(i,"height",l.t=r),c!==l.a&&$(n,"x1",l.a=c),a!==l.o&&$(n,"x2",l.o=a),u!==l.i&&$(n,"y2",l.i=u),d!==l.n&&$(o,"y1",l.n=d),g!==l.s&&$(o,"x2",l.s=g),b!==l.h&&$(o,"y2",l.h=b),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=Vi();return T(i=>{var n=e.config.width,o=e.config.height;return n!==i.e&&$(t,"width",i.e=n),o!==i.t&&$(t,"height",i.t=o),i},{e:void 0,t:void 0}),t})()]}});var Zi=k("<svg><g class=text-element-unified-container data-bounds-version=unified-v2><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=text-content-unified></svg>",!1,!0,!1),Et=k("<svg><rect class=text-selection-unified></svg>",!1,!0,!1),Ji=k("<svg><rect class=text-background-unified></svg>",!1,!0,!1),Qi=k("<svg><rect fill=none class=text-border-unified></svg>",!1,!0,!1),el=k("<svg><tspan class=text-line-wrapped></svg>",!1,!0,!1),tl=k("<svg><tspan class=text-line-original></svg>",!1,!0,!1),nl=k("<svg><rect x=0 y=0></svg>",!1,!0,!1),il=k("<svg><line x1=0></svg>",!1,!0,!1),ll=k("<svg><g class=datafield-element-unified-container><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=datafield-content-unified></svg>",!1,!0,!1),ol=k("<svg><tspan class=datafield-line-wrapped></svg>",!1,!0,!1),sl=k("<svg><tspan dy=0></svg>",!1,!0,!1),rl=k("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),al=k("<svg><g></svg>",!1,!0,!1);const cl=e=>{const t=ie(()=>{const{position:n}=e.element;return{transform:`translate(${n.x}px, ${n.y}px)`,opacity:e.element.visible?1:.5}}),i=()=>{const{content:n,size:o}=e.element;if(n.type==="Text"&&n.content&&n.style){const l=Ue.calculateUnifiedBounds(n.content,n.style,o),s=Ue.getTextAnchor(n.style.align);return(()=>{var r=Zi(),c=r.firstChild;return h(r,(()=>{var a=ne(()=>!!e.selected);return()=>a()&&(()=>{var u=Et();return T(d=>{var g=l.containerBounds.x,b=l.containerBounds.y,w=l.containerBounds.width,S=l.containerBounds.height;return g!==d.e&&$(u,"x",d.e=g),b!==d.t&&$(u,"y",d.t=b),w!==d.a&&$(u,"width",d.a=w),S!==d.o&&$(u,"height",d.o=S),d},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),c),h(r,(()=>{var a=ne(()=>!!n.style.background);return()=>a()&&(()=>{var u=Ji();return T(d=>{var M,B;var g=l.positioning.backgroundX,b=l.positioning.backgroundY,w=l.containerBounds.width+(n.style.background.padding||0)*2,S=l.containerBounds.height+(n.style.background.padding||0)*2,O=n.style.background.color,A=n.style.background.opacity||1,P=((M=n.style.border)==null?void 0:M.radius)||0,E=((B=n.style.border)==null?void 0:B.radius)||0;return g!==d.e&&$(u,"x",d.e=g),b!==d.t&&$(u,"y",d.t=b),w!==d.a&&$(u,"width",d.a=w),S!==d.o&&$(u,"height",d.o=S),O!==d.i&&$(u,"fill",d.i=O),A!==d.n&&$(u,"fill-opacity",d.n=A),P!==d.s&&$(u,"rx",d.s=P),E!==d.h&&$(u,"ry",d.h=E),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()})(),c),h(r,(()=>{var a=ne(()=>!!n.style.border);return()=>a()&&(()=>{var u=Qi();return T(d=>{var B,R;var g=l.positioning.backgroundX,b=l.positioning.backgroundY,w=l.containerBounds.width+(((B=n.style.background)==null?void 0:B.padding)||0)*2,S=l.containerBounds.height+(((R=n.style.background)==null?void 0:R.padding)||0)*2,O=n.style.border.color,A=n.style.border.width,P=n.style.border.style==="Dashed"?"5,5":n.style.border.style==="Dotted"?"2,2":"none",E=n.style.border.radius||0,M=n.style.border.radius||0;return g!==d.e&&$(u,"x",d.e=g),b!==d.t&&$(u,"y",d.t=b),w!==d.a&&$(u,"width",d.a=w),S!==d.o&&$(u,"height",d.o=S),O!==d.i&&$(u,"stroke",d.i=O),A!==d.n&&$(u,"stroke-width",d.n=A),P!==d.s&&$(u,"stroke-dasharray",d.s=P),E!==d.h&&$(u,"rx",d.h=E),M!==d.r&&$(u,"ry",d.r=M),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),u})()})(),c),$(c,"text-anchor",s),h(c,(()=>{var a=ne(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,d)=>(()=>{var g=el();return h(g,u),T(b=>{var w=l.positioning.textAnchorX,S=d===0?0:l.fontMetrics.lineHeight;return w!==b.e&&$(g,"x",b.e=w),S!==b.t&&$(g,"dy",b.t=S),b},{e:void 0,t:void 0}),g})()):n.content.split(`
`).map((u,d)=>(()=>{var g=tl();return h(g,u),T(b=>{var w=l.positioning.textAnchorX,S=d===0?0:l.fontMetrics.lineHeight;return w!==b.e&&$(g,"x",b.e=w),S!==b.t&&$(g,"dy",b.t=S),b},{e:void 0,t:void 0}),g})())})()),T(a=>{var u=l.positioning.textAnchorX,d=l.positioning.textAnchorY,g=n.style.font_family,b=n.style.font_size.toString(),w=n.style.font_weight,S=n.style.color;return u!==a.e&&$(c,"x",a.e=u),d!==a.t&&$(c,"y",a.t=d),g!==a.a&&$(c,"font-family",a.a=g),b!==a.o&&$(c,"font-size",a.o=b),w!==a.i&&$(c,"font-weight",a.i=w),S!==a.n&&$(c,"fill",a.n=S),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}if(n.type==="Rectangle"){const l=n.opacity!==void 0?n.opacity:1,s=n.corner_radius||0;return(()=>{var r=nl();return $(r,"rx",s),$(r,"ry",s),$(r,"fill-opacity",l),$(r,"stroke-opacity",l),T(c=>{var S,O,A,P;var a=o.width,u=o.height,d=n.fill_color||"transparent",g=((S=n.border)==null?void 0:S.color)||"#000000",b=((O=n.border)==null?void 0:O.width)||1,w=((A=n.border)==null?void 0:A.style)==="Dashed"?"5,5":((P=n.border)==null?void 0:P.style)==="Dotted"?"2,2":"none";return a!==c.e&&$(r,"width",c.e=a),u!==c.t&&$(r,"height",c.t=u),d!==c.a&&$(r,"fill",c.a=d),g!==c.o&&$(r,"stroke",c.o=g),b!==c.i&&$(r,"stroke-width",c.i=b),w!==c.n&&$(r,"stroke-dasharray",c.n=w),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}if(n.type==="Line"){const l=n.opacity!==void 0?n.opacity:1,s=n.line_style||"Solid",r=s==="Dashed"?"8,4":s==="Dotted"?"2,2":s==="DashDot"?"8,4,2,4":"none";return(()=>{var c=il();return $(c,"stroke-opacity",l),$(c,"stroke-dasharray",r),T(a=>{var u=o.height/2,d=o.width,g=o.height/2,b=n.color,w=n.width;return u!==a.e&&$(c,"y1",a.e=u),d!==a.t&&$(c,"x2",a.t=d),g!==a.a&&$(c,"y2",a.a=g),b!==a.o&&$(c,"stroke",a.o=b),w!==a.i&&$(c,"stroke-width",a.i=w),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c})()}if(n.type==="DataField"&&n.style){const l=Ue.calculateUnifiedBounds(n.expression||"[数据字段]",n.style,o),s=Ue.getTextAnchor(n.style.align);return(()=>{var r=ll(),c=r.firstChild;return h(r,(()=>{var a=ne(()=>!!e.selected);return()=>a()&&(()=>{var u=Et();return T(d=>{var g=l.containerBounds.x,b=l.containerBounds.y,w=l.containerBounds.width,S=l.containerBounds.height;return g!==d.e&&$(u,"x",d.e=g),b!==d.t&&$(u,"y",d.t=b),w!==d.a&&$(u,"width",d.a=w),S!==d.o&&$(u,"height",d.o=S),d},{e:void 0,t:void 0,a:void 0,o:void 0}),u})()})(),c),$(c,"text-anchor",s),h(c,(()=>{var a=ne(()=>{var u;return!!((u=l.textLayout)!=null&&u.isWrapped)});return()=>a()?l.textLayout.wrappedLines.map((u,d)=>(()=>{var g=ol();return h(g,u),T(b=>{var w=l.positioning.textAnchorX,S=d===0?0:l.fontMetrics.lineHeight;return w!==b.e&&$(g,"x",b.e=w),S!==b.t&&$(g,"dy",b.t=S),b},{e:void 0,t:void 0}),g})()):(()=>{var u=sl();return h(u,()=>n.expression||"[数据字段]"),T(()=>$(u,"x",l.positioning.textAnchorX)),u})()})()),T(a=>{var u=l.positioning.textAnchorX,d=l.positioning.textAnchorY,g=n.style.font_family,b=n.style.font_size.toString(),w=n.style.font_weight,S=n.style.color;return u!==a.e&&$(c,"x",a.e=u),d!==a.t&&$(c,"y",a.t=d),g!==a.a&&$(c,"font-family",a.a=g),b!==a.o&&$(c,"font-size",a.o=b),w!==a.i&&$(c,"font-weight",a.i=w),S!==a.n&&$(c,"fill",a.n=S),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),r})()}return(()=>{var l=rl();return T(s=>{var r=o.width,c=o.height;return r!==s.e&&$(l,"width",s.e=r),c!==s.t&&$(l,"height",s.t=c),s},{e:void 0,t:void 0}),l})()};return(()=>{var n=al();return h(n,i),T(o=>{var l=`element ${e.selected&&e.element.content.type!=="Text"&&e.element.content.type!=="DataField"?"element-selected":""}`,s=t(),r=e.element.id,c=e.element.content.type;return l!==o.e&&$(n,"class",o.e=l),o.t=Rt(n,s,o.t),r!==o.a&&$(n,"data-element-id",o.a=r),c!==o.o&&$(n,"data-element-type",o.o=c),o},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};var dl=k("<svg><g class=resize-handles></svg>",!1,!0,!1),ul=k("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const hl=e=>{const{updateElement:t,setResizeOperation:i}=Se(),[n,o]=J(!1),[l,s]=J(null),[r,c]=J({x:0,y:0}),[a,u]=J({width:0,height:0}),[d,g]=J({x:0,y:0}),[b,w]=J({width:0,height:0}),[S,O]=J({x:0,y:0}),[A,P]=J(!1),E=ie(()=>{const{position:F,size:U,content:p}=e.element,D=8/2;let y={x:F.x,y:F.y,width:U.width,height:U.height};if((p.type==="Text"||p.type==="DataField")&&p.style){const re=p.type==="Text"?p.content:p.expression||"[数据字段]",j=Ue.calculateUnifiedBounds(re,p.style,U);y={x:F.x+j.containerBounds.x,y:F.y+j.containerBounds.y,width:j.containerBounds.width,height:j.containerBounds.height}}const C=y.x,I=y.y,N=y.x+y.width,H=y.y+y.height,V=y.x+y.width/2,ue=y.y+y.height/2;return[{position:"nw",cursor:"nw-resize",x:C-D,y:I-D},{position:"ne",cursor:"ne-resize",x:N-D,y:I-D},{position:"sw",cursor:"sw-resize",x:C-D,y:H-D},{position:"se",cursor:"se-resize",x:N-D,y:H-D},{position:"n",cursor:"n-resize",x:V-D,y:I-D},{position:"s",cursor:"s-resize",x:V-D,y:H-D},{position:"w",cursor:"w-resize",x:C-D,y:ue-D},{position:"e",cursor:"e-resize",x:N-D,y:ue-D}]}),M=(F,U,p,X=!1,D=!1)=>{const y=a(),C=d();let I=y.width,N=y.height,H=C.x,V=C.y;switch(F){case"nw":I=y.width-U,N=y.height-p,H=C.x+U,V=C.y+p;break;case"ne":I=y.width+U,N=y.height-p,V=C.y+p;break;case"sw":I=y.width-U,N=y.height+p,H=C.x+U;break;case"se":I=y.width+U,N=y.height+p;break;case"n":N=y.height-p,V=C.y+p;break;case"s":N=y.height+p;break;case"w":I=y.width-U,H=C.x+U;break;case"e":I=y.width+U;break}if(X&&(F==="nw"||F==="ne"||F==="sw"||F==="se")){const re=y.width/y.height;I/N>re?(I=N*re,(F==="nw"||F==="sw")&&(H=C.x+(y.width-I))):(N=I/re,(F==="nw"||F==="ne")&&(V=C.y+(y.height-N)))}if(D){const re=C.x+y.width/2,j=C.y+y.height/2;H=re-I/2,V=j-N/2}const ue=20;return I=Math.max(ue,I),N=Math.max(ue,N),{size:{width:I,height:N},position:{x:H,y:V}}},B=F=>(F.preventDefault(),F.stopPropagation(),F.stopImmediatePropagation(),!1),R=(F,U)=>{var p;i(!0),document.addEventListener("click",B,{capture:!0}),o(!0),s(F),c({x:U.clientX,y:U.clientY}),u({width:e.element.size.width,height:e.element.size.height}),g({x:e.element.position.x,y:e.element.position.y}),w(e.element.size),O(e.element.position),P(!1),document.addEventListener("mousemove",L),document.addEventListener("mouseup",Z),document.body.style.cursor=((p=E().find(X=>X.position===F))==null?void 0:p.cursor)||"default"};let K=0;const L=F=>{if(!n())return;const U=l();if(!U)return;const p=r(),X=F.clientX-p.x,D=F.clientY-p.y,y=M(U,X,D,F.shiftKey,F.altKey);w(y.size),O(y.position),P(Math.abs(X)>2||Math.abs(D)>2);const C=Date.now();if(C-K>50)try{t(e.element.id,{size:y.size,position:y.position}),K=C}catch{}},Z=()=>{if(!n()||!l())return;const U=()=>{document.removeEventListener("click",B,{capture:!0}),i(!1),o(!1),s(null),document.body.style.cursor="default",document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",Z)};if(A()){const p=b(),X=S();t(e.element.id,{size:p,position:X}).catch(D=>{t(e.element.id,{size:a(),position:d()}).catch(y=>{})})}U()};return at(()=>{i(!1),document.removeEventListener("click",B,{capture:!0}),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",Z),document.body.style.cursor="default"}),(()=>{var F=dl();return h(F,()=>E().map(U=>(()=>{var p=ul(),X=p.firstChild,D=X.nextSibling;return D.addEventListener("mouseleave",y=>{n()||(document.body.style.cursor="default")}),D.addEventListener("mouseenter",y=>{n()||(document.body.style.cursor=U.cursor)}),D.$$mousedown=y=>{y.stopPropagation(),y.preventDefault(),R(U.position,y)},D.style.setProperty("pointer-events","all"),T(y=>{var C=U.x+4,I=U.y+4,N=U.x,H=U.y,V=U.cursor;return C!==y.e&&$(X,"cx",y.e=C),I!==y.t&&$(X,"cy",y.t=I),N!==y.a&&$(D,"x",y.a=N),H!==y.o&&$(D,"y",y.o=H),V!==y.i&&((y.i=V)!=null?D.style.setProperty("cursor",V):D.style.removeProperty("cursor")),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),p})())),F})()};ye(["mousedown"]);var he=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(he||{});const gl={dragThreshold:3,updateThrottle:16};var fl=k("<div tabindex=0>"),yl=k("<div>"),vl=k("<div><div>🎯 修复版交互层</div><div>模式: </div><div>选中: </div><div>光标: "),ml=k("<div>拖拽: <!>个元素"),pl=k("<div>[<!>]");const bl=e=>{const{resizeOperation:t,setResizeOperation:i}=Se(),n=gl;let o;const[l,s]=J(he.IDLE),[r,c]=J([]),[a,u]=J(null),[d,g]=J(null),[b,w]=J(null),S=(f,v)=>Math.sqrt(Math.pow(f.x-v.x,2)+Math.pow(f.y-v.y,2)),O=(f,v)=>f.length===v.length&&f.every((_,x)=>_===v[x]),A=()=>{w(null)},[P,E]=J(null);let M="default";const B=(f,v)=>{!o||M===f||(o.style.cursor=f,M=f)},R=(f,...v)=>{console.log(`🎯 [InteractionLayer] ${f}`,...v)},K=f=>{if(!o)return{x:0,y:0};const v=o.getBoundingClientRect();return{x:f.clientX-v.left,y:f.clientY-v.top}},L=(f,v)=>f.x>=v.position.x&&f.x<=v.position.x+v.size.width&&f.y>=v.position.y&&f.y<=v.position.y+v.size.height,Z=f=>{var _;const v=F(f);return v.length>0&&(_=v[0])!=null?_:null},F=f=>{const v=e.getAllElements();return v.filter(x=>x&&x.visible&&L(f,x)).sort((x,z)=>{var ee,te;const G=(ee=x.z_index)!=null?ee:v.indexOf(x);return((te=z.z_index)!=null?te:v.indexOf(z))-G})},U=f=>{const v=r();if(v.length===0)return null;const _=e.getAllElements();for(const x of v){const z=_.find(Ce=>Ce.id===x);if(!z||!z.visible)continue;const G=8,W=G/2,ee=z.position.x,te=z.position.y,q=z.position.x+z.size.width,Pe=z.position.y+z.size.height,pe=z.position.x+z.size.width/2,Be=z.position.y+z.size.height/2,nn=[{direction:"nw",cursor:"nw-resize",x:ee-W,y:te-W},{direction:"ne",cursor:"ne-resize",x:q-W,y:te-W},{direction:"sw",cursor:"sw-resize",x:ee-W,y:Pe-W},{direction:"se",cursor:"se-resize",x:q-W,y:Pe-W},{direction:"n",cursor:"n-resize",x:pe-W,y:te-W},{direction:"s",cursor:"s-resize",x:pe-W,y:Pe-W},{direction:"w",cursor:"w-resize",x:ee-W,y:Be-W},{direction:"e",cursor:"e-resize",x:q-W,y:Be-W}];for(const Ce of nn)if(f.x>=Ce.x&&f.x<Ce.x+G&&f.y>=Ce.y&&f.y<Ce.y+G)return{elementId:z.id,direction:Ce.direction,cursor:Ce.cursor}}return null},p=f=>e.getAllElements().filter(_=>{if(!_.visible)return!1;const x={x:_.position.x,y:_.position.y,width:_.size.width,height:_.size.height};return!(x.x>f.x+f.width||x.x+x.width<f.x||x.y>f.y+f.height||x.y+x.height<f.y)}),X=(f,v)=>{var x,z,G;const _=F(f);return R("重叠选择检测",{elementsCount:_.length,isCtrlClick:v,elementIds:_.map(W=>W.id)}),_.length===0?null:_.length===1?(A(),((x=_[0])==null?void 0:x.id)||null):v?D(f,_):(A(),R("普通点击选中最上层",{elementId:(z=_[0])==null?void 0:z.id}),((G=_[0])==null?void 0:G.id)||null)},D=(f,v)=>{var G,W,ee,te;const _=b(),x=Date.now();if(R("循环选择开始",{hasContext:!!_,elementIds:v.map(q=>q.id)}),!_||S(f,_.clickPoint)>5||x-_.lastClickTime>3e3||!O(v.map(q=>q.id),_.overlappingElements.map(q=>q.id))){const q=v.length>1?1:0;return w({clickPoint:f,overlappingElements:v,currentSelectedIndex:q,lastClickTime:x}),R("循环选择重置",{selectedIndex:q,selectedId:(G=v[q])==null?void 0:G.id,reason:_?S(f,_.clickPoint)>5?"position_changed":x-_.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),y(q+1,v.length,f),((W=v[q])==null?void 0:W.id)||null}else{const q=(_.currentSelectedIndex+1)%v.length;return w({..._,currentSelectedIndex:q,lastClickTime:x}),R("循环选择继续",{selectedIndex:q,selectedId:(ee=v[q])==null?void 0:ee.id}),y(q+1,v.length,f),((te=v[q])==null?void 0:te.id)||null}},y=(f,v,_)=>{const x=document.querySelector(".overlap-indicator");x!=null&&x.parentNode&&x.parentNode.removeChild(x);const z=document.createElement("div");z.className="overlap-indicator",z.textContent=`${f}/${v}`,Object.assign(z.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${_.x+10}px`,top:`${_.y-20}px`}),document.body.appendChild(z),R("显示重叠指示器",{current:f,total:v,point:_}),setTimeout(()=>{z.parentNode&&(z.parentNode.removeChild(z),R("移除重叠指示器"))},1500)},C=f=>{var _;const v=K(f);if(P()){qt(v);return}if(l()===he.DRAGGING){Ye(v);return}if(l()===he.SELECTING){Ve(v);return}if(l()===he.IDLE&&a()&&!((_=a())!=null&&_.isDragging)){ve(v);return}l()===he.IDLE&&!a()&&!P()&&I(v)},I=f=>{const v=U(f);if(v){B(v.cursor);return}const _=Z(f);if(_){const z=r().includes(_.id)?"grab":"pointer";B(z);return}B("default")},N=f=>{const v=K(f),_=U(v);if(_){R("点击ResizeHandle",{elementId:_.elementId,direction:_.direction}),H(_,v);return}if(t()){R("调整大小操作进行中，跳过交互处理");return}const x=X(v,f.ctrlKey);if(R("鼠标按下",{point:v,selectedElementId:x,currentMode:l(),isCtrlClick:f.ctrlKey}),x){const z=e.getAllElements().find(G=>G.id===x);z&&V(z,v,f)}else ue(v)},H=(f,v,_)=>{const x=e.getAllElements().find(z=>z.id===f.elementId);x&&(R("开始resize操作",{elementId:f.elementId,direction:f.direction}),i(!0),E({elementId:f.elementId,handlePosition:f.direction,startPoint:v,initialSize:{width:x.size.width,height:x.size.height},initialPosition:{x:x.position.x,y:x.position.y},cursor:f.cursor}),B(f.cursor),R("resize状态已设置",P()))},V=(f,v,_)=>{const x=r().includes(f.id),z=r(),G=!!b();R("元素点击",{elementId:f.id,isSelected:x,currentlySelected:z,ctrlKey:_.ctrlKey,shiftKey:_.shiftKey,hasOverlapContext:G}),_.ctrlKey&&!G?re(f.id):_.shiftKey&&r().length>0?j(f.id):x?(R("点击已选中元素，准备拖拽",{selectedCount:z.length}),fe(z,v)):ae(f.id,v)},ue=(f,v)=>{var _;R("开始框选",{point:f}),c([]),(_=e.onElementsSelect)==null||_.call(e,[]),A(),s(he.SELECTING),B("crosshair"),g({startPoint:f,currentPoint:f,selectedIds:[]})},re=f=>{var x;const v=r(),_=v.includes(f)?v.filter(z=>z!==f):[...v,f];R("切换选择",{elementId:f,newSelection:_}),c(_),(x=e.onElementsSelect)==null||x.call(e,_)},j=f=>{var _;const v=r();if(!v.includes(f)){const x=[...v,f];R("添加到选择",{elementId:f,newSelection:x}),c(x),(_=e.onElementsSelect)==null||_.call(e,x)}},ae=(f,v,_)=>{var x;R("选择并准备拖拽",{elementId:f,point:v}),c([f]),(x=e.onElementsSelect)==null||x.call(e,[f]),fe([f],v)},fe=(f,v,_)=>{R("准备拖拽操作",{elementIds:f,startPoint:v});const x=e.getAllElements(),z=new Map;f.forEach(G=>{const W=x.find(ee=>ee.id===G);W&&z.set(G,{x:W.position.x,y:W.position.y})}),u({elementIds:f,startPoint:v,startPositions:z,currentOffset:{x:0,y:0},isDragging:!1})},ve=f=>{const v=a();if(!v)return;const _=Math.sqrt(Math.pow(f.x-v.startPoint.x,2)+Math.pow(f.y-v.startPoint.y,2));_>n.dragThreshold&&(R("开始拖拽",{distance:_,threshold:n.dragThreshold}),s(he.DRAGGING),B("grabbing"),u({...v,isDragging:!0}))};let me=!1,ze=0;const ke=(f,v=!1)=>{if(v){f();return}Date.now()-ze>=n.updateThrottle&&!me&&(me=!0,requestAnimationFrame(()=>{f(),me=!1,ze=Date.now()}))},Ye=f=>{const v=a();if(!v)return;const _={x:f.x-v.startPoint.x,y:f.y-v.startPoint.y};u({...v,currentOffset:_}),ke(()=>{if(e.onBatchUpdatePositions&&v.elementIds.length>1){const x=v.elementIds.map(z=>{const G=v.startPositions.get(z);return G?{element_id:z,new_position:{x:G.x+_.x,y:G.y+_.y}}:null}).filter(Boolean);x.length>0&&e.onBatchUpdatePositions(x).catch(()=>{})}else if(e.onElementMove){const x=v.elementIds.map(z=>{const G=v.startPositions.get(z);if(G)return e.onElementMove(z,{x:G.x+_.x,y:G.y+_.y})}).filter(Boolean);Promise.allSettled(x).catch(()=>{})}})},Ve=f=>{const v=d();if(!v)return;const _={...v,currentPoint:f};g(_);const x={x:Math.min(v.startPoint.x,f.x),y:Math.min(v.startPoint.y,f.y),width:Math.abs(f.x-v.startPoint.x),height:Math.abs(f.y-v.startPoint.y)},G=p(x).map(W=>W.id);g({..._,selectedIds:G}),c(G)},qt=f=>{const v=P();if(!v)return;const _=f.x-v.startPoint.x,x=f.y-v.startPoint.y,z=Zt(v.handlePosition,_,x,v.initialSize,v.initialPosition);ke(()=>{e.onElementResize&&e.onElementResize(v.elementId,z.size,z.position)})},Zt=(f,v,_,x,z)=>{let G=x.width,W=x.height,ee=z.x,te=z.y;switch(f){case"nw":G=x.width-v,W=x.height-_,ee=z.x+v,te=z.y+_;break;case"ne":G=x.width+v,W=x.height-_,te=z.y+_;break;case"sw":G=x.width-v,W=x.height+_,ee=z.x+v;break;case"se":G=x.width+v,W=x.height+_;break;case"n":W=x.height-_,te=z.y+_;break;case"s":W=x.height+_;break;case"w":G=x.width-v,ee=z.x+v;break;case"e":G=x.width+v;break}const q=10;return G=Math.max(q,G),W=Math.max(q,W),{size:{width:G,height:W},position:{x:ee,y:te}}},mt=()=>{const f=l();if(R("鼠标释放",{currentMode:f,hasResizeState:!!P()}),P()){en();return}f===he.DRAGGING?Jt():f===he.SELECTING&&Qt(),tn()},Jt=()=>{const f=a();if(!f||!f.isDragging&&f.currentOffset.x===0&&f.currentOffset.y===0){R("拖拽完成，无实际移动");return}if(e.onBatchUpdatePositions&&f.elementIds.length>1){const v=f.elementIds.map(_=>{const x=f.startPositions.get(_);return x?{element_id:_,new_position:{x:x.x+f.currentOffset.x,y:x.y+f.currentOffset.y}}:null}).filter(Boolean);v.length>0&&(R("拖拽完成 - 批量更新",{elementCount:v.length}),e.onBatchUpdatePositions(v).catch(_=>{console.warn("批量更新最终位置失败:",_)}))}},Qt=()=>{const f=d();f&&(R("框选完成",{selectedCount:f.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(f.selectedIds))},en=()=>{const f=P();f&&(R("完成resize操作",{elementId:f.elementId}),i(!1),E(null))},tn=()=>{s(he.IDLE),B("default"),u(null),g(null),E(null),i(!1),A(),R("状态重置完成")};Re(async()=>{document.addEventListener("mousemove",C),document.addEventListener("mouseup",mt),R("修复版交互层已初始化")}),at(()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",mt),R("修复版交互层已清理")});const Oe=()=>{const f=d();if(!f||l()!==he.SELECTING)return null;const{startPoint:v,currentPoint:_}=f;return{x:Math.min(v.x,_.x),y:Math.min(v.y,_.y),width:Math.abs(_.x-v.x),height:Math.abs(_.y-v.y)}};return(()=>{var f=fl();f.$$mousedown=N;var v=o;return typeof v=="function"?Ft(v,f):o=f,f.style.setProperty("position","absolute"),f.style.setProperty("top","0"),f.style.setProperty("left","0"),f.style.setProperty("width","100%"),f.style.setProperty("height","100%"),f.style.setProperty("z-index","10"),f.style.setProperty("pointer-events","all"),f.style.setProperty("background","transparent"),f.style.setProperty("user-select","none"),h(f,(()=>{var _=ne(()=>!!Oe());return()=>_()&&(()=>{var x=yl();return x.style.setProperty("position","absolute"),x.style.setProperty("border","1px dashed #007acc"),x.style.setProperty("background","rgba(0, 122, 204, 0.1)"),x.style.setProperty("pointer-events","none"),T(z=>{var G=`${Oe().x}px`,W=`${Oe().y}px`,ee=`${Oe().width}px`,te=`${Oe().height}px`;return G!==z.e&&((z.e=G)!=null?x.style.setProperty("left",G):x.style.removeProperty("left")),W!==z.t&&((z.t=W)!=null?x.style.setProperty("top",W):x.style.removeProperty("top")),ee!==z.a&&((z.a=ee)!=null?x.style.setProperty("width",ee):x.style.removeProperty("width")),te!==z.o&&((z.o=te)!=null?x.style.setProperty("height",te):x.style.removeProperty("height")),z},{e:void 0,t:void 0,a:void 0,o:void 0}),x})()})(),null),h(f,(()=>{var _=ne(()=>!!e.enableDebugMode);return()=>_()&&(()=>{var x=vl(),z=x.firstChild,G=z.nextSibling;G.firstChild;var W=G.nextSibling;W.firstChild;var ee=W.nextSibling;return ee.firstChild,x.style.setProperty("position","fixed"),x.style.setProperty("top","10px"),x.style.setProperty("right","10px"),x.style.setProperty("padding","8px"),x.style.setProperty("background","rgba(0, 0, 0, 0.8)"),x.style.setProperty("color","white"),x.style.setProperty("font-family","monospace"),x.style.setProperty("font-size","12px"),x.style.setProperty("border-radius","4px"),x.style.setProperty("z-index","9999"),x.style.setProperty("pointer-events","none"),h(G,l,null),h(W,()=>r().length,null),h(ee,M,null),h(x,(()=>{var te=ne(()=>{var q;return!!((q=a())!=null&&q.isDragging)});return()=>te()&&(()=>{var q=ml(),Pe=q.firstChild,pe=Pe.nextSibling;return pe.nextSibling,q.style.setProperty("color","#ffeb3b"),h(q,()=>{var Be;return(Be=a())==null?void 0:Be.elementIds.length},pe),q})()})(),null),h(x,(()=>{var te=ne(()=>r().length>0);return()=>te()&&(()=>{var q=pl(),Pe=q.firstChild,pe=Pe.nextSibling;return pe.nextSibling,q.style.setProperty("font-size","10px"),q.style.setProperty("color","#ccc"),h(q,()=>r().slice(0,3).join(", "),pe),h(q,()=>r().length>3&&"...",pe),q})()})(),null),x})()})(),null),f})()};ye(["mousedown"]);var xl=k("<div class=toolbar-section><div class=section-title>智能建议</div><button class=smart-align-button><div class=smart-icon>🎯</div><div class=smart-text></div></button><div class=smart-reason>"),wl=k("<div class=toolbar-status><div class=status-text>选择至少2个元素以使用对齐功能"),_l=k('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>正在执行对齐操作...'),$l=k('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>对齐</div><div class=button-group><button class="align-button left"title=左对齐><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=水平居中对齐><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=右对齐><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>垂直对齐</div><div class=button-group><button class="align-button top"title=顶部对齐><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=垂直居中对齐><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=底部对齐><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>分布</div><div class=button-group><button class="align-button distribute-h"title=水平均匀分布><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=垂直均匀分布><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const Sl=(e,t)=>{if(e.length<2)return[];const i=e.map(n=>({x:n.position.x,y:n.position.y,width:n.size.width,height:n.size.height}));return i.map((n,o)=>{let l=n.x,s=n.y;switch(t){case"left":l=Math.min(...i.map(d=>d.x));break;case"right":l=Math.max(...i.map(d=>d.x+d.width))-n.width;break;case"top":s=Math.min(...i.map(d=>d.y));break;case"bottom":s=Math.max(...i.map(d=>d.y+d.height))-n.height;break;case"h_center":l=i.reduce((d,g)=>d+g.x+g.width/2,0)/i.length-n.width/2;break;case"v_center":s=i.reduce((d,g)=>d+g.y+g.height/2,0)/i.length-n.height/2;break}return{element_id:e[o].id,new_position:{x:l,y:s}}})},kl=e=>{const{batchUpdatePositions:t,state:i}=Se(),[n,o]=J(!1),l=()=>e.selectedElementIds().length>=2,s=()=>{const u=e.selectedElementIds();return i.elements.filter(d=>u.includes(d.id))},r=async u=>{const d=s();if(d.length<2){console.warn("对齐功能需要至少2个元素");return}try{o(!0),console.log(`🎯 执行${u}对齐:`,d.length,"个元素");const g=Sl(d,u);await t(g),console.log("✅ 对齐操作完成"),e.onAlignmentComplete&&e.onAlignmentComplete(g)}catch(g){console.error("❌ 对齐操作失败:",g)}finally{o(!1)}},c=()=>s().length<2?null:{recommended:"left",reason:"建议左对齐",results:[]},a=()=>c();return(()=>{var u=$l(),d=u.firstChild,g=d.firstChild,b=g.nextSibling,w=b.firstChild,S=w.nextSibling,O=S.nextSibling,A=d.nextSibling,P=A.firstChild,E=P.nextSibling,M=E.firstChild,B=M.nextSibling,R=B.nextSibling,K=A.nextSibling,L=K.firstChild,Z=L.nextSibling,F=Z.firstChild,U=F.nextSibling;return w.$$click=()=>r("left"),S.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"h_center")}),S.$$click=()=>r("h_center"),O.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"right")}),O.$$click=()=>r("right"),M.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"top")}),M.$$click=()=>r("top"),B.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"v_center")}),B.$$click=()=>r("v_center"),R.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"bottom")}),R.$$click=()=>r("bottom"),F.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"distribute_h")}),F.$$click=()=>r("distribute_h"),U.addEventListener("mouseenter",()=>{var p;return(p=e.onAlignmentPreview)==null?void 0:p.call(e,"distribute_v")}),U.$$click=()=>r("distribute_v"),h(u,m(se,{get when(){return ne(()=>!!l())()&&a()},get children(){var p=xl(),X=p.firstChild,D=X.nextSibling,y=D.firstChild,C=y.nextSibling,I=D.nextSibling;return D.$$click=()=>r(a().recommended),h(C,()=>a().recommended==="left"&&"左对齐",null),h(C,()=>a().recommended==="right"&&"右对齐",null),h(C,()=>a().recommended==="top"&&"顶对齐",null),h(C,()=>a().recommended==="bottom"&&"底对齐",null),h(C,()=>a().recommended==="h_center"&&"水平居中",null),h(C,()=>a().recommended==="v_center"&&"垂直居中",null),h(I,()=>a().reason),T(N=>{var H=n(),V=a().reason;return H!==N.e&&(D.disabled=N.e=H),V!==N.t&&$(D,"title",N.t=V),N},{e:void 0,t:void 0}),p}}),null),h(u,m(se,{get when(){return!l()},get children(){var p=wl(),X=p.firstChild;return X.firstChild,h(X,()=>e.selectedElementIds().length<3&&"，至少3个元素以使用分布功能",null),p}}),null),h(u,m(se,{get when(){return n()},get children(){return _l()}}),null),T(p=>{var X=!l()||n(),D=!l()||n(),y=!l()||n(),C=!l()||n(),I=!l()||n(),N=!l()||n(),H=e.selectedElementIds().length<3||n(),V=e.selectedElementIds().length<3||n();return X!==p.e&&(w.disabled=p.e=X),D!==p.t&&(S.disabled=p.t=D),y!==p.a&&(O.disabled=p.a=y),C!==p.o&&(M.disabled=p.o=C),I!==p.i&&(B.disabled=p.i=I),N!==p.n&&(R.disabled=p.n=N),H!==p.s&&(F.disabled=p.s=H),V!==p.h&&(U.disabled=p.h=V),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()},Cl=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=Cl,document.head.appendChild(e)}ye(["click"]);var El=k("<div>"),Al=k('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),zl=k("<span class=ml-2>Zoom: <!>%");const Pl=()=>{const{state:e,selectElement:t,clearSelection:i,createElement:n,selectMultiple:o,updateElement:l,batchUpdatePositions:s}=Se();let r;const[c,a]=J([]),u=ie(()=>e.elements.filter(E=>E.visible)),d=(E,M)=>{if(!r)return{x:0,y:0};const B=r.getBoundingClientRect(),R=(E-B.left)/e.canvas_config.zoom,K=(M-B.top)/e.canvas_config.zoom;return{x:R,y:K}},g=async E=>{console.log("🎯 选择元素",E),a([...E]);try{E.length===0?await i():E.length===1?await t(E[0]):await o([...E])}catch(M){console.error("❌ 选择元素失败:",M)}},b=async E=>{try{await s(E)}catch(M){console.error("❌ 批量更新位置失败:",M)}},w=async(E,M)=>{try{await l(E,{position:{x:M.x,y:M.y}})}catch(B){console.error("❌ 移动元素失败:",B)}},S=async(E,M,B)=>{try{await l(E,{size:M,position:B})}catch(R){console.error("❌ 调整大小失败:",R)}},O=async E=>{console.log("🖱️ 画布点击",E)},A=async E=>{var M;E.preventDefault();try{const B=(M=E.dataTransfer)==null?void 0:M.getData("application/json");if(!B)return;const{type:R,component:K}=JSON.parse(B);if(R==="component"){const{x:L,y:Z}=d(E.clientX,E.clientY),F=Math.max(0,L-K.default_size.width/2),U=Math.max(0,Z-K.default_size.height/2);console.log("🎯 通过拖放创建组件:",K.name,"at",F,U);const p=await n(K.id,{x:F,y:U},K.default_size,K.create_content());console.log("✅ 通过拖放创建元素成功:",p),a([p]),await t(p)}}catch(B){console.error("拖放处理失败:",B)}};Re(()=>{a([...e.selected_ids])}),ie(()=>{a([...e.selected_ids])});const P=ie(()=>{const{width:E,height:M}=e.canvas_config;return`0 0 ${E} ${M}`});return(()=>{var E=Al(),M=E.firstChild,B=M.firstChild,R=B.firstChild,K=R.nextSibling,L=K.nextSibling,Z=L.nextSibling,F=Z.nextSibling,U=F.nextSibling,p=U.firstChild,X=p.nextSibling;X.nextSibling;var D=M.nextSibling,y=D.firstChild,C=y.firstChild,I=C.firstChild,N=I.firstChild,H=N.nextSibling,V=H.nextSibling,ue=V.nextSibling;h(B,()=>e.canvas_config.width,K),h(B,()=>e.canvas_config.height,Z),h(B,(()=>{var j=ne(()=>e.canvas_config.zoom!==1);return()=>j()&&(()=>{var ae=zl(),fe=ae.firstChild,ve=fe.nextSibling;return ve.nextSibling,h(ae,()=>Math.round(e.canvas_config.zoom*100),ve),ae})()})(),U),h(U,()=>e.elements.length,X),h(U,()=>c().length,null),C.style.setProperty("position","relative"),I.addEventListener("drop",A),I.addEventListener("dragover",j=>{j.preventDefault(),j.dataTransfer.dropEffect="copy"}),I.$$contextmenu=j=>j.preventDefault();var re=r;return typeof re=="function"?Ft(re,I):r=I,h(I,m(qi,{get config(){return e.canvas_config}}),H),h(V,m(_e,{get each(){return u()},children:j=>m(cl,{element:j,get selected(){return c().includes(j.id)}})})),h(ue,m(_e,{get each(){return u().filter(j=>c().includes(j.id))},children:j=>m(hl,{element:j})})),h(C,m(bl,{canvasRef:r,getAllElements:()=>[...e.elements],onElementsSelect:g,onElementMove:w,onBatchUpdatePositions:b,onElementResize:S,onCanvasClick:O,get enableDebugMode(){return!1}}),null),h(C,m(se,{get when(){return c().length>=2},get children(){var j=El();return j.style.setProperty("position","fixed"),j.style.setProperty("top","80px"),j.style.setProperty("right","20px"),j.style.setProperty("z-index","1000"),j.style.setProperty("background","white"),j.style.setProperty("border-radius","8px"),j.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),j.style.setProperty("border","1px solid #e5e7eb"),h(j,m(kl,{selectedElementIds:c,onAlignmentComplete:ae=>{console.log("✅ 对齐操作完成:",ae)},onAlignmentPreview:ae=>{console.log("👁️ 对齐预览:",ae)},onPreviewCancel:()=>{console.log("❌ 取消对齐预览")}})),j}}),null),T(j=>{var ae=e.canvas_config.width*e.canvas_config.zoom,fe=e.canvas_config.height*e.canvas_config.zoom,ve=P(),me=e.canvas_config.width,ze=e.canvas_config.height,ke=e.canvas_config.background_color,Ye=e.canvas_config.width,Ve=e.canvas_config.height;return ae!==j.e&&$(I,"width",j.e=ae),fe!==j.t&&$(I,"height",j.t=fe),ve!==j.a&&$(I,"viewBox",j.a=ve),me!==j.o&&$(N,"width",j.o=me),ze!==j.i&&$(N,"height",j.i=ze),ke!==j.n&&$(N,"fill",j.n=ke),Ye!==j.s&&$(H,"width",j.s=Ye),Ve!==j.h&&$(H,"height",j.h=Ve),j},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),E})()};ye(["contextmenu"]);var Ll=k('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),Tl=k('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Ml=k('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),Dl=k('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Ul=k('<div class="text-xs text-gray-500 p-2">暂无元素');const Il=()=>{const{state:e,createElement:t,selectElement:i,clearSelection:n}=Se(),[o,l]=J(!1),s=[{name:"创建文字元素",action:async()=>{const u=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",u),u}},{name:"创建矩形元素",action:async()=>{const u=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",u),u}},{name:"创建线条元素",action:async()=>{const u=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",u),u}},{name:"创建数据字段",action:async()=>{const u=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",u),u}}],r=async u=>{try{console.log(`🧪 开始测试: ${u.name}`);const d=await u.action();await i(d),console.log(`✅ 测试完成: ${u.name}, 元素ID: ${d}`)}catch(d){console.error(`❌ 测试失败: ${u.name}`,d)}},c=async()=>{console.log("🚀 开始运行所有测试案例..."),await n();for(const u of s)await r(u),await new Promise(d=>setTimeout(d,500));console.log("🎉 所有测试案例运行完成!")},a=async()=>{try{console.log("🧹 清理所有测试元素..."),await n(),console.log("✅ 清理完成")}catch(u){console.error("❌ 清理失败:",u)}};return[(()=>{var u=Ll();return u.$$click=()=>l(!o()),u})(),ne(()=>ne(()=>!!o())()&&(()=>{var u=Tl(),d=u.firstChild,g=d.firstChild,b=g.nextSibling,w=d.nextSibling,S=w.firstChild,O=S.firstChild,A=O.firstChild,P=A.nextSibling,E=O.nextSibling,M=E.firstChild,B=M.nextSibling,R=E.nextSibling,K=R.firstChild,L=K.nextSibling,Z=R.nextSibling,F=Z.firstChild,U=F.nextSibling,p=w.nextSibling,X=p.firstChild,D=X.nextSibling,y=p.nextSibling;y.firstChild;var C=y.nextSibling,I=C.firstChild,N=I.nextSibling;return b.$$click=()=>l(!1),h(P,()=>e.elements.length),h(B,()=>e.selected_ids.length),h(L,()=>e.can_undo?"是":"否"),h(U,()=>e.can_redo?"是":"否"),X.$$click=c,D.$$click=a,h(y,m(_e,{each:s,children:H=>(()=>{var V=Ml();return V.$$click=()=>r(H),h(V,()=>H.name),V})()}),null),h(N,m(_e,{get each(){return e.elements},children:H=>(()=>{var V=Dl(),ue=V.firstChild,re=ue.nextSibling,j=re.firstChild,ae=j.nextSibling;ae.nextSibling;var fe=re.nextSibling,ve=fe.firstChild,me=ve.nextSibling,ze=me.nextSibling,ke=ze.nextSibling;return ke.nextSibling,V.$$click=()=>i(H.id),h(ue,()=>H.content.type),h(re,()=>H.id.slice(0,8),ae),h(fe,()=>Math.round(H.position.x),me),h(fe,()=>Math.round(H.position.y),ke),T(()=>Ee(V,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(H.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),V})()}),null),h(N,(()=>{var H=ne(()=>e.elements.length===0);return()=>H()&&Ul()})(),null),u})())]};ye(["click"]);var Rl=k('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const Fl=()=>(()=>{var e=Rl(),t=e.firstChild,i=t.firstChild,n=i.nextSibling,o=n.nextSibling;return h(e,m(Un,{}),t),h(i,m(Fn,{})),h(n,m(Pl,{})),h(o,m(Ni,{})),h(e,m(Il,{}),null),e})(),Ol={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},Bl=()=>{const{state:e,copySelectedElements:t,pasteElements:i,deleteElements:n,undo:o,redo:l,selectAllElements:s,clearSelection:r,moveElements:c}=Se(),a=(w,S)=>{const O=w.key.toLowerCase()===S.key.toLowerCase()||w.key===S.key,A=!!S.ctrl===(w.ctrlKey||w.metaKey),P=!!S.alt===w.altKey,E=!!S.shift===w.shiftKey;return O&&A&&P&&E},u=async w=>{console.log("🎯 执行快捷键:",w);try{switch(w){case"copy":e.selected_ids.length>0&&(await t(),g("复制成功","✅"));break;case"paste":const S={x:20,y:20},O=await i(S.x,S.y);O.length>0&&g(`粘贴 ${O.length} 个元素`,"📋");break;case"cut":e.selected_ids.length>0&&(await t(),await n([...e.selected_ids]),g("剪切成功","✂️"));break;case"delete":if(e.selected_ids.length>0){const A=e.selected_ids.length;await n([...e.selected_ids]),g(`删除 ${A} 个元素`,"🗑️")}break;case"undo":await o(),g("撤销","↶");break;case"redo":await l(),g("重做","↷");break;case"selectAll":await s(),g(`全选 ${e.elements.length} 个元素`,"🎯");break;case"clearSelection":e.selected_ids.length>0&&(r(),g("清除选择","⭕"));break;case"duplicate":if(e.selected_ids.length>0){await t();const A=await i(20,20);g(`复制 ${A.length} 个元素`,"📄")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await d(w);break;default:console.warn("未知的快捷键动作:",w)}}catch(S){console.error("快捷键执行失败:",S),g("操作失败","❌")}},d=async w=>{if(e.selected_ids.length===0)return;const S=w.includes("Fast"),O=S?10:1;let A=0,P=0;switch(w){case"moveUp":case"moveFastUp":P=-O;break;case"moveDown":case"moveFastDown":P=O;break;case"moveLeft":case"moveFastLeft":A=-O;break;case"moveRight":case"moveFastRight":A=O;break}(A!==0||P!==0)&&(await c([...e.selected_ids],A,P),S&&g(`快速移动 ${O}px`,"🔄"))},g=(w,S)=>{const O=document.createElement("div");O.className="keyboard-feedback",O.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${S}</span>
        <span class="feedback-text">${w}</span>
      </div>
    `,document.body.appendChild(O),setTimeout(()=>{O.parentNode&&O.parentNode.removeChild(O)},2e3)},b=w=>{const S=w.target;if(!(S.tagName==="INPUT"||S.tagName==="TEXTAREA"||S.contentEditable==="true")){for(const[A,P]of Object.entries(Ol))if(a(w,P.combination)){w.preventDefault(),w.stopPropagation(),console.log("🎹 快捷键触发:",A,P.action),u(P.action);return}}};return Re(()=>{if(document.addEventListener("keydown",b,!0),console.log("🎹 键盘快捷键管理器已启动"),!document.getElementById("keyboard-feedback-styles")){const w=document.createElement("style");w.id="keyboard-feedback-styles",w.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(w)}}),at(()=>{document.removeEventListener("keydown",b,!0),console.log("🎹 键盘快捷键管理器已停止")}),null},Nl=()=>(Re(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),m(Pn,{get children(){return[m(Bl,{}),m(Fl,{})]}})),Hl=document.getElementById("root");_n(()=>m(Nl,{}),Hl);
