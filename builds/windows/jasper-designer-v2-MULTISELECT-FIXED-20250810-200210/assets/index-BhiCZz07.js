(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(l){if(l.ep)return;l.ep=!0;const o=i(l);fetch(l.href,o)}})();const Mt=!1,Dt=(e,t)=>e===t,ye=Symbol("solid-proxy"),We=Symbol("solid-track"),Te={equals:Dt};let ut=yt;const he=1,Ie=2,ft={owned:null,cleanups:null,context:null,owner:null};var B=null;let Ke=null,Lt=null,Y=null,ne=null,de=null,Be=0;function Ue(e,t){const i=Y,n=B,l=e.length===0,o=t===void 0?n:t,r=l?ft:{owned:null,cleanups:null,context:o?o.context:null,owner:o},s=l?e:()=>e(()=>se(()=>Pe(r)));B=r,Y=null;try{return $e(s,!0)}finally{Y=i,B=n}}function K(e,t){t=t?Object.assign({},Te,t):Te;const i={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=l=>(typeof l=="function"&&(l=l(i.value)),vt(i,l));return[gt.bind(i),n]}function k(e,t,i){const n=nt(e,t,!1,he);Le(n)}function Ut(e,t,i){ut=Nt;const n=nt(e,t,!1,he);n.user=!0,de?de.push(n):Le(n)}function J(e,t,i){i=i?Object.assign({},Te,i):Te;const n=nt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=i.equals||void 0,Le(n),gt.bind(n)}function Tt(e){return $e(e,!1)}function se(e){if(Y===null)return e();const t=Y;Y=null;try{return e()}finally{Y=t}}function Ve(e){Ut(()=>se(e))}function tt(e){return B===null||(B.cleanups===null?B.cleanups=[e]:B.cleanups.push(e)),e}function Xe(){return Y}function It(e,t){const i=Symbol("context");return{id:i,Provider:Ht(i),defaultValue:e}}function Ot(e){let t;return B&&B.context&&(t=B.context[e.id])!==void 0?t:e.defaultValue}function ht(e){const t=J(e),i=J(()=>Ze(t()));return i.toArray=()=>{const n=i();return Array.isArray(n)?n:n!=null?[n]:[]},i}function gt(){if(this.sources&&this.state)if(this.state===he)Le(this);else{const e=ne;ne=null,$e(()=>Fe(this),!1),ne=e}if(Y){const e=this.observers?this.observers.length:0;Y.sources?(Y.sources.push(this),Y.sourceSlots.push(e)):(Y.sources=[this],Y.sourceSlots=[e]),this.observers?(this.observers.push(Y),this.observerSlots.push(Y.sources.length-1)):(this.observers=[Y],this.observerSlots=[Y.sources.length-1])}return this.value}function vt(e,t,i){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&$e(()=>{for(let l=0;l<e.observers.length;l+=1){const o=e.observers[l],r=Ke&&Ke.running;r&&Ke.disposed.has(o),(r?!o.tState:!o.state)&&(o.pure?ne.push(o):de.push(o),o.observers&&mt(o)),r||(o.state=he)}if(ne.length>1e6)throw ne=[],new Error},!1)),t}function Le(e){if(!e.fn)return;Pe(e);const t=Be;Ft(e,e.value,t)}function Ft(e,t,i){let n;const l=B,o=Y;Y=B=e;try{n=e.fn(t)}catch(r){return e.pure&&(e.state=he,e.owned&&e.owned.forEach(Pe),e.owned=null),e.updatedAt=i+1,bt(r)}finally{Y=o,B=l}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?vt(e,n):e.value=n,e.updatedAt=i)}function nt(e,t,i,n=he,l){const o={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:B,context:B?B.context:null,pure:i};return B===null||B!==ft&&(B.owned?B.owned.push(o):B.owned=[o]),o}function Oe(e){if(e.state===0)return;if(e.state===Ie)return Fe(e);if(e.suspense&&se(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Be);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===he)Le(e);else if(e.state===Ie){const n=ne;ne=null,$e(()=>Fe(e,t[0]),!1),ne=n}}function $e(e,t){if(ne)return e();let i=!1;t||(ne=[]),de?i=!0:de=[],Be++;try{const n=e();return Rt(i),n}catch(n){i||(de=null),ne=null,bt(n)}}function Rt(e){if(ne&&(yt(ne),ne=null),e)return;const t=de;de=null,t.length&&$e(()=>ut(t),!1)}function yt(e){for(let t=0;t<e.length;t++)Oe(e[t])}function Nt(e){let t,i=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[i++]=n:Oe(n)}for(t=0;t<i;t++)Oe(e[t])}function Fe(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const n=e.sources[i];if(n.sources){const l=n.state;l===he?n!==t&&(!n.updatedAt||n.updatedAt<Be)&&Oe(n):l===Ie&&Fe(n,t)}}}function mt(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=Ie,i.pure?ne.push(i):de.push(i),i.observers&&mt(i))}}function Pe(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),n=e.sourceSlots.pop(),l=i.observers;if(l&&l.length){const o=l.pop(),r=i.observerSlots.pop();n<l.length&&(o.sourceSlots[r]=n,l[n]=o,i.observerSlots[n]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Pe(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Pe(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function jt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function bt(e,t=B){throw jt(e)}function Ze(e){if(typeof e=="function"&&!e.length)return Ze(e());if(Array.isArray(e)){const t=[];for(let i=0;i<e.length;i++){const n=Ze(e[i]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function Ht(e,t){return function(n){let l;return k(()=>l=se(()=>(B.context={...B.context,[e]:n.value},ht(()=>n.children))),void 0),l}}const Gt=Symbol("fallback");function ot(e){for(let t=0;t<e.length;t++)e[t]()}function Bt(e,t,i={}){let n=[],l=[],o=[],r=0,s=t.length>1?[]:null;return tt(()=>ot(o)),()=>{let c=e()||[],a=c.length,h,f;return c[We],se(()=>{let M,P,H,E,I,D,N,F,V;if(a===0)r!==0&&(ot(o),o=[],n=[],l=[],r=0,s&&(s=[])),i.fallback&&(n=[Gt],l[0]=Ue(W=>(o[0]=W,i.fallback())),r=1);else if(r===0){for(l=new Array(a),f=0;f<a;f++)n[f]=c[f],l[f]=Ue(C);r=a}else{for(H=new Array(a),E=new Array(a),s&&(I=new Array(a)),D=0,N=Math.min(r,a);D<N&&n[D]===c[D];D++);for(N=r-1,F=a-1;N>=D&&F>=D&&n[N]===c[F];N--,F--)H[F]=l[N],E[F]=o[N],s&&(I[F]=s[N]);for(M=new Map,P=new Array(F+1),f=F;f>=D;f--)V=c[f],h=M.get(V),P[f]=h===void 0?-1:h,M.set(V,f);for(h=D;h<=N;h++)V=n[h],f=M.get(V),f!==void 0&&f!==-1?(H[f]=l[h],E[f]=o[h],s&&(I[f]=s[h]),f=P[f],M.set(V,f)):o[h]();for(f=D;f<a;f++)f in H?(l[f]=H[f],o[f]=E[f],s&&(s[f]=I[f],s[f](f))):l[f]=Ue(C);l=l.slice(0,r=a),n=c.slice(0)}return l});function C(M){if(o[f]=M,s){const[P,H]=K(f);return s[f]=H,t(c[f],P)}return t(c[f])}}}function g(e,t){return se(()=>e(t||{}))}const wt=e=>`Stale read from <${e}>.`;function ve(e){const t="fallback"in e&&{fallback:()=>e.fallback};return J(Bt(()=>e.each,e.children,t||void 0))}function Ee(e){const t=e.keyed,i=J(()=>e.when,void 0,void 0),n=t?i:J(i,void 0,{equals:(l,o)=>!l==!o});return J(()=>{const l=n();if(l){const o=e.children;return typeof o=="function"&&o.length>0?se(()=>o(t?l:()=>{if(!se(n))throw wt("Show");return i()})):o}return e.fallback},void 0,void 0)}function Vt(e){const t=ht(()=>e.children),i=J(()=>{const n=t(),l=Array.isArray(n)?n:[n];let o=()=>{};for(let r=0;r<l.length;r++){const s=r,c=l[r],a=o,h=J(()=>a()?void 0:c.when,void 0,void 0),f=c.keyed?h:J(h,void 0,{equals:(C,M)=>!C==!M});o=()=>a()||(f()?[s,h,c]:void 0)}return o});return J(()=>{const n=i()();if(!n)return e.fallback;const[l,o,r]=n,s=r.children;return typeof s=="function"&&s.length>0?se(()=>s(r.keyed?o():()=>{var a;if(((a=se(i)())==null?void 0:a[0])!==l)throw wt("Match");return o()})):s},void 0,void 0)}function Se(e){return e}const ae=e=>J(()=>e());function qt(e,t,i){let n=i.length,l=t.length,o=n,r=0,s=0,c=t[l-1].nextSibling,a=null;for(;r<l||s<o;){if(t[r]===i[s]){r++,s++;continue}for(;t[l-1]===i[o-1];)l--,o--;if(l===r){const h=o<n?s?i[s-1].nextSibling:i[o-s]:c;for(;s<o;)e.insertBefore(i[s++],h)}else if(o===s)for(;r<l;)(!a||!a.has(t[r]))&&t[r].remove(),r++;else if(t[r]===i[o-1]&&i[s]===t[l-1]){const h=t[--l].nextSibling;e.insertBefore(i[s++],t[r++].nextSibling),e.insertBefore(i[--o],h),t[l]=i[o]}else{if(!a){a=new Map;let f=s;for(;f<o;)a.set(i[f],f++)}const h=a.get(t[r]);if(h!=null)if(s<h&&h<o){let f=r,C=1,M;for(;++f<l&&f<o&&!((M=a.get(t[f]))==null||M!==h+C);)C++;if(C>h-s){const P=t[r];for(;s<h;)e.insertBefore(i[s++],P)}else e.replaceChild(i[s++],t[r++])}else r++;else t[r++].remove()}}}const it="_$DX_DELEGATE";function Kt(e,t,i,n={}){let l;return Ue(o=>{l=o,t===document?e():d(t,e(),t.firstChild?null:void 0,i)},n.owner),()=>{l(),t.textContent=""}}function _(e,t,i,n){let l;const o=()=>{const s=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return s.innerHTML=e,i?s.content.firstChild.firstChild:n?s.firstChild:s.content.firstChild},r=t?()=>se(()=>document.importNode(l||(l=o()),!0)):()=>(l||(l=o())).cloneNode(!0);return r.cloneNode=r,r}function me(e,t=window.document){const i=t[it]||(t[it]=new Set);for(let n=0,l=e.length;n<l;n++){const o=e[n];i.has(o)||(i.add(o),t.addEventListener(o,Wt))}}function b(e,t,i){i==null?e.removeAttribute(t):e.setAttribute(t,i)}function xe(e,t){t==null?e.removeAttribute("class"):e.className=t}function Je(e,t,i,n){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function Yt(e,t,i){if(!t)return i?b(e,"style"):t;const n=e.style;if(typeof t=="string")return n.cssText=t;typeof i=="string"&&(n.cssText=i=void 0),i||(i={}),t||(t={});let l,o;for(o in i)t[o]==null&&n.removeProperty(o),delete i[o];for(o in t)l=t[o],l!==i[o]&&(n.setProperty(o,l),i[o]=l);return i}function pt(e,t,i){return se(()=>e(t,i))}function d(e,t,i,n){if(i!==void 0&&!n&&(n=[]),typeof t!="function")return Re(e,t,n,i);k(l=>Re(e,t(),l,i),n)}function Wt(e){let t=e.target;const i=`$$${e.type}`,n=e.target,l=e.currentTarget,o=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),r=()=>{const c=t[i];if(c&&!t.disabled){const a=t[`${i}Data`];if(a!==void 0?c.call(t,a,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&o(t.host),!0},s=()=>{for(;r()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();o(c[0]);for(let a=0;a<c.length-2&&(t=c[a],!!r());a++){if(t._$host){t=t._$host,s();break}if(t.parentNode===l)break}}else s();o(n)}function Re(e,t,i,n,l){for(;typeof i=="function";)i=i();if(t===i)return i;const o=typeof t,r=n!==void 0;if(e=r&&i[0]&&i[0].parentNode||e,o==="string"||o==="number"){if(o==="number"&&(t=t.toString(),t===i))return i;if(r){let s=i[0];s&&s.nodeType===3?s.data!==t&&(s.data=t):s=document.createTextNode(t),i=pe(e,i,n,s)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||o==="boolean")i=pe(e,i,n);else{if(o==="function")return k(()=>{let s=t();for(;typeof s=="function";)s=s();i=Re(e,s,i,n)}),()=>i;if(Array.isArray(t)){const s=[],c=i&&Array.isArray(i);if(Qe(s,t,i,l))return k(()=>i=Re(e,s,i,n,!0)),()=>i;if(s.length===0){if(i=pe(e,i,n),r)return i}else c?i.length===0?rt(e,s,n):qt(e,i,s):(i&&pe(e),rt(e,s));i=s}else if(t.nodeType){if(Array.isArray(i)){if(r)return i=pe(e,i,n,t);pe(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function Qe(e,t,i,n){let l=!1;for(let o=0,r=t.length;o<r;o++){let s=t[o],c=i&&i[e.length],a;if(!(s==null||s===!0||s===!1))if((a=typeof s)=="object"&&s.nodeType)e.push(s);else if(Array.isArray(s))l=Qe(e,s,c)||l;else if(a==="function")if(n){for(;typeof s=="function";)s=s();l=Qe(e,Array.isArray(s)?s:[s],Array.isArray(c)?c:[c])||l}else e.push(s),l=!0;else{const h=String(s);c&&c.nodeType===3&&c.data===h?e.push(c):e.push(document.createTextNode(h))}}return l}function rt(e,t,i=null){for(let n=0,l=t.length;n<l;n++)e.insertBefore(t[n],i)}function pe(e,t,i,n){if(i===void 0)return e.textContent="";const l=n||document.createTextNode("");if(t.length){let o=!1;for(let r=t.length-1;r>=0;r--){const s=t[r];if(l!==s){const c=s.parentNode===e;!o&&!r?c?e.replaceChild(l,s):e.insertBefore(l,i):c&&s.remove()}else o=!0}}else e.insertBefore(l,i);return[l]}const et=Symbol("store-raw"),_e=Symbol("store-node"),ce=Symbol("store-has"),xt=Symbol("store-self");function _t(e){let t=e[ye];if(!t&&(Object.defineProperty(e,ye,{value:t=new Proxy(e,Jt)}),!Array.isArray(e))){const i=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let l=0,o=i.length;l<o;l++){const r=i[l];n[r].get&&Object.defineProperty(e,r,{enumerable:n[r].enumerable,get:n[r].get.bind(t)})}}return t}function Ne(e){let t;return e!=null&&typeof e=="object"&&(e[ye]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function ze(e,t=new Set){let i,n,l,o;if(i=e!=null&&e[et])return i;if(!Ne(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let r=0,s=e.length;r<s;r++)l=e[r],(n=ze(l,t))!==l&&(e[r]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const r=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let c=0,a=r.length;c<a;c++)o=r[c],!s[o].get&&(l=e[o],(n=ze(l,t))!==l&&(e[o]=n))}return e}function je(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function Ae(e,t,i){if(e[t])return e[t];const[n,l]=K(i,{equals:!1,internal:!0});return n.$=l,e[t]=n}function Xt(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return!i||i.get||!i.configurable||t===ye||t===_e||(delete i.value,delete i.writable,i.get=()=>e[ye][t]),i}function $t(e){Xe()&&Ae(je(e,_e),xt)()}function Zt(e){return $t(e),Reflect.ownKeys(e)}const Jt={get(e,t,i){if(t===et)return e;if(t===ye)return i;if(t===We)return $t(e),i;const n=je(e,_e),l=n[t];let o=l?l():e[t];if(t===_e||t===ce||t==="__proto__")return o;if(!l){const r=Object.getOwnPropertyDescriptor(e,t);Xe()&&(typeof o!="function"||e.hasOwnProperty(t))&&!(r&&r.get)&&(o=Ae(n,t,o)())}return Ne(o)?_t(o):o},has(e,t){return t===et||t===ye||t===We||t===_e||t===ce||t==="__proto__"?!0:(Xe()&&Ae(je(e,ce),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Zt,getOwnPropertyDescriptor:Xt};function He(e,t,i,n=!1){if(!n&&e[t]===i)return;const l=e[t],o=e.length;i===void 0?(delete e[t],e[ce]&&e[ce][t]&&l!==void 0&&e[ce][t].$()):(e[t]=i,e[ce]&&e[ce][t]&&l===void 0&&e[ce][t].$());let r=je(e,_e),s;if((s=Ae(r,t,l))&&s.$(()=>i),Array.isArray(e)&&e.length!==o){for(let c=e.length;c<o;c++)(s=r[c])&&s.$();(s=Ae(r,"length",o))&&s.$(e.length)}(s=r[xt])&&s.$()}function St(e,t){const i=Object.keys(t);for(let n=0;n<i.length;n+=1){const l=i[n];He(e,l,t[l])}}function Qt(e,t){if(typeof t=="function"&&(t=t(e)),t=ze(t),Array.isArray(t)){if(e===t)return;let i=0,n=t.length;for(;i<n;i++){const l=t[i];e[i]!==l&&He(e,i,l)}He(e,"length",n)}else St(e,t)}function ke(e,t,i=[]){let n,l=e;if(t.length>1){n=t.shift();const r=typeof n,s=Array.isArray(e);if(Array.isArray(n)){for(let c=0;c<n.length;c++)ke(e,[n[c]].concat(t),i);return}else if(s&&r==="function"){for(let c=0;c<e.length;c++)n(e[c],c)&&ke(e,[c].concat(t),i);return}else if(s&&r==="object"){const{from:c=0,to:a=e.length-1,by:h=1}=n;for(let f=c;f<=a;f+=h)ke(e,[f].concat(t),i);return}else if(t.length>1){ke(e[n],t,[n].concat(i));return}l=e[n],i=[n].concat(i)}let o=t[0];typeof o=="function"&&(o=o(l,i),o===l)||n===void 0&&o==null||(o=ze(o),n===void 0||Ne(l)&&Ne(o)&&!Array.isArray(o)?St(l,o):He(e,n,o))}function en(...[e,t]){const i=ze(e||{}),n=Array.isArray(i),l=_t(i);function o(...r){Tt(()=>{n&&r.length===1?Qt(i,r[0]):ke(i,r)})}return[l,o]}function tn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function st(e,t=!1){const i=tn(),n=`_${i}`;return Object.defineProperty(window,n,{value:l=>(t&&Reflect.deleteProperty(window,n),e==null?void 0:e(l)),writable:!1,configurable:!0}),i}async function X(e,t={}){return new Promise((i,n)=>{const l=st(r=>{i(r),Reflect.deleteProperty(window,`_${o}`)},!0),o=st(r=>{n(r),Reflect.deleteProperty(window,`_${l}`)},!0);window.__TAURI_IPC__({cmd:e,callback:l,error:o,...t})})}const Ct=It(),nn=e=>{const[t,i]=en({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[n,l]=K(!1),[o,r]=K(null),[s,c]=K(!1),a=async()=>{try{l(!0),console.log("🔄 Loading app state...");const m=await X("get_app_state");console.log("🔄 App state loaded, selected_ids:",m.selected_ids),i(m)}catch(m){console.error("Failed to load app state:",m)}finally{l(!1)}};Ve(()=>{a()});const z={state:t,createElement:async(m,v,$,A={})=>{try{l(!0);const w=await X("create_element",{request:{element_type:m,position:v,size:$,content_data:A}});return await a(),w}catch(w){throw console.error("Failed to create element:",w),w}finally{l(!1)}},updateElement:async(m,v)=>{try{l(!0),await X("update_element",{request:{id:m,updates:v}}),await a()}catch($){throw console.error("Failed to update element:",$),$}finally{l(!1)}},batchUpdatePositions:async m=>{try{l(!0),await X("batch_update_positions",{request:{updates:m}}),i(v=>{const $=v.elements.map(A=>{const w=m.find(T=>T.element_id===A.id);return w?{...A,position:w.new_position}:A});return{...v,elements:$,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(v){throw console.error("Failed to batch update positions:",v),await a(),v}finally{l(!1)}},deleteElement:async m=>{try{l(!0),await X("delete_element",{elementId:m}),await a()}catch(v){throw console.error("Failed to delete element:",v),v}finally{l(!1)}},selectElement:async m=>{try{console.log("Selecting element:",m),await X("select_element",{elementId:m}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(v){throw console.error("Failed to select element:",v),v}},selectMultiple:async m=>{try{console.log("Selecting multiple elements:",m),m.length>0?(await X("select_multiple",{elementIds:m}),console.log("✅ Multi-select completed for:",m.length,"elements")):await X("clear_selection"),await a()}catch(v){throw console.error("Failed to select multiple elements:",v),v}},addToSelection:async m=>{try{console.log("Adding to selection:",m),await X("add_to_selection",{elementId:m}),await a()}catch(v){throw console.error("Failed to add to selection:",v),v}},removeFromSelection:async m=>{try{console.log("Removing from selection:",m),await X("remove_from_selection",{elementId:m}),await a()}catch(v){throw console.error("Failed to remove from selection:",v),v}},toggleSelection:async m=>{try{console.log("Toggling selection:",m),await X("toggle_selection",{elementId:m}),await a()}catch(v){throw console.error("Failed to toggle selection:",v),v}},clearSelection:async()=>{try{await X("clear_selection"),await a()}catch(m){throw console.error("Failed to clear selection:",m),m}},copySelected:async()=>{try{await X("copy_selected")}catch(m){throw console.error("Failed to copy selected elements:",m),m}},pasteElements:async(m,v)=>{try{l(!0);const $=await X("paste_elements",{offsetX:m,offsetY:v});return await a(),$}catch($){throw console.error("Failed to paste elements:",$),$}finally{l(!1)}},undo:async()=>{try{l(!0),await X("undo"),await a()}catch(m){throw console.error("Failed to undo:",m),m}finally{l(!1)}},redo:async()=>{try{l(!0),await X("redo"),await a()}catch(m){throw console.error("Failed to redo:",m),m}finally{l(!1)}},updateCanvasConfig:async m=>{try{l(!0),await X("update_canvas_config",{request:m}),await a()}catch(v){throw console.error("Failed to update canvas config:",v),v}finally{l(!1)}},getElementsAtPoint:async(m,v)=>{try{return await X("get_elements_at_point",{x:m,y:v})}catch($){return console.error("Failed to get elements at point:",$),[]}},isLoading:n,setLoading:l,dragOperation:o,setDragOperation:r,resizeOperation:s,setResizeOperation:c};return g(Ct.Provider,{value:z,get children(){return e.children}})},be=()=>{const e=Ot(Ct);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var ln=_("<span class=text-warning>●"),on=_("<span class=ml-2> 个元素"),rn=_('<span class="ml-2 text-primary">已选择 <!> 个'),sn=_('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const an=()=>{const{state:e,undo:t,redo:i,updateCanvasConfig:n}=be(),[l,o]=K(e.canvas_config.zoom*100),r=async C=>{const M=C/100;o(C);try{await n({zoom:M})}catch(P){console.error("Failed to update zoom:",P)}},s=()=>{const C=Math.min(l()+25,500);r(C)},c=()=>{const C=Math.max(l()-25,25);r(C)},a=async()=>{try{await n({show_grid:!e.canvas_config.show_grid})}catch(C){console.error("Failed to toggle grid:",C)}},h=async()=>{try{await n({show_rulers:!e.canvas_config.show_rulers})}catch(C){console.error("Failed to toggle rulers:",C)}},f=async()=>{try{await X("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(C){console.error("Failed to toggle DevTools:",C)}};return(()=>{var C=sn(),M=C.firstChild,P=M.nextSibling,H=P.firstChild,E=H.nextSibling,I=E.nextSibling,D=I.nextSibling,N=D.nextSibling,F=N.nextSibling,V=F.nextSibling,W=V.nextSibling,Z=W.nextSibling,L=Z.nextSibling,q=L.nextSibling,z=P.nextSibling,m=z.firstChild;return Je(H,"click",t),Je(E,"click",i),D.$$click=c,N.addEventListener("change",v=>{const $=v.target.value;if($==="fit")console.log("Fit to window");else{const A=parseInt($.replace("%",""));r(A)}}),F.$$click=s,W.$$click=a,Z.$$click=h,q.$$click=f,d(z,g(Ee,{get when(){return e.dirty},get children(){return ln()}}),m),d(m,()=>e.template_name||"未命名模板"),d(z,g(Ee,{get when(){return e.elements.length>0},get children(){var v=on(),$=v.firstChild;return d(v,()=>e.elements.length,$),v}}),null),d(z,g(Ee,{get when(){return e.selected_ids.length>0},get children(){var v=rn(),$=v.firstChild,A=$.nextSibling;return A.nextSibling,d(v,()=>e.selected_ids.length,A),v}}),null),k(v=>{var $=`toolbar-btn-icon ${e.can_undo?"":"opacity-50 cursor-not-allowed"}`,A=!e.can_undo,w=`撤销${e.undo_description?` (${e.undo_description})`:""} (Ctrl+Z)`,T=`toolbar-btn-icon ${e.can_redo?"":"opacity-50 cursor-not-allowed"}`,O=!e.can_redo,j=`重做${e.redo_description?` (${e.redo_description})`:""} (Ctrl+Y)`,R=`toolbar-btn-icon ${e.canvas_config.show_grid?"active":""}`,S=`toolbar-btn-icon ${e.canvas_config.show_rulers?"active":""}`;return $!==v.e&&xe(H,v.e=$),A!==v.t&&(H.disabled=v.t=A),w!==v.a&&b(H,"title",v.a=w),T!==v.o&&xe(E,v.o=T),O!==v.i&&(E.disabled=v.i=O),j!==v.n&&b(E,"title",v.n=j),R!==v.s&&xe(W,v.s=R),S!==v.h&&xe(Z,v.h=S),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),k(()=>N.value=`${Math.round(l())}%`),C})()};me(["click"]);var cn=_('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),dn=_('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const un=()=>{const{createElement:e}=be(),[t,i]=K(""),n=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"图片"})}],l=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center"}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right"}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left"}})}],o=[...n,...l],r=()=>{const a=t().toLowerCase();return a?o.filter(h=>h.name.toLowerCase().includes(a)||h.description.toLowerCase().includes(a)):o},s=(a,h)=>{if(console.log("Starting drag for component:",a.id),h.dataTransfer){h.dataTransfer.effectAllowed="copy",h.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const f=document.createElement("div");f.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,f.style.position="absolute",f.style.top="-1000px",document.body.appendChild(f),h.dataTransfer.setDragImage(f,50,20),setTimeout(()=>{document.body.removeChild(f)},0)}},c=async a=>{try{const h=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",h)}catch(h){console.error("Failed to create element:",h)}};return(()=>{var a=cn(),h=a.firstChild,f=h.firstChild,C=f.nextSibling,M=h.nextSibling,P=M.firstChild,H=P.firstChild,E=H.firstChild,I=E.nextSibling,D=H.nextSibling,N=D.firstChild,F=N.nextSibling,V=D.nextSibling,W=V.firstChild,Z=W.nextSibling;return C.$$input=L=>i(L.target.value),d(I,g(ve,{get each(){return r().filter(L=>L.category==="basic")},children:L=>g(Ye,{component:L,onDrag:q=>s(L,q),onClick:()=>c(L)})})),d(F,g(ve,{get each(){return r().filter(L=>L.category==="data")},children:L=>g(Ye,{component:L,onDrag:q=>s(L,q),onClick:()=>c(L)})})),d(Z,g(ve,{get each(){return r().filter(L=>L.category==="bank")},children:L=>g(Ye,{component:L,onDrag:q=>s(L,q),onClick:()=>c(L)})})),k(()=>C.value=t()),a})()},Ye=e=>(()=>{var t=dn(),i=t.firstChild,n=i.firstChild,l=n.nextSibling;return Je(t,"click",e.onClick),t.addEventListener("dragstart",o=>e.onDrag(o)),b(t,"draggable",!0),d(n,()=>e.component.icon),d(l,()=>e.component.name),k(()=>b(t,"title",e.component.description)),t})();me(["input","click"]);var fn=_('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),hn=_('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),gn=_("<span class=property-value>"),vn=_('<span class="property-value text-xs text-muted">'),Ge=_("<div class=space-y-2>"),Ce=_("<input type=number class=property-input>"),yn=_('<div class="grid grid-cols-2 gap-2">'),at=_("<input type=checkbox class=property-checkbox>"),mn=_('<div class="p-4 space-y-4">'),bn=_("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),wn=_("<div class=property-field><label class=property-label>"),pn=_("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),kt=_('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Et=_("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),Pt=_('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),xn=_("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),zt=_('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),_n=_('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),$n=_("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),ct=_("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Sn=_('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),Cn=_("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),kn=_("<input type=text class=property-input placeholder=图片描述文字>"),En=_("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),Pn=_("<div class=space-y-3>"),zn=_("<img class=property-image>"),An=_("<input type=text class=property-input placeholder=${fieldName}>"),Mn=_("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),Dn=_("<div class=space-y-4>"),Ln=_('<div class=flex><input type=number class="property-input flex-1">'),Un=_("<span class=property-unit>"),Tn=_('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),In=_("<div class=property-alignment-group>"),On=_("<button>");const Fn=()=>{const{state:e,updateElement:t}=be(),i=J(()=>{const o=new Set(e.selected_ids);return e.elements.filter(r=>o.has(r.id))}),n=J(()=>i()[0]),l=async(o,r,s)=>{try{await t(o,{[r]:s})}catch(c){console.error("Failed to update element property:",c)}};return(()=>{var o=fn(),r=o.firstChild,s=r.nextSibling;return d(s,g(Ee,{get when(){return n()},get fallback(){return hn()},get children(){return g(Rn,{get element(){return n()},onUpdate:l})}})),o})()},Rn=e=>{const t=(n,l)=>{const o={...e.element.position,[n]:l};e.onUpdate(e.element.id,"position",o)},i=(n,l)=>{const o={...e.element.size,[n]:Math.max(1,l)};e.onUpdate(e.element.id,"size",o)};return(()=>{var n=mn();return d(n,g(ue,{title:"元素信息",icon:"ℹ️",get children(){var l=Ge();return d(l,g(U,{label:"类型",get children(){var o=gn();return d(o,()=>e.element.content.type),o}}),null),d(l,g(U,{label:"ID",get children(){var o=vn();return d(o,()=>e.element.id),o}}),null),l}}),null),d(n,g(ue,{title:"位置和大小",icon:"📐",get children(){var l=yn();return d(l,g(U,{label:"X",get children(){var o=Ce();return o.$$input=r=>t("x",parseFloat(r.target.value)||0),k(()=>o.value=e.element.position.x),o}}),null),d(l,g(U,{label:"Y",get children(){var o=Ce();return o.$$input=r=>t("y",parseFloat(r.target.value)||0),k(()=>o.value=e.element.position.y),o}}),null),d(l,g(U,{label:"宽度",get children(){var o=Ce();return o.$$input=r=>i("width",parseFloat(r.target.value)||1),k(()=>o.value=e.element.size.width),o}}),null),d(l,g(U,{label:"高度",get children(){var o=Ce();return o.$$input=r=>i("height",parseFloat(r.target.value)||1),k(()=>o.value=e.element.size.height),o}}),null),l}}),null),d(n,g(ue,{title:"状态",icon:"👁️",get children(){var l=Ge();return d(l,g(U,{label:"可见",get children(){var o=at();return o.addEventListener("change",r=>e.onUpdate(e.element.id,"visible",r.target.checked)),k(()=>o.checked=e.element.visible),o}}),null),d(l,g(U,{label:"锁定",get children(){var o=at();return o.addEventListener("change",r=>e.onUpdate(e.element.id,"locked",r.target.checked)),k(()=>o.checked=e.element.locked),o}}),null),d(l,g(U,{label:"层级",get children(){var o=Ce();return o.$$input=r=>e.onUpdate(e.element.id,"z_index",parseInt(r.target.value)||0),k(()=>o.value=e.element.z_index),o}}),null),l}}),null),d(n,g(Vt,{get children(){return[g(Se,{get when(){return e.element.content.type==="Text"&&e.element.content},children:l=>g(Nn,{get content(){return l()},onUpdate:o=>{console.log("Text content update:",o),e.onUpdate(e.element.id,"content",o)}})}),g(Se,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:l=>g(jn,{get content(){return l()},onUpdate:o=>{console.log("Rectangle content update:",o),e.onUpdate(e.element.id,"content",o)}})}),g(Se,{get when(){return e.element.content.type==="Line"&&e.element.content},children:l=>g(Hn,{get content(){return l()},onUpdate:o=>{console.log("Line content update:",o),e.onUpdate(e.element.id,"content",o)}})}),g(Se,{get when(){return e.element.content.type==="Image"&&e.element.content},children:l=>g(Gn,{get content(){return l()},onUpdate:o=>{console.log("Image content update:",o),e.onUpdate(e.element.id,"content",o)}})}),g(Se,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:l=>g(Bn,{get content(){return l()},onUpdate:o=>{console.log("DataField content update:",o),e.onUpdate(e.element.id,"content",o)}})})]}}),null),n})()},ue=e=>(()=>{var t=bn(),i=t.firstChild,n=i.firstChild,l=n.nextSibling,o=i.nextSibling;return d(n,()=>e.icon),d(l,()=>e.title),d(o,()=>e.children),t})(),U=e=>(()=>{var t=wn(),i=t.firstChild;return d(i,()=>e.label),d(t,()=>e.children,null),t})(),Nn=e=>g(ue,{title:"文字样式",icon:"🔤",get children(){var t=Pt(),i=t.firstChild,n=i.nextSibling;return d(t,g(U,{label:"内容",get children(){var l=pn();return l.$$input=o=>e.onUpdate({content:o.target.value}),k(()=>l.value=e.content.content),l}}),i),d(i,g(U,{label:"字体",get children(){var l=kt();return l.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,font_family:o.target.value}})),k(()=>l.value=e.content.style.font_family),l}}),null),d(i,g(U,{label:"大小",get children(){return g(Me,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),d(n,g(U,{label:"字重",get children(){var l=Et();return l.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,font_weight:o.target.value}})),k(()=>l.value=e.content.style.font_weight),l}}),null),d(n,g(U,{label:"对齐",get children(){return g(At,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),d(t,g(U,{label:"颜色",get children(){return g(De,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),t}}),jn=e=>g(ue,{title:"矩形样式",icon:"▭",get children(){var t=_n(),i=t.firstChild,n=i.firstChild;return d(t,g(U,{label:"填充颜色",get children(){return g(De,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:l=>e.onUpdate({fill_color:l})})}}),i),d(i,g(U,{label:"边框",get children(){var l=Ge();return d(l,g(De,{get value(){var o;return((o=e.content.border)==null?void 0:o.color)||"#000000"},onUpdate:o=>e.onUpdate({border:{...e.content.border,color:o}})})),l}}),n),d(n,g(U,{label:"宽度",get children(){return g(Me,{get value(){var l;return((l=e.content.border)==null?void 0:l.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:l=>e.onUpdate({border:{...e.content.border,width:l}})})}}),null),d(n,g(U,{label:"样式",get children(){var l=xn();return l.addEventListener("change",o=>e.onUpdate({border:{...e.content.border,style:o.target.value}})),k(()=>{var o;return l.value=((o=e.content.border)==null?void 0:o.style)||"Solid"}),l}}),null),d(t,g(U,{label:"圆角半径",get children(){return g(Me,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:l=>e.onUpdate({corner_radius:l})})}}),null),d(t,g(U,{label:"透明度",get children(){var l=zt(),o=l.firstChild,r=o.nextSibling,s=r.firstChild;return o.$$input=c=>e.onUpdate({opacity:parseFloat(c.target.value)/100}),d(r,()=>Math.round((e.content.opacity||1)*100),s),k(()=>o.value=(e.content.opacity||1)*100),l}}),null),t}}),Hn=e=>g(ue,{title:"线条样式",icon:"━",get children(){var t=Sn(),i=t.firstChild;return d(t,g(U,{label:"颜色",get children(){return g(De,{get value(){return e.content.color},onUpdate:n=>e.onUpdate({color:n})})}}),i),d(t,g(U,{label:"宽度",get children(){return g(Me,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:n=>e.onUpdate({width:n})})}}),i),d(t,g(U,{label:"样式",get children(){var n=$n();return n.addEventListener("change",l=>e.onUpdate({line_style:l.target.value})),k(()=>n.value=e.content.line_style||"Solid"),n}}),i),d(i,g(U,{label:"起点",get children(){var n=ct();return n.addEventListener("change",l=>e.onUpdate({start_cap:l.target.value})),k(()=>n.value=e.content.start_cap||"None"),n}}),null),d(i,g(U,{label:"终点",get children(){var n=ct();return n.addEventListener("change",l=>e.onUpdate({end_cap:l.target.value})),k(()=>n.value=e.content.end_cap||"None"),n}}),null),d(t,g(U,{label:"透明度",get children(){var n=zt(),l=n.firstChild,o=l.nextSibling,r=o.firstChild;return l.$$input=s=>e.onUpdate({opacity:parseFloat(s.target.value)/100}),d(o,()=>Math.round((e.content.opacity||1)*100),r),k(()=>l.value=(e.content.opacity||1)*100),n}}),null),t}}),Gn=e=>g(ue,{title:"图片属性",icon:"🖼️",get children(){var t=Pn();return d(t,g(U,{label:"图片地址",get children(){var i=Cn();return i.$$input=n=>e.onUpdate({src:n.target.value}),k(()=>i.value=e.content.src),i}}),null),d(t,g(U,{label:"替代文本",get children(){var i=kn();return i.$$input=n=>e.onUpdate({alt:n.target.value}),k(()=>i.value=e.content.alt||""),i}}),null),d(t,g(U,{label:"预览",get children(){var i=En(),n=i.firstChild;return d(i,(()=>{var l=ae(()=>!!e.content.src);return()=>l()?(()=>{var o=zn();return o.addEventListener("load",r=>{const s=r.target,c=s.nextElementSibling;s&&(s.style.display="block"),c&&(c.style.display="none")}),o.addEventListener("error",r=>{const s=r.target,c=s.nextElementSibling;s&&(s.style.display="none"),c&&(c.style.display="flex")}),k(r=>{var s=e.content.src,c=e.content.alt||"图片预览";return s!==r.e&&b(o,"src",r.e=s),c!==r.t&&b(o,"alt",r.t=c),r},{e:void 0,t:void 0}),o})():null})(),n),k(l=>(l=e.content.src?"none":"flex")!=null?n.style.setProperty("display",l):n.style.removeProperty("display")),i}}),null),t}}),Bn=e=>(()=>{var t=Dn();return d(t,g(ue,{title:"数据字段",icon:"🔗",get children(){var i=Ge();return d(i,g(U,{label:"表达式",get children(){var n=An();return n.$$input=l=>e.onUpdate({expression:l.target.value}),k(()=>n.value=e.content.expression),n}}),null),d(i,g(U,{label:"格式",get children(){var n=Mn();return n.addEventListener("change",l=>e.onUpdate({format:l.target.value==="default"?void 0:l.target.value})),k(()=>n.value=e.content.format||"default"),n}}),null),i}}),null),d(t,g(ue,{title:"字段样式",icon:"🎨",get children(){var i=Pt(),n=i.firstChild,l=n.nextSibling;return d(n,g(U,{label:"字体",get children(){var o=kt();return o.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_family:r.target.value}})),k(()=>o.value=e.content.style.font_family),o}}),null),d(n,g(U,{label:"大小",get children(){return g(Me,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:o=>e.onUpdate({style:{...e.content.style,font_size:o}})})}}),null),d(l,g(U,{label:"字重",get children(){var o=Et();return o.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_weight:r.target.value}})),k(()=>o.value=e.content.style.font_weight),o}}),null),d(l,g(U,{label:"对齐",get children(){return g(At,{get value(){return e.content.style.align},onUpdate:o=>e.onUpdate({style:{...e.content.style,align:o}})})}}),null),d(i,g(U,{label:"颜色",get children(){return g(De,{get value(){return e.content.style.color},onUpdate:o=>e.onUpdate({style:{...e.content.style,color:o}})})}}),null),i}}),null),t})(),Me=e=>(()=>{var t=Ln(),i=t.firstChild;return i.addEventListener("blur",n=>{const l=parseFloat(n.target.value)||e.value,o=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));o!==l&&(n.target.value=o.toString(),e.onUpdate(o))}),i.$$input=n=>{const l=parseFloat(n.target.value);if(!isNaN(l)){const o=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));e.onUpdate(o)}},d(t,(()=>{var n=ae(()=>!!e.unit);return()=>n()&&(()=>{var l=Un();return d(l,()=>e.unit),l})()})(),null),k(n=>{var l=e.min,o=e.max,r=e.step||1;return l!==n.e&&b(i,"min",n.e=l),o!==n.t&&b(i,"max",n.t=o),r!==n.a&&b(i,"step",n.a=r),n},{e:void 0,t:void 0,a:void 0}),k(()=>i.value=e.value),t})(),De=e=>(()=>{var t=Tn(),i=t.firstChild,n=i.firstChild,l=n.nextSibling,o=i.nextSibling;return n.$$input=r=>e.onUpdate(r.target.value),o.$$input=r=>{const s=r.target.value;(/^#[0-9A-Fa-f]{6}$/.test(s)||/^#[0-9A-Fa-f]{3}$/.test(s))&&e.onUpdate(s)},k(r=>(r=e.value)!=null?l.style.setProperty("background-color",r):l.style.removeProperty("background-color")),k(()=>n.value=e.value),k(()=>o.value=e.value),t})(),At=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var i=In();return d(i,()=>t.map(n=>(()=>{var l=On();return l.$$click=()=>e.onUpdate(n.value),d(l,()=>n.icon),k(o=>{var r=`property-alignment-btn ${e.value===n.value?"active":""}`,s=n.label;return r!==o.e&&xe(l,o.e=r),s!==o.t&&b(l,"title",o.t=s),o},{e:void 0,t:void 0}),l})())),i})()};me(["input","click"]);var Vn=_("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),qn=_("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const Kn=e=>g(Ee,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Vn(),i=t.firstChild,n=i.firstChild,l=n.nextSibling;return k(o=>{var r=e.config.grid_size,s=e.config.grid_size,c=e.config.grid_size,a=e.config.grid_size,h=e.config.grid_size,f=e.config.grid_size,C=e.config.grid_size,M=e.config.grid_size;return r!==o.e&&b(i,"width",o.e=r),s!==o.t&&b(i,"height",o.t=s),c!==o.a&&b(n,"x1",o.a=c),a!==o.o&&b(n,"x2",o.o=a),h!==o.i&&b(n,"y2",o.i=h),f!==o.n&&b(l,"y1",o.n=f),C!==o.s&&b(l,"x2",o.s=C),M!==o.h&&b(l,"y2",o.h=M),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=qn();return k(i=>{var n=e.config.width,l=e.config.height;return n!==i.e&&b(t,"width",i.e=n),l!==i.t&&b(t,"height",i.t=l),i},{e:void 0,t:void 0}),t})()]}});var Yn=_("<svg><g class=resize-handles></svg>",!1,!0,!1),Wn=_("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const Xn=e=>{const{updateElement:t,setResizeOperation:i}=be(),[n,l]=K(!1),[o,r]=K(null),[s,c]=K({x:0,y:0}),[a,h]=K({width:0,height:0}),[f,C]=K({x:0,y:0}),[M,P]=K({width:0,height:0}),[H,E]=K({x:0,y:0}),[I,D]=K(!1),N=J(()=>{const{position:z,size:m}=e.element,$=8/2,A=z.x,w=z.y,T=z.x+m.width,O=z.y+m.height,j=z.x+m.width/2,R=z.y+m.height/2;return[{position:"nw",cursor:"nw-resize",x:A-$,y:w-$},{position:"ne",cursor:"ne-resize",x:T-$,y:w-$},{position:"sw",cursor:"sw-resize",x:A-$,y:O-$},{position:"se",cursor:"se-resize",x:T-$,y:O-$},{position:"n",cursor:"n-resize",x:j-$,y:w-$},{position:"s",cursor:"s-resize",x:j-$,y:O-$},{position:"w",cursor:"w-resize",x:A-$,y:R-$},{position:"e",cursor:"e-resize",x:T-$,y:R-$}]}),F=(z,m,v,$=!1,A=!1)=>{const w=a(),T=f();let O=w.width,j=w.height,R=T.x,S=T.y;switch(z){case"nw":O=w.width-m,j=w.height-v,R=T.x+m,S=T.y+v;break;case"ne":O=w.width+m,j=w.height-v,S=T.y+v;break;case"sw":O=w.width-m,j=w.height+v,R=T.x+m;break;case"se":O=w.width+m,j=w.height+v;break;case"n":j=w.height-v,S=T.y+v;break;case"s":j=w.height+v;break;case"w":O=w.width-m,R=T.x+m;break;case"e":O=w.width+m;break}if($&&(z==="nw"||z==="ne"||z==="sw"||z==="se")){const Q=w.width/w.height;O/j>Q?(O=j*Q,(z==="nw"||z==="sw")&&(R=T.x+(w.width-O))):(j=O/Q,(z==="nw"||z==="ne")&&(S=T.y+(w.height-j)))}if(A){const Q=T.x+w.width/2,ee=T.y+w.height/2;R=Q-O/2,S=ee-j/2}const le=20;return O=Math.max(le,O),j=Math.max(le,j),{size:{width:O,height:j},position:{x:R,y:S}}},V=z=>(z.preventDefault(),z.stopPropagation(),z.stopImmediatePropagation(),!1),W=(z,m)=>{var v;i(!0),document.addEventListener("click",V,{capture:!0}),l(!0),r(z),c({x:m.clientX,y:m.clientY}),h({width:e.element.size.width,height:e.element.size.height}),C({x:e.element.position.x,y:e.element.position.y}),P(e.element.size),E(e.element.position),D(!1),document.addEventListener("mousemove",L),document.addEventListener("mouseup",q),document.body.style.cursor=((v=N().find($=>$.position===z))==null?void 0:v.cursor)||"default"};let Z=0;const L=z=>{if(!n())return;const m=o();if(!m)return;const v=s(),$=z.clientX-v.x,A=z.clientY-v.y,w=F(m,$,A,z.shiftKey,z.altKey);P(w.size),E(w.position),D(Math.abs($)>2||Math.abs(A)>2);const T=Date.now();if(T-Z>50)try{t(e.element.id,{size:w.size,position:w.position}),Z=T}catch{}},q=()=>{if(!n()||!o())return;const m=()=>{document.removeEventListener("click",V,{capture:!0}),i(!1),l(!1),r(null),document.body.style.cursor="default",document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",q)};if(I()){const v=M(),$=H();t(e.element.id,{size:v,position:$}).catch(A=>{t(e.element.id,{size:a(),position:f()}).catch(w=>{})})}m()};return tt(()=>{i(!1),document.removeEventListener("click",V,{capture:!0}),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",q),document.body.style.cursor="default"}),(()=>{var z=Yn();return d(z,()=>N().map(m=>(()=>{var v=Wn(),$=v.firstChild,A=$.nextSibling;return A.addEventListener("mouseleave",w=>{n()||(document.body.style.cursor="default")}),A.addEventListener("mouseenter",w=>{n()||(document.body.style.cursor=m.cursor)}),A.$$mousedown=w=>{w.stopPropagation(),w.preventDefault(),W(m.position,w)},A.style.setProperty("pointer-events","all"),k(w=>{var T=m.x+4,O=m.y+4,j=m.x,R=m.y,S=m.cursor;return T!==w.e&&b($,"cx",w.e=T),O!==w.t&&b($,"cy",w.t=O),j!==w.a&&b(A,"x",w.a=j),R!==w.o&&b(A,"y",w.o=R),S!==w.i&&((w.i=S)!=null?A.style.setProperty("cursor",S):A.style.removeProperty("cursor")),w},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),v})())),z})()};me(["mousedown"]);var re=(e=>(e.IDLE="idle",e.SELECTING="selecting",e.DRAGGING="dragging",e))(re||{});const Zn={dragThreshold:3,updateThrottle:50};var Jn=_("<div tabindex=0>"),Qn=_("<div>"),el=_("<div><div>🎯 统一交互层</div><div>模式: </div><div>选中: </div><div>悬停: "),tl=_("<div>拖拽: <!>个元素"),nl=_("<div>[<!>]");const ll=e=>{const{resizeOperation:t}=be(),i=Zn;let n;const[l,o]=K(re.IDLE),[r,s]=K([]),[c,a]=K(null),[h,f]=K(null),[C,M]=K(null),P=(u,...y)=>{console.log(`🎯 [InteractionLayer] ${u}`,...y)},H=u=>{if(!n)return{x:0,y:0};const y=n.getBoundingClientRect();return{x:u.clientX-y.left,y:u.clientY-y.top}},E=(u,y)=>u.x>=y.position.x&&u.x<=y.position.x+y.size.width&&u.y>=y.position.y&&u.y<=y.position.y+y.size.height,I=u=>{const y=e.getAllElements();for(let p=y.length-1;p>=0;p--){const x=y[p];if(x&&x.visible&&E(u,x))return x}return null},D=u=>e.getAllElements().filter(p=>{if(!p.visible)return!1;const x={x:p.position.x,y:p.position.y,width:p.size.width,height:p.size.height};return!(x.x>u.x+u.width||x.x+x.width<u.x||x.y>u.y+u.height||x.y+x.height<u.y)}),N=u=>{if(t()){P("调整大小操作进行中，跳过交互处理");return}const y=H(u),p=I(y);P("鼠标按下",{point:y,elementId:p==null?void 0:p.id,currentMode:l()}),p?F(p,y,u):V(y)},F=(u,y,p)=>{const x=r().includes(u.id);p.ctrlKey?W(u.id):p.shiftKey&&r().length>0?Z(u.id):x?q(r(),y):L(u.id,y)},V=(u,y)=>{var p;P("开始框选",{point:u}),s([]),(p=e.onElementsSelect)==null||p.call(e,[]),o(re.SELECTING),M({startPoint:u,currentPoint:u,selectedIds:[]})},W=u=>{var x;const y=r(),p=y.includes(u)?y.filter(G=>G!==u):[...y,u];P("切换选择",{elementId:u,newSelection:p}),s(p),(x=e.onElementsSelect)==null||x.call(e,p)},Z=u=>{var p;const y=r();if(!y.includes(u)){const x=[...y,u];P("添加到选择",{elementId:u,newSelection:x}),s(x),(p=e.onElementsSelect)==null||p.call(e,x)}},L=(u,y,p)=>{var x;P("选择并准备拖拽",{elementId:u,point:y}),s([u]),(x=e.onElementsSelect)==null||x.call(e,[u]),q([u],y)},q=(u,y,p)=>{P("准备拖拽操作",{elementIds:u,startPoint:y});const x=e.getAllElements(),G=new Map;u.forEach(te=>{const ie=x.find(fe=>fe.id===te);ie&&G.set(te,{x:ie.position.x,y:ie.position.y})}),f({elementIds:u,startPoint:y,startPositions:G,currentOffset:{x:0,y:0},isDragging:!1})};let z=0;const m=u=>{const y=Date.now();y-z>=i.updateThrottle&&(u(),z=y)},v=u=>{const y=H(u),p=l();p===re.IDLE&&h()?A(y):p===re.DRAGGING?w(y):p===re.SELECTING?T(y):$(y)},$=u=>{const y=I(u),p=(y==null?void 0:y.id)||null;p!==c()&&(a(p),O())},A=u=>{const y=h();if(!y)return;const p=Math.sqrt(Math.pow(u.x-y.startPoint.x,2)+Math.pow(u.y-y.startPoint.y,2));p>i.dragThreshold&&(P("开始拖拽",{distance:p,threshold:i.dragThreshold}),o(re.DRAGGING),f({...y,isDragging:!0}),O("grabbing"))},w=u=>{const y=h();if(!y)return;const p={x:u.x-y.startPoint.x,y:u.y-y.startPoint.y};f({...y,currentOffset:p}),m(()=>{y.elementIds.forEach(x=>{const G=y.startPositions.get(x);G&&e.onElementMove&&e.onElementMove(x,{x:G.x+p.x,y:G.y+p.y})})})},T=u=>{const y=C();if(!y)return;const p={...y,currentPoint:u};M(p);const x={x:Math.min(y.startPoint.x,u.x),y:Math.min(y.startPoint.y,u.y),width:Math.abs(u.x-y.startPoint.x),height:Math.abs(u.y-y.startPoint.y)},te=D(x).map(ie=>ie.id);M({...p,selectedIds:te}),s(te)},O=u=>{if(!n)return;if(u){n.style.cursor=u;return}const y=l(),p=c();y===re.DRAGGING?n.style.cursor="grabbing":y===re.SELECTING?n.style.cursor="crosshair":p&&r().includes(p)?n.style.cursor="grab":p?n.style.cursor="pointer":n.style.cursor="default"},j=()=>{const u=l();P("鼠标释放",{currentMode:u}),u===re.DRAGGING?R():u===re.SELECTING&&S(),le()},R=()=>{const u=h();if(!u||!u.isDragging&&u.currentOffset.x===0&&u.currentOffset.y===0){P("拖拽完成，无实际移动");return}u.elementIds.forEach(y=>{const p=u.startPositions.get(y);if(p&&e.onElementMove){const x={x:p.x+u.currentOffset.x,y:p.y+u.currentOffset.y};e.onElementMove(y,x),P("拖拽完成",{elementId:y,finalPosition:x})}})},S=()=>{const u=C();u&&(P("框选完成",{selectedCount:u.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(u.selectedIds))},le=()=>{o(re.IDLE),f(null),M(null),O()},Q=()=>{};Ve(()=>{document.addEventListener("mousemove",v),document.addEventListener("mouseup",j),P("统一交互层已初始化")}),tt(()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",j),P("统一交互层已清理")});const ee=()=>{const u=C();if(!u||l()!==re.SELECTING)return null;const{startPoint:y,currentPoint:p}=u;return{x:Math.min(y.x,p.x),y:Math.min(y.y,p.y),width:Math.abs(p.x-y.x),height:Math.abs(p.y-y.y)}};return(()=>{var u=Jn();u.$$click=Q,u.$$mousedown=N;var y=n;return typeof y=="function"?pt(y,u):n=u,u.style.setProperty("position","absolute"),u.style.setProperty("top","0"),u.style.setProperty("left","0"),u.style.setProperty("width","100%"),u.style.setProperty("height","100%"),u.style.setProperty("z-index","10"),u.style.setProperty("pointer-events","all"),u.style.setProperty("background","transparent"),u.style.setProperty("user-select","none"),d(u,(()=>{var p=ae(()=>!!ee());return()=>p()&&(()=>{var x=Qn();return x.style.setProperty("position","absolute"),x.style.setProperty("border","1px dashed #007acc"),x.style.setProperty("background","rgba(0, 122, 204, 0.1)"),x.style.setProperty("pointer-events","none"),k(G=>{var te=`${ee().x}px`,ie=`${ee().y}px`,fe=`${ee().width}px`,ge=`${ee().height}px`;return te!==G.e&&((G.e=te)!=null?x.style.setProperty("left",te):x.style.removeProperty("left")),ie!==G.t&&((G.t=ie)!=null?x.style.setProperty("top",ie):x.style.removeProperty("top")),fe!==G.a&&((G.a=fe)!=null?x.style.setProperty("width",fe):x.style.removeProperty("width")),ge!==G.o&&((G.o=ge)!=null?x.style.setProperty("height",ge):x.style.removeProperty("height")),G},{e:void 0,t:void 0,a:void 0,o:void 0}),x})()})(),null),d(u,(()=>{var p=ae(()=>!!e.enableDebugMode);return()=>p()&&(()=>{var x=el(),G=x.firstChild,te=G.nextSibling;te.firstChild;var ie=te.nextSibling;ie.firstChild;var fe=ie.nextSibling;return fe.firstChild,x.style.setProperty("position","fixed"),x.style.setProperty("top","10px"),x.style.setProperty("right","10px"),x.style.setProperty("padding","8px"),x.style.setProperty("background","rgba(0, 0, 0, 0.8)"),x.style.setProperty("color","white"),x.style.setProperty("font-family","monospace"),x.style.setProperty("font-size","12px"),x.style.setProperty("border-radius","4px"),x.style.setProperty("z-index","9999"),x.style.setProperty("pointer-events","none"),d(te,l,null),d(ie,()=>r().length,null),d(fe,()=>c()||"无",null),d(x,(()=>{var ge=ae(()=>{var oe;return!!((oe=h())!=null&&oe.isDragging)});return()=>ge()&&(()=>{var oe=tl(),qe=oe.firstChild,we=qe.nextSibling;return we.nextSibling,oe.style.setProperty("color","#ffeb3b"),d(oe,()=>{var lt;return(lt=h())==null?void 0:lt.elementIds.length},we),oe})()})(),null),d(x,(()=>{var ge=ae(()=>r().length>0);return()=>ge()&&(()=>{var oe=nl(),qe=oe.firstChild,we=qe.nextSibling;return we.nextSibling,oe.style.setProperty("font-size","10px"),oe.style.setProperty("color","#ccc"),d(oe,()=>r().slice(0,3).join(", "),we),d(oe,()=>r().length>3&&"...",we),oe})()})(),null),x})()})(),null),u})()};me(["mousedown","click"]);var ol=_('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),il=_("<span class=ml-2>Zoom: <!>%"),dt=_("<svg><text dominant-baseline=hanging></svg>",!1,!0,!1),rl=_("<svg><tspan></svg>",!1,!0,!1),sl=_("<svg><rect x=0 y=0></svg>",!1,!0,!1),al=_("<svg><line x1=0></svg>",!1,!0,!1),cl=_('<svg><rect x=0 y=0 fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.3)"stroke-width=1 stroke-dasharray=2,2></svg>',!1,!0,!1),dl=_("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),ul=_("<svg><g></svg>",!1,!0,!1);const fl=()=>{const{state:e,selectElement:t,clearSelection:i,createElement:n,selectMultiple:l,updateElement:o}=be();let r;const[s,c]=K([]),a=J(()=>e.elements.filter(E=>E.visible)),h=(E,I)=>{if(!r)return{x:0,y:0};const D=r.getBoundingClientRect(),N=(E-D.left)/e.canvas_config.zoom,F=(I-D.top)/e.canvas_config.zoom;return{x:N,y:F}},f=async E=>{console.log("🎯 选择元素",E),c([...E]);try{E.length===0?await i():E.length===1?await t(E[0]):await l([...E])}catch(I){console.error("❌ 选择元素失败:",I)}},C=async(E,I)=>{console.log("🚚 移动元素",E,I);try{await o(E,{position:{x:I.x,y:I.y}})}catch(D){console.error("❌ 移动元素失败:",D)}},M=async E=>{console.log("🖱️ 画布点击",E)},P=async E=>{var I;E.preventDefault();try{const D=(I=E.dataTransfer)==null?void 0:I.getData("application/json");if(!D)return;const{type:N,component:F}=JSON.parse(D);if(N==="component"){const{x:V,y:W}=h(E.clientX,E.clientY),Z=Math.max(0,V-F.default_size.width/2),L=Math.max(0,W-F.default_size.height/2);console.log("🎯 通过拖放创建组件:",F.name,"at",Z,L);const q=await n(F.id,{x:Z,y:L},F.default_size,F.create_content());console.log("✅ 通过拖放创建元素成功:",q),c([q]),await t(q)}}catch(D){console.error("拖放处理失败:",D)}};Ve(()=>{c([...e.selected_ids])}),J(()=>{c([...e.selected_ids])});const H=J(()=>{const{width:E,height:I}=e.canvas_config;return`0 0 ${E} ${I}`});return(()=>{var E=ol(),I=E.firstChild,D=I.firstChild,N=D.firstChild,F=N.nextSibling,V=F.nextSibling,W=V.nextSibling,Z=W.nextSibling,L=Z.nextSibling,q=L.firstChild,z=q.nextSibling;z.nextSibling;var m=I.nextSibling,v=m.firstChild,$=v.firstChild,A=$.firstChild,w=A.firstChild,T=w.nextSibling,O=T.nextSibling,j=O.nextSibling;d(D,()=>e.canvas_config.width,F),d(D,()=>e.canvas_config.height,W),d(D,(()=>{var S=ae(()=>e.canvas_config.zoom!==1);return()=>S()&&(()=>{var le=il(),Q=le.firstChild,ee=Q.nextSibling;return ee.nextSibling,d(le,()=>Math.round(e.canvas_config.zoom*100),ee),le})()})(),L),d(L,()=>e.elements.length,z),d(L,()=>s().length,null),$.style.setProperty("position","relative"),A.addEventListener("drop",P),A.addEventListener("dragover",S=>{S.preventDefault(),S.dataTransfer.dropEffect="copy"}),A.$$contextmenu=S=>S.preventDefault();var R=r;return typeof R=="function"?pt(R,A):r=A,d(A,g(Kn,{get config(){return e.canvas_config}}),T),d(O,g(ve,{get each(){return a()},children:S=>g(hl,{element:S,get selected(){return s().includes(S.id)}})})),d(j,g(ve,{get each(){return a().filter(S=>s().includes(S.id))},children:S=>g(Xn,{element:S})})),d($,g(ll,{canvasRef:r,getAllElements:()=>[...e.elements],onElementsSelect:f,onElementMove:C,onCanvasClick:M,get enableDebugMode(){return!1}}),null),k(S=>{var le=e.canvas_config.width*e.canvas_config.zoom,Q=e.canvas_config.height*e.canvas_config.zoom,ee=H(),u=e.canvas_config.width,y=e.canvas_config.height,p=e.canvas_config.background_color,x=e.canvas_config.width,G=e.canvas_config.height;return le!==S.e&&b(A,"width",S.e=le),Q!==S.t&&b(A,"height",S.t=Q),ee!==S.a&&b(A,"viewBox",S.a=ee),u!==S.o&&b(w,"width",S.o=u),y!==S.i&&b(w,"height",S.i=y),p!==S.n&&b(w,"fill",S.n=p),x!==S.s&&b(T,"width",S.s=x),G!==S.h&&b(T,"height",S.h=G),S},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),E})()},hl=e=>{const t=J(()=>{const{position:n}=e.element;return{transform:`translate(${n.x}px, ${n.y}px)`,opacity:e.element.visible?1:.5}}),i=()=>{const{content:n,size:l}=e.element;if(n.type==="Text"&&n.content&&n.style){const o=n.style.align,r=o==="Center"?"middle":o==="Right"?"end":"start",s=o==="Center"?l.width/2:o==="Right"?l.width:0;return(()=>{var c=dt();return b(c,"x",s),b(c,"text-anchor",r),d(c,()=>n.content.split(`
`).map((a,h)=>(()=>{var f=rl();return b(f,"x",s),d(f,a),k(()=>b(f,"dy",h===0?0:n.style.font_size*1.2)),f})())),k(a=>{var h=n.style.font_size*.75,f=n.style.font_family,C=`${n.style.font_size}`,M=n.style.font_weight,P=n.style.color;return h!==a.e&&b(c,"y",a.e=h),f!==a.t&&b(c,"font-family",a.t=f),C!==a.a&&b(c,"font-size",a.a=C),M!==a.o&&b(c,"font-weight",a.o=M),P!==a.i&&b(c,"fill",a.i=P),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c})()}if(n.type==="Rectangle"){const o=n.opacity!==void 0?n.opacity:1,r=n.corner_radius||0;return(()=>{var s=sl();return b(s,"rx",r),b(s,"ry",r),b(s,"fill-opacity",o),b(s,"stroke-opacity",o),k(c=>{var H,E,I,D;var a=l.width,h=l.height,f=n.fill_color||"transparent",C=((H=n.border)==null?void 0:H.color)||"#000000",M=((E=n.border)==null?void 0:E.width)||1,P=((I=n.border)==null?void 0:I.style)==="Dashed"?"5,5":((D=n.border)==null?void 0:D.style)==="Dotted"?"2,2":"none";return a!==c.e&&b(s,"width",c.e=a),h!==c.t&&b(s,"height",c.t=h),f!==c.a&&b(s,"fill",c.a=f),C!==c.o&&b(s,"stroke",c.o=C),M!==c.i&&b(s,"stroke-width",c.i=M),P!==c.n&&b(s,"stroke-dasharray",c.n=P),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),s})()}if(n.type==="Line"){const o=n.opacity!==void 0?n.opacity:1,r=n.line_style||"Solid",s=r==="Dashed"?"8,4":r==="Dotted"?"2,2":r==="DashDot"?"8,4,2,4":"none";return(()=>{var c=al();return b(c,"stroke-opacity",o),b(c,"stroke-dasharray",s),k(a=>{var h=l.height/2,f=l.width,C=l.height/2,M=n.color,P=n.width;return h!==a.e&&b(c,"y1",a.e=h),f!==a.t&&b(c,"x2",a.t=f),C!==a.a&&b(c,"y2",a.a=C),M!==a.o&&b(c,"stroke",a.o=M),P!==a.i&&b(c,"stroke-width",a.i=P),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c})()}return n.type==="DataField"&&n.style?[(()=>{var o=cl();return k(r=>{var s=l.width,c=l.height;return s!==r.e&&b(o,"width",r.e=s),c!==r.t&&b(o,"height",r.t=c),r},{e:void 0,t:void 0}),o})(),(()=>{var o=dt();return d(o,()=>n.expression||"[数据字段]"),k(r=>{var s=n.style.align==="Center"?l.width/2:n.style.align==="Right"?l.width-4:4,c=n.style.font_size*.8,a=n.style.font_family,h=`${n.style.font_size}`,f=n.style.font_weight,C=n.style.color,M=n.style.align==="Center"?"middle":n.style.align==="Right"?"end":"start";return s!==r.e&&b(o,"x",r.e=s),c!==r.t&&b(o,"y",r.t=c),a!==r.a&&b(o,"font-family",r.a=a),h!==r.o&&b(o,"font-size",r.o=h),f!==r.i&&b(o,"font-weight",r.i=f),C!==r.n&&b(o,"fill",r.n=C),M!==r.s&&b(o,"text-anchor",r.s=M),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),o})()]:(()=>{var o=dl();return k(r=>{var s=l.width,c=l.height;return s!==r.e&&b(o,"width",r.e=s),c!==r.t&&b(o,"height",r.t=c),r},{e:void 0,t:void 0}),o})()};return(()=>{var n=ul();return d(n,i),k(l=>{var o=`element ${e.selected?"element-selected":""}`,r=t(),s=e.element.id,c=e.element.content.type;return o!==l.e&&b(n,"class",l.e=o),l.t=Yt(n,r,l.t),s!==l.a&&b(n,"data-element-id",l.a=s),c!==l.o&&b(n,"data-element-type",l.o=c),l},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};me(["contextmenu"]);var gl=_('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),vl=_('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),yl=_('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),ml=_('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),bl=_('<div class="text-xs text-gray-500 p-2">暂无元素');const wl=()=>{const{state:e,createElement:t,selectElement:i,clearSelection:n}=be(),[l,o]=K(!1),r=[{name:"创建文字元素",action:async()=>{const h=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",h),h}},{name:"创建矩形元素",action:async()=>{const h=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",h),h}},{name:"创建线条元素",action:async()=>{const h=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",h),h}},{name:"创建数据字段",action:async()=>{const h=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",h),h}}],s=async h=>{try{console.log(`🧪 开始测试: ${h.name}`);const f=await h.action();await i(f),console.log(`✅ 测试完成: ${h.name}, 元素ID: ${f}`)}catch(f){console.error(`❌ 测试失败: ${h.name}`,f)}},c=async()=>{console.log("🚀 开始运行所有测试案例..."),await n();for(const h of r)await s(h),await new Promise(f=>setTimeout(f,500));console.log("🎉 所有测试案例运行完成!")},a=async()=>{try{console.log("🧹 清理所有测试元素..."),await n(),console.log("✅ 清理完成")}catch(h){console.error("❌ 清理失败:",h)}};return[(()=>{var h=gl();return h.$$click=()=>o(!l()),h})(),ae(()=>ae(()=>!!l())()&&(()=>{var h=vl(),f=h.firstChild,C=f.firstChild,M=C.nextSibling,P=f.nextSibling,H=P.firstChild,E=H.firstChild,I=E.firstChild,D=I.nextSibling,N=E.nextSibling,F=N.firstChild,V=F.nextSibling,W=N.nextSibling,Z=W.firstChild,L=Z.nextSibling,q=W.nextSibling,z=q.firstChild,m=z.nextSibling,v=P.nextSibling,$=v.firstChild,A=$.nextSibling,w=v.nextSibling;w.firstChild;var T=w.nextSibling,O=T.firstChild,j=O.nextSibling;return M.$$click=()=>o(!1),d(D,()=>e.elements.length),d(V,()=>e.selected_ids.length),d(L,()=>e.can_undo?"是":"否"),d(m,()=>e.can_redo?"是":"否"),$.$$click=c,A.$$click=a,d(w,g(ve,{each:r,children:R=>(()=>{var S=yl();return S.$$click=()=>s(R),d(S,()=>R.name),S})()}),null),d(j,g(ve,{get each(){return e.elements},children:R=>(()=>{var S=ml(),le=S.firstChild,Q=le.nextSibling,ee=Q.firstChild,u=ee.nextSibling;u.nextSibling;var y=Q.nextSibling,p=y.firstChild,x=p.nextSibling,G=x.nextSibling,te=G.nextSibling;return te.nextSibling,S.$$click=()=>i(R.id),d(le,()=>R.content.type),d(Q,()=>R.id.slice(0,8),u),d(y,()=>Math.round(R.position.x),x),d(y,()=>Math.round(R.position.y),te),k(()=>xe(S,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(R.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),S})()}),null),d(j,(()=>{var R=ae(()=>e.elements.length===0);return()=>R()&&bl()})(),null),h})())]};me(["click"]);var pl=_('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const xl=()=>(()=>{var e=pl(),t=e.firstChild,i=t.firstChild,n=i.nextSibling,l=n.nextSibling;return d(e,g(an,{}),t),d(i,g(un,{})),d(n,g(fl,{})),d(l,g(Fn,{})),d(e,g(wl,{}),null),e})(),_l=()=>(Ve(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),g(nn,{get children(){return g(xl,{})}})),$l=document.getElementById("root");Kt(()=>g(_l,{}),$l);
