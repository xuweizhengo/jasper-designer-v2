var Pn=Object.defineProperty;var An=(e,t,n)=>t in e?Pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var je=(e,t,n)=>An(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const zn=!1,Rn=(e,t)=>e===t,Ze=Symbol("solid-proxy"),Mt=Symbol("solid-track"),yt={equals:Rn};let tn=cn;const We=1,$t=2,nn={owned:null,cleanups:null,context:null,owner:null};var Ee=null;let Et=null,Mn=null,Le=null,Re=null,Je=null,Tt=0;function bt(e,t){const n=Le,l=Ee,i=e.length===0,s=t===void 0?l:t,a=i?nn:{owned:null,cleanups:null,context:s?s.context:null,owner:s},o=i?e:()=>e(()=>Ue(()=>dt(a)));Ee=a,Le=null;try{return it(o,!0)}finally{Le=n,Ee=l}}function ee(e,t){t=t?Object.assign({},yt,t):yt;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},l=i=>(typeof i=="function"&&(i=i(n.value)),on(n,i));return[an.bind(n),l]}function A(e,t,n){const l=qt(e,t,!1,We);ht(l)}function Ft(e,t,n){tn=Un;const l=qt(e,t,!1,We);l.user=!0,Je?Je.push(l):ht(l)}function Ce(e,t,n){n=n?Object.assign({},yt,n):yt;const l=qt(e,t,!0,0);return l.observers=null,l.observerSlots=null,l.comparator=n.equals||void 0,ht(l),an.bind(l)}function Nn(e){return it(e,!1)}function Ue(e){if(Le===null)return e();const t=Le;Le=null;try{return e()}finally{Le=t}}function qe(e){Ft(()=>Ue(e))}function lt(e){return Ee===null||(Ee.cleanups===null?Ee.cleanups=[e]:Ee.cleanups.push(e)),e}function Nt(){return Le}const[Ac,zc]=ee(!1);function ln(e,t){const n=Symbol("context");return{id:n,Provider:qn(n),defaultValue:e}}function sn(e){let t;return Ee&&Ee.context&&(t=Ee.context[e.id])!==void 0?t:e.defaultValue}function rn(e){const t=Ce(e),n=Ce(()=>Ot(t()));return n.toArray=()=>{const l=n();return Array.isArray(l)?l:l!=null?[l]:[]},n}function an(){if(this.sources&&this.state)if(this.state===We)ht(this);else{const e=Re;Re=null,it(()=>_t(this),!1),Re=e}if(Le){const e=this.observers?this.observers.length:0;Le.sources?(Le.sources.push(this),Le.sourceSlots.push(e)):(Le.sources=[this],Le.sourceSlots=[e]),this.observers?(this.observers.push(Le),this.observerSlots.push(Le.sources.length-1)):(this.observers=[Le],this.observerSlots=[Le.sources.length-1])}return this.value}function on(e,t,n){let l=e.value;return(!e.comparator||!e.comparator(l,t))&&(e.value=t,e.observers&&e.observers.length&&it(()=>{for(let i=0;i<e.observers.length;i+=1){const s=e.observers[i],a=Et&&Et.running;a&&Et.disposed.has(s),(a?!s.tState:!s.state)&&(s.pure?Re.push(s):Je.push(s),s.observers&&dn(s)),a||(s.state=We)}if(Re.length>1e6)throw Re=[],new Error},!1)),t}function ht(e){if(!e.fn)return;dt(e);const t=Tt;On(e,e.value,t)}function On(e,t,n){let l;const i=Ee,s=Le;Le=Ee=e;try{l=e.fn(t)}catch(a){return e.pure&&(e.state=We,e.owned&&e.owned.forEach(dt),e.owned=null),e.updatedAt=n+1,un(a)}finally{Le=s,Ee=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?on(e,l):e.value=l,e.updatedAt=n)}function qt(e,t,n,l=We,i){const s={fn:e,state:l,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Ee,context:Ee?Ee.context:null,pure:n};return Ee===null||Ee!==nn&&(Ee.owned?Ee.owned.push(s):Ee.owned=[s]),s}function pt(e){if(e.state===0)return;if(e.state===$t)return _t(e);if(e.suspense&&Ue(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Tt);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===We)ht(e);else if(e.state===$t){const l=Re;Re=null,it(()=>_t(e,t[0]),!1),Re=l}}function it(e,t){if(Re)return e();let n=!1;t||(Re=[]),Je?n=!0:Je=[],Tt++;try{const l=e();return In(n),l}catch(l){n||(Je=null),Re=null,un(l)}}function In(e){if(Re&&(cn(Re),Re=null),e)return;const t=Je;Je=null,t.length&&it(()=>tn(t),!1)}function cn(e){for(let t=0;t<e.length;t++)pt(e[t])}function Un(e){let t,n=0;for(t=0;t<e.length;t++){const l=e[t];l.user?e[n++]=l:pt(l)}for(t=0;t<n;t++)pt(e[t])}function _t(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const l=e.sources[n];if(l.sources){const i=l.state;i===We?l!==t&&(!l.updatedAt||l.updatedAt<Tt)&&pt(l):i===$t&&_t(l,t)}}}function dn(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=$t,n.pure?Re.push(n):Je.push(n),n.observers&&dn(n))}}function dt(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),l=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),a=n.observerSlots.pop();l<i.length&&(s.sourceSlots[a]=l,i[l]=s,n.observerSlots[l]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)dt(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)dt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Fn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function un(e,t=Ee){throw Fn(e)}function Ot(e){if(typeof e=="function"&&!e.length)return Ot(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const l=Ot(e[n]);Array.isArray(l)?t.push.apply(t,l):t.push(l)}return t}return e}function qn(e,t){return function(l){let i;return A(()=>i=Ue(()=>(Ee.context={...Ee.context,[e]:l.value},rn(()=>l.children))),void 0),i}}const Bn=Symbol("fallback");function Qt(e){for(let t=0;t<e.length;t++)e[t]()}function jn(e,t,n={}){let l=[],i=[],s=[],a=0,o=t.length>1?[]:null;return lt(()=>Qt(s)),()=>{let g=e()||[],c=g.length,b,u;return g[Mt],Ue(()=>{let f,d,y,p,$,x,k,T,E;if(c===0)a!==0&&(Qt(s),s=[],l=[],i=[],a=0,o&&(o=[])),n.fallback&&(l=[Bn],i[0]=bt(N=>(s[0]=N,n.fallback())),a=1);else if(a===0){for(i=new Array(c),u=0;u<c;u++)l[u]=g[u],i[u]=bt(v);a=c}else{for(y=new Array(c),p=new Array(c),o&&($=new Array(c)),x=0,k=Math.min(a,c);x<k&&l[x]===g[x];x++);for(k=a-1,T=c-1;k>=x&&T>=x&&l[k]===g[T];k--,T--)y[T]=i[k],p[T]=s[k],o&&($[T]=o[k]);for(f=new Map,d=new Array(T+1),u=T;u>=x;u--)E=g[u],b=f.get(E),d[u]=b===void 0?-1:b,f.set(E,u);for(b=x;b<=k;b++)E=l[b],u=f.get(E),u!==void 0&&u!==-1?(y[u]=i[b],p[u]=s[b],o&&($[u]=o[b]),u=d[u],f.set(E,u)):s[b]();for(u=x;u<c;u++)u in y?(i[u]=y[u],s[u]=p[u],o&&(o[u]=$[u],o[u](u))):i[u]=bt(v);i=i.slice(0,a=c),l=g.slice(0)}return i});function v(f){if(s[u]=f,o){const[d,y]=ee(u);return o[u]=y,t(g[u],d)}return t(g[u])}}}function h(e,t){return Ue(()=>e(t||{}))}const gn=e=>`Stale read from <${e}>.`;function ce(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Ce(jn(()=>e.each,e.children,t||void 0))}function z(e){const t=e.keyed,n=Ce(()=>e.when,void 0,void 0),l=t?n:Ce(n,void 0,{equals:(i,s)=>!i==!s});return Ce(()=>{const i=l();if(i){const s=e.children;return typeof s=="function"&&s.length>0?Ue(()=>s(t?i:()=>{if(!Ue(l))throw gn("Show");return n()})):s}return e.fallback},void 0,void 0)}function Qn(e){const t=rn(()=>e.children),n=Ce(()=>{const l=t(),i=Array.isArray(l)?l:[l];let s=()=>{};for(let a=0;a<i.length;a++){const o=a,g=i[a],c=s,b=Ce(()=>c()?void 0:g.when,void 0,void 0),u=g.keyed?b:Ce(b,void 0,{equals:(v,f)=>!v==!f});s=()=>c()||(u()?[o,b,g]:void 0)}return s});return Ce(()=>{const l=n()();if(!l)return e.fallback;const[i,s,a]=l,o=a.children;return typeof o=="function"&&o.length>0?Ue(()=>o(a.keyed?s():()=>{var c;if(((c=Ue(n)())==null?void 0:c[0])!==i)throw gn("Match");return s()})):o},void 0,void 0)}function at(e){return e}const _e=e=>Ce(()=>e());function Hn(e,t,n){let l=n.length,i=t.length,s=l,a=0,o=0,g=t[i-1].nextSibling,c=null;for(;a<i||o<s;){if(t[a]===n[o]){a++,o++;continue}for(;t[i-1]===n[s-1];)i--,s--;if(i===a){const b=s<l?o?n[o-1].nextSibling:n[s-o]:g;for(;o<s;)e.insertBefore(n[o++],b)}else if(s===o)for(;a<i;)(!c||!c.has(t[a]))&&t[a].remove(),a++;else if(t[a]===n[s-1]&&n[o]===t[i-1]){const b=t[--i].nextSibling;e.insertBefore(n[o++],t[a++].nextSibling),e.insertBefore(n[--s],b),t[i]=n[s]}else{if(!c){c=new Map;let u=o;for(;u<s;)c.set(n[u],u++)}const b=c.get(t[a]);if(b!=null)if(o<b&&b<s){let u=a,v=1,f;for(;++u<i&&u<s&&!((f=c.get(t[u]))==null||f!==b+v);)v++;if(v>b-o){const d=t[a];for(;o<b;)e.insertBefore(n[o++],d)}else e.replaceChild(n[o++],t[a++])}else a++;else t[a++].remove()}}}const Ht="_$DX_DELEGATE";function Jn(e,t,n,l={}){let i;return bt(s=>{i=s,t===document?e():r(t,e(),t.firstChild?null:void 0,n)},l.owner),()=>{i(),t.textContent=""}}function m(e,t,n,l){let i;const s=()=>{const o=l?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return o.innerHTML=e,n?o.content.firstChild.firstChild:l?o.firstChild:o.content.firstChild},a=t?()=>Ue(()=>document.importNode(i||(i=s()),!0)):()=>(i||(i=s())).cloneNode(!0);return a.cloneNode=a,a}function De(e,t=window.document){const n=t[Ht]||(t[Ht]=new Set);for(let l=0,i=e.length;l<i;l++){const s=e[l];n.has(s)||(n.add(s),t.addEventListener(s,Vn))}}function q(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function $e(e,t){t==null?e.removeAttribute("class"):e.className=t}function Te(e,t,n,l){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function hn(e,t,n){if(!t)return n?q(e,"style"):t;const l=e.style;if(typeof t=="string")return l.cssText=t;typeof n=="string"&&(l.cssText=n=void 0),n||(n={}),t||(t={});let i,s;for(s in n)t[s]==null&&l.removeProperty(s),delete n[s];for(s in t)i=t[s],i!==n[s]&&(l.setProperty(s,i),n[s]=i);return n}function Bt(e,t,n){return Ue(()=>e(t,n))}function r(e,t,n,l){if(n!==void 0&&!l&&(l=[]),typeof t!="function")return xt(e,t,l,n);A(i=>xt(e,t(),i,n),l)}function Vn(e){let t=e.target;const n=`$$${e.type}`,l=e.target,i=e.currentTarget,s=g=>Object.defineProperty(e,"target",{configurable:!0,value:g}),a=()=>{const g=t[n];if(g&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?g.call(t,c,e):g.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},o=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const g=e.composedPath();s(g[0]);for(let c=0;c<g.length-2&&(t=g[c],!!a());c++){if(t._$host){t=t._$host,o();break}if(t.parentNode===i)break}}else o();s(l)}function xt(e,t,n,l,i){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,a=l!==void 0;if(e=a&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(a){let o=n[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),n=et(e,n,l,o)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=et(e,n,l);else{if(s==="function")return A(()=>{let o=t();for(;typeof o=="function";)o=o();n=xt(e,o,n,l)}),()=>n;if(Array.isArray(t)){const o=[],g=n&&Array.isArray(n);if(It(o,t,n,i))return A(()=>n=xt(e,o,n,l,!0)),()=>n;if(o.length===0){if(n=et(e,n,l),a)return n}else g?n.length===0?Jt(e,o,l):Hn(e,n,o):(n&&et(e),Jt(e,o));n=o}else if(t.nodeType){if(Array.isArray(n)){if(a)return n=et(e,n,l,t);et(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function It(e,t,n,l){let i=!1;for(let s=0,a=t.length;s<a;s++){let o=t[s],g=n&&n[e.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))i=It(e,o,g)||i;else if(c==="function")if(l){for(;typeof o=="function";)o=o();i=It(e,Array.isArray(o)?o:[o],Array.isArray(g)?g:[g])||i}else e.push(o),i=!0;else{const b=String(o);g&&g.nodeType===3&&g.data===b?e.push(g):e.push(document.createTextNode(b))}}return i}function Jt(e,t,n=null){for(let l=0,i=t.length;l<i;l++)e.insertBefore(t[l],n)}function et(e,t,n,l){if(n===void 0)return e.textContent="";const i=l||document.createTextNode("");if(t.length){let s=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(i!==o){const g=o.parentNode===e;!s&&!a?g?e.replaceChild(i,o):e.insertBefore(i,n):g&&o.remove()}else s=!0}}else e.insertBefore(i,n);return[i]}var Wn=m("<div class=preview-toggle-container><div class=current-mode-indicator><span class=mode-icon></span><span class=mode-text></span></div><div class=mode-toggle-group>"),Gn=m("<span class=loading-indicator>â³"),Kn=m("<button><span class=button-icon></span><span class=button-text>"),Yn=m("<span class=coming-soon>æ•¬è¯·æœŸå¾…"),Xn=m("<div class=error-indicator>âŒ");const vn=ln(),Zn=e=>{const[t,n]=ee({mode:"design",loading:!1,error:void 0}),l=u=>{n(v=>({...v,mode:u,error:void 0})),console.log(`ğŸ¯ é¢„è§ˆæ¨¡å¼åˆ‡æ¢: ${u==="design"?"è®¾è®¡æ¨¡å¼":"é¢„è§ˆæ¨¡å¼"}`),window.dispatchEvent(new CustomEvent("preview-mode-changed",{detail:{mode:u,timestamp:Date.now()}}))},b={state:t,actions:{setMode:l,toggleMode:()=>{const u=t().mode;l(u==="design"?"data":u==="data"?"preview":"design")},setLoading:u=>{n(v=>({...v,loading:u}))},setError:u=>{n(v=>({...v,error:u,loading:!1}))},isDesignMode:()=>t().mode==="design",isDataMode:()=>t().mode==="data",isPreviewMode:()=>t().mode==="preview"}};return h(vn.Provider,{value:b,get children(){return e.children}})},fn=()=>{const e=sn(vn);if(!e)throw new Error("usePreviewå¿…é¡»åœ¨PreviewProviderå†…ä½¿ç”¨");return e},el=()=>{const{state:e,actions:t}=fn(),n=i=>({design:{icon:"ğŸ¨",text:"è®¾è®¡æ¨¡å¼",color:"blue"},data:{icon:"ğŸ”—",text:"æ•°æ®æ¨¡å¼",color:"green"},preview:{icon:"ğŸ”",text:"é¢„è§ˆæ¨¡å¼",color:"purple"}})[i],l=()=>n(e().mode);return(()=>{var i=Wn(),s=i.firstChild,a=s.firstChild,o=a.nextSibling,g=s.nextSibling;return r(a,()=>l().icon),r(o,()=>l().text),r(s,(()=>{var c=_e(()=>!!e().loading);return()=>c()&&Gn()})(),null),r(g,()=>["design","data","preview"].map(c=>{const b=n(c),u=e().mode===c,v=c==="preview";return(()=>{var f=Kn(),d=f.firstChild,y=d.nextSibling;return f.$$click=()=>{if(v){alert(`ğŸ” é¢„è§ˆæ¨¡å¼å³å°†æ¨å‡ºï¼

âœ¨ å³å°†æ”¯æŒçš„åŠŸèƒ½ï¼š
â€¢ çº¯å‡€çš„æœ€ç»ˆæ•ˆæœé¢„è§ˆ
â€¢ éšè—æ‰€æœ‰è®¾è®¡è¾…åŠ©å…ƒç´ 
â€¢ åªè¯»æ¨¡å¼ï¼Œä¸“æ³¨æŸ¥çœ‹è¾“å‡ºæ•ˆæœ`);return}t.setMode(c)},$e(f,`mode-btn ${u?"active":""} ${v?"preview-placeholder":""}`),r(d,()=>b.icon),r(y,()=>b.text),r(f,v&&Yn(),null),A(p=>{var $=e().loading,x=v?"é¢„è§ˆæ¨¡å¼ - å³å°†æ¨å‡º":`åˆ‡æ¢åˆ°${b.text}`;return $!==p.e&&(f.disabled=p.e=$),x!==p.t&&q(f,"title",p.t=x),p},{e:void 0,t:void 0}),f})()})),r(i,(()=>{var c=_e(()=>!!e().error);return()=>c()&&(()=>{var b=Xn();return A(()=>q(b,"title",e().error)),b})()})(),null),i})()},Lt={getModeDisplayText:e=>({design:"è®¾è®¡æ¨¡å¼",data:"æ•°æ®æ¨¡å¼",preview:"é¢„è§ˆæ¨¡å¼"})[e],getModeIcon:e=>({design:"ğŸ¨",data:"ğŸ”—",preview:"ğŸ”"})[e],shouldShowExpression:e=>e==="design",shouldEvaluateExpression:e=>e==="data"||e==="preview",shouldShowDesignAids:e=>e==="design"||e==="data",shouldAllowInteraction:e=>e==="design"||e==="data",isReadOnlyMode:e=>e==="preview",getModeTransitionClass:e=>`mode-${e}-active`};De(["click"]);const Ut=Symbol("store-raw"),nt=Symbol("store-node"),Qe=Symbol("store-has"),mn=Symbol("store-self");function bn(e){let t=e[Ze];if(!t&&(Object.defineProperty(e,Ze,{value:t=new Proxy(e,ll)}),!Array.isArray(e))){const n=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let i=0,s=n.length;i<s;i++){const a=n[i];l[a].get&&Object.defineProperty(e,a,{enumerable:l[a].enumerable,get:l[a].get.bind(t)})}}return t}function St(e){let t;return e!=null&&typeof e=="object"&&(e[Ze]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function ut(e,t=new Set){let n,l,i,s;if(n=e!=null&&e[Ut])return n;if(!St(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let a=0,o=e.length;a<o;a++)i=e[a],(l=ut(i,t))!==i&&(e[a]=l)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const a=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let g=0,c=a.length;g<c;g++)s=a[g],!o[s].get&&(i=e[s],(l=ut(i,t))!==i&&(e[s]=l))}return e}function wt(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function gt(e,t,n){if(e[t])return e[t];const[l,i]=ee(n,{equals:!1,internal:!0});return l.$=i,e[t]=l}function tl(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===Ze||t===nt||(delete n.value,delete n.writable,n.get=()=>e[Ze][t]),n}function yn(e){Nt()&&gt(wt(e,nt),mn)()}function nl(e){return yn(e),Reflect.ownKeys(e)}const ll={get(e,t,n){if(t===Ut)return e;if(t===Ze)return n;if(t===Mt)return yn(e),n;const l=wt(e,nt),i=l[t];let s=i?i():e[t];if(t===nt||t===Qe||t==="__proto__")return s;if(!i){const a=Object.getOwnPropertyDescriptor(e,t);Nt()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(a&&a.get)&&(s=gt(l,t,s)())}return St(s)?bn(s):s},has(e,t){return t===Ut||t===Ze||t===Mt||t===nt||t===Qe||t==="__proto__"?!0:(Nt()&&gt(wt(e,Qe),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:nl,getOwnPropertyDescriptor:tl};function Ct(e,t,n,l=!1){if(!l&&e[t]===n)return;const i=e[t],s=e.length;n===void 0?(delete e[t],e[Qe]&&e[Qe][t]&&i!==void 0&&e[Qe][t].$()):(e[t]=n,e[Qe]&&e[Qe][t]&&i===void 0&&e[Qe][t].$());let a=wt(e,nt),o;if((o=gt(a,t,i))&&o.$(()=>n),Array.isArray(e)&&e.length!==s){for(let g=e.length;g<s;g++)(o=a[g])&&o.$();(o=gt(a,"length",s))&&o.$(e.length)}(o=a[mn])&&o.$()}function $n(e,t){const n=Object.keys(t);for(let l=0;l<n.length;l+=1){const i=n[l];Ct(e,i,t[i])}}function il(e,t){if(typeof t=="function"&&(t=t(e)),t=ut(t),Array.isArray(t)){if(e===t)return;let n=0,l=t.length;for(;n<l;n++){const i=t[n];e[n]!==i&&Ct(e,n,i)}Ct(e,"length",l)}else $n(e,t)}function ct(e,t,n=[]){let l,i=e;if(t.length>1){l=t.shift();const a=typeof l,o=Array.isArray(e);if(Array.isArray(l)){for(let g=0;g<l.length;g++)ct(e,[l[g]].concat(t),n);return}else if(o&&a==="function"){for(let g=0;g<e.length;g++)l(e[g],g)&&ct(e,[g].concat(t),n);return}else if(o&&a==="object"){const{from:g=0,to:c=e.length-1,by:b=1}=l;for(let u=g;u<=c;u+=b)ct(e,[u].concat(t),n);return}else if(t.length>1){ct(e[l],t,[l].concat(n));return}i=e[l],n=[l].concat(n)}let s=t[0];typeof s=="function"&&(s=s(i,n),s===i)||l===void 0&&s==null||(s=ut(s),l===void 0||St(i)&&St(s)&&!Array.isArray(s)?$n(i,s):Ct(e,l,s))}function sl(...[e,t]){const n=ut(e||{}),l=Array.isArray(n),i=bn(n);function s(...a){Nn(()=>{l&&a.length===1?il(n,a[0]):ct(n,a)})}return[i,s]}function rl(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Vt(e,t=!1){const n=rl(),l=`_${n}`;return Object.defineProperty(window,l,{value:i=>(t&&Reflect.deleteProperty(window,l),e==null?void 0:e(i)),writable:!1,configurable:!0}),n}async function ge(e,t={}){return new Promise((n,l)=>{const i=Vt(a=>{n(a),Reflect.deleteProperty(window,`_${s}`)},!0),s=Vt(a=>{l(a),Reflect.deleteProperty(window,`_${i}`)},!0);window.__TAURI_IPC__({cmd:e,callback:i,error:s,...t})})}const pn=ln(),al=e=>{const[t,n]=sl({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[l,i]=ee(!1),[s,a]=ee(null),[o,g]=ee(!1),c=async()=>{try{i(!0),console.log("ğŸ”„ Loading app state...");const C=await ge("get_app_state");console.log("ğŸ”„ App state loaded, selected_ids:",C.selected_ids),n(C)}catch(C){console.error("Failed to load app state:",C)}finally{i(!1)}};qe(()=>{c()});const b=async(C,P,J,H={})=>{try{i(!0);const V=await ge("create_element",{request:{element_type:C,position:P,size:J,content_data:H}});return await c(),V}catch(V){throw console.error("Failed to create element:",V),V}finally{i(!1)}},u=async(C,P)=>{try{i(!0),await ge("update_element",{request:{id:C,updates:P}}),await c()}catch(J){throw console.error("Failed to update element:",J),J}finally{i(!1)}},v=async C=>{try{i(!0),await ge("batch_update_positions",{request:{updates:C}}),n(P=>{const J=P.elements.map(H=>{const V=C.find(W=>W.element_id===H.id);return V?{...H,position:V.new_position}:H});return{...P,elements:J,dirty:!0}}),console.log("ğŸš€ Optimized batch position update completed without full reload")}catch(P){throw console.error("Failed to batch update positions:",P),await c(),P}finally{i(!1)}},f=async C=>{try{i(!0),await ge("delete_element",{elementId:C}),await c()}catch(P){throw console.error("Failed to delete element:",P),P}finally{i(!1)}},d=async C=>{try{console.log("Selecting element:",C),await ge("select_element",{elementId:C}),console.log("Select command completed, reloading state..."),await c(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(P){throw console.error("Failed to select element:",P),P}},y=async C=>{try{console.log("Selecting multiple elements:",C),C.length>0?(await ge("select_multiple",{elementIds:C}),console.log("âœ… Multi-select completed for:",C.length,"elements")):await ge("clear_selection"),await c()}catch(P){throw console.error("Failed to select multiple elements:",P),P}},p=async C=>{try{console.log("Adding to selection:",C),await ge("add_to_selection",{elementId:C}),await c()}catch(P){throw console.error("Failed to add to selection:",P),P}},$=async C=>{try{console.log("Removing from selection:",C),await ge("remove_from_selection",{elementId:C}),await c()}catch(P){throw console.error("Failed to remove from selection:",P),P}},x=async C=>{try{console.log("Toggling selection:",C),await ge("toggle_selection",{elementId:C}),await c()}catch(P){throw console.error("Failed to toggle selection:",P),P}},k=async()=>{try{await ge("clear_selection"),await c()}catch(C){throw console.error("Failed to clear selection:",C),C}},T=async()=>{try{await ge("copy_selected")}catch(C){throw console.error("Failed to copy selected elements:",C),C}},O={state:t,setState:n,createElement:b,updateElement:u,batchUpdatePositions:v,deleteElement:f,selectElement:d,selectMultiple:y,addToSelection:p,removeFromSelection:$,toggleSelection:x,clearSelection:k,copySelected:T,copySelectedElements:async()=>T(),pasteElements:async(C,P)=>{try{i(!0);const J=await ge("paste_elements",{offsetX:C,offsetY:P});return await c(),J}catch(J){throw console.error("Failed to paste elements:",J),J}finally{i(!1)}},deleteElements:async C=>{try{i(!0);for(const P of C)await ge("delete_element",{elementId:P});await c()}catch(P){throw console.error("Failed to delete elements:",P),P}finally{i(!1)}},selectAllElements:async()=>{try{const C=t.elements.map(P=>P.id);await y(C)}catch(C){throw console.error("Failed to select all elements:",C),C}},moveElements:async(C,P,J)=>{try{i(!0);const H=t.elements.filter(V=>C.includes(V.id)).map(V=>({element_id:V.id,new_position:{x:V.position.x+P,y:V.position.y+J}}));H.length>0&&await v(H)}catch(H){throw console.error("Failed to move elements:",H),H}finally{i(!1)}},undo:async()=>{try{i(!0),await ge("undo"),await c()}catch(C){throw console.error("Failed to undo:",C),C}finally{i(!1)}},redo:async()=>{try{i(!0),await ge("redo"),await c()}catch(C){throw console.error("Failed to redo:",C),C}finally{i(!1)}},updateCanvasConfig:async C=>{try{i(!0),await ge("update_canvas_config",{request:C}),await c()}catch(P){throw console.error("Failed to update canvas config:",P),P}finally{i(!1)}},getElementsAtPoint:async(C,P)=>{try{return await ge("get_elements_at_point",{x:C,y:P})}catch(J){return console.error("Failed to get elements at point:",J),[]}},isLoading:l,setLoading:i,dragOperation:s,setDragOperation:a,resizeOperation:o,setResizeOperation:g};return h(pn.Provider,{value:O,get children(){return e.children}})},Ge=()=>{const e=sn(pn);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};async function _n(e){return ge("tauri",e)}async function ol(e={}){return typeof e=="object"&&Object.freeze(e),_n({__tauriModule:"Dialog",message:{cmd:"openDialog",options:e}})}async function cl(e={}){return typeof e=="object"&&Object.freeze(e),_n({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:e}})}class Dt{static async loadTemplate(t){return await ge("load_jasper_template",{filePath:t})}static async saveTemplate(t,n){await ge("save_jasper_template",{template:t,filePath:n})}static async saveTemplateAs(t,n,l){await ge("save_template_as",{template:t,filePath:n,format:l})}static async validateTemplate(t){return await ge("validate_template",{template:t})}static async createEmptyTemplate(){return await ge("create_empty_template")}static async getTemplateInfo(t){return await ge("get_template_info",{filePath:t})}static async detectTemplateFormat(t){return await ge("detect_template_format",{filePath:t})}static async generateTemplatePreview(t){return await ge("generate_template_preview",{template:t})}static async exportTemplateJson(t){return await ge("export_template_json",{template:t})}static async importTemplateJson(t){return await ge("import_template_json",{jsonData:t})}static async cloneTemplate(t){return await ge("clone_template",{template:t})}static async mergeTemplates(t,n){return await ge("merge_templates",{baseTemplate:t,overlayTemplate:n})}static async extractTemplateElements(t,n){return await ge("extract_template_elements",{template:t,elementIds:n})}}const dl="modulepreload",ul=function(e){return"/"+e},Wt={},gl=function(t,n,l){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(n.map(g=>{if(g=ul(g),g in Wt)return;Wt[g]=!0;const c=g.endsWith(".css"),b=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${b}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":dl,c||(u.as="script"),u.crossOrigin="",u.href=g,o&&u.setAttribute("nonce",o),document.head.appendChild(u),c)return new Promise((v,f)=>{u.addEventListener("load",v),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${g}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},hl=()=>({metadata:{version:"2.0.0",format_version:"1.0.0",created_at:new Date().toISOString(),last_modified:new Date().toISOString(),created_by:"jasper-designer-v2",tags:[],compatibility:{min_jasper_version:"2.0.0",jasperreports_version:"6.20.0"}},canvas:{width:595,height:842,unit:"pt",orientation:"portrait",margins:{top:20,bottom:20,left:20,right:20},grid:{enabled:!0,size:10,snap:!0,visible:!0},background:{color:"#ffffff"}},data_sources:[],elements:[],parameters:[],variables:[],groups:[]});class Pt{static toJasperTemplate(t,n){const l={...hl()},i={...l.metadata,...n,last_modified:new Date().toISOString()},s=this.convertCanvasConfig(t.canvas_config),a=t.elements.map(o=>this.convertReportElementToTemplateElement(o));return{...l,metadata:i,canvas:s,elements:a}}static convertCanvasConfig(t){return{width:t.width,height:t.height,unit:"pt",orientation:t.width>t.height?"landscape":"portrait",margins:{top:20,bottom:20,left:20,right:20},grid:{enabled:t.show_grid,size:t.grid_size,snap:t.snap_to_grid,visible:t.show_grid},background:{color:t.background_color}}}static convertReportElementToTemplateElement(t){const n=this.getElementType(t.content),l=this.convertElementContent(t.content),i=this.convertElementStyle(t.content);return{id:t.id,element_type:n,position:{x:t.position.x,y:t.position.y},size:{width:t.size.width,height:t.size.height},z_index:t.z_index,visible:t.visible,content:l,style:i,data_binding:this.extractDataBinding(t.content)}}static getElementType(t){switch(t.type){case"Text":return"Text";case"DataField":return"DataField";case"Rectangle":return"Rectangle";case"Line":return"Line";case"Image":return"Image";default:return"Text"}}static convertElementContent(t){switch(t.type){case"Text":return{text:t.content,font:this.convertTextStyleToFont(t.style),alignment:this.convertTextStyleToAlignment(t.style),color:t.style.color};case"DataField":return{expression:t.expression,format:t.format,font:this.convertTextStyleToFont(t.style),alignment:this.convertTextStyleToAlignment(t.style),color:t.style.color};case"Rectangle":return{color:t.fill_color};case"Line":return{color:t.color};case"Image":return{expression:t.src,text:t.alt};default:return{}}}static convertTextStyleToFont(t){return{family:t.font_family||"Arial",size:t.font_size||12,weight:this.mapFontWeight(t.font_weight),style:"normal"}}static convertTextStyleToAlignment(t){return{horizontal:this.mapTextAlign(t.align),vertical:"middle"}}static convertElementStyle(t){const n={};switch(t.type){case"Rectangle":t.fill_color&&(n.background={color:t.fill_color}),t.border&&(n.border={width:t.border.width,color:t.border.color,style:this.mapBorderStyle(t.border.style)});break;case"Text":case"DataField":t.style.background&&(n.background={color:t.style.background.color}),t.style.border&&(n.border={width:t.style.border.width,color:t.style.border.color,style:this.mapBorderStyle(t.style.border.style)});break}return n}static extractDataBinding(t){if(t.type==="DataField"&&t.data_source_id)return{source_id:t.data_source_id,field_name:this.extractFieldNameFromExpression(t.expression)}}static extractFieldNameFromExpression(t){var l;const n=t.match(/^\{([^}]+)\}$/);return(l=n==null?void 0:n[1])!=null?l:t}static toAppState(t){const n=t.metadata.description||void 0;return{elements:t.elements.map(l=>this.convertTemplateElementToReportElement(l)),canvas_config:this.convertCanvasToCanvasConfig(t.canvas),selected_ids:[],can_undo:!1,can_redo:!1,dirty:!1,...n&&{template_name:n}}}static convertCanvasToCanvasConfig(t){return{width:t.width,height:t.height,zoom:1,offset_x:0,offset_y:0,show_grid:t.grid.enabled,show_rulers:!0,grid_size:t.grid.size,snap_to_grid:t.grid.snap,background_color:t.background.color}}static convertTemplateElementToReportElement(t){const n=this.convertTemplateContentToElementContent(t);return{id:t.id,position:{x:t.position.x,y:t.position.y},size:{width:t.size.width,height:t.size.height},content:n,z_index:t.z_index,visible:t.visible,locked:!1}}static convertTemplateContentToElementContent(t){var n,l,i,s,a,o;switch(t.element_type){case"Text":return{type:"Text",content:t.content.text||"",style:this.convertTemplateStyleToTextStyle(t)};case"DataField":return{type:"DataField",expression:t.content.expression||"{data}",...t.content.format&&{format:t.content.format},style:this.convertTemplateStyleToTextStyle(t),...((n=t.data_binding)==null?void 0:n.source_id)&&{data_source_id:t.data_binding.source_id}};case"Rectangle":return{type:"Rectangle",...((i=(l=t.style)==null?void 0:l.background)==null?void 0:i.color)&&{fill_color:t.style.background.color},...t.content.color&&!((a=(s=t.style)==null?void 0:s.background)!=null&&a.color)&&{fill_color:t.content.color},...((o=t.style)==null?void 0:o.border)&&{border:{color:t.style.border.color,width:t.style.border.width,style:this.mapTemplateBorderStyle(t.style.border.style)}},corner_radius:0,opacity:1};case"Line":return{type:"Line",color:t.content.color||"#000000",width:1,line_style:"Solid",opacity:1};case"Image":return{type:"Image",src:t.content.expression||"",...t.content.text&&{alt:t.content.text}};default:return{type:"Text",content:"Unknown Element",style:this.createDefaultTextStyle()}}}static convertTemplateStyleToTextStyle(t){const n=t.content.font,l=t.content.alignment,i=t.style;return{font_family:(n==null?void 0:n.family)||"Arial",font_size:(n==null?void 0:n.size)||12,font_weight:this.mapTemplateFont(n==null?void 0:n.weight),color:t.content.color||"#000000",align:this.mapTemplateAlignment(l==null?void 0:l.horizontal),background:i!=null&&i.background?{color:i.background.color||"",opacity:1,padding:0}:void 0,border:i!=null&&i.border?{color:i.border.color,width:i.border.width,style:this.mapTemplateBorderStyle(i.border.style),radius:0}:void 0}}static createDefaultTextStyle(){return{font_family:"Arial",font_size:12,font_weight:"normal",color:"#000000",align:"Left"}}static mapFontWeight(t){switch(t){case"bold":return"bold";case"light":return"light";default:return"normal"}}static mapTemplateFont(t){switch(t){case"bold":return"bold";case"light":return"light";default:return"normal"}}static mapTextAlign(t){switch(t){case"Center":return"center";case"Right":return"right";default:return"left"}}static mapTemplateAlignment(t){switch(t){case"center":return"Center";case"right":return"Right";default:return"Left"}}static mapBorderStyle(t){switch(t){case"Dashed":return"dashed";case"Dotted":return"dotted";default:return"solid"}}static mapTemplateBorderStyle(t){switch(t){case"dashed":return"Dashed";case"dotted":return"Dotted";default:return"Solid"}}}var vl=m("<span class=text-warning>â—"),fl=m("<span class=ml-2> ä¸ªå…ƒç´ "),ml=m('<span class="ml-2 text-primary">å·²é€‰æ‹© <!> ä¸ª'),bl=m('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="æ–°å»ºæ¨¡æ¿ (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>æ–°å»º</span></button><button class=toolbar-btn title="æ‰“å¼€æ¨¡æ¿ (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>æ‰“å¼€</span></button><button class=toolbar-btn title="ä¿å­˜æ¨¡æ¿ (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>ä¿å­˜</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=æ•°æ®æºç®¡ç†><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg><span>æ•°æ®æº</span></button><button class="toolbar-btn opacity-50 cursor-not-allowed"title="è¾“å‡ºé¢„è§ˆ - å³å°†æ¨å‡º (PDF/æ‰“å°é¢„è§ˆåŠŸèƒ½)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>è¾“å‡ºé¢„è§ˆ</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="ç¼©å° (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>é€‚åº”çª—å£</option></select><button class=toolbar-btn-icon title="æ”¾å¤§ (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="æ˜¾ç¤ºç½‘æ ¼ (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="æ˜¾ç¤ºæ ‡å°º (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="å¼€å¯/å…³é—­å¼€å‘è€…å·¥å…· (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const yl=e=>{const{state:t,undo:n,redo:l,updateCanvasConfig:i,setState:s}=Ge(),[a,o]=ee(t.canvas_config.zoom*100),g=async()=>{try{const $=await Dt.createEmptyTemplate(),x=Pt.toAppState($);s(x),console.log("âœ… æ–°å»ºæ¨¡æ¿æˆåŠŸ")}catch($){console.error("âŒ æ–°å»ºæ¨¡æ¿å¤±è´¥:",$),alert("æ–°å»ºæ¨¡æ¿å¤±è´¥")}},c=async()=>{try{const $=await ol({title:"æ‰“å¼€æ¨¡æ¿æ–‡ä»¶",filters:[{name:"Jasperæ¨¡æ¿",extensions:["jasper","jbin","jrxml"]}],multiple:!1});if($&&typeof $=="string"){const x=await Dt.loadTemplate($),k=Pt.toAppState(x);s({...k,template_name:x.metadata.description||"æœªå‘½åæ¨¡æ¿"}),console.log("âœ… æ¨¡æ¿åŠ è½½æˆåŠŸ:",$)}}catch($){console.error("âŒ åŠ è½½æ¨¡æ¿å¤±è´¥:",$),alert("åŠ è½½æ¨¡æ¿å¤±è´¥")}},b=async()=>{try{const $=await cl({title:"ä¿å­˜æ¨¡æ¿æ–‡ä»¶",filters:[{name:"Jasperæ¨¡æ¿",extensions:["jasper"]}],defaultPath:t.template_name||"æœªå‘½åæ¨¡æ¿"});if($){const x=Pt.toJasperTemplate(t,{description:t.template_name||"æœªå‘½åæ¨¡æ¿"});await Dt.saveTemplate(x,$),console.log("âœ… æ¨¡æ¿ä¿å­˜æˆåŠŸ:",$)}}catch($){console.error("âŒ ä¿å­˜æ¨¡æ¿å¤±è´¥:",$),alert("ä¿å­˜æ¨¡æ¿å¤±è´¥")}},u=async $=>{const x=$/100;o($);try{await i({zoom:x})}catch(k){console.error("Failed to update zoom:",k)}},v=()=>{const $=Math.min(a()+25,500);u($)},f=()=>{const $=Math.max(a()-25,25);u($)},d=async()=>{try{await i({show_grid:!t.canvas_config.show_grid})}catch($){console.error("Failed to toggle grid:",$)}},y=async()=>{try{await i({show_rulers:!t.canvas_config.show_rulers})}catch($){console.error("Failed to toggle rulers:",$)}},p=async()=>{try{await ge("toggle_devtools"),console.log("ğŸ”§ DevTools toggled")}catch($){console.error("Failed to toggle DevTools:",$)}};return(()=>{var $=bl(),x=$.firstChild,k=x.firstChild,T=k.nextSibling,E=T.nextSibling,N=E.nextSibling,M=N.nextSibling,B=M.nextSibling,j=x.nextSibling,L=j.firstChild,D=L.nextSibling,_=D.nextSibling,Q=_.nextSibling,O=Q.nextSibling,C=O.nextSibling,P=C.nextSibling,J=P.nextSibling,H=J.nextSibling,V=H.nextSibling,W=V.nextSibling,G=j.nextSibling,U=G.firstChild;return k.$$click=g,T.$$click=c,E.$$click=b,r(x,h(el,{}),M),M.$$click=()=>{console.log("ğŸ”„ æ•°æ®æºæŒ‰é’®è¢«ç‚¹å‡»ï¼"),e.onOpenDataSources()},B.$$click=()=>{alert(`ğŸ“„ è¾“å‡ºé¢„è§ˆå³å°†æ¨å‡ºï¼

âœ¨ å³å°†æ”¯æŒçš„åŠŸèƒ½ï¼š
â€¢ PDFæ ¼å¼é¢„è§ˆ
â€¢ æ‰“å°æ•ˆæœé¢„è§ˆ
â€¢ åˆ†é¡µæ˜¾ç¤º
â€¢ å¯¼å‡ºè®¾ç½®`)},B.disabled=!0,Te(L,"click",n),Te(D,"click",l),Q.$$click=f,O.addEventListener("change",F=>{const de=F.target.value;if(de==="fit")console.log("Fit to window");else{const pe=parseInt(de.replace("%",""));u(pe)}}),C.$$click=v,J.$$click=d,H.$$click=y,W.$$click=p,r(G,h(z,{get when(){return t.dirty},get children(){return vl()}}),U),r(U,()=>t.template_name||"æœªå‘½åæ¨¡æ¿"),r(G,h(z,{get when(){return t.elements.length>0},get children(){var F=fl(),de=F.firstChild;return r(F,()=>t.elements.length,de),F}}),null),r(G,h(z,{get when(){return t.selected_ids.length>0},get children(){var F=ml(),de=F.firstChild,pe=de.nextSibling;return pe.nextSibling,r(F,()=>t.selected_ids.length,pe),F}}),null),A(F=>{var de=`toolbar-btn-icon ${t.can_undo?"":"opacity-50 cursor-not-allowed"}`,pe=!t.can_undo,ae=`æ’¤é”€${t.undo_description?` (${t.undo_description})`:""} (Ctrl+Z)`,ne=`toolbar-btn-icon ${t.can_redo?"":"opacity-50 cursor-not-allowed"}`,te=!t.can_redo,le=`é‡åš${t.redo_description?` (${t.redo_description})`:""} (Ctrl+Y)`,re=`toolbar-btn-icon ${t.canvas_config.show_grid?"active":""}`,Y=`toolbar-btn-icon ${t.canvas_config.show_rulers?"active":""}`;return de!==F.e&&$e(L,F.e=de),pe!==F.t&&(L.disabled=F.t=pe),ae!==F.a&&q(L,"title",F.a=ae),ne!==F.o&&$e(D,F.o=ne),te!==F.i&&(D.disabled=F.i=te),le!==F.n&&q(D,"title",F.n=le),re!==F.s&&$e(J,F.s=re),Y!==F.h&&$e(H,F.h=Y),F},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),A(()=>O.value=`${Math.round(a())}%`),$})()};De(["click"]);var $l=m('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">ç»„ä»¶åº“</h2><input type=text placeholder=æœç´¢ç»„ä»¶... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">åŸºç¡€ç»„ä»¶</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">æ•°æ®ç»„ä»¶</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">é“¶è¡Œç»„ä»¶</h3><div class="grid grid-cols-2 gap-2">'),pl=m('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const _l=()=>{const{createElement:e}=Ge(),[t,n]=ee(""),l=[{id:"text",name:"æ–‡å­—",category:"basic",icon:"ğŸ“",description:"é™æ€æ–‡å­—æ ‡ç­¾",default_size:{width:100,height:24},create_content:c=>({type:"Text",content:(c==null?void 0:c.text)||"æ–‡å­—å†…å®¹",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"æ•°æ®å­—æ®µ",category:"data",icon:"ğŸ”—",description:"åŠ¨æ€æ•°æ®å­—æ®µ",default_size:{width:120,height:24},create_content:c=>({type:"DataField",expression:(c==null?void 0:c.expression)||"${fieldName}",format:c==null?void 0:c.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"çŸ©å½¢",category:"basic",icon:"â–­",description:"çŸ©å½¢æ¡†æ¶",default_size:{width:100,height:60},create_content:c=>({type:"Rectangle",fill_color:(c==null?void 0:c.fill_color)||"transparent",border:{color:(c==null?void 0:c.border_color)||"#000000",width:(c==null?void 0:c.border_width)||1,style:"Solid"}})},{id:"line",name:"çº¿æ¡",category:"basic",icon:"â”",description:"åˆ†éš”çº¿",default_size:{width:200,height:2},create_content:c=>({type:"Line",color:(c==null?void 0:c.color)||"#000000",width:(c==null?void 0:c.width)||1})},{id:"image",name:"å›¾ç‰‡",category:"basic",icon:"ğŸ–¼ï¸",description:"å›¾ç‰‡å ä½ç¬¦",default_size:{width:100,height:80},create_content:c=>({type:"Image",src:(c==null?void 0:c.src)||"",alt:(c==null?void 0:c.alt)||"å›¾ç‰‡"})}],i=[{id:"bank_header",name:"é“¶è¡ŒæŠ¬å¤´",category:"bank",icon:"ğŸ¦",description:"é“¶è¡Œæ ‡é¢˜å’ŒLogoåŒºåŸŸ",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"ä¸­å›½å·¥å•†é“¶è¡Œç”µå­å›å•",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"é‡‘é¢å­—æ®µ",category:"bank",icon:"ğŸ’°",description:"æ ¼å¼åŒ–é‡‘é¢æ˜¾ç¤º",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"å®¢æˆ·ä¿¡æ¯",category:"bank",icon:"ğŸ‘¤",description:"å®¢æˆ·å§“åå’Œè´¦å·",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],s=[...l,...i],a=()=>{const c=t().toLowerCase();return c?s.filter(b=>b.name.toLowerCase().includes(c)||b.description.toLowerCase().includes(c)):s},o=(c,b)=>{if(console.log("Starting drag for component:",c.id),b.dataTransfer){b.dataTransfer.effectAllowed="copy",b.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:c}));const u=document.createElement("div");u.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${c.icon} ${c.name}
        </div>
      `,u.style.position="absolute",u.style.top="-1000px",document.body.appendChild(u),b.dataTransfer.setDragImage(u,50,20),setTimeout(()=>{document.body.removeChild(u)},0)}},g=async c=>{try{const b=await e(c.id,{x:100,y:100},c.default_size,c.create_content());console.log("Created element:",b)}catch(b){console.error("Failed to create element:",b)}};return(()=>{var c=$l(),b=c.firstChild,u=b.firstChild,v=u.nextSibling,f=b.nextSibling,d=f.firstChild,y=d.firstChild,p=y.firstChild,$=p.nextSibling,x=y.nextSibling,k=x.firstChild,T=k.nextSibling,E=x.nextSibling,N=E.firstChild,M=N.nextSibling;return v.$$input=B=>n(B.target.value),r($,h(ce,{get each(){return a().filter(B=>B.category==="basic")},children:B=>h(At,{component:B,onDrag:j=>o(B,j),onClick:()=>g(B)})})),r(T,h(ce,{get each(){return a().filter(B=>B.category==="data")},children:B=>h(At,{component:B,onDrag:j=>o(B,j),onClick:()=>g(B)})})),r(M,h(ce,{get each(){return a().filter(B=>B.category==="bank")},children:B=>h(At,{component:B,onDrag:j=>o(B,j),onClick:()=>g(B)})})),A(()=>v.value=t()),c})()},At=e=>(()=>{var t=pl(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return Te(t,"click",e.onClick),t.addEventListener("dragstart",s=>e.onDrag(s)),q(t,"draggable",!0),r(l,()=>e.component.icon),r(i,()=>e.component.name),A(()=>q(t,"title",e.component.description)),t})();De(["input","click"]);class we{static async listDataSources(){return ge("list_data_sources")}static async deleteDataSource(t){return ge("delete_data_source",{source_id:t})}static async updateConfig(t,n){return ge("update_data_source_config",{source_id:t,config:n})}static async queryDataSource(t,n){return ge("query_data_source",{source_id:t,query:n})}static async getDataPreview(t,n){return ge("get_data_preview",{source_id:t,limit:n})}static async testConnection(t,n){return ge("test_data_source_connection",{provider_type:t,config:n})}static async discoverSchema(t,n){return ge("discover_schema",{provider_type:t,config:n})}static async testDatabaseConnection(t){return ge("test_database_connection",{config:t})}static async loadDatabaseSchema(t){return ge("load_database_schema",{config:t})}static async executeDatabasePreview(t,n,l){return ge("execute_database_preview",{config:t,sql:n,limit:l})}static async validateSqlSyntax(t,n){if(console.log("ğŸ” éªŒè¯SQLè¯­æ³• - å‚æ•°:",{sql:t.length+" å­—ç¬¦",databaseType:n}),!t||t.trim().length===0)throw new Error("SQLä¸èƒ½ä¸ºç©º");if(!n)throw console.error("âŒ databaseTypeå‚æ•°ä¸ºç©ºæˆ–æœªå®šä¹‰:",n),new Error("æ•°æ®åº“ç±»å‹ä¸èƒ½ä¸ºç©º");try{const l={sql:t,databaseType:n};return console.log("ğŸ” å°†ä¼ é€’ç»™Rustçš„å‚æ•°:",l),console.log("ğŸ” å‚æ•°å¯¹è±¡çš„é”®:",Object.keys(l)),console.log("ğŸ” å‚æ•°JSON:",JSON.stringify(l)),await ge("validate_sql_syntax",l)}catch(l){console.error("âŒ è°ƒç”¨å¤±è´¥:",l),console.log("ğŸ”„ å°è¯•ä½¿ç”¨database_typeé”®å...");try{return await ge("validate_sql_syntax",{sql:t,database_type:n})}catch(i){throw console.error("âŒ å®¹é”™è°ƒç”¨ä¹Ÿå¤±è´¥:",i),i}}}static async formatSql(t,n){return ge("format_sql",{sql:t,databaseType:n})}static async saveDataSource(t){var n,l;try{const i=t.config;console.log("ğŸ” saveDataSource è¯·æ±‚å‚æ•°:",{name:t.name,selected_tables:t.selected_tables,selected_tables_type:typeof t.selected_tables,selected_tables_length:(n=t.selected_tables)==null?void 0:n.length,sql_length:(l=t.sql)==null?void 0:l.length});const s=t.selected_tables||[];console.log("ğŸ” å®é™…ä¼ é€’çš„ selectedTables:",s);const a=await ge("create_database_source",{name:t.name,description:t.description||null,databaseType:i.database_type,host:i.host,port:i.port,database:i.database,username:i.username,password:i.password||null,sql:t.sql,selectedTables:s,tags:t.tags?t.tags:null});return{success:!0,data_source_id:String(a),message:`æ•°æ®æº "${t.name}" åˆ›å»ºæˆåŠŸ`,warnings:[],errors:[]}}catch(i){return{success:!1,data_source_id:"",message:`ä¿å­˜æ•°æ®æºå¤±è´¥: ${i}`,warnings:[],errors:[String(i)]}}}static async createDataSource(t,n,l){return ge("create_data_source",{name:t,provider_type:n,config:l})}static async getPreview(t,n,l){return this.getDataPreview(t,l)}static async queryData(t,n){return this.queryDataSource(t,n||{})}static async evaluateExpression(t,n,l){return ge("evaluate_expression",{source_id:t,expression:n,context:l})}static async getAvailableTypes(){return ge("get_available_data_source_types")}static async getSchema(t){return ge("get_data_source_schema",{source_id:t})}static async getConfigSchema(t){return ge("get_config_schema",{provider_type:t})}static async getDefaultConfig(t){return ge("get_default_config",{provider_type:t})}static async validateConfig(t,n){return ge("validate_config",{provider_type:t,config:n})}static async captureDataPreview(t,n){return this.executeDatabasePreview(t,n,50)}static async validateDataSourceBeforeSave(t){try{console.log("ğŸ” å¼€å§‹éªŒè¯æ•°æ®æºä¿å­˜å‰æ£€æŸ¥"),console.log("ğŸ” è¯·æ±‚é…ç½®:",t.config),console.log("ğŸ” æ•°æ®åº“ç±»å‹:",t.config.database_type);const n=await this.testDatabaseConnection(t.config),l=await this.validateSqlSyntax(t.sql,t.config.database_type),i=await this.performSecurityCheck(t.config,t.sql);return{connection_valid:n.success,sql_valid:l.valid,security_passed:i.is_safe,performance_acceptable:!0,warnings:[...l.warnings||[],...i.warnings||[]],errors:[]}}catch(n){return{connection_valid:!1,sql_valid:!1,security_passed:!1,performance_acceptable:!1,warnings:[],errors:[String(n)]}}}static async performSecurityCheck(t,n){const l=[],i=[],s=[/drop\s+table/i,/truncate\s+table/i,/delete\s+from/i,/update\s+.*set/i,/insert\s+into/i,/alter\s+table/i];for(const a of s)if(a.test(n)){l.push("åŒ…å«å¯èƒ½å±é™©çš„SQLæ“ä½œ");break}return{is_safe:l.length===0,security_issues:l,warnings:i}}}class xl{constructor(){je(this,"styles",new Map);je(this,"elementStyleMap",new Map);je(this,"observers",new Set);je(this,"initialized",!1);console.log("ğŸ¨ TextStyleManager åˆå§‹åŒ–ä¸­...")}async initialize(){if(!this.initialized)try{await this.loadSystemStyles(),await this.loadUserStyles(),this.initialized=!0,console.log(`âœ… TextStyleManager åˆå§‹åŒ–å®Œæˆï¼ŒåŠ è½½äº† ${this.styles.size} ä¸ªæ ·å¼`)}catch(t){throw console.error("âŒ TextStyleManager åˆå§‹åŒ–å¤±è´¥:",t),t}}createStyle(t){const n=`style_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l={...t,id:n,metadata:{createdAt:new Date,lastModified:new Date,author:"user",usageCount:0,isSystemStyle:!1,tags:[]}};return this.styles.set(n,l),this.notifyObservers("style-created",n),this.saveUserStyles(),console.log(`ğŸ¨ åˆ›å»ºæ–°æ ·å¼: ${l.name} (${n})`),n}getStyle(t){return this.styles.get(t)||null}updateStyle(t,n){const l=this.styles.get(t);if(!l)return console.warn(`âš ï¸ æ ·å¼ ${t} ä¸å­˜åœ¨`),!1;if(l.metadata.isSystemStyle)return console.warn(`âš ï¸ æ— æ³•ä¿®æ”¹ç³»ç»Ÿé¢„è®¾æ ·å¼ ${t}`),!1;const i={...l,style:{...l.style,...n},metadata:{...l.metadata,lastModified:new Date}};return this.styles.set(t,i),this.syncAllStyleInstances(t),this.saveUserStyles(),this.notifyObservers("style-updated",t),console.log(`ğŸ”„ æ ·å¼å·²æ›´æ–°: ${l.name} (${t})`),!0}deleteStyle(t){const n=this.styles.get(t);if(!n)return!1;if(n.metadata.isSystemStyle)return console.warn(`âš ï¸ æ— æ³•åˆ é™¤ç³»ç»Ÿé¢„è®¾æ ·å¼ ${t}`),!1;const l=Array.from(this.elementStyleMap.entries()).filter(([i,s])=>s===t).map(([i,s])=>i);return l.length>0?(console.warn(`âš ï¸ æ— æ³•åˆ é™¤æ ·å¼ ${t}ï¼Œä»æœ‰ ${l.length} ä¸ªå…ƒç´ åœ¨ä½¿ç”¨`),!1):(this.styles.delete(t),this.saveUserStyles(),this.notifyObservers("style-deleted",t),console.log(`ğŸ—‘ï¸ æ ·å¼å·²åˆ é™¤: ${n.name} (${t})`),!0)}applyStyleToElement(t,n){const l=this.styles.get(n);if(!l)return{success:!1,elementId:t,styleId:n,appliedAt:new Date,error:`æ ·å¼ ${n} ä¸å­˜åœ¨`};try{const i=this.elementStyleMap.get(t);if(this.elementStyleMap.set(t,n),l.metadata.usageCount++,i&&i!==n){const s=this.styles.get(i);s&&(s.metadata.usageCount=Math.max(0,s.metadata.usageCount-1))}return this.applyStyleToDOM(t,l.style),this.notifyObservers("style-applied",{elementId:t,styleId:n}),console.log(`ğŸ¯ åº”ç”¨æ ·å¼: ${l.name} â†’ å…ƒç´  ${t}`),{success:!0,elementId:t,styleId:n,appliedAt:new Date}}catch(i){return console.error(`âŒ åº”ç”¨æ ·å¼å¤±è´¥: ${i}`),{success:!1,elementId:t,styleId:n,appliedAt:new Date,error:i instanceof Error?i.message:String(i)}}}getElementStyleId(t){return this.elementStyleMap.get(t)||null}removeElementStyle(t){const n=this.elementStyleMap.get(t);if(n){this.elementStyleMap.delete(t);const l=this.styles.get(n);l&&(l.metadata.usageCount=Math.max(0,l.metadata.usageCount-1)),console.log(`ğŸ”— ç§»é™¤å…ƒç´ æ ·å¼æ˜ å°„: å…ƒç´  ${t}`)}}getStylesByCategory(t){const n=Array.from(this.styles.values());return(t?n.filter(i=>i.category===t):n).sort((i,s)=>i.metadata.isSystemStyle!==s.metadata.isSystemStyle?i.metadata.isSystemStyle?-1:1:s.metadata.usageCount-i.metadata.usageCount)}searchStyles(t,n){const l=this.getStylesByCategory(n),i=t.toLowerCase().trim();return i?l.filter(s=>s.name.toLowerCase().includes(i)||s.description.toLowerCase().includes(i)||s.metadata.tags.some(a=>a.toLowerCase().includes(i))):l}getStyleUsageStats(){const t=[];for(const[n,l]of this.styles){const i=Array.from(this.elementStyleMap.entries()).filter(([s,a])=>a===n).map(([s,a])=>s);t.push({styleId:n,usageCount:i.length,elements:i,lastUsed:l.metadata.lastModified})}return t.sort((n,l)=>l.usageCount-n.usageCount)}cleanupUnusedStyles(){const t=new Set(this.elementStyleMap.values()),n=[];for(const[l,i]of this.styles)!t.has(l)&&!i.metadata.isSystemStyle&&(this.styles.delete(l),n.push(l),console.log(`ğŸ§¹ æ¸…ç†æœªä½¿ç”¨æ ·å¼: ${i.name} (${l})`));return n.length>0&&this.saveUserStyles(),n}exportStyles(t){const n=t?t.map(i=>this.styles.get(i)).filter(Boolean):Array.from(this.styles.values()),l=new Set(n.map(i=>i.category));return{version:"2.0.0",exportedAt:new Date,styles:n,metadata:{totalStyles:n.length,categories:Array.from(l),author:"user"}}}async importStyles(t){const n=[];for(const l of t.styles){if(Array.from(this.styles.values()).find(a=>a.name===l.name&&a.category===l.category)){console.warn(`âš ï¸ è·³è¿‡å·²å­˜åœ¨çš„æ ·å¼: ${l.name}`);continue}const s=this.createStyle({name:l.name,description:l.description,category:l.category,style:l.style,...l.inheritance&&{inheritance:l.inheritance}});n.push(s)}return console.log(`ğŸ“¦ å¯¼å…¥å®Œæˆï¼Œå…±å¯¼å…¥ ${n.length} ä¸ªæ ·å¼`),n}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}syncAllStyleInstances(t){const n=this.styles.get(t);if(!n)return;const l=[];for(const[i,s]of this.elementStyleMap)s===t&&(this.applyStyleToDOM(i,n.style),l.push(i));this.notifyObservers("styles-synced",{styleId:t,affectedElements:l}),console.log(`ğŸ”„ æ ·å¼åŒæ­¥å®Œæˆ: ${t} â†’ ${l.length} ä¸ªå…ƒç´ `)}applyStyleToDOM(t,n){console.log(`ğŸ¨ åº”ç”¨æ ·å¼åˆ°DOM: å…ƒç´  ${t}`,{font_family:n.font_family,font_size:n.font_size,typography:n.typography})}async loadSystemStyles(){try{const{BANK_TEXT_STYLES:t}=await gl(async()=>{const{BANK_TEXT_STYLES:n}=await import("./bank-text-styles-BtzE7aIi.js");return{BANK_TEXT_STYLES:n}},[]);for(const n of t)this.styles.set(n.id,n);console.log(`ğŸ¦ åŠ è½½äº† ${t.length} ä¸ªé“¶è¡Œé¢„è®¾æ ·å¼`)}catch(t){console.warn("âš ï¸ åŠ è½½ç³»ç»Ÿæ ·å¼å¤±è´¥:",t)}}async loadUserStyles(){try{const t=localStorage.getItem("jasper-text-styles");if(t){const n=JSON.parse(t);for(const l of n)l.metadata.createdAt=new Date(l.metadata.createdAt),l.metadata.lastModified=new Date(l.metadata.lastModified),this.styles.set(l.id,l);console.log(`ğŸ‘¤ åŠ è½½äº† ${n.length} ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ ·å¼`)}}catch(t){console.warn("âš ï¸ åŠ è½½ç”¨æˆ·æ ·å¼å¤±è´¥:",t)}}saveUserStyles(){try{const t=Array.from(this.styles.values()).filter(n=>!n.metadata.isSystemStyle);localStorage.setItem("jasper-text-styles",JSON.stringify(t)),console.log(`ğŸ’¾ ä¿å­˜äº† ${t.length} ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ ·å¼`)}catch(t){console.error("âŒ ä¿å­˜ç”¨æˆ·æ ·å¼å¤±è´¥:",t)}}notifyObservers(t,n){for(const l of this.observers)try{l.onStyleChange(t,n)}catch(i){console.error("âŒ è§‚å¯Ÿè€…é€šçŸ¥å¤±è´¥:",i)}}}const Me=new xl;class Sl{calculateUnifiedBounds(t,n,l){const i=this.calculateFontMetrics(n),s=this.measureTextContent(t,n,l.width),a=this.calculateContainerHeight(s,i,l.height),o=this.calculateTextPositioning(n,l,a,i),g={containerBounds:{x:0,y:0,width:l.width,height:a},contentBounds:s.bounds,fontMetrics:i,positioning:o};return s.wrappedLines&&(g.textLayout={wrappedLines:s.wrappedLines,isWrapped:!0,originalLineCount:t.split(`
`).length,wrappedLineCount:s.wrappedLines.length}),g}calculateFontMetrics(t){const n=t.font_size,l=1.2,i=.75,s=.25,a=n*i,o=n*s;return{fontSize:n,lineHeight:n*l,ascender:a,descender:o,baseline:a}}getCharacterWidth(t,n){const l=n.font_size,i=n.font_family,s=/[\u4e00-\u9fa5]/.test(t),a={"Courier New":{chinese:.6,english:.6},Monaco:{chinese:.6,english:.6},Consolas:{chinese:.6,english:.6},SimSun:{chinese:1,english:.5},SimHei:{chinese:1,english:.5},KaiTi:{chinese:1.1,english:.6},FangSong:{chinese:1,english:.55},Arial:{chinese:1,english:.55},Helvetica:{chinese:1,english:.55},"Times New Roman":{chinese:1,english:.5},"Microsoft YaHei":{chinese:1,english:.52},"PingFang SC":{chinese:1,english:.52},"Noto Sans":{chinese:1,english:.53},default:{chinese:1,english:.55}},o=i.toLowerCase();let g=a.default;for(const[b,u]of Object.entries(a))if(o.includes(b.toLowerCase())||b.toLowerCase().includes(o)){g=u;break}const c=s?g.chinese:g.english;return l*c}calculateTextWidth(t,n){let l=0;for(const i of t)i!==`
`&&(l+=this.getCharacterWidth(i,n));return l}measureTextContent(t,n,l=0){const i=t.split(`
`),s=i.length;let a=0;for(const c of i){const b=this.calculateTextWidth(c,n);a=Math.max(a,b)}if(l>0&&a>l)return this.calculateWrappedText(t,n,l);const o=l>0?Math.min(a,l):a,g=s*n.font_size*1.2;return{bounds:{x:0,y:0,width:o,height:g},lineCount:s,actualHeight:g}}calculateWrappedText(t,n,l){const i=this.getCharacterWidth("æµ‹",n);if(Math.floor(l/i)<1||l<i)return{bounds:{x:0,y:0,width:l,height:n.font_size*1.2},lineCount:1,actualHeight:n.font_size*1.2,wrappedLines:["..."]};const a=this.smartSegmentation(t);let o=[],g="",c=0;for(const u of a){const v=this.calculateTextWidth(u,n),f=c+v;if(f>l)if(g.trim())o.push(g.trim()),g=u,c=v;else{const{truncated:d,remaining:y}=this.forceTruncateSegment(u,l,n);o.push(d),g=y,c=this.calculateTextWidth(y,n)}else g+=u,c=f}g.trim()&&o.push(g.trim());const b=o.length*n.font_size*1.2;return{bounds:{x:0,y:0,width:l,height:b},lineCount:o.length,actualHeight:b,wrappedLines:o}}forceTruncateSegment(t,n,l){let i="",s=0,a=0;for(a=0;a<t.length;a++){const g=t[a];if(!g)break;const c=this.getCharacterWidth(g,l);if(s+c>n)break;i+=g,s+=c}const o=t.substring(a);return{truncated:i,remaining:o}}smartSegmentation(t){const n=[];let l="";for(let i=0;i<t.length;i++){const s=t[i];s&&(/[\u4e00-\u9fa5]/.test(s)?(l&&(n.push(l),l=""),n.push(s)):s===`
`?(l&&(n.push(l),l=""),n.push(`
`)):s===" "?l?(n.push(l+" "),l=""):n.push(" "):l+=s)}return l&&n.push(l),n.filter(i=>i.length>0)}calculateContainerHeight(t,n,l){const i=n.lineHeight*t.lineCount,s=n.ascender+n.descender,a=n.lineHeight,o=Math.max(i,s,a);return Math.max(o,l)}calculateTextPositioning(t,n,l,i){var b;const s=this.calculateHorizontalAnchor(t.align,n.width),a=i.baseline,o=((b=t.background)==null?void 0:b.padding)||0,g=-o,c=-o;return{textAnchorX:s,textAnchorY:a,backgroundX:g,backgroundY:c}}calculateHorizontalAnchor(t,n){switch(t){case"Left":return 0;case"Center":return n/2;case"Right":return n;default:return 0}}getTextAnchor(t){switch(t){case"Left":return"start";case"Center":return"middle";case"Right":return"end";default:return"start"}}debugBounds(t,n){}}const tt=new Sl;class wl{constructor(){je(this,"initialized",!1);this.initialize()}async initialize(){if(!this.initialized)try{await Me.initialize(),this.initialized=!0,console.log("ğŸ¨ ProfessionalTextRenderer å·²åˆå§‹åŒ–")}catch(t){console.error("âŒ ProfessionalTextRenderer åˆå§‹åŒ–å¤±è´¥:",t)}}isElementUsingProfessionalStyle(t){return Me.getElementStyleId(t)!==null}adaptLegacyTextStyle(t){return{...t,font_weight:t.font_weight,typography:{letterSpacing:0,lineHeight:1.2,paragraphSpacing:0,textIndent:0,decoration:{underline:!1,strikethrough:!1,overline:!1,decorationStyle:"solid"},textTransform:"none",whiteSpace:"normal"},fills:[{type:"solid",enabled:!0,opacity:1,solid:{color:t.color}}],effects:[]}}renderProfessionalText(t,n=!1){if(t.content.type!=="Text"&&t.content.type!=="DataField")return null;const l=Me.getElementStyleId(t.id);let i;if(l){const o=Me.getStyle(l);if(!o)return console.warn(`âš ï¸ æ‰¾ä¸åˆ°æ ·å¼å®šä¹‰: ${l}`),null;i=o.style,console.log(`ğŸ¨ ä½¿ç”¨ä¸“ä¸šæ ·å¼æ¸²æŸ“: ${o.name} (${l})`)}else{const o=t.content.type==="Text"||t.content.type==="DataField"?t.content.style:null;if(!o)return null;i=this.adaptLegacyTextStyle(o),console.log("ğŸ”„ é€‚é…ä¼ ç»Ÿæ ·å¼åˆ°ä¸“ä¸šæ’ç‰ˆç³»ç»Ÿ")}const s=this.calculateEnhancedBounds(t.content.type==="Text"?t.content.content:t.content.expression||"[æ•°æ®å­—æ®µ]",i,t.size);return{element:this.createProfessionalTextElement(s,t.content.type==="Text"?t.content.content:t.content.expression||"[æ•°æ®å­—æ®µ]",i,!1),bounds:s,style:i}}calculateEnhancedBounds(t,n,l){const i=tt.calculateUnifiedBounds(t,n,l),s=n.typography,a=this.calculateLetterSpacingEffect(t,s.letterSpacing),o=this.calculateLineHeightEffect(t,n.font_size,s.lineHeight),g=this.calculateParagraphSpacingEffect(t,s.paragraphSpacing);return{containerBounds:i.containerBounds,positioning:i.positioning,fontMetrics:i.fontMetrics,typography:{adjustedWidth:i.containerBounds.width+a.widthIncrease,adjustedHeight:i.containerBounds.height+o.heightIncrease+g.heightIncrease,letterSpacingData:a,lineHeightData:o,paragraphData:g}}}calculateLetterSpacingEffect(t,n){const l=t.split(`
`),i=l.reduce((a,o)=>a+o.length,0),s=Math.max(0,i-l.length);return{spacingValue:n,totalSpaces:s,widthIncrease:s*n,charPositions:[]}}calculateLineHeightEffect(t,n,l){const s=t.split(`
`).length,a=n*l,o=n*1.2,g=a-o;return{lineHeightRatio:l,actualLineHeight:a,lineCount:s,heightIncrease:g*Math.max(0,s-1),baselinePositions:[]}}calculateParagraphSpacingEffect(t,n){const i=t.split(`

`).length;return{spacing:n,paragraphCount:i,heightIncrease:n*Math.max(0,i-1),paragraphPositions:[]}}createProfessionalTextElement(t,n,l,i){const s=document.createElementNS("http://www.w3.org/2000/svg","g");return s.setAttribute("class","professional-text-container"),this.renderMultipleFills(s,t,l.fills),this.renderEffects(s,t,l.effects),this.renderTypographyText(s,t,n,l),this.renderTextDecorations(s,t,n,l.typography.decoration),s}renderMultipleFills(t,n,l){if(l&&l.length>0&&l[0].enabled){const i=l[0];i.type==="solid"&&i.solid&&console.log("ğŸ¨ åº”ç”¨çº¯è‰²å¡«å……:",i.solid.color)}}renderEffects(t,n,l){if(!l||l.length===0)return;const i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","filter"),a=`text-effects-${Date.now()}-${Math.random().toString(36).substr(2,5)}`;s.id=a;for(const o of l)if(o.enabled&&o.type==="drop-shadow"&&o.dropShadow){const g=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");g.setAttribute("dx",o.dropShadow.offsetX.toString()),g.setAttribute("dy",o.dropShadow.offsetY.toString()),g.setAttribute("stdDeviation",o.dropShadow.blur.toString()),g.setAttribute("flood-color",o.dropShadow.color),g.setAttribute("flood-opacity",o.dropShadow.opacity.toString()),s.appendChild(g),console.log("âœ¨ åº”ç”¨æŠ•å½±æ•ˆæœ")}s.children.length>0&&(i.appendChild(s),t.appendChild(i),t.setAttribute("filter",`url(#${a})`))}renderTypographyText(t,n,l,i){var g,c;const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("font-family",i.font_family),s.setAttribute("font-size",i.font_size.toString()),s.setAttribute("font-weight",i.font_weight),s.setAttribute("fill",((c=(g=i.fills[0])==null?void 0:g.solid)==null?void 0:c.color)||i.color),s.setAttribute("text-anchor",this.getTextAnchor(i.align));const a=l.split(`
`),o=i.typography;a.forEach((b,u)=>{const v=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.letterSpacing!==0&&v.setAttribute("letter-spacing",`${o.letterSpacing}px`);const f=n.positioning.textAnchorY+u*n.typography.lineHeightData.actualLineHeight;if(v.setAttribute("x",n.positioning.textAnchorX.toString()),v.setAttribute("y",f.toString()),u===0&&o.textIndent!==0){const d=n.positioning.textAnchorX+o.textIndent;v.setAttribute("x",d.toString())}o.textTransform&&o.textTransform!=="none"?v.textContent=this.applyTextTransform(b,o.textTransform):v.textContent=b,s.appendChild(v)}),t.appendChild(s)}renderTextDecorations(t,n,l,i){if(!i.underline&&!i.strikethrough&&!i.overline)return;const s=l.split(`
`),a=i.decorationColor||"#000000",o=i.decorationThickness||1,g=i.decorationStyle==="dashed"?"4,2":i.decorationStyle==="dotted"?"1,1":"none";s.forEach((c,b)=>{if(!c.trim())return;const u=n.positioning.textAnchorY+b*n.typography.lineHeightData.actualLineHeight,v=c.length*n.fontMetrics.fontSize*.6,f=n.positioning.textAnchorX,d=f+v;if(i.underline){const y=u+n.fontMetrics.fontSize*.1;this.createDecorationLine(t,f,y,d,y,a,o,g,"underline")}if(i.strikethrough){const y=u-n.fontMetrics.fontSize*.3;this.createDecorationLine(t,f,y,d,y,a,o,g,"strikethrough")}if(i.overline){const y=u-n.fontMetrics.fontSize*.8;this.createDecorationLine(t,f,y,d,y,a,o,g,"overline")}})}createDecorationLine(t,n,l,i,s,a,o,g,c){const b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("x1",n.toString()),b.setAttribute("y1",l.toString()),b.setAttribute("x2",i.toString()),b.setAttribute("y2",s.toString()),b.setAttribute("stroke",a),b.setAttribute("stroke-width",o.toString()),b.setAttribute("stroke-dasharray",g),b.setAttribute("class",`text-decoration-${c}`),t.appendChild(b)}getTextAnchor(t){switch(t){case"Center":return"middle";case"Right":return"end";case"Left":default:return"start"}}applyTextTransform(t,n){switch(n){case"uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"capitalize":return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();default:return t}}}const Cl=new wl;var kl=m("<button class=search-clear title=æ¸…é™¤æœç´¢>âœ•"),Tl=m('<div class=style-picker-container><div class=style-categories></div><div class=style-search><div class=search-input-container><span class=search-icon>ğŸ”</span><input type=text placeholder=æœç´¢æ ·å¼... class=search-input></div></div><div class=style-grid><div class="style-card create-style-card"><div class=create-style-content><div class=create-style-icon>â•</div><div class=create-style-label>æ–°å»ºæ ·å¼</div></div></div></div><div class=style-stats><span class=stats-text> ä¸ªæ ·å¼'),El=m("<button><span class=category-icon></span><span class=category-label>"),Ll=m("<div><div class=style-preview></div><div class=style-info><div class=style-name></div><div class=style-meta><span class=style-category></span></div></div><div class=style-actions>"),Dl=m("<span class=usage-count>"),Pl=m("<button class=edit-button title=ç¼–è¾‘æ ·å¼>âœï¸"),Al=m("<span class=system-badge title=ç³»ç»Ÿé¢„è®¾æ ·å¼>ğŸ”’"),zl=m("<div class=selection-indicator>âœ“");const Rl=e=>{const[t,n]=ee("bank-special"),[l,i]=ee(""),[s,a]=ee([]);(async()=>{await Me.initialize();const v=Me.getStylesByCategory();a(v)})();const g=Ce(()=>{let v=s();t()&&(v=v.filter(d=>d.category===t()));const f=l().toLowerCase().trim();return f&&(v=v.filter(d=>d.name.toLowerCase().includes(f)||d.description.toLowerCase().includes(f)||d.metadata.tags.some(y=>y.toLowerCase().includes(f)))),v}),c=[{key:"bank-special",label:"é“¶è¡Œä¸“ç”¨",icon:"ğŸ¦"},{key:"heading",label:"æ ‡é¢˜",icon:"ğŸ“°"},{key:"body",label:"æ­£æ–‡",icon:"ğŸ“"},{key:"caption",label:"è¯´æ˜",icon:"ğŸ’¬"},{key:"custom",label:"è‡ªå®šä¹‰",icon:"âš™ï¸"}],b=v=>{console.log("ğŸ¯ é€‰æ‹©æ ·å¼:",v),e.onStyleSelect(v)},u=v=>{n(v),console.log("ğŸ“‚ åˆ‡æ¢åˆ†ç±»:",v)};return(()=>{var v=Tl(),f=v.firstChild,d=f.nextSibling,y=d.firstChild,p=y.firstChild,$=p.nextSibling,x=d.nextSibling,k=x.firstChild,T=x.nextSibling,E=T.firstChild,N=E.firstChild;return r(f,h(ce,{each:c,children:M=>(()=>{var B=El(),j=B.firstChild,L=j.nextSibling;return B.$$click=()=>u(M.key),r(j,()=>M.icon),r(L,()=>M.label),A(D=>{var _=`category-button ${t()===M.key?"active":""}`,Q=M.label;return _!==D.e&&$e(B,D.e=_),Q!==D.t&&q(B,"title",D.t=Q),D},{e:void 0,t:void 0}),B})()})),$.$$input=M=>i(M.target.value),r(y,h(z,{get when(){return l()},get children(){var M=kl();return M.$$click=()=>i(""),M}}),null),r(x,h(ce,{get each(){return g()},children:M=>h(Ml,{style:M,get selected(){return e.selectedStyleId===M.id},onClick:()=>b(M.id),onEdit:()=>e.onStyleEdit(M.id)})}),k),Te(k,"click",e.onStyleCreate),r(E,()=>g().length,N),r(E,(()=>{var M=_e(()=>!!l());return()=>M()&&` (æœç´¢: "${l()}")`})(),null),A(()=>$.value=l()),v})()},Ml=e=>{const t=()=>{switch(e.style.category){case"bank-special":return e.style.id.includes("amount")?"Â¥123,456.78":e.style.id.includes("account")?"6222 0012 3456 7890":e.style.id.includes("institution")?e.style.name:e.style.id.includes("date")?"2025-08-19":e.style.name;case"heading":return e.style.name;case"body":return"æ­£æ–‡ç¤ºä¾‹æ–‡å­— Abc";case"caption":return"è¯´æ˜æ–‡å­—";default:return e.style.name}},n=Ce(()=>{var a,o,g,c,b,u,v,f;const s=e.style.style;return{fontFamily:s.font_family,fontSize:`${Math.min(s.font_size,14)}px`,fontWeight:s.font_weight,color:((g=(o=(a=s.fills)==null?void 0:a[0])==null?void 0:o.solid)==null?void 0:g.color)||s.color,textAlign:s.align.toLowerCase(),letterSpacing:`${((c=s.typography)==null?void 0:c.letterSpacing)||0}px`,textDecoration:(u=(b=s.typography)==null?void 0:b.decoration)!=null&&u.underline?"underline":(f=(v=s.typography)==null?void 0:v.decoration)!=null&&f.strikethrough?"line-through":"none"}}),l=s=>{s.preventDefault(),e.onClick()},i=s=>{s.preventDefault(),s.stopPropagation(),e.onEdit()};return(()=>{var s=Ll(),a=s.firstChild,o=a.nextSibling,g=o.firstChild,c=g.nextSibling,b=c.firstChild,u=o.nextSibling;return s.$$click=l,r(a,t),r(g,()=>e.style.name),r(b,()=>Nl(e.style.category)),r(c,(()=>{var v=_e(()=>e.style.metadata.usageCount>0);return()=>v()&&(()=>{var f=Dl();return r(f,()=>e.style.metadata.usageCount),A(()=>q(f,"title",`ä½¿ç”¨æ¬¡æ•°: ${e.style.metadata.usageCount}`)),f})()})(),null),r(u,(()=>{var v=_e(()=>!e.style.metadata.isSystemStyle);return()=>v()&&(()=>{var f=Pl();return f.$$click=i,f})()})(),null),r(u,(()=>{var v=_e(()=>!!e.style.metadata.isSystemStyle);return()=>v()&&Al()})(),null),r(s,(()=>{var v=_e(()=>!!e.selected);return()=>v()&&zl()})(),null),A(v=>{var f=`style-card ${e.selected?"selected":""} ${e.style.metadata.isSystemStyle?"system-style":"user-style"}`,d=n();return f!==v.e&&$e(s,v.e=f),v.t=hn(a,d,v.t),v},{e:void 0,t:void 0}),s})()};function Nl(e){return{"bank-special":"é“¶è¡Œ",heading:"æ ‡é¢˜",body:"æ­£æ–‡",caption:"è¯´æ˜",custom:"è‡ªå®šä¹‰"}[e]||e}De(["input","click"]);var Ol=m("<button class=style-picker-toggle>"),Il=m("<button class=style-reload-btn title=é‡æ–°åŠ è½½æ ·å¼ç³»ç»Ÿ>ğŸ”„"),Ul=m("<div class=initialization-fallback><div class=fallback-content><span class=fallback-icon>â³</span><span class=fallback-text>ä¸“ä¸šæ ·å¼ç³»ç»ŸåŠ è½½ä¸­...</span><div class=fallback-actions><button class=retry-btn>é‡è¯•åŠ è½½"),Fl=m("<div class=quick-style-actions><button class=apply-style-btn><span class=btn-icon>ğŸ¨</span><span class=btn-text>é€‰æ‹©æ ·å¼</span></button><button class=create-style-btn title=åŸºäºå½“å‰è®¾ç½®åˆ›å»ºæ–°æ ·å¼><span class=btn-icon>â•</span><span class=btn-text>æ–°å»º"),ql=m("<div class=style-picker-panel>"),Bl=m("<div class=property-group><div class=property-group-title><span>ğŸ“</span><span>æ’ç‰ˆæ§åˆ¶</span><div class=coming-soon-badge>å³å°†æ¨å‡º</div></div><div class=property-group-content><div class=typography-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>âš™ï¸</span><span class=placeholder-text>é«˜çº§æ’ç‰ˆæ§åˆ¶åŠŸèƒ½</span><span class=placeholder-subtitle>å­—é—´è·ã€è¡Œé«˜ã€è£…é¥°ç­‰"),jl=m("<div class=property-group><div class=property-group-title><span>âœ¨</span><span>è§†è§‰æ•ˆæœ</span><div class=coming-soon-badge>å³å°†æ¨å‡º</div></div><div class=property-group-content><div class=effects-controls-placeholder><div class=placeholder-content><span class=placeholder-icon>ğŸŒˆ</span><span class=placeholder-text>å¤šé‡å¡«å…… & é˜´å½±æ•ˆæœ</span><span class=placeholder-subtitle>æ¸å˜ã€æŠ•å½±ã€å‘å…‰ç­‰"),Ql=m('<div class="property-group debug-panel"><div class=property-group-title><span>ğŸ”§</span><span>è°ƒè¯•ä¿¡æ¯</span></div><div class=property-group-content><div class=debug-info><div class=debug-item><span class=debug-label>å…ƒç´ ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>å½“å‰æ ·å¼ID:</span><span class=debug-value></span></div><div class=debug-item><span class=debug-label>å¯ç”¨æ ·å¼:</span><span class=debug-value> ä¸ª</span></div><div class=debug-item><span class=debug-label>ä½¿ç”¨ä¸“ä¸šæ¸²æŸ“:</span><span class=debug-value>'),Hl=m("<div class=professional-text-properties><div class=property-group><div class=property-group-title><span>ğŸ¨</span><span>ä¸“ä¸šæ–‡å­—æ ·å¼</span><div class=property-group-actions></div></div><div class=property-group-content>"),Jl=m('<div class=current-style-info><div class=current-style-preview><div class=style-preview-badge><span class=style-name></span><span class=style-category></span></div><div class=style-actions><button class="style-action-btn edit-btn"title=ç¼–è¾‘æ ·å¼>âœï¸</button><button class="style-action-btn remove-btn"title=ç§»é™¤æ ·å¼>ğŸ—‘ï¸');const Gt=e=>{const[t,n]=ee(null),[l,i]=ee(!1),[s,a]=ee([]),[o,g]=ee(!1);qe(async()=>{try{await Me.initialize();const $=Me.getElementStyleId(e.element.id);n($);const x=Me.getStylesByCategory();a(x),g(!0),console.log("ğŸ¨ ProfessionalTextPropertiesPanel åˆå§‹åŒ–å®Œæˆ")}catch($){console.error("âŒ ä¸“ä¸šæ–‡å­—å±æ€§é¢æ¿åˆå§‹åŒ–å¤±è´¥:",$)}});const c=Ce(()=>{const $=t();return $?Me.getStyle($):null}),b=Ce(()=>e.element.content.type==="Text"||e.element.content.type==="DataField"),u=async $=>{try{const x=await Me.applyStyleToElement(e.element.id,$);if(x.success){n($);const k=Me.getStyle($);if(k){const T=v(k.style);e.onUpdate(e.element.id,"content",{...e.element.content,style:T})}console.log("âœ… æ ·å¼åº”ç”¨æˆåŠŸ:",x)}else console.error("âŒ æ ·å¼åº”ç”¨å¤±è´¥:",x.error)}catch(x){console.error("âŒ æ ·å¼é€‰æ‹©å¤„ç†å¤±è´¥:",x)}},v=$=>{var x,k,T;return{font_family:$.font_family,font_size:$.font_size,font_weight:$.font_weight,color:((T=(k=(x=$.fills)==null?void 0:x[0])==null?void 0:k.solid)==null?void 0:T.color)||$.color,align:$.align}},f=()=>{console.log("ğŸ†• åˆ›å»ºæ–°æ ·å¼")},d=$=>{console.log("âœï¸ ç¼–è¾‘æ ·å¼:",$)},y=()=>{i(!l())},p=()=>{t()&&(Me.removeElementStyle(e.element.id),n(null),console.log("ğŸ—‘ï¸ ç§»é™¤å…ƒç´ æ ·å¼"))};return b()?(()=>{var $=Hl(),x=$.firstChild,k=x.firstChild,T=k.firstChild,E=T.nextSibling,N=E.nextSibling,M=k.nextSibling;return r(N,h(z,{get when(){return o()},get children(){var B=Ol();return B.$$click=y,r(B,()=>l()?"ğŸ“":"ğŸ“š"),A(()=>q(B,"title",l()?"éšè—æ ·å¼åº“":"æ˜¾ç¤ºæ ·å¼åº“")),B}}),null),r(N,h(z,{get when(){return!o()},get children(){var B=Il();return B.$$click=()=>window.location.reload(),B}}),null),r(M,h(z,{get when(){return!o()},get children(){var B=Ul(),j=B.firstChild,L=j.firstChild,D=L.nextSibling,_=D.nextSibling,Q=_.firstChild;return Q.$$click=async()=>{try{await Me.initialize();const O=Me.getStylesByCategory();a(O),g(!0),console.log("ğŸ”„ æ ·å¼ç³»ç»Ÿé‡æ–°åˆå§‹åŒ–æˆåŠŸ")}catch(O){console.error("âŒ é‡æ–°åˆå§‹åŒ–å¤±è´¥:",O)}},B}}),null),r(M,h(z,{get when(){return o()},get children(){return[h(z,{get when(){return c()},children:B=>(()=>{var j=Jl(),L=j.firstChild,D=L.firstChild,_=D.firstChild,Q=_.nextSibling,O=D.nextSibling,C=O.firstChild,P=C.nextSibling;return r(_,()=>B().name),r(Q,()=>Vl(B().category)),C.$$click=()=>d(B().id),P.$$click=p,j})()}),h(z,{get when(){return!c()},get children(){var B=Fl(),j=B.firstChild,L=j.nextSibling;return j.$$click=y,L.$$click=f,B}}),h(z,{get when(){return l()},get children(){var B=ql();return r(B,h(Rl,{get selectedStyleId(){return t()},onStyleSelect:u,onStyleCreate:f,onStyleEdit:d})),B}})]}}),null),r($,h(z,{get when(){return c()},get children(){return Bl()}}),null),r($,h(z,{get when(){return c()},get children(){return jl()}}),null),r($,h(z,{get when(){return!1},get children(){var B=Ql(),j=B.firstChild,L=j.nextSibling,D=L.firstChild,_=D.firstChild,Q=_.firstChild,O=Q.nextSibling,C=_.nextSibling,P=C.firstChild,J=P.nextSibling,H=C.nextSibling,V=H.firstChild,W=V.nextSibling,G=W.firstChild,U=H.nextSibling,F=U.firstChild,de=F.nextSibling;return r(O,()=>e.element.id),r(J,()=>t()||"æ— "),r(W,()=>s().length,G),r(de,()=>Cl.isElementUsingProfessionalStyle(e.element.id)?"æ˜¯":"å¦"),B}}),null),$})():null};function Vl(e){return{"bank-special":"é“¶è¡Œ",heading:"æ ‡é¢˜",body:"æ­£æ–‡",caption:"è¯´æ˜",custom:"è‡ªå®šä¹‰"}[e]||e}De(["click"]);var Wl=m('<div class="flex flex-col h-auto"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">å±æ€§é¢æ¿</h2></div><div class=p-0>'),Gl=m('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>é€‰æ‹©å…ƒç´ ä»¥æŸ¥çœ‹å±æ€§'),Kl=m("<span class=property-value>"),Yl=m('<span class="property-value text-xs text-muted">'),kt=m("<div class=space-y-2>"),ot=m("<input type=number class=property-input>"),Xl=m('<div class="grid grid-cols-2 gap-2">'),Kt=m("<input type=checkbox class=property-checkbox>"),Zl=m('<div class="p-4 space-y-4">'),Yt=m("<div>"),ei=m("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),ti=m("<div class=property-field><label class=property-label>"),ni=m("<textarea class=property-textarea rows=2 placeholder=è¾“å…¥æ–‡æœ¬å†…å®¹...>"),xn=m('<select class=property-select><option value=SimSun>å®‹ä½“</option><option value=SimHei>é»‘ä½“</option><option value="Microsoft YaHei">å¾®è½¯é›…é»‘</option><option value=KaiTi>æ¥·ä½“</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Sn=m("<select class=property-select><option value=normal>æ­£å¸¸</option><option value=bold>ç²—ä½“</option><option value=lighter>ç»†ä½“</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),li=m('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),wn=m("<select class=property-select><option value=Solid>å®çº¿</option><option value=Dashed>è™šçº¿</option><option value=Dotted>ç‚¹çº¿"),ii=m('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),Cn=m('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),kn=m('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),si=m('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),ri=m("<select class=property-select><option value=Solid>å®çº¿</option><option value=Dashed>è™šçº¿</option><option value=Dotted>ç‚¹çº¿</option><option value=DashDot>ç‚¹åˆ’çº¿"),Xt=m("<select class=property-select><option value=None>æ— </option><option value=Arrow>ç®­å¤´</option><option value=Circle>åœ†ç‚¹</option><option value=Square>æ–¹å—"),ai=m('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),oi=m("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),ci=m("<input type=text class=property-input placeholder=å›¾ç‰‡æè¿°æ–‡å­—>"),di=m("<div class=property-image-preview><div class=property-image-placeholder><span>ğŸ“· æ— å›¾ç‰‡"),ui=m("<div class=space-y-3>"),gi=m("<img class=property-image>"),hi=m("<div class=property-loading>åŠ è½½æ•°æ®æº..."),vi=m('<div class=data-source-info><div class="text-xs text-muted"><div><span class=font-medium>çŠ¶æ€:</span> <span></span></div><div><span class=font-medium>ç±»å‹:</span> </div><div><span class=font-medium>æ›´æ–°:</span> '),fi=m('<input type=text class=property-input placeholder="{name} æˆ– {user.email} æ ¼å¼"title="ä½¿ç”¨ {fieldName} è¯­æ³•å¼•ç”¨æ•°æ®å­—æ®µï¼Œå¦‚ {name}, {price}, {user.email} ç­‰">'),mi=m('<div class="text-xs text-blue-600">ğŸ’¡ æç¤º: ä½¿ç”¨ {fieldName} è¯­æ³•ï¼Œå¦‚ {name}, {price}, {user.email} ç­‰'),bi=m('<div class="text-xs text-orange-600">âš ï¸ æ³¨æ„: é€‰æ‹©æ•°æ®æºåè¡¨è¾¾å¼æ‰èƒ½åœ¨é¢„è§ˆæ¨¡å¼ä¸‹æ±‚å€¼'),yi=m("<select class=property-select><option value=default>é»˜è®¤</option><option value=currency>è´§å¸</option><option value=date>æ—¥æœŸ</option><option value=datetime>æ—¥æœŸæ—¶é—´</option><option value=number>æ•°å­—"),$i=m("<div class=space-y-4>"),pi=m("<select class=property-select><option value>é€‰æ‹©æ•°æ®æº"),_i=m("<option> (<!>)"),xi=m('<div class=flex><input type=number class="property-input flex-1">'),Si=m("<span class=property-unit>"),wi=m('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),Ci=m("<div class=property-alignment-group>"),ki=m("<button>");const Ti=()=>{const{state:e,updateElement:t}=Ge(),n=Ce(()=>{const s=new Set(e.selected_ids);return e.elements.filter(a=>s.has(a.id))}),l=Ce(()=>n()[0]),i=async(s,a,o)=>{try{await t(s,{[a]:o})}catch(g){console.error("Failed to update element property:",g)}};return(()=>{var s=Wl(),a=s.firstChild,o=a.nextSibling;return r(o,h(z,{get when(){return l()},get fallback(){return Gl()},get children(){return h(Ei,{get element(){return l()},onUpdate:i})}})),s})()},Ei=e=>{const t=(l,i)=>{const s={...e.element.position,[l]:i};e.onUpdate(e.element.id,"position",s)},n=(l,i)=>{const s={...e.element.size,[l]:Math.max(1,i)};e.onUpdate(e.element.id,"size",s)};return(()=>{var l=Zl();return r(l,h(Ve,{title:"å…ƒç´ ä¿¡æ¯",icon:"â„¹ï¸",get children(){var i=kt();return r(i,h(ye,{label:"ç±»å‹",get children(){var s=Kl();return r(s,()=>e.element.content.type),s}}),null),r(i,h(ye,{label:"ID",get children(){var s=Yl();return r(s,()=>e.element.id),s}}),null),i}}),null),r(l,h(Ve,{title:"ä½ç½®å’Œå¤§å°",icon:"ğŸ“",get children(){var i=Xl();return r(i,h(ye,{label:"X",get children(){var s=ot();return s.$$input=a=>t("x",parseFloat(a.target.value)||0),A(()=>s.value=e.element.position.x),s}}),null),r(i,h(ye,{label:"Y",get children(){var s=ot();return s.$$input=a=>t("y",parseFloat(a.target.value)||0),A(()=>s.value=e.element.position.y),s}}),null),r(i,h(ye,{label:"å®½åº¦",get children(){var s=ot();return s.$$input=a=>n("width",parseFloat(a.target.value)||1),A(()=>s.value=e.element.size.width),s}}),null),r(i,h(ye,{label:"é«˜åº¦",get children(){var s=ot();return s.$$input=a=>n("height",parseFloat(a.target.value)||1),A(()=>s.value=e.element.size.height),s}}),null),i}}),null),r(l,h(Ve,{title:"çŠ¶æ€",icon:"ğŸ‘ï¸",get children(){var i=kt();return r(i,h(ye,{label:"å¯è§",get children(){var s=Kt();return s.addEventListener("change",a=>e.onUpdate(e.element.id,"visible",a.target.checked)),A(()=>s.checked=e.element.visible),s}}),null),r(i,h(ye,{label:"é”å®š",get children(){var s=Kt();return s.addEventListener("change",a=>e.onUpdate(e.element.id,"locked",a.target.checked)),A(()=>s.checked=e.element.locked),s}}),null),r(i,h(ye,{label:"å±‚çº§",get children(){var s=ot();return s.$$input=a=>e.onUpdate(e.element.id,"z_index",parseInt(a.target.value)||0),A(()=>s.value=e.element.z_index),s}}),null),i}}),null),r(l,h(Qn,{get children(){return[h(at,{get when(){return e.element.content.type==="Text"&&e.element.content},children:i=>(()=>{var s=Yt();return r(s,h(Gt,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),r(s,h(Li,{get content(){return i()},onUpdate:a=>{console.log("Text content update:",a),e.onUpdate(e.element.id,"content",a)}}),null),s})()}),h(at,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:i=>h(Di,{get content(){return i()},onUpdate:s=>{console.log("Rectangle content update:",s),e.onUpdate(e.element.id,"content",s)}})}),h(at,{get when(){return e.element.content.type==="Line"&&e.element.content},children:i=>h(Pi,{get content(){return i()},onUpdate:s=>{console.log("Line content update:",s),e.onUpdate(e.element.id,"content",s)}})}),h(at,{get when(){return e.element.content.type==="Image"&&e.element.content},children:i=>h(Ai,{get content(){return i()},onUpdate:s=>{console.log("Image content update:",s),e.onUpdate(e.element.id,"content",s)}})}),h(at,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:i=>(()=>{var s=Yt();return r(s,h(Gt,{get element(){return e.element},get onUpdate(){return e.onUpdate}}),null),r(s,h(zi,{get content(){return i()},onUpdate:a=>{console.log("DataField content update:",a),e.onUpdate(e.element.id,"content",a)}}),null),s})()})]}}),null),l})()},Ve=e=>(()=>{var t=ei(),n=t.firstChild,l=n.firstChild,i=l.nextSibling,s=n.nextSibling;return r(l,()=>e.icon),r(i,()=>e.title),r(s,()=>e.children),t})(),ye=e=>(()=>{var t=ti(),n=t.firstChild;return r(n,()=>e.label),r(t,()=>e.children,null),t})(),Li=e=>h(Ve,{title:"æ–‡å­—æ ·å¼",icon:"ğŸ”¤",get children(){var t=Cn(),n=t.firstChild,l=n.nextSibling;return r(t,h(ye,{label:"å†…å®¹",get children(){var i=ni();return i.$$input=s=>e.onUpdate({content:s.target.value}),A(()=>i.value=e.content.content),i}}),n),r(n,h(ye,{label:"å­—ä½“",get children(){var i=xn();return i.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_family:s.target.value}})),A(()=>i.value=e.content.style.font_family),i}}),null),r(n,h(ye,{label:"å¤§å°",get children(){return h(He,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:i=>e.onUpdate({style:{...e.content.style,font_size:i}})})}}),null),r(l,h(ye,{label:"å­—é‡",get children(){var i=Sn();return i.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,font_weight:s.target.value}})),A(()=>i.value=e.content.style.font_weight),i}}),null),r(l,h(ye,{label:"å¯¹é½",get children(){return h(Tn,{get value(){return e.content.style.align},onUpdate:i=>e.onUpdate({style:{...e.content.style,align:i}})})}}),null),r(t,h(ye,{label:"é¢œè‰²",get children(){return h(Xe,{get value(){return e.content.style.color},onUpdate:i=>e.onUpdate({style:{...e.content.style,color:i}})})}}),null),r(t,h(ye,{label:"èƒŒæ™¯",get children(){var i=li(),s=i.firstChild;return r(i,h(Xe,{get value(){var a;return((a=e.content.style.background)==null?void 0:a.color)||"transparent"},onUpdate:a=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:a}}})}),s),r(s,h(ye,{label:"é€æ˜åº¦",get children(){return h(He,{get value(){var a;return((a=e.content.style.background)==null?void 0:a.opacity)||1},min:0,max:1,step:.1,onUpdate:a=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:a}}})})}}),null),r(s,h(ye,{label:"å†…è¾¹è·",get children(){return h(He,{get value(){var a;return((a=e.content.style.background)==null?void 0:a.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:a=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:a}}})})}}),null),i}}),null),r(t,h(ye,{label:"è¾¹æ¡†",get children(){var i=ii(),s=i.firstChild;return r(i,h(Xe,{get value(){var a;return((a=e.content.style.border)==null?void 0:a.color)||"#000000"},onUpdate:a=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:a}}})}),s),r(s,h(ye,{label:"å®½åº¦",get children(){return h(He,{get value(){var a;return((a=e.content.style.border)==null?void 0:a.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:a=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:a}}})})}}),null),r(s,h(ye,{label:"æ ·å¼",get children(){var a=wn();return a.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:o.target.value}}})),A(()=>{var o;return a.value=((o=e.content.style.border)==null?void 0:o.style)||"Solid"}),a}}),null),r(s,h(ye,{label:"åœ†è§’",get children(){return h(He,{get value(){var a;return((a=e.content.style.border)==null?void 0:a.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:a=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:a}}})})}}),null),i}}),null),t}}),Di=e=>h(Ve,{title:"çŸ©å½¢æ ·å¼",icon:"â–­",get children(){var t=si(),n=t.firstChild,l=n.firstChild;return r(t,h(ye,{label:"å¡«å……é¢œè‰²",get children(){return h(Xe,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:i=>e.onUpdate({fill_color:i})})}}),n),r(n,h(ye,{label:"è¾¹æ¡†",get children(){var i=kt();return r(i,h(Xe,{get value(){var s;return((s=e.content.border)==null?void 0:s.color)||"#000000"},onUpdate:s=>e.onUpdate({border:{...e.content.border,color:s}})})),i}}),l),r(l,h(ye,{label:"å®½åº¦",get children(){return h(He,{get value(){var i;return((i=e.content.border)==null?void 0:i.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:i=>e.onUpdate({border:{...e.content.border,width:i}})})}}),null),r(l,h(ye,{label:"æ ·å¼",get children(){var i=wn();return i.addEventListener("change",s=>e.onUpdate({border:{...e.content.border,style:s.target.value}})),A(()=>{var s;return i.value=((s=e.content.border)==null?void 0:s.style)||"Solid"}),i}}),null),r(t,h(ye,{label:"åœ†è§’åŠå¾„",get children(){return h(He,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:i=>e.onUpdate({corner_radius:i})})}}),null),r(t,h(ye,{label:"é€æ˜åº¦",get children(){var i=kn(),s=i.firstChild,a=s.nextSibling,o=a.firstChild;return s.$$input=g=>e.onUpdate({opacity:parseFloat(g.target.value)/100}),r(a,()=>Math.round((e.content.opacity||1)*100),o),A(()=>s.value=(e.content.opacity||1)*100),i}}),null),t}}),Pi=e=>h(Ve,{title:"çº¿æ¡æ ·å¼",icon:"â”",get children(){var t=ai(),n=t.firstChild;return r(t,h(ye,{label:"é¢œè‰²",get children(){return h(Xe,{get value(){return e.content.color},onUpdate:l=>e.onUpdate({color:l})})}}),n),r(t,h(ye,{label:"å®½åº¦",get children(){return h(He,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:l=>e.onUpdate({width:l})})}}),n),r(t,h(ye,{label:"æ ·å¼",get children(){var l=ri();return l.addEventListener("change",i=>e.onUpdate({line_style:i.target.value})),A(()=>l.value=e.content.line_style||"Solid"),l}}),n),r(n,h(ye,{label:"èµ·ç‚¹",get children(){var l=Xt();return l.addEventListener("change",i=>e.onUpdate({start_cap:i.target.value})),A(()=>l.value=e.content.start_cap||"None"),l}}),null),r(n,h(ye,{label:"ç»ˆç‚¹",get children(){var l=Xt();return l.addEventListener("change",i=>e.onUpdate({end_cap:i.target.value})),A(()=>l.value=e.content.end_cap||"None"),l}}),null),r(t,h(ye,{label:"é€æ˜åº¦",get children(){var l=kn(),i=l.firstChild,s=i.nextSibling,a=s.firstChild;return i.$$input=o=>e.onUpdate({opacity:parseFloat(o.target.value)/100}),r(s,()=>Math.round((e.content.opacity||1)*100),a),A(()=>i.value=(e.content.opacity||1)*100),l}}),null),t}}),Ai=e=>h(Ve,{title:"å›¾ç‰‡å±æ€§",icon:"ğŸ–¼ï¸",get children(){var t=ui();return r(t,h(ye,{label:"å›¾ç‰‡åœ°å€",get children(){var n=oi();return n.$$input=l=>e.onUpdate({src:l.target.value}),A(()=>n.value=e.content.src),n}}),null),r(t,h(ye,{label:"æ›¿ä»£æ–‡æœ¬",get children(){var n=ci();return n.$$input=l=>e.onUpdate({alt:l.target.value}),A(()=>n.value=e.content.alt||""),n}}),null),r(t,h(ye,{label:"é¢„è§ˆ",get children(){var n=di(),l=n.firstChild;return r(n,(()=>{var i=_e(()=>!!e.content.src);return()=>i()?(()=>{var s=gi();return s.addEventListener("load",a=>{const o=a.target,g=o.nextElementSibling;o&&(o.style.display="block"),g&&(g.style.display="none")}),s.addEventListener("error",a=>{const o=a.target,g=o.nextElementSibling;o&&(o.style.display="none"),g&&(g.style.display="flex")}),A(a=>{var o=e.content.src,g=e.content.alt||"å›¾ç‰‡é¢„è§ˆ";return o!==a.e&&q(s,"src",a.e=o),g!==a.t&&q(s,"alt",a.t=g),a},{e:void 0,t:void 0}),s})():null})(),l),A(i=>(i=e.content.src?"none":"flex")!=null?l.style.setProperty("display",i):l.style.removeProperty("display")),n}}),null),t}}),zi=e=>{const[t,n]=ee([]),[l,i]=ee(!1);qe(async()=>{try{i(!0);const o=await we.listDataSources();n(o)}catch(o){console.error("Failed to load data sources:",o)}finally{i(!1)}});const s=o=>{e.onUpdate({data_source_id:o===""?void 0:o})},a=Ce(()=>e.content.data_source_id?t().find(o=>o.id===e.content.data_source_id):null);return(()=>{var o=$i();return r(o,h(Ve,{title:"æ•°æ®æºé…ç½®",icon:"ğŸ”—",get children(){var g=kt();return r(g,h(ye,{label:"æ•°æ®æº",get children(){return h(z,{get when(){return l()},get fallback(){return(()=>{var c=pi();return c.firstChild,c.addEventListener("change",b=>s(b.currentTarget.value)),r(c,h(ce,{get each(){return t()},children:b=>(()=>{var u=_i(),v=u.firstChild,f=v.nextSibling;return f.nextSibling,r(u,()=>b.name,v),r(u,()=>b.provider_type,f),A(()=>u.value=b.id),u})()}),null),A(()=>c.value=e.content.data_source_id||""),c})()},get children(){return hi()}})}}),null),r(g,h(z,{get when(){return a()},get children(){var c=vi(),b=c.firstChild,u=b.firstChild,v=u.firstChild,f=v.nextSibling,d=f.nextSibling,y=u.nextSibling,p=y.firstChild;p.nextSibling;var $=y.nextSibling,x=$.firstChild;return x.nextSibling,r(d,(()=>{var k=_e(()=>a().status==="active");return()=>k()?"æ´»è·ƒ":a().status==="error"?"é”™è¯¯":"ç¦ç”¨"})()),r(y,()=>a().provider_type,null),r($,()=>new Date(a().last_updated).toLocaleString("zh-CN"),null),A(()=>$e(d,a().status==="active"?"text-green-600":a().status==="error"?"text-red-600":"text-gray-600")),c}}),null),r(g,h(ye,{label:"è¡¨è¾¾å¼",get children(){var c=fi();return c.$$input=b=>e.onUpdate({expression:b.currentTarget.value}),c.disabled=!1,A(()=>c.value=e.content.expression||""),c}}),null),r(g,h(z,{get when(){return!e.content.expression||!e.content.expression.trim()},get children(){return mi()}}),null),r(g,h(z,{get when(){return e.content.expression&&!e.content.data_source_id},get children(){return bi()}}),null),r(g,h(ye,{label:"æ ¼å¼",get children(){var c=yi();return c.addEventListener("change",b=>e.onUpdate({format:b.currentTarget.value==="default"?void 0:b.currentTarget.value})),A(()=>c.value=e.content.format||"default"),c}}),null),g}}),null),r(o,h(Ve,{title:"å­—æ®µæ ·å¼",icon:"ğŸ¨",get children(){var g=Cn(),c=g.firstChild,b=c.nextSibling;return r(c,h(ye,{label:"å­—ä½“",get children(){var u=xn();return u.addEventListener("change",v=>e.onUpdate({style:{...e.content.style,font_family:v.currentTarget.value}})),A(()=>u.value=e.content.style.font_family),u}}),null),r(c,h(ye,{label:"å¤§å°",get children(){return h(He,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:u=>e.onUpdate({style:{...e.content.style,font_size:u}})})}}),null),r(b,h(ye,{label:"å­—é‡",get children(){var u=Sn();return u.addEventListener("change",v=>e.onUpdate({style:{...e.content.style,font_weight:v.currentTarget.value}})),A(()=>u.value=e.content.style.font_weight),u}}),null),r(b,h(ye,{label:"å¯¹é½",get children(){return h(Tn,{get value(){return e.content.style.align},onUpdate:u=>e.onUpdate({style:{...e.content.style,align:u}})})}}),null),r(g,h(ye,{label:"é¢œè‰²",get children(){return h(Xe,{get value(){return e.content.style.color},onUpdate:u=>e.onUpdate({style:{...e.content.style,color:u}})})}}),null),g}}),null),o})()},He=e=>(()=>{var t=xi(),n=t.firstChild;return n.addEventListener("blur",l=>{const i=parseFloat(l.target.value)||e.value,s=Math.max(e.min||-1/0,Math.min(e.max||1/0,i));s!==i&&(l.target.value=s.toString(),e.onUpdate(s))}),n.$$input=l=>{const i=parseFloat(l.target.value);if(!isNaN(i)){const s=Math.max(e.min||-1/0,Math.min(e.max||1/0,i));e.onUpdate(s)}},r(t,(()=>{var l=_e(()=>!!e.unit);return()=>l()&&(()=>{var i=Si();return r(i,()=>e.unit),i})()})(),null),A(l=>{var i=e.min,s=e.max,a=e.step||1;return i!==l.e&&q(n,"min",l.e=i),s!==l.t&&q(n,"max",l.t=s),a!==l.a&&q(n,"step",l.a=a),l},{e:void 0,t:void 0,a:void 0}),A(()=>n.value=e.value),t})(),Xe=e=>(()=>{var t=wi(),n=t.firstChild,l=n.firstChild,i=l.nextSibling,s=n.nextSibling;return l.$$input=a=>e.onUpdate(a.target.value),s.$$input=a=>{const o=a.target.value;(/^#[0-9A-Fa-f]{6}$/.test(o)||/^#[0-9A-Fa-f]{3}$/.test(o))&&e.onUpdate(o)},A(a=>(a=e.value)!=null?i.style.setProperty("background-color",a):i.style.removeProperty("background-color")),A(()=>l.value=e.value),A(()=>s.value=e.value),t})(),Tn=e=>{const t=[{value:"Left",icon:"â¬…ï¸",label:"å·¦å¯¹é½"},{value:"Center",icon:"â†”ï¸",label:"å±…ä¸­"},{value:"Right",icon:"â¡ï¸",label:"å³å¯¹é½"}];return(()=>{var n=Ci();return r(n,()=>t.map(l=>(()=>{var i=ki();return i.$$click=()=>e.onUpdate(l.value),r(i,()=>l.icon),A(s=>{var a=`property-alignment-btn ${e.value===l.value?"active":""}`,o=l.label;return a!==s.e&&$e(i,s.e=a),o!==s.t&&q(i,"title",s.t=o),s},{e:void 0,t:void 0}),i})())),n})()};De(["input","click"]);var Ri=m("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),Mi=m("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const Ni=e=>h(z,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Ri(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return A(s=>{var a=e.config.grid_size,o=e.config.grid_size,g=e.config.grid_size,c=e.config.grid_size,b=e.config.grid_size,u=e.config.grid_size,v=e.config.grid_size,f=e.config.grid_size;return a!==s.e&&q(n,"width",s.e=a),o!==s.t&&q(n,"height",s.t=o),g!==s.a&&q(l,"x1",s.a=g),c!==s.o&&q(l,"x2",s.o=c),b!==s.i&&q(l,"y2",s.i=b),u!==s.n&&q(i,"y1",s.n=u),v!==s.s&&q(i,"x2",s.s=v),f!==s.h&&q(i,"y2",s.h=f),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=Mi();return A(n=>{var l=e.config.width,i=e.config.height;return l!==n.e&&q(t,"width",n.e=l),i!==n.t&&q(t,"height",n.t=i),n},{e:void 0,t:void 0}),t})()]}});class Oi{constructor(){je(this,"expressionCache",new Map);je(this,"maxCacheSize",1e3)}async evaluateExpression(t,n){if(!t||!t.trim())return{success:!1,error:"è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º"};if(!n)return{success:!1,error:"æ²¡æœ‰å¯ç”¨çš„æ•°æ®ä¸Šä¸‹æ–‡"};try{const l=this.preprocessExpression(t),i=this.getCompiledExpression(l),s=await this.executeCompiledExpression(i,n);return{success:!0,value:s.value,type:this.inferValueType(s.value)}}catch(l){return{success:!1,error:l instanceof Error?l.message:String(l)}}}validateExpression(t,n){if(!t||!t.trim())return{valid:!1,error:"è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º"};try{const l=this.preprocessExpression(t),i=this.compileExpression(l);return this.staticValidation(i,n)}catch(l){return{valid:!1,error:l instanceof Error?l.message:"è¡¨è¾¾å¼æ ¼å¼é”™è¯¯"}}}getFieldSuggestions(t,n){if(!n)return[];const l=t.toLowerCase().replace(/[{}]/g,""),i=[];if(n.fields.forEach(s=>{s.name.toLowerCase().includes(l)&&i.push(`{${s.name}}`),s.displayName&&s.displayName.toLowerCase().includes(l)&&i.push(`{${s.name}}`)}),n.currentRecord.data){const s=this.getNestedFieldSuggestions(l,n.currentRecord.data,"");i.push(...s)}return Array.from(new Set(i)).sort((s,a)=>{const o=s.replace(/[{}]/g,""),g=a.replace(/[{}]/g,"");return o===l?-1:g===l?1:o.startsWith(l)?-1:g.startsWith(l)?1:o.localeCompare(g)}).slice(0,20)}preprocessExpression(t){let n=t.trim();return!n.startsWith("{")&&!n.endsWith("}")&&(n=`{${n}}`),n=n.replace(/^\{+/,"{").replace(/\}+$/,"}"),n}getCompiledExpression(t){let n=this.expressionCache.get(t);if(!n){if(n=this.compileExpression(t),this.expressionCache.size>=this.maxCacheSize){const l=this.expressionCache.keys().next().value;l&&this.expressionCache.delete(l)}this.expressionCache.set(t,n)}return n}compileExpression(t){const n=t.slice(1,-1),l=this.parsePath(n);return{original:t,path:l,type:this.determineExpressionType(l)}}parsePath(t){const n=[];let l="",i=!1;for(let s=0;s<t.length;s++){const a=t[s];if(a==="["&&!i)l&&(n.push({type:"field",value:l}),l=""),i=!0;else if(a==="]"&&i){const o=parseInt(l,10);if(isNaN(o))throw new Error(`æ— æ•ˆçš„æ•°ç»„ç´¢å¼•: ${l}`);n.push({type:"index",value:o}),l="",i=!1}else a==="."&&!i?l&&(n.push({type:"field",value:l}),l=""):l+=a}if(l){if(i)throw new Error("æœªé—­åˆçš„æ•°ç»„ç´¢å¼•");n.push({type:"field",value:l})}if(n.length===0)throw new Error("ç©ºçš„å­—æ®µè·¯å¾„");return n}async executeCompiledExpression(t,n){let l=n.currentRecord.data;for(const i of t.path){if(l==null)throw new Error("æ— æ³•è®¿é—® null/undefined å€¼çš„å±æ€§");if(i.type==="field"){if(typeof l!="object")throw new Error(`å°è¯•è®¿é—®éå¯¹è±¡ç±»å‹çš„å­—æ®µ: ${i.value}`);if(!(i.value in l))throw new Error(`å­—æ®µä¸å­˜åœ¨: ${i.value}`);l=l[i.value]}else if(i.type==="index"){if(!Array.isArray(l))throw new Error("å°è¯•å¯¹éæ•°ç»„ç±»å‹ä½¿ç”¨ç´¢å¼•è®¿é—®");const s=i.value;if(s<0||s>=l.length)throw new Error(`æ•°ç»„ç´¢å¼•è¶…å‡ºèŒƒå›´: ${s}`);l=l[s]}}return{value:l}}staticValidation(t,n){if(!n)return{valid:!0,warnings:["æ²¡æœ‰æ•°æ®ä¸Šä¸‹æ–‡ï¼Œæ— æ³•éªŒè¯å­—æ®µæ˜¯å¦å­˜åœ¨"]};const l=[],i=t.path[0];if(i&&i.type==="field"){const a=i.value;if(!n.fields.some(g=>g.name===a)){const g=n.fields.filter(c=>c.name.toLowerCase().includes(a.toLowerCase())||this.levenshteinDistance(c.name.toLowerCase(),a.toLowerCase())<=2).map(c=>`{${c.name}}`).slice(0,5);return{valid:!1,error:`å­—æ®µä¸å­˜åœ¨: ${a}`,suggestions:g}}}t.path.length>5&&l.push("è¡¨è¾¾å¼è·¯å¾„è¿‡æ·±ï¼Œå¯èƒ½å½±å“æ€§èƒ½");const s={valid:!0};return l.length>0&&(s.warnings=l),s}getNestedFieldSuggestions(t,n,l){const i=[];if(!n||typeof n!="object")return i;for(const s of Object.keys(n)){const a=l?`${l}.${s}`:s;a.toLowerCase().includes(t)&&i.push(`{${a}}`),l.split(".").length<3&&n[s]&&typeof n[s]=="object"&&i.push(...this.getNestedFieldSuggestions(t,n[s],a))}return i}inferValueType(t){return t==null?"object":typeof t=="string"?"string":typeof t=="number"?"number":typeof t=="boolean"?"boolean":t instanceof Date?"date":typeof t=="object"?"object":"string"}determineExpressionType(t){return t.length===1?"simple":t.length<=3&&t.every(n=>n.type==="field")?"nested":"complex"}levenshteinDistance(t,n){if(t.length===0)return n.length;if(n.length===0)return t.length;const l=new Array(n.length+1);for(let i=0;i<=n.length;i++)l[i]=new Array(t.length+1),l[i][0]=i;for(let i=0;i<=t.length;i++)l[0][i]=i;for(let i=1;i<=n.length;i++)for(let s=1;s<=t.length;s++){const a=t[s-1]===n[i-1]?0:1;l[i][s]=Math.min(l[i-1][s]+1,l[i][s-1]+1,l[i-1][s-1]+a)}return l[n.length][t.length]}clearCache(){this.expressionCache.clear()}getCacheStats(){return{size:this.expressionCache.size,maxSize:this.maxCacheSize,hitRate:0}}}const zt=new Oi;class Ii{constructor(){je(this,"context",ee(null));je(this,"subscribers",[]);this.context[1](null)}getCurrentContext(){return this.context[0]()}async setActiveDataSource(t){var n,l;try{const s=(await we.listDataSources()).find(u=>u.id===t);if(!s)throw new Error(`æ•°æ®æºä¸å­˜åœ¨: ${t}`);console.log("ğŸ” æ‰¾åˆ°æ•°æ®æº:",s);const a=s.provider_type||s.type_name||"json";console.log("ğŸ” æ¨æ–­çš„ providerType:",a);const o=await we.getPreview(t,void 0,1);console.log("ğŸ” é¢„è§ˆæ•°æ®:",o);const g=await we.getSchema(t);console.log("ğŸ” Schemaä¿¡æ¯:",g);const c=g.columns.map(u=>({name:u.name,displayName:u.description||u.name,type:this.mapDataType(u.data_type),nullable:u.nullable,sample:u.default_value})),b={dataSource:{id:t,type:this.inferDataSourceType(a),name:s.name,status:this.mapDataSourceStatus(s.status)},currentRecord:{index:0,total:(l=(n=o.total_rows)!=null?n:o.total_count)!=null?l:0,data:o.rows[0]||{}},fields:c};console.log("âœ… åˆ›å»ºæ–°çš„æ•°æ®ä¸Šä¸‹æ–‡:",b),this.context[1](b);try{typeof window<"u"&&window.localStorage&&window.localStorage.setItem("jasper.activeDataSourceId",t)}catch(u){console.warn("æ— æ³•æŒä¹…åŒ–æ¿€æ´»æ•°æ®æºID:",u)}this.notifySubscribers(b)}catch(i){console.error("è®¾ç½®æ•°æ®æºå¤±è´¥:",i);const s={dataSource:{id:t,type:"json",name:"æœªçŸ¥æ•°æ®æº",status:"error"},currentRecord:{index:0,total:0,data:{}},fields:[],error:{type:"system",message:i instanceof Error?i.message:"æ•°æ®æºåŠ è½½å¤±è´¥",details:i}};this.context[1](s),this.notifySubscribers(s)}}async navigateToRecord(t){const n=this.getCurrentContext();if(!n||t<0||t>=n.currentRecord.total)return!1;try{const l=await we.queryData(n.dataSource.id,{limit:1,offset:t});if(l.rows.length===0)return!1;const i={...n,currentRecord:{...n.currentRecord,index:t,data:l.rows[0]}};return this.context[1](i),this.notifySubscribers(i),!0}catch(l){return console.error("å¯¼èˆªåˆ°è®°å½•å¤±è´¥:",l),!1}}async navigateNext(){const t=this.getCurrentContext();return t?this.navigateToRecord(t.currentRecord.index+1):!1}async navigatePrevious(){const t=this.getCurrentContext();return t?this.navigateToRecord(t.currentRecord.index-1):!1}async evaluateExpression(t){const n=this.getCurrentContext();return await zt.evaluateExpression(t,n)}validateExpression(t){const n=this.getCurrentContext(),l=zt.validateExpression(t,n);return{valid:l.valid,...l.error&&{error:l.error},...l.suggestions&&{suggestions:l.suggestions}}}getFieldSuggestions(t){const n=this.getCurrentContext();return zt.getFieldSuggestions(t,n)}subscribe(t){return this.subscribers.push(t),()=>{const n=this.subscribers.indexOf(t);n>-1&&this.subscribers.splice(n,1)}}destroy(){this.subscribers.length=0,this.context[1](null)}notifySubscribers(t){this.subscribers.forEach(n=>{try{n(t)}catch(l){console.error("æ•°æ®ä¸Šä¸‹æ–‡è®¢é˜…å›è°ƒé”™è¯¯:",l)}})}inferDataSourceType(t){if(!t)return console.warn("providerType is undefined, defaulting to json"),"json";switch(t.toLowerCase()){case"json":return"json";case"excel":return"excel";case"sql":return"sql";case"xml":return"xml";case"csv":return"csv";default:return"json"}}mapDataType(t){switch(t){case"String":return"string";case"Number":return"number";case"Boolean":return"boolean";case"Date":case"DateTime":return"date";case"Array":return"array";case"Object":return"object";default:return"string"}}mapDataSourceStatus(t){if(!t)return console.warn("status is undefined, defaulting to empty"),"empty";switch(t.toLowerCase()){case"active":case"connected":case"ready":return"ready";case"error":case"failed":return"error";case"loading":case"processing":case"connecting":return"loading";case"disabled":case"disconnected":case"inactive":return"empty";default:return console.warn(`Unknown status: ${t}, defaulting to empty`),"empty"}}}const Oe=new Ii;var Ui=m("<svg><g class=text-element-unified-container data-bounds-version=unified-v2><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto class=text-content-unified></svg>",!1,!0,!1),Zt=m("<svg><rect class=text-selection-unified></svg>",!1,!0,!1),Fi=m("<svg><rect class=text-background-unified></svg>",!1,!0,!1),qi=m("<svg><rect fill=none class=text-border-unified></svg>",!1,!0,!1),Bi=m("<svg><tspan class=text-line-wrapped></svg>",!1,!0,!1),ji=m("<svg><tspan class=text-line-original></svg>",!1,!0,!1),Qi=m("<svg><rect x=0 y=0></svg>",!1,!0,!1),Hi=m("<svg><line x1=0></svg>",!1,!0,!1),Ji=m("<svg><g class=datafield-element-unified-container><text dominant-baseline=hanging text-rendering=optimizeLegibility shape-rendering=geometricPrecision font-kerning=auto></svg>",!1,!0,!1),Vi=m('<svg><g class=design-mode-indicator><circle r=6 fill="rgba(24, 144, 255, 0.1)"stroke=#1890ff stroke-width=1></circle><text text-anchor=middle dominant-baseline=middle font-size=8 font-weight=bold fill=#1890ff></svg>',!1,!0,!1),Wi=m("<svg><tspan class=datafield-line-wrapped></svg>",!1,!0,!1),Gi=m("<svg><tspan dy=0></svg>",!1,!0,!1),Ki=m("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),Yi=m("<svg><g></svg>",!1,!0,!1);const Xi=e=>{const{state:t}=fn(),[n,l]=ee("[æ•°æ®å­—æ®µ]");Ft(()=>{if(e.element.content.type==="DataField"){const a=e.element.content.expression||"",o=t().mode;Lt.shouldShowExpression(o)?l(a||"[æ•°æ®å­—æ®µ]"):Lt.shouldEvaluateExpression(o)&&Oe.evaluateExpression(a).then(g=>{g.success?l(String(g.value||"")):l(`[é”™è¯¯: ${g.error}]`)}).catch(g=>{l(`[é”™è¯¯: ${g}]`)})}});const i=Ce(()=>{const{position:a}=e.element;return{transform:`translate(${a.x}px, ${a.y}px)`,opacity:e.element.visible?1:.5}}),s=()=>{const{content:a,size:o}=e.element;if(a.type==="Text"&&a.content&&a.style){const g=tt.calculateUnifiedBounds(a.content,a.style,o),c=tt.getTextAnchor(a.style.align);return(()=>{var b=Ui(),u=b.firstChild;return r(b,(()=>{var v=_e(()=>!!e.selected);return()=>v()&&(()=>{var f=Zt();return A(d=>{var y=g.containerBounds.x,p=g.containerBounds.y,$=g.containerBounds.width,x=g.containerBounds.height;return y!==d.e&&q(f,"x",d.e=y),p!==d.t&&q(f,"y",d.t=p),$!==d.a&&q(f,"width",d.a=$),x!==d.o&&q(f,"height",d.o=x),d},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()})(),u),r(b,(()=>{var v=_e(()=>!!a.style.background);return()=>v()&&(()=>{var f=Fi();return A(d=>{var M,B;var y=g.positioning.backgroundX,p=g.positioning.backgroundY,$=g.containerBounds.width+(a.style.background.padding||0)*2,x=g.containerBounds.height+(a.style.background.padding||0)*2,k=a.style.background.color,T=a.style.background.opacity||1,E=((M=a.style.border)==null?void 0:M.radius)||0,N=((B=a.style.border)==null?void 0:B.radius)||0;return y!==d.e&&q(f,"x",d.e=y),p!==d.t&&q(f,"y",d.t=p),$!==d.a&&q(f,"width",d.a=$),x!==d.o&&q(f,"height",d.o=x),k!==d.i&&q(f,"fill",d.i=k),T!==d.n&&q(f,"fill-opacity",d.n=T),E!==d.s&&q(f,"rx",d.s=E),N!==d.h&&q(f,"ry",d.h=N),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),f})()})(),u),r(b,(()=>{var v=_e(()=>!!a.style.border);return()=>v()&&(()=>{var f=qi();return A(d=>{var B,j;var y=g.positioning.backgroundX,p=g.positioning.backgroundY,$=g.containerBounds.width+(((B=a.style.background)==null?void 0:B.padding)||0)*2,x=g.containerBounds.height+(((j=a.style.background)==null?void 0:j.padding)||0)*2,k=a.style.border.color,T=a.style.border.width,E=a.style.border.style==="Dashed"?"5,5":a.style.border.style==="Dotted"?"2,2":"none",N=a.style.border.radius||0,M=a.style.border.radius||0;return y!==d.e&&q(f,"x",d.e=y),p!==d.t&&q(f,"y",d.t=p),$!==d.a&&q(f,"width",d.a=$),x!==d.o&&q(f,"height",d.o=x),k!==d.i&&q(f,"stroke",d.i=k),T!==d.n&&q(f,"stroke-width",d.n=T),E!==d.s&&q(f,"stroke-dasharray",d.s=E),N!==d.h&&q(f,"rx",d.h=N),M!==d.r&&q(f,"ry",d.r=M),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),f})()})(),u),q(u,"text-anchor",c),r(u,(()=>{var v=_e(()=>{var f;return!!((f=g.textLayout)!=null&&f.isWrapped)});return()=>v()?g.textLayout.wrappedLines.map((f,d)=>(()=>{var y=Bi();return r(y,f),A(p=>{var $=g.positioning.textAnchorX,x=d===0?0:g.fontMetrics.lineHeight;return $!==p.e&&q(y,"x",p.e=$),x!==p.t&&q(y,"dy",p.t=x),p},{e:void 0,t:void 0}),y})()):a.content.split(`
`).map((f,d)=>(()=>{var y=ji();return r(y,f),A(p=>{var $=g.positioning.textAnchorX,x=d===0?0:g.fontMetrics.lineHeight;return $!==p.e&&q(y,"x",p.e=$),x!==p.t&&q(y,"dy",p.t=x),p},{e:void 0,t:void 0}),y})())})()),A(v=>{var f=g.positioning.textAnchorX,d=g.positioning.textAnchorY,y=a.style.font_family,p=a.style.font_size.toString(),$=a.style.font_weight,x=a.style.color;return f!==v.e&&q(u,"x",v.e=f),d!==v.t&&q(u,"y",v.t=d),y!==v.a&&q(u,"font-family",v.a=y),p!==v.o&&q(u,"font-size",v.o=p),$!==v.i&&q(u,"font-weight",v.i=$),x!==v.n&&q(u,"fill",v.n=x),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),b})()}if(a.type==="Rectangle"){const g=a.opacity!==void 0?a.opacity:1,c=a.corner_radius||0;return(()=>{var b=Qi();return q(b,"rx",c),q(b,"ry",c),q(b,"fill-opacity",g),q(b,"stroke-opacity",g),A(u=>{var x,k,T,E;var v=o.width,f=o.height,d=a.fill_color||"transparent",y=((x=a.border)==null?void 0:x.color)||"#000000",p=((k=a.border)==null?void 0:k.width)||1,$=((T=a.border)==null?void 0:T.style)==="Dashed"?"5,5":((E=a.border)==null?void 0:E.style)==="Dotted"?"2,2":"none";return v!==u.e&&q(b,"width",u.e=v),f!==u.t&&q(b,"height",u.t=f),d!==u.a&&q(b,"fill",u.a=d),y!==u.o&&q(b,"stroke",u.o=y),p!==u.i&&q(b,"stroke-width",u.i=p),$!==u.n&&q(b,"stroke-dasharray",u.n=$),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),b})()}if(a.type==="Line"){const g=a.opacity!==void 0?a.opacity:1,c=a.line_style||"Solid",b=c==="Dashed"?"8,4":c==="Dotted"?"2,2":c==="DashDot"?"8,4,2,4":"none";return(()=>{var u=Hi();return q(u,"stroke-opacity",g),q(u,"stroke-dasharray",b),A(v=>{var f=o.height/2,d=o.width,y=o.height/2,p=a.color,$=a.width;return f!==v.e&&q(u,"y1",v.e=f),d!==v.t&&q(u,"x2",v.t=d),y!==v.a&&q(u,"y2",v.a=y),p!==v.o&&q(u,"stroke",v.o=p),$!==v.i&&q(u,"stroke-width",v.i=$),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),u})()}if(a.type==="DataField"&&a.style){const g=n(),c=tt.calculateUnifiedBounds(g,a.style,o),b=tt.getTextAnchor(a.style.align);return(()=>{var u=Ji(),v=u.firstChild;return r(u,(()=>{var f=_e(()=>!!e.selected);return()=>f()&&(()=>{var d=Zt();return A(y=>{var p=c.containerBounds.x,$=c.containerBounds.y,x=c.containerBounds.width,k=c.containerBounds.height;return p!==y.e&&q(d,"x",y.e=p),$!==y.t&&q(d,"y",y.t=$),x!==y.a&&q(d,"width",y.a=x),k!==y.o&&q(d,"height",y.o=k),y},{e:void 0,t:void 0,a:void 0,o:void 0}),d})()})(),v),r(u,(()=>{var f=_e(()=>!!Lt.shouldShowExpression(t().mode));return()=>f()&&(()=>{var d=Vi(),y=d.firstChild,p=y.nextSibling;return A($=>{var x=c.containerBounds.x+c.containerBounds.width-8,k=c.containerBounds.y+8,T=c.containerBounds.x+c.containerBounds.width-8,E=c.containerBounds.y+8;return x!==$.e&&q(y,"cx",$.e=x),k!==$.t&&q(y,"cy",$.t=k),T!==$.a&&q(p,"x",$.a=T),E!==$.o&&q(p,"y",$.o=E),$},{e:void 0,t:void 0,a:void 0,o:void 0}),d})()})(),v),q(v,"text-anchor",b),r(v,(()=>{var f=_e(()=>{var d;return!!((d=c.textLayout)!=null&&d.isWrapped)});return()=>f()?c.textLayout.wrappedLines.map((d,y)=>(()=>{var p=Wi();return r(p,d),A($=>{var x=c.positioning.textAnchorX,k=y===0?0:c.fontMetrics.lineHeight;return x!==$.e&&q(p,"x",$.e=x),k!==$.t&&q(p,"dy",$.t=k),$},{e:void 0,t:void 0}),p})()):(()=>{var d=Gi();return r(d,g),A(()=>q(d,"x",c.positioning.textAnchorX)),d})()})()),A(f=>{var d=t().mode,y=c.positioning.textAnchorX,p=c.positioning.textAnchorY,$=a.style.font_family,x=a.style.font_size.toString(),k=a.style.font_weight,T=g.startsWith("[é”™è¯¯:")?"#ff4d4f":a.style.color,E=`datafield-content-unified ${t().mode}-mode`;return d!==f.e&&q(u,"data-preview-mode",f.e=d),y!==f.t&&q(v,"x",f.t=y),p!==f.a&&q(v,"y",f.a=p),$!==f.o&&q(v,"font-family",f.o=$),x!==f.i&&q(v,"font-size",f.i=x),k!==f.n&&q(v,"font-weight",f.n=k),T!==f.s&&q(v,"fill",f.s=T),E!==f.h&&q(v,"class",f.h=E),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()}return(()=>{var g=Ki();return A(c=>{var b=o.width,u=o.height;return b!==c.e&&q(g,"width",c.e=b),u!==c.t&&q(g,"height",c.t=u),c},{e:void 0,t:void 0}),g})()};return(()=>{var a=Yi();return r(a,s),A(o=>{var g=`element ${e.selected&&e.element.content.type!=="Text"&&e.element.content.type!=="DataField"?"element-selected":""}`,c=i(),b=e.element.id,u=e.element.content.type;return g!==o.e&&q(a,"class",o.e=g),o.t=hn(a,c,o.t),b!==o.a&&q(a,"data-element-id",o.a=b),u!==o.o&&q(a,"data-element-type",o.o=u),o},{e:void 0,t:void 0,a:void 0,o:void 0}),a})()};var Zi=m("<svg><g class=resize-handles></svg>",!1,!0,!1),es=m("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const ts=e=>{const{updateElement:t,setResizeOperation:n}=Ge(),[l,i]=ee(!1),[s,a]=ee(null),[o,g]=ee({x:0,y:0}),[c,b]=ee({width:0,height:0}),[u,v]=ee({x:0,y:0}),[f,d]=ee({width:0,height:0}),[y,p]=ee({x:0,y:0}),[$,x]=ee(!1),k=Ce(()=>{const{position:L,size:D,content:_}=e.element,O=8/2;let C={x:L.x,y:L.y,width:D.width,height:D.height};if((_.type==="Text"||_.type==="DataField")&&_.style){const U=_.type==="Text"?_.content:_.expression||"[æ•°æ®å­—æ®µ]",F=tt.calculateUnifiedBounds(U,_.style,D);C={x:L.x+F.containerBounds.x,y:L.y+F.containerBounds.y,width:F.containerBounds.width,height:F.containerBounds.height}}const P=C.x,J=C.y,H=C.x+C.width,V=C.y+C.height,W=C.x+C.width/2,G=C.y+C.height/2;return[{position:"nw",cursor:"nw-resize",x:P-O,y:J-O},{position:"ne",cursor:"ne-resize",x:H-O,y:J-O},{position:"sw",cursor:"sw-resize",x:P-O,y:V-O},{position:"se",cursor:"se-resize",x:H-O,y:V-O},{position:"n",cursor:"n-resize",x:W-O,y:J-O},{position:"s",cursor:"s-resize",x:W-O,y:V-O},{position:"w",cursor:"w-resize",x:P-O,y:G-O},{position:"e",cursor:"e-resize",x:H-O,y:G-O}]}),T=(L,D,_,Q=!1,O=!1)=>{const C=c(),P=u();let J=C.width,H=C.height,V=P.x,W=P.y;switch(L){case"nw":J=C.width-D,H=C.height-_,V=P.x+D,W=P.y+_;break;case"ne":J=C.width+D,H=C.height-_,W=P.y+_;break;case"sw":J=C.width-D,H=C.height+_,V=P.x+D;break;case"se":J=C.width+D,H=C.height+_;break;case"n":H=C.height-_,W=P.y+_;break;case"s":H=C.height+_;break;case"w":J=C.width-D,V=P.x+D;break;case"e":J=C.width+D;break}if(Q&&(L==="nw"||L==="ne"||L==="sw"||L==="se")){const U=C.width/C.height;J/H>U?(J=H*U,(L==="nw"||L==="sw")&&(V=P.x+(C.width-J))):(H=J/U,(L==="nw"||L==="ne")&&(W=P.y+(C.height-H)))}if(O){const U=P.x+C.width/2,F=P.y+C.height/2;V=U-J/2,W=F-H/2}const G=20;return J=Math.max(G,J),H=Math.max(G,H),{size:{width:J,height:H},position:{x:V,y:W}}},E=L=>(L.preventDefault(),L.stopPropagation(),L.stopImmediatePropagation(),!1),N=(L,D)=>{var _;n(!0),document.addEventListener("click",E,{capture:!0}),i(!0),a(L),g({x:D.clientX,y:D.clientY}),b({width:e.element.size.width,height:e.element.size.height}),v({x:e.element.position.x,y:e.element.position.y}),d(e.element.size),p(e.element.position),x(!1),document.addEventListener("mousemove",B),document.addEventListener("mouseup",j),document.body.style.cursor=((_=k().find(Q=>Q.position===L))==null?void 0:_.cursor)||"default"};let M=0;const B=L=>{if(!l())return;const D=s();if(!D)return;const _=o(),Q=L.clientX-_.x,O=L.clientY-_.y,C=T(D,Q,O,L.shiftKey,L.altKey);d(C.size),p(C.position),x(Math.abs(Q)>2||Math.abs(O)>2);const P=Date.now();if(P-M>50)try{t(e.element.id,{size:C.size,position:C.position}),M=P}catch{}},j=()=>{if(!l()||!s())return;const D=()=>{document.removeEventListener("click",E,{capture:!0}),n(!1),i(!1),a(null),document.body.style.cursor="default",document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",j)};if($()){const _=f(),Q=y();t(e.element.id,{size:_,position:Q}).catch(O=>{t(e.element.id,{size:c(),position:u()}).catch(C=>{})})}D()};return lt(()=>{n(!1),document.removeEventListener("click",E,{capture:!0}),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",j),document.body.style.cursor="default"}),(()=>{var L=Zi();return r(L,()=>k().map(D=>(()=>{var _=es(),Q=_.firstChild,O=Q.nextSibling;return O.addEventListener("mouseleave",C=>{l()||(document.body.style.cursor="default")}),O.addEventListener("mouseenter",C=>{l()||(document.body.style.cursor=D.cursor)}),O.$$mousedown=C=>{C.stopPropagation(),C.preventDefault(),N(D.position,C)},O.style.setProperty("pointer-events","all"),A(C=>{var P=D.x+4,J=D.y+4,H=D.x,V=D.y,W=D.cursor;return P!==C.e&&q(Q,"cx",C.e=P),J!==C.t&&q(Q,"cy",C.t=J),H!==C.a&&q(O,"x",C.a=H),V!==C.o&&q(O,"y",C.o=V),W!==C.i&&((C.i=W)!=null?O.style.setProperty("cursor",W):O.style.removeProperty("cursor")),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),_})())),L})()};De(["mousedown"]);var Ie=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(Ie||{});const ns={dragThreshold:3,updateThrottle:16};var ls=m("<div tabindex=0>"),is=m("<div>"),ss=m("<div><div>ğŸ¯ ä¿®å¤ç‰ˆäº¤äº’å±‚</div><div>æ¨¡å¼: </div><div>é€‰ä¸­: </div><div>å…‰æ ‡: "),rs=m("<div>æ‹–æ‹½: <!>ä¸ªå…ƒç´ "),as=m("<div>[<!>]");const os=e=>{const{resizeOperation:t,setResizeOperation:n}=Ge(),l=ns;let i;const[s,a]=ee(Ie.IDLE),[o,g]=ee([]),[c,b]=ee(null),[u,v]=ee(null),[f,d]=ee(null),y=(S,w)=>Math.sqrt(Math.pow(S.x-w.x,2)+Math.pow(S.y-w.y,2)),p=(S,w)=>S.length===w.length&&S.every((I,R)=>I===w[R]),$=()=>{d(null)},[x,k]=ee(null);let T="default";const E=(S,w)=>{!i||T===S||(i.style.cursor=S,T=S)},N=(S,...w)=>{console.log(`ğŸ¯ [InteractionLayer] ${S}`,...w)},M=S=>{if(!i)return{x:0,y:0};const w=i.getBoundingClientRect();return{x:S.clientX-w.left,y:S.clientY-w.top}},B=(S,w)=>S.x>=w.position.x&&S.x<=w.position.x+w.size.width&&S.y>=w.position.y&&S.y<=w.position.y+w.size.height,j=S=>{var I;const w=L(S);return w.length>0&&(I=w[0])!=null?I:null},L=S=>{const w=e.getAllElements();return w.filter(R=>R&&R.visible&&B(S,R)).sort((R,K)=>{var be,Se;const se=(be=R.z_index)!=null?be:w.indexOf(R);return((Se=K.z_index)!=null?Se:w.indexOf(K))-se})},D=S=>{const w=o();if(w.length===0)return null;const I=e.getAllElements();for(const R of w){const K=I.find(Fe=>Fe.id===R);if(!K||!K.visible)continue;const se=8,Z=se/2,be=K.position.x,Se=K.position.y,oe=K.position.x+K.size.width,ze=K.position.y+K.size.height,Pe=K.position.x+K.size.width/2,Ne=K.position.y+K.size.height/2,Ke=[{direction:"nw",cursor:"nw-resize",x:be-Z,y:Se-Z},{direction:"ne",cursor:"ne-resize",x:oe-Z,y:Se-Z},{direction:"sw",cursor:"sw-resize",x:be-Z,y:ze-Z},{direction:"se",cursor:"se-resize",x:oe-Z,y:ze-Z},{direction:"n",cursor:"n-resize",x:Pe-Z,y:Se-Z},{direction:"s",cursor:"s-resize",x:Pe-Z,y:ze-Z},{direction:"w",cursor:"w-resize",x:be-Z,y:Ne-Z},{direction:"e",cursor:"e-resize",x:oe-Z,y:Ne-Z}];for(const Fe of Ke)if(S.x>=Fe.x&&S.x<Fe.x+se&&S.y>=Fe.y&&S.y<Fe.y+se)return{elementId:K.id,direction:Fe.direction,cursor:Fe.cursor}}return null},_=S=>e.getAllElements().filter(I=>{if(!I.visible)return!1;const R={x:I.position.x,y:I.position.y,width:I.size.width,height:I.size.height};return!(R.x>S.x+S.width||R.x+R.width<S.x||R.y>S.y+S.height||R.y+R.height<S.y)}),Q=(S,w)=>{var R,K,se;const I=L(S);return N("é‡å é€‰æ‹©æ£€æµ‹",{elementsCount:I.length,isCtrlClick:w,elementIds:I.map(Z=>Z.id)}),I.length===0?null:I.length===1?($(),((R=I[0])==null?void 0:R.id)||null):w?O(S,I):($(),N("æ™®é€šç‚¹å‡»é€‰ä¸­æœ€ä¸Šå±‚",{elementId:(K=I[0])==null?void 0:K.id}),((se=I[0])==null?void 0:se.id)||null)},O=(S,w)=>{var se,Z,be,Se;const I=f(),R=Date.now();if(N("å¾ªç¯é€‰æ‹©å¼€å§‹",{hasContext:!!I,elementIds:w.map(oe=>oe.id)}),!I||y(S,I.clickPoint)>5||R-I.lastClickTime>3e3||!p(w.map(oe=>oe.id),I.overlappingElements.map(oe=>oe.id))){const oe=w.length>1?1:0;return d({clickPoint:S,overlappingElements:w,currentSelectedIndex:oe,lastClickTime:R}),N("å¾ªç¯é€‰æ‹©é‡ç½®",{selectedIndex:oe,selectedId:(se=w[oe])==null?void 0:se.id,reason:I?y(S,I.clickPoint)>5?"position_changed":R-I.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),C(oe+1,w.length,S),((Z=w[oe])==null?void 0:Z.id)||null}else{const oe=(I.currentSelectedIndex+1)%w.length;return d({...I,currentSelectedIndex:oe,lastClickTime:R}),N("å¾ªç¯é€‰æ‹©ç»§ç»­",{selectedIndex:oe,selectedId:(be=w[oe])==null?void 0:be.id}),C(oe+1,w.length,S),((Se=w[oe])==null?void 0:Se.id)||null}},C=(S,w,I)=>{const R=document.querySelector(".overlap-indicator");R!=null&&R.parentNode&&R.parentNode.removeChild(R);const K=document.createElement("div");K.className="overlap-indicator",K.textContent=`${S}/${w}`,Object.assign(K.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${I.x+10}px`,top:`${I.y-20}px`}),document.body.appendChild(K),N("æ˜¾ç¤ºé‡å æŒ‡ç¤ºå™¨",{current:S,total:w,point:I}),setTimeout(()=>{K.parentNode&&(K.parentNode.removeChild(K),N("ç§»é™¤é‡å æŒ‡ç¤ºå™¨"))},1500)},P=S=>{var I;const w=M(S);if(x()){X(w);return}if(s()===Ie.DRAGGING){re(w);return}if(s()===Ie.SELECTING){Y(w);return}if(s()===Ie.IDLE&&c()&&!((I=c())!=null&&I.isDragging)){ae(w);return}s()===Ie.IDLE&&!c()&&!x()&&J(w)},J=S=>{const w=D(S);if(w){E(w.cursor);return}const I=j(S);if(I){const K=o().includes(I.id)?"grab":"pointer";E(K);return}E("default")},H=S=>{const w=M(S),I=D(w);if(I){N("ç‚¹å‡»ResizeHandle",{elementId:I.elementId,direction:I.direction}),V(I,w);return}if(t()){N("è°ƒæ•´å¤§å°æ“ä½œè¿›è¡Œä¸­ï¼Œè·³è¿‡äº¤äº’å¤„ç†");return}const R=Q(w,S.ctrlKey);if(N("é¼ æ ‡æŒ‰ä¸‹",{point:w,selectedElementId:R,currentMode:s(),isCtrlClick:S.ctrlKey}),R){const K=e.getAllElements().find(se=>se.id===R);K&&W(K,w,S)}else G(w)},V=(S,w,I)=>{const R=e.getAllElements().find(K=>K.id===S.elementId);R&&(N("å¼€å§‹resizeæ“ä½œ",{elementId:S.elementId,direction:S.direction}),n(!0),k({elementId:S.elementId,handlePosition:S.direction,startPoint:w,initialSize:{width:R.size.width,height:R.size.height},initialPosition:{x:R.position.x,y:R.position.y},cursor:S.cursor}),E(S.cursor),N("resizeçŠ¶æ€å·²è®¾ç½®",x()))},W=(S,w,I)=>{const R=o().includes(S.id),K=o(),se=!!f();N("å…ƒç´ ç‚¹å‡»",{elementId:S.id,isSelected:R,currentlySelected:K,ctrlKey:I.ctrlKey,shiftKey:I.shiftKey,hasOverlapContext:se}),I.ctrlKey&&!se?U(S.id):I.shiftKey&&o().length>0?F(S.id):R?(N("ç‚¹å‡»å·²é€‰ä¸­å…ƒç´ ï¼Œå‡†å¤‡æ‹–æ‹½",{selectedCount:K.length}),pe(K,w)):de(S.id,w)},G=(S,w)=>{var I;N("å¼€å§‹æ¡†é€‰",{point:S}),g([]),(I=e.onElementsSelect)==null||I.call(e,[]),$(),a(Ie.SELECTING),E("crosshair"),v({startPoint:S,currentPoint:S,selectedIds:[]})},U=S=>{var R;const w=o(),I=w.includes(S)?w.filter(K=>K!==S):[...w,S];N("åˆ‡æ¢é€‰æ‹©",{elementId:S,newSelection:I}),g(I),(R=e.onElementsSelect)==null||R.call(e,I)},F=S=>{var I;const w=o();if(!w.includes(S)){const R=[...w,S];N("æ·»åŠ åˆ°é€‰æ‹©",{elementId:S,newSelection:R}),g(R),(I=e.onElementsSelect)==null||I.call(e,R)}},de=(S,w,I)=>{var R;N("é€‰æ‹©å¹¶å‡†å¤‡æ‹–æ‹½",{elementId:S,point:w}),g([S]),(R=e.onElementsSelect)==null||R.call(e,[S]),pe([S],w)},pe=(S,w,I)=>{N("å‡†å¤‡æ‹–æ‹½æ“ä½œ",{elementIds:S,startPoint:w});const R=e.getAllElements(),K=new Map;S.forEach(se=>{const Z=R.find(be=>be.id===se);Z&&K.set(se,{x:Z.position.x,y:Z.position.y})}),b({elementIds:S,startPoint:w,startPositions:K,currentOffset:{x:0,y:0},isDragging:!1})},ae=S=>{const w=c();if(!w)return;const I=Math.sqrt(Math.pow(S.x-w.startPoint.x,2)+Math.pow(S.y-w.startPoint.y,2));I>l.dragThreshold&&(N("å¼€å§‹æ‹–æ‹½",{distance:I,threshold:l.dragThreshold}),a(Ie.DRAGGING),E("grabbing"),b({...w,isDragging:!0}))};let ne=!1,te=0;const le=(S,w=!1)=>{if(w){S();return}Date.now()-te>=l.updateThrottle&&!ne&&(ne=!0,requestAnimationFrame(()=>{S(),ne=!1,te=Date.now()}))},re=S=>{const w=c();if(!w)return;const I={x:S.x-w.startPoint.x,y:S.y-w.startPoint.y};b({...w,currentOffset:I}),le(()=>{if(e.onBatchUpdatePositions&&w.elementIds.length>1){const R=w.elementIds.map(K=>{const se=w.startPositions.get(K);return se?{element_id:K,new_position:{x:se.x+I.x,y:se.y+I.y}}:null}).filter(Boolean);R.length>0&&e.onBatchUpdatePositions(R).catch(()=>{})}else if(e.onElementMove){const R=w.elementIds.map(K=>{const se=w.startPositions.get(K);if(se)return e.onElementMove(K,{x:se.x+I.x,y:se.y+I.y})}).filter(Boolean);Promise.allSettled(R).catch(()=>{})}})},Y=S=>{const w=u();if(!w)return;const I={...w,currentPoint:S};v(I);const R={x:Math.min(w.startPoint.x,S.x),y:Math.min(w.startPoint.y,S.y),width:Math.abs(S.x-w.startPoint.x),height:Math.abs(S.y-w.startPoint.y)},se=_(R).map(Z=>Z.id);v({...I,selectedIds:se}),g(se)},X=S=>{const w=x();if(!w)return;const I=S.x-w.startPoint.x,R=S.y-w.startPoint.y,K=ue(w.handlePosition,I,R,w.initialSize,w.initialPosition);le(()=>{e.onElementResize&&e.onElementResize(w.elementId,K.size,K.position)})},ue=(S,w,I,R,K)=>{let se=R.width,Z=R.height,be=K.x,Se=K.y;switch(S){case"nw":se=R.width-w,Z=R.height-I,be=K.x+w,Se=K.y+I;break;case"ne":se=R.width+w,Z=R.height-I,Se=K.y+I;break;case"sw":se=R.width-w,Z=R.height+I,be=K.x+w;break;case"se":se=R.width+w,Z=R.height+I;break;case"n":Z=R.height-I,Se=K.y+I;break;case"s":Z=R.height+I;break;case"w":se=R.width-w,be=K.x+w;break;case"e":se=R.width+w;break}const oe=10;return se=Math.max(oe,se),Z=Math.max(oe,Z),{size:{width:se,height:Z},position:{x:be,y:Se}}},me=()=>{const S=s();if(N("é¼ æ ‡é‡Šæ”¾",{currentMode:S,hasResizeState:!!x()}),x()){xe();return}S===Ie.DRAGGING?fe():S===Ie.SELECTING&&he(),ie()},fe=()=>{const S=c();if(!S||!S.isDragging&&S.currentOffset.x===0&&S.currentOffset.y===0){N("æ‹–æ‹½å®Œæˆï¼Œæ— å®é™…ç§»åŠ¨");return}if(e.onBatchUpdatePositions&&S.elementIds.length>1){const w=S.elementIds.map(I=>{const R=S.startPositions.get(I);return R?{element_id:I,new_position:{x:R.x+S.currentOffset.x,y:R.y+S.currentOffset.y}}:null}).filter(Boolean);w.length>0&&(N("æ‹–æ‹½å®Œæˆ - æ‰¹é‡æ›´æ–°",{elementCount:w.length}),e.onBatchUpdatePositions(w).catch(I=>{console.warn("æ‰¹é‡æ›´æ–°æœ€ç»ˆä½ç½®å¤±è´¥:",I)}))}},he=()=>{const S=u();S&&(N("æ¡†é€‰å®Œæˆ",{selectedCount:S.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(S.selectedIds))},xe=()=>{const S=x();S&&(N("å®Œæˆresizeæ“ä½œ",{elementId:S.elementId}),n(!1),k(null))},ie=()=>{a(Ie.IDLE),E("default"),b(null),v(null),k(null),n(!1),$(),N("çŠ¶æ€é‡ç½®å®Œæˆ")};qe(async()=>{document.addEventListener("mousemove",P),document.addEventListener("mouseup",me),N("ä¿®å¤ç‰ˆäº¤äº’å±‚å·²åˆå§‹åŒ–")}),lt(()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",me),N("ä¿®å¤ç‰ˆäº¤äº’å±‚å·²æ¸…ç†")});const ve=()=>{const S=u();if(!S||s()!==Ie.SELECTING)return null;const{startPoint:w,currentPoint:I}=S;return{x:Math.min(w.x,I.x),y:Math.min(w.y,I.y),width:Math.abs(I.x-w.x),height:Math.abs(I.y-w.y)}};return(()=>{var S=ls();S.$$mousedown=H;var w=i;return typeof w=="function"?Bt(w,S):i=S,S.style.setProperty("position","absolute"),S.style.setProperty("top","0"),S.style.setProperty("left","0"),S.style.setProperty("width","100%"),S.style.setProperty("height","100%"),S.style.setProperty("z-index","10"),S.style.setProperty("pointer-events","all"),S.style.setProperty("background","transparent"),S.style.setProperty("user-select","none"),r(S,(()=>{var I=_e(()=>!!ve());return()=>I()&&(()=>{var R=is();return R.style.setProperty("position","absolute"),R.style.setProperty("border","1px dashed #007acc"),R.style.setProperty("background","rgba(0, 122, 204, 0.1)"),R.style.setProperty("pointer-events","none"),A(K=>{var se=`${ve().x}px`,Z=`${ve().y}px`,be=`${ve().width}px`,Se=`${ve().height}px`;return se!==K.e&&((K.e=se)!=null?R.style.setProperty("left",se):R.style.removeProperty("left")),Z!==K.t&&((K.t=Z)!=null?R.style.setProperty("top",Z):R.style.removeProperty("top")),be!==K.a&&((K.a=be)!=null?R.style.setProperty("width",be):R.style.removeProperty("width")),Se!==K.o&&((K.o=Se)!=null?R.style.setProperty("height",Se):R.style.removeProperty("height")),K},{e:void 0,t:void 0,a:void 0,o:void 0}),R})()})(),null),r(S,(()=>{var I=_e(()=>!!e.enableDebugMode);return()=>I()&&(()=>{var R=ss(),K=R.firstChild,se=K.nextSibling;se.firstChild;var Z=se.nextSibling;Z.firstChild;var be=Z.nextSibling;return be.firstChild,R.style.setProperty("position","fixed"),R.style.setProperty("top","10px"),R.style.setProperty("right","10px"),R.style.setProperty("padding","8px"),R.style.setProperty("background","rgba(0, 0, 0, 0.8)"),R.style.setProperty("color","white"),R.style.setProperty("font-family","monospace"),R.style.setProperty("font-size","12px"),R.style.setProperty("border-radius","4px"),R.style.setProperty("z-index","9999"),R.style.setProperty("pointer-events","none"),r(se,s,null),r(Z,()=>o().length,null),r(be,T,null),r(R,(()=>{var Se=_e(()=>{var oe;return!!((oe=c())!=null&&oe.isDragging)});return()=>Se()&&(()=>{var oe=rs(),ze=oe.firstChild,Pe=ze.nextSibling;return Pe.nextSibling,oe.style.setProperty("color","#ffeb3b"),r(oe,()=>{var Ne;return(Ne=c())==null?void 0:Ne.elementIds.length},Pe),oe})()})(),null),r(R,(()=>{var Se=_e(()=>o().length>0);return()=>Se()&&(()=>{var oe=as(),ze=oe.firstChild,Pe=ze.nextSibling;return Pe.nextSibling,oe.style.setProperty("font-size","10px"),oe.style.setProperty("color","#ccc"),r(oe,()=>o().slice(0,3).join(", "),Pe),r(oe,()=>o().length>3&&"...",Pe),oe})()})(),null),R})()})(),null),S})()};De(["mousedown"]);var cs=m("<div class=toolbar-section><div class=section-title>æ™ºèƒ½å»ºè®®</div><button class=smart-align-button><div class=smart-icon>ğŸ¯</div><div class=smart-text></div></button><div class=smart-reason>"),ds=m("<div class=toolbar-status><div class=status-text>é€‰æ‹©è‡³å°‘2ä¸ªå…ƒç´ ä»¥ä½¿ç”¨å¯¹é½åŠŸèƒ½"),us=m('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>æ­£åœ¨æ‰§è¡Œå¯¹é½æ“ä½œ...'),gs=m('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>å¯¹é½</div><div class=button-group><button class="align-button left"title=å·¦å¯¹é½><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=æ°´å¹³å±…ä¸­å¯¹é½><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=å³å¯¹é½><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>å‚ç›´å¯¹é½</div><div class=button-group><button class="align-button top"title=é¡¶éƒ¨å¯¹é½><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=å‚ç›´å±…ä¸­å¯¹é½><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=åº•éƒ¨å¯¹é½><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>åˆ†å¸ƒ</div><div class=button-group><button class="align-button distribute-h"title=æ°´å¹³å‡åŒ€åˆ†å¸ƒ><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=å‚ç›´å‡åŒ€åˆ†å¸ƒ><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const hs=(e,t)=>{if(e.length<2)return[];const n=e.map(l=>({x:l.position.x,y:l.position.y,width:l.size.width,height:l.size.height}));return n.map((l,i)=>{let s=l.x,a=l.y;switch(t){case"left":s=Math.min(...n.map(u=>u.x));break;case"right":s=Math.max(...n.map(u=>u.x+u.width))-l.width;break;case"top":a=Math.min(...n.map(u=>u.y));break;case"bottom":a=Math.max(...n.map(u=>u.y+u.height))-l.height;break;case"h_center":s=n.reduce((u,v)=>u+v.x+v.width/2,0)/n.length-l.width/2;break;case"v_center":a=n.reduce((u,v)=>u+v.y+v.height/2,0)/n.length-l.height/2;break}return{element_id:e[i].id,new_position:{x:s,y:a}}})},vs=e=>{const{batchUpdatePositions:t,state:n}=Ge(),[l,i]=ee(!1),s=()=>e.selectedElementIds().length>=2,a=()=>{const b=e.selectedElementIds();return n.elements.filter(u=>b.includes(u.id))},o=async b=>{const u=a();if(u.length<2){console.warn("å¯¹é½åŠŸèƒ½éœ€è¦è‡³å°‘2ä¸ªå…ƒç´ ");return}try{i(!0),console.log(`ğŸ¯ æ‰§è¡Œ${b}å¯¹é½:`,u.length,"ä¸ªå…ƒç´ ");const v=hs(u,b);await t(v),console.log("âœ… å¯¹é½æ“ä½œå®Œæˆ"),e.onAlignmentComplete&&e.onAlignmentComplete(v)}catch(v){console.error("âŒ å¯¹é½æ“ä½œå¤±è´¥:",v)}finally{i(!1)}},g=()=>a().length<2?null:{recommended:"left",reason:"å»ºè®®å·¦å¯¹é½",results:[]},c=()=>g();return(()=>{var b=gs(),u=b.firstChild,v=u.firstChild,f=v.nextSibling,d=f.firstChild,y=d.nextSibling,p=y.nextSibling,$=u.nextSibling,x=$.firstChild,k=x.nextSibling,T=k.firstChild,E=T.nextSibling,N=E.nextSibling,M=$.nextSibling,B=M.firstChild,j=B.nextSibling,L=j.firstChild,D=L.nextSibling;return d.$$click=()=>o("left"),y.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"h_center")}),y.$$click=()=>o("h_center"),p.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"right")}),p.$$click=()=>o("right"),T.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"top")}),T.$$click=()=>o("top"),E.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"v_center")}),E.$$click=()=>o("v_center"),N.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"bottom")}),N.$$click=()=>o("bottom"),L.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"distribute_h")}),L.$$click=()=>o("distribute_h"),D.addEventListener("mouseenter",()=>{var _;return(_=e.onAlignmentPreview)==null?void 0:_.call(e,"distribute_v")}),D.$$click=()=>o("distribute_v"),r(b,h(z,{get when(){return _e(()=>!!s())()&&c()},get children(){var _=cs(),Q=_.firstChild,O=Q.nextSibling,C=O.firstChild,P=C.nextSibling,J=O.nextSibling;return O.$$click=()=>o(c().recommended),r(P,()=>c().recommended==="left"&&"å·¦å¯¹é½",null),r(P,()=>c().recommended==="right"&&"å³å¯¹é½",null),r(P,()=>c().recommended==="top"&&"é¡¶å¯¹é½",null),r(P,()=>c().recommended==="bottom"&&"åº•å¯¹é½",null),r(P,()=>c().recommended==="h_center"&&"æ°´å¹³å±…ä¸­",null),r(P,()=>c().recommended==="v_center"&&"å‚ç›´å±…ä¸­",null),r(J,()=>c().reason),A(H=>{var V=l(),W=c().reason;return V!==H.e&&(O.disabled=H.e=V),W!==H.t&&q(O,"title",H.t=W),H},{e:void 0,t:void 0}),_}}),null),r(b,h(z,{get when(){return!s()},get children(){var _=ds(),Q=_.firstChild;return Q.firstChild,r(Q,()=>e.selectedElementIds().length<3&&"ï¼Œè‡³å°‘3ä¸ªå…ƒç´ ä»¥ä½¿ç”¨åˆ†å¸ƒåŠŸèƒ½",null),_}}),null),r(b,h(z,{get when(){return l()},get children(){return us()}}),null),A(_=>{var Q=!s()||l(),O=!s()||l(),C=!s()||l(),P=!s()||l(),J=!s()||l(),H=!s()||l(),V=e.selectedElementIds().length<3||l(),W=e.selectedElementIds().length<3||l();return Q!==_.e&&(d.disabled=_.e=Q),O!==_.t&&(y.disabled=_.t=O),C!==_.a&&(p.disabled=_.a=C),P!==_.o&&(T.disabled=_.o=P),J!==_.i&&(E.disabled=_.i=J),H!==_.n&&(N.disabled=_.n=H),V!==_.s&&(L.disabled=_.s=V),W!==_.h&&(D.disabled=_.h=W),_},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),b})()},fs=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=fs,document.head.appendChild(e)}De(["click"]);var ms=m("<div>"),bs=m('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> Ã— <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">å…ƒç´ : <!> | é€‰ä¸­: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),ys=m("<span class=ml-2>Zoom: <!>%");const $s=()=>{const{state:e,selectElement:t,clearSelection:n,createElement:l,selectMultiple:i,updateElement:s,batchUpdatePositions:a}=Ge();let o;const[g,c]=ee([]),b=Ce(()=>e.elements.filter(k=>k.visible)),u=(k,T)=>{if(!o)return{x:0,y:0};const E=o.getBoundingClientRect(),N=(k-E.left)/e.canvas_config.zoom,M=(T-E.top)/e.canvas_config.zoom;return{x:N,y:M}},v=async k=>{console.log("ğŸ¯ é€‰æ‹©å…ƒç´ ",k),c([...k]);try{k.length===0?await n():k.length===1?await t(k[0]):await i([...k])}catch(T){console.error("âŒ é€‰æ‹©å…ƒç´ å¤±è´¥:",T)}},f=async k=>{try{await a(k)}catch(T){console.error("âŒ æ‰¹é‡æ›´æ–°ä½ç½®å¤±è´¥:",T)}},d=async(k,T)=>{try{await s(k,{position:{x:T.x,y:T.y}})}catch(E){console.error("âŒ ç§»åŠ¨å…ƒç´ å¤±è´¥:",E)}},y=async(k,T,E)=>{try{await s(k,{size:T,position:E})}catch(N){console.error("âŒ è°ƒæ•´å¤§å°å¤±è´¥:",N)}},p=async k=>{console.log("ğŸ–±ï¸ ç”»å¸ƒç‚¹å‡»",k)},$=async k=>{var T;k.preventDefault();try{const E=(T=k.dataTransfer)==null?void 0:T.getData("application/json");if(!E)return;const{type:N,component:M}=JSON.parse(E);if(N==="component"){const{x:B,y:j}=u(k.clientX,k.clientY),L=Math.max(0,B-M.default_size.width/2),D=Math.max(0,j-M.default_size.height/2);console.log("ğŸ¯ é€šè¿‡æ‹–æ”¾åˆ›å»ºç»„ä»¶:",M.name,"at",L,D);const _=await l(M.id,{x:L,y:D},M.default_size,M.create_content());console.log("âœ… é€šè¿‡æ‹–æ”¾åˆ›å»ºå…ƒç´ æˆåŠŸ:",_),c([_]),await t(_)}}catch(E){console.error("æ‹–æ”¾å¤„ç†å¤±è´¥:",E)}};qe(()=>{c([...e.selected_ids])}),Ce(()=>{c([...e.selected_ids])});const x=Ce(()=>{const{width:k,height:T}=e.canvas_config;return`0 0 ${k} ${T}`});return(()=>{var k=bs(),T=k.firstChild,E=T.firstChild,N=E.firstChild,M=N.nextSibling,B=M.nextSibling,j=B.nextSibling,L=j.nextSibling,D=L.nextSibling,_=D.firstChild,Q=_.nextSibling;Q.nextSibling;var O=T.nextSibling,C=O.firstChild,P=C.firstChild,J=P.firstChild,H=J.firstChild,V=H.nextSibling,W=V.nextSibling,G=W.nextSibling;r(E,()=>e.canvas_config.width,M),r(E,()=>e.canvas_config.height,j),r(E,(()=>{var F=_e(()=>e.canvas_config.zoom!==1);return()=>F()&&(()=>{var de=ys(),pe=de.firstChild,ae=pe.nextSibling;return ae.nextSibling,r(de,()=>Math.round(e.canvas_config.zoom*100),ae),de})()})(),D),r(D,()=>e.elements.length,Q),r(D,()=>g().length,null),P.style.setProperty("position","relative"),J.addEventListener("drop",$),J.addEventListener("dragover",F=>{F.preventDefault(),F.dataTransfer.dropEffect="copy"}),J.$$contextmenu=F=>F.preventDefault();var U=o;return typeof U=="function"?Bt(U,J):o=J,r(J,h(Ni,{get config(){return e.canvas_config}}),V),r(W,h(ce,{get each(){return b()},children:F=>h(Xi,{element:F,get selected(){return g().includes(F.id)}})})),r(G,h(ce,{get each(){return b().filter(F=>g().includes(F.id))},children:F=>h(ts,{element:F})})),r(P,h(os,{canvasRef:o,getAllElements:()=>[...e.elements],onElementsSelect:v,onElementMove:d,onBatchUpdatePositions:f,onElementResize:y,onCanvasClick:p,get enableDebugMode(){return!1}}),null),r(P,h(z,{get when(){return g().length>=2},get children(){var F=ms();return F.style.setProperty("position","fixed"),F.style.setProperty("top","80px"),F.style.setProperty("right","20px"),F.style.setProperty("z-index","1000"),F.style.setProperty("background","white"),F.style.setProperty("border-radius","8px"),F.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),F.style.setProperty("border","1px solid #e5e7eb"),r(F,h(vs,{selectedElementIds:g,onAlignmentComplete:de=>{console.log("âœ… å¯¹é½æ“ä½œå®Œæˆ:",de)},onAlignmentPreview:de=>{console.log("ğŸ‘ï¸ å¯¹é½é¢„è§ˆ:",de)},onPreviewCancel:()=>{console.log("âŒ å–æ¶ˆå¯¹é½é¢„è§ˆ")}})),F}}),null),A(F=>{var de=e.canvas_config.width*e.canvas_config.zoom,pe=e.canvas_config.height*e.canvas_config.zoom,ae=x(),ne=e.canvas_config.width,te=e.canvas_config.height,le=e.canvas_config.background_color,re=e.canvas_config.width,Y=e.canvas_config.height;return de!==F.e&&q(J,"width",F.e=de),pe!==F.t&&q(J,"height",F.t=pe),ae!==F.a&&q(J,"viewBox",F.a=ae),ne!==F.o&&q(H,"width",F.o=ne),te!==F.i&&q(H,"height",F.i=te),le!==F.n&&q(H,"fill",F.n=le),re!==F.s&&q(V,"width",F.s=re),Y!==F.h&&q(V,"height",F.h=Y),F},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),k})()};De(["contextmenu"]);var ps=m("<div class=wizard-errors>"),_s=m("<div class=data-source-wizard><div class=wizard-header><button class=back-btn>â† è¿”å›</button><div class=wizard-title><h3>æ·»åŠ JSONæ•°æ®æº</h3><p></p></div></div><div class=wizard-content>"),xs=m("<div class=error-message>"),Ss=m("<div class=wizard-progress>"),ws=m("<div><div class=step-indicator><span class=step-number></span></div><div class=step-info><div class=step-title></div><div class=step-description>"),Cs=m("<div class=source-type-step><div class=step-header><h4>é€‰æ‹©JSONæ•°æ®çš„è¾“å…¥æ–¹å¼</h4><p>è¯·é€‰æ‹©æœ€é€‚åˆæ‚¨ä½¿ç”¨åœºæ™¯çš„æ•°æ®è¾“å…¥æ–¹å¼</p></div><div class=source-options>"),ks=m("<div><div class=option-header><div class=option-title></div><div class=option-description></div></div><div class=option-features></div><div class=option-example></div><div class=option-selector><input type=radio>"),Ts=m("<span class=feature-tag>"),Es=m("<div class=data-input-step><div class=step-header><h4></h4><p>"),Ls=m("<div class=selected-file><span class=file-icon>ğŸ“„</span><span class=file-name></span><button class=remove-file>âœ•"),Ds=m("<div class=file-error>"),Ps=m('<div class=file-selection-panel><div><div class=drop-zone-content><div class=drop-icon>ğŸ“</div><div class=drop-text><div>å°†JSONæ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„</div><div>æˆ–è€…ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</div></div></div></div><div class=file-input-section><label class=file-select-btn><input type=file accept=.json>é€‰æ‹©JSONæ–‡ä»¶</label></div><div class=file-help><div class=help-title>ğŸ“ æ”¯æŒçš„æ–‡ä»¶æ ¼å¼:</div><ul class=help-list><li>JSONå¯¹è±¡: <code>{"name": "value"}</code></li><li>JSONæ•°ç»„: <code>[{"id": 1}, {"id": 2}]</code></li><li>æ–‡ä»¶å¤§å°: æœ€å¤§10MB</li><li>ç¼–ç æ ¼å¼: UTF-8'),As=m("<div class=field-error>"),zs=m("<div class=form-field><label class=field-label>åˆ·æ–°é—´éš” (ç§’)</label><div class=interval-input-group><input type=range class=interval-slider min=10 max=3600 step=10><input type=number class=interval-number min=10 max=3600><span class=interval-unit>ç§’</span></div><div class=field-hint>æ¨èè®¾ç½®: 5åˆ†é’Ÿ (300ç§’) é€‚åˆå¤§å¤šæ•°åœºæ™¯"),Rs=m('<div class=form-section><div class=section-title><span class=title-icon>ğŸ”„</span><h5>è‡ªåŠ¨åˆ·æ–°è®¾ç½®</h5></div><div class=form-field><label class="field-label checkbox-label"><input type=checkbox class=refresh-checkbox><span class=checkbox-text>å¯ç”¨è‡ªåŠ¨åˆ·æ–°</span></label><div class=field-hint>å½“JSONæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½æ•°æ®'),Ms=m('<div class=summary-item><span class=summary-label>æ–‡ä»¶è·¯å¾„:</span><span class="summary-value file-path">'),Ns=m("<div class=summary-item><span class=summary-label>è‡ªåŠ¨åˆ·æ–°:</span><span class=summary-value>"),Os=m("<div class=summary-item><span class=summary-label>å†…å®¹é•¿åº¦:</span><span class=summary-value> å­—ç¬¦"),Is=m('<div class=configuration-step><div class=step-header><h4>âš™ï¸ é…ç½®æ•°æ®æº</h4><p>ä¸ºæ‚¨çš„æ•°æ®æºè®¾ç½®åç§°å’ŒåŸºæœ¬é€‰é¡¹</p></div><div class=config-form><div class=form-section><div class=section-title><span class=title-icon>ğŸ·ï¸</span><h5>åŸºæœ¬ä¿¡æ¯</h5></div><div class=form-field><label class=field-label>æ•°æ®æºåç§° <span class=required>*</span></label><input type=text placeholder="è¯·è¾“å…¥æ•°æ®æºåç§°ï¼Œå¦‚: å®¢æˆ·æ•°æ®ã€é”€å”®æŠ¥è¡¨ç­‰"maxlength=50><div class=field-hint>ä¸ºæ‚¨çš„æ•°æ®æºèµ·ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„åç§°ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨å’Œç®¡ç†</div></div></div><div class=form-section><div class=section-title><span class=title-icon>ğŸ“‹</span><h5>é…ç½®æ¦‚è§ˆ</h5></div><div class=config-summary><div class=summary-item><span class=summary-label>æ•°æ®æ¥æº:</span><span class=summary-value></span></div></div></div><div class=form-section><div class=usage-tips><div class=tips-title>ğŸ’¡ ä½¿ç”¨å»ºè®®:</div><ul class=tips-list><li>ä½¿ç”¨å…·æœ‰æè¿°æ€§çš„åç§°ï¼Œå¦‚"2024å¹´é”€å”®æ•°æ®"è€Œä¸æ˜¯"data1"</li><li>å¯¹äºç»å¸¸å˜åŒ–çš„æ–‡ä»¶ï¼Œå»ºè®®å¯ç”¨è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½</li><li>è¾ƒå¤§çš„JSONæ–‡ä»¶å»ºè®®è®¾ç½®è¾ƒé•¿çš„åˆ·æ–°é—´éš”ä»¥é¿å…æ€§èƒ½é—®é¢˜</li><li>ç›´æ¥è¾“å…¥çš„JSONå†…å®¹ä¼šä¿å­˜åœ¨åº”ç”¨ä¸­ï¼Œä¸ä¼šè‡ªåŠ¨æ›´æ–°'),Us=m("<span class=status-success>âœ… JSONæ ¼å¼æ­£ç¡®"),Fs=m("<span class=status-error>âŒ æ ¼å¼é”™è¯¯"),qs=m("<div class=template-selector><div class=template-header>é€‰æ‹©JSONæ¨¡æ¿:</div><div class=template-list>"),Bs=m("<div class=syntax-error><div class=error-title>âŒ JSONæ ¼å¼é”™è¯¯:</div><div class=error-message>"),js=m(`<div class=content-editing-panel><div class=editor-toolbar><button class=template-btn>ğŸ“‹ ä½¿ç”¨æ¨¡æ¿</button><button class=clear-btn>ğŸ—‘ï¸ æ¸…ç©º</button><div class=editor-status></div></div><div class=json-editor><textarea placeholder="è¯·è¾“å…¥æˆ–ç²˜è´´JSONå†…å®¹...

ç¤ºä¾‹:
{
  &quot;name&quot;: &quot;ç¤ºä¾‹æ•°æ®&quot;,
  &quot;value&quot;: 123
}"rows=15></textarea></div><div class=editor-help><div class=help-title>ğŸ’¡ ä½¿ç”¨æç¤º:</div><ul class=help-list><li>æ”¯æŒJSONå¯¹è±¡å’Œæ•°ç»„æ ¼å¼</li><li>å­—ç¬¦ä¸²éœ€è¦ç”¨åŒå¼•å·åŒ…å›´</li><li>å¯ä»¥ä½¿ç”¨Ctrl+Aå…¨é€‰ï¼ŒCtrl+Vç²˜è´´</li><li>ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯JSONæ ¼å¼`),Qs=m("<div class=template-item><div class=template-name></div><div class=template-description>"),Hs=m("<div class=error-details><div class=error-title>é”™è¯¯è¯¦æƒ…:</div><div class=error-content>"),Js=m("<div><div class=result-message><span class=result-icon></span><span class=result-text>"),Vs=m('<div class=info-item><span class=info-label>æ–‡ä»¶è·¯å¾„:</span><span class="info-value file-path">'),Ws=m("<div class=info-item><span class=info-label>è‡ªåŠ¨åˆ·æ–°:</span><span class=info-value>"),Gs=m("<div class=advanced-content><div class=info-grid><div class=info-item><span class=info-label>æ•°æ®æºç±»å‹:</span><span class=info-value></span></div><div class=info-item><span class=info-label>é¢„è§ˆé™åˆ¶:</span><span class=info-value>æœ€å¤šæ˜¾ç¤º5æ¡è®°å½•"),Ks=m("<div class=data-preview><div class=preview-header><div class=preview-title><span class=preview-icon>ğŸ“Š</span><h5>æ•°æ®é¢„è§ˆ</h5></div><div class=preview-stats><span class=stat-item><span class=stat-label>è®°å½•æ•°:</span><span class=stat-value></span></span><span class=stat-item><span class=stat-label>å­—æ®µæ•°:</span><span class=stat-value></span></span></div></div><div class=fields-info><div class=fields-title>ğŸ“‹ æ£€æµ‹åˆ°çš„å­—æ®µ:</div><div class=fields-grid></div></div><div class=preview-table-container><div class=table-title>ğŸ” ç¤ºä¾‹æ•°æ® (å‰5æ¡):</div><div class=preview-table><table><thead><tr></tr></thead><tbody></tbody></table></div></div><div class=advanced-info><button class=advanced-toggle><span class=toggle-icon></span><span class=toggle-text>é«˜çº§ä¿¡æ¯"),Ys=m("<li>é¦–æ¬¡é…ç½®æ•°æ®æºæ—¶ï¼Œå»ºè®®å…ˆæµ‹è¯•è¿æ¥ç¡®ä¿é…ç½®æ­£ç¡®"),Xs=m("<li>æµ‹è¯•è¿‡ç¨‹ä¼šéªŒè¯JSONæ ¼å¼å’Œæ–‡ä»¶è®¿é—®æƒé™"),Zs=m("<li>é¢„è§ˆåŠŸèƒ½å¯ä»¥å¸®åŠ©æ‚¨ç¡®è®¤æ•°æ®ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸ"),er=m("<li>âœ… è¿æ¥æµ‹è¯•æˆåŠŸï¼æ‚¨å¯ä»¥ç»§ç»­åˆ›å»ºæ•°æ®æº"),tr=m("<li>é¢„è§ˆæ˜¾ç¤ºçš„æ˜¯å®é™…æ•°æ®ï¼Œåˆ›å»ºåå¯ç”¨äºæŠ¥è¡¨è®¾è®¡"),nr=m("<li>å­—æ®µåç§°å°†ç”¨äºæ•°æ®ç»‘å®šè¡¨è¾¾å¼"),lr=m("<li>âŒ è¯·æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®"),ir=m("<li>å¦‚æœæ˜¯æ–‡ä»¶ç±»å‹ï¼Œè¯·ç¡®è®¤æ–‡ä»¶è·¯å¾„å­˜åœ¨ä¸”å¯è®¿é—®"),sr=m("<li>å¯ä»¥è¿”å›ä¸Šä¸€æ­¥ä¿®æ”¹é…ç½®åé‡æ–°æµ‹è¯•"),rr=m("<div class=security-notice><div class=notice-icon>ğŸ”’</div><div class=notice-content><div class=notice-title>å®‰å…¨æç¤º</div><div class=notice-text>åº”ç”¨å°†è¯»å–æŒ‡å®šçš„JSONæ–‡ä»¶ã€‚è¯·ç¡®ä¿æ–‡ä»¶å†…å®¹å®‰å…¨ï¼Œé¿å…åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚ å¯ç”¨è‡ªåŠ¨åˆ·æ–°æ—¶ï¼Œåº”ç”¨ä¼šå®šæœŸæ£€æŸ¥æ–‡ä»¶å˜åŒ–ã€‚"),ar=m("<div class=test-preview-step><div class=step-header><h4>ğŸ§ª æµ‹è¯•ä¸é¢„è§ˆ</h4><p>éªŒè¯æ•°æ®æºé…ç½®å¹¶é¢„è§ˆæ•°æ®å†…å®¹</p></div><div class=test-section><div class=test-connection><div class=test-header><div class=test-title><span class=test-icon></span><span class=test-text></span></div><button></button></div></div><div class=test-suggestions><div class=suggestions-title>ğŸ’¡ æµ‹è¯•å»ºè®®:</div><ul class=suggestions-list>"),or=m("<span class=loading-spinner>â³"),cr=m("<span class=test-button-icon>ğŸ”Œ"),dr=m("<div class=field-tag><span class=field-name>"),ur=m("<th>"),gr=m("<tr>"),hr=m("<td><div class=cell-content>"),vr=m("<span class=validation-hint><span class=hint-icon>âš ï¸</span>è¯·å®Œæˆå½“å‰æ­¥éª¤çš„å¿…å¡«é¡¹"),fr=m('<button class="control-btn next-btn"><span class=btn-text>ä¸‹ä¸€æ­¥</span><span class=btn-icon>â†’'),mr=m('<button class="control-btn finish-btn">'),br=m("<span class=hint-text>é€‰æ‹©æ‚¨çš„JSONæ•°æ®æ¥æºæ–¹å¼"),en=m("<span class=hint-text>"),yr=m("<span class=hint-text>è®¾ç½®æ•°æ®æºåç§°å’Œé€‰é¡¹"),$r=m('<div class=wizard-controls><div class=controls-info><span class=current-step-info>æ­¥éª¤ <!> / 4: </span></div><div class=control-buttons><button class="control-btn back-btn"><span class=btn-icon>â†</span><span class=btn-text>ä¸Šä¸€æ­¥</span></button></div><div class=progress-hints>'),pr=m("<span class=btn-loading>â³"),_r=m("<span class=btn-text>åˆ›å»ºä¸­..."),xr=m("<span class=btn-icon>âœ“"),Sr=m("<span class=btn-text>åˆ›å»ºæ•°æ®æº");function En(e){const[t,n]=ee({currentStep:1,sourceType:null,name:"",config:{source_type:"content",auto_refresh:!1,refresh_interval:300},validation:{isValid:!1,errors:[],warnings:[]},testResult:null,loading:!1}),l=[{step:1,title:"é€‰æ‹©æ•°æ®æ¥æº",description:"é€‰æ‹©JSONæ•°æ®çš„è¾“å…¥æ–¹å¼"},{step:2,title:"è¾“å…¥æ•°æ®",description:"æä¾›å…·ä½“çš„JSONæ•°æ®"},{step:3,title:"åŸºç¡€é…ç½®",description:"è®¾ç½®æ•°æ®æºåç§°å’Œé€‰é¡¹"},{step:4,title:"æµ‹è¯•é¢„è§ˆ",description:"éªŒè¯æ•°æ®æºå¹¶é¢„è§ˆæ•ˆæœ"}],i=Ce(()=>{const d=t();switch(d.currentStep){case 1:return d.sourceType!==null;case 2:return s(d);case 3:return a(d);case 4:return o(d);default:return!1}}),s=d=>{var y,p;if(d.sourceType==="file")return!!((y=d.config.file_path)!=null&&y.trim());if(d.sourceType==="content"){const $=(p=d.config.json_content)==null?void 0:p.trim();if(!$)return!1;try{return JSON.parse($),!0}catch{return!1}}return!1},a=d=>{const y=d.name.trim();return!(y.length<2||y.length>50||!/^[\u4e00-\u9fa5a-zA-Z0-9\s\-_]+$/.test(y))},o=d=>{var y;return!!((y=d.testResult)!=null&&y.success)},g=d=>{const y=t();n(p=>({...p,validation:{...p.validation,errors:[]}})),y.currentStep===1&&y.sourceType?n(p=>({...p,currentStep:d,config:{...p.config,source_type:y.sourceType}})):n(p=>({...p,currentStep:d}))},c=()=>{const d=t();d.currentStep<4&&i()&&g(d.currentStep+1)},b=()=>{const d=t();d.currentStep>1&&(d.currentStep===4?n(y=>({...y,currentStep:y.currentStep-1,testResult:null})):g(d.currentStep-1))},u=d=>{n(y=>({...y,...d}))},v=async()=>{var y,p;const d=t();u({loading:!0,testResult:null});try{console.log("ğŸ”„ å¼€å§‹æµ‹è¯•è¿æ¥...");const $={...d.config,source_type:d.sourceType};if(await we.testConnection("json",$)){console.log("âœ… è¿æ¥æµ‹è¯•æˆåŠŸï¼Œè·å–é¢„è§ˆæ•°æ®...");const k=await we.discoverSchema("json",$),T=`temp_${Date.now()}`,E=await we.createDataSource(T,"json",$),N=await we.getPreview(E,void 0,5);await we.deleteDataSource(E),u({testResult:{success:!0,message:"è¿æ¥æµ‹è¯•æˆåŠŸï¼æ•°æ®æ ¼å¼æ­£ç¡®ã€‚",preview:{record_count:(p=(y=N.total_rows)!=null?y:N.total_count)!=null?p:0,fields:k.columns.map(M=>M.name),sample_data:N.rows}},loading:!1})}}catch($){console.error("âŒ è¿æ¥æµ‹è¯•å¤±è´¥:",$),u({testResult:{success:!1,message:"è¿æ¥æµ‹è¯•å¤±è´¥",error:$ instanceof Error?$.message:String($)},loading:!1})}},f=async()=>{const d=t();u({loading:!0});try{console.log("ğŸ”„ å¼€å§‹åˆ›å»ºæ•°æ®æº...");const y={...d.config,source_type:d.sourceType},p=await we.createDataSource(d.name,"json",y);console.log("âœ… æ•°æ®æºåˆ›å»ºæˆåŠŸï¼ŒID:",p);try{await Oe.setActiveDataSource(p),console.log("âœ… æ•°æ®æºè‡ªåŠ¨æ¿€æ´»æˆåŠŸ")}catch($){console.warn("âš ï¸ æ•°æ®æºæ¿€æ´»å¤±è´¥ï¼Œä½†åˆ›å»ºæˆåŠŸ:",$)}e.onSuccess(),e.onBack()}catch(y){console.error("âŒ åˆ›å»ºæ•°æ®æºå¤±è´¥:",y),u({validation:{isValid:!1,errors:[`åˆ›å»ºå¤±è´¥: ${y}`],warnings:[]},loading:!1})}};return(()=>{var d=_s(),y=d.firstChild,p=y.firstChild,$=p.nextSibling,x=$.firstChild,k=x.nextSibling,T=y.nextSibling;return Te(p,"click",e.onBack),r(k,()=>{var E;return(E=l[t().currentStep-1])==null?void 0:E.description}),r(d,h(wr,{get currentStep(){return t().currentStep},stepInfo:l,onStepClick:g}),T),r(T,h(z,{get when(){return t().currentStep===1},get children(){return h(Cr,{get selectedType(){return t().sourceType},onSelect:E=>u({sourceType:E,config:{...t().config,source_type:E}})})}}),null),r(T,h(z,{get when(){return t().currentStep===2},get children(){return h(kr,{get sourceType(){return t().sourceType},get config(){return t().config},onConfigUpdate:E=>u({config:{...t().config,...E}})})}}),null),r(T,h(z,{get when(){return t().currentStep===3},get children(){return h(Er,{get name(){return t().name},get config(){return t().config},onNameChange:E=>u({name:E}),onConfigUpdate:E=>u({config:{...t().config,...E}})})}}),null),r(T,h(z,{get when(){return t().currentStep===4},get children(){return h(Dr,{get config(){return t().config},get testResult(){return t().testResult},get loading(){return t().loading},onTest:v})}}),null),r(d,h(Pr,{get currentStep(){return t().currentStep},get canProceed(){return i()},get loading(){return t().loading},get testResult(){return t().testResult},onPrevious:b,onNext:c,onFinish:f}),null),r(d,h(z,{get when(){return t().validation.errors.length>0},get children(){var E=ps();return r(E,h(ce,{get each(){return t().validation.errors},children:N=>(()=>{var M=xs();return r(M,N),M})()})),E}}),null),d})()}function wr(e){return(()=>{var t=Ss();return r(t,h(ce,{get each(){return e.stepInfo},children:n=>{const l=e.currentStep===n.step,i=e.currentStep>n.step,s=e.currentStep>=n.step;return(()=>{var a=ws(),o=a.firstChild,g=o.firstChild,c=o.nextSibling,b=c.firstChild,u=b.nextSibling;return a.$$click=()=>s&&e.onStepClick(n.step),$e(a,`progress-step ${l?"active":""} ${i?"completed":""}`),r(g,()=>i?"âœ“":n.step),r(b,()=>n.title),r(u,()=>n.description),a})()}})),t})()}function Cr(e){const t=[{type:"file",title:"ğŸ“ ä»æ–‡ä»¶åŠ è½½",description:"ä»æœ¬åœ°JSONæ–‡ä»¶å¯¼å…¥æ•°æ®",features:["æ”¯æŒå¤§æ–‡ä»¶","è‡ªåŠ¨åˆ·æ–°","é€‚åˆé™æ€æ•°æ®"],example:"é€‚åˆï¼šæœ¬åœ°é…ç½®æ–‡ä»¶ã€å¯¼å‡ºæ•°æ®ç­‰"},{type:"content",title:"âœï¸ ç›´æ¥è¾“å…¥å†…å®¹",description:"ç²˜è´´æˆ–è¾“å…¥JSONå†…å®¹",features:["å¿«é€Ÿæµ‹è¯•","åŠ¨æ€ç¼–è¾‘","é€‚åˆå°æ•°æ®"],example:"é€‚åˆï¼šAPIå“åº”ã€ä¸´æ—¶æ•°æ®ã€æµ‹è¯•æ•°æ®ç­‰"}];return(()=>{var n=Cs(),l=n.firstChild,i=l.nextSibling;return r(i,h(ce,{each:t,children:s=>(()=>{var a=ks(),o=a.firstChild,g=o.firstChild,c=g.nextSibling,b=o.nextSibling,u=b.nextSibling,v=u.nextSibling,f=v.firstChild;return a.$$click=()=>e.onSelect(s.type),r(g,()=>s.title),r(c,()=>s.description),r(b,h(ce,{get each(){return s.features},children:d=>(()=>{var y=Ts();return r(y,d),y})()})),r(u,()=>s.example),f.addEventListener("change",()=>e.onSelect(s.type)),A(()=>$e(a,`source-option ${e.selectedType===s.type?"selected":""}`)),A(()=>f.checked=e.selectedType===s.type),a})()})),n})()}function kr(e){return(()=>{var t=Es(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return r(l,()=>e.sourceType==="file"?"ğŸ“ é€‰æ‹©JSONæ–‡ä»¶":"âœï¸ è¾“å…¥JSONå†…å®¹"),r(i,()=>e.sourceType==="file"?"è¯·é€‰æ‹©è¦å¯¼å…¥çš„JSONæ–‡ä»¶ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ ":"è¯·ç²˜è´´æˆ–è¾“å…¥æ‚¨çš„JSONæ•°æ®å†…å®¹"),r(t,h(z,{get when(){return e.sourceType==="file"},get children(){return h(Tr,{get filePath(){return e.config.file_path||""},onFileSelect:s=>e.onConfigUpdate({file_path:s})})}}),null),r(t,h(z,{get when(){return e.sourceType==="content"},get children(){return h(Lr,{get content(){return e.config.json_content||""},onContentChange:s=>e.onConfigUpdate({json_content:s})})}}),null),t})()}function Tr(e){const[t,n]=ee(!1),[l,i]=ee(null),s=g=>{var u;const b=(u=g.target.files)==null?void 0:u[0];b&&o(b)},a=g=>{var b,u;g.preventDefault(),n(!1);const c=(u=(b=g.dataTransfer)==null?void 0:b.files)==null?void 0:u[0];c&&o(c)},o=g=>{if(i(null),!g.name.endsWith(".json")){i("è¯·é€‰æ‹©JSONæ–‡ä»¶ï¼ˆ.jsonæ ¼å¼ï¼‰");return}if(g.size>10*1024*1024){i("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB");return}const c=new FileReader;c.onload=b=>{var u;try{const v=(u=b.target)==null?void 0:u.result;JSON.parse(v),e.onFileSelect(g.name),console.log("âœ… æ–‡ä»¶é€‰æ‹©æˆåŠŸ:",g.name)}catch{i("æ–‡ä»¶å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼")}},c.readAsText(g)};return(()=>{var g=Ps(),c=g.firstChild,b=c.nextSibling,u=b.firstChild,v=u.firstChild,f=b.nextSibling;return c.addEventListener("drop",a),c.addEventListener("dragleave",()=>n(!1)),c.addEventListener("dragover",d=>{d.preventDefault(),n(!0)}),v.addEventListener("change",s),r(b,h(z,{get when(){return e.filePath},get children(){var d=Ls(),y=d.firstChild,p=y.nextSibling,$=p.nextSibling;return r(p,()=>e.filePath),$.$$click=()=>e.onFileSelect(""),d}}),null),r(g,h(z,{get when(){return l()},get children(){var d=Ds();return r(d,l),d}}),f),A(()=>$e(c,`file-drop-zone ${t()?"active":""}`)),g})()}function Er(e){const[t,n]=ee(null),l=s=>{e.onNameChange(s),s.trim().length===0?n("æ•°æ®æºåç§°ä¸èƒ½ä¸ºç©º"):s.trim().length<2?n("æ•°æ®æºåç§°è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦"):s.trim().length>50?n("æ•°æ®æºåç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦"):/^[\u4e00-\u9fa5a-zA-Z0-9\s\-_]+$/.test(s.trim())?n(null):n("æ•°æ®æºåç§°åªèƒ½åŒ…å«ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ç©ºæ ¼ã€è¿å­—ç¬¦å’Œä¸‹åˆ’çº¿")},i=s=>{const a=parseInt(s);!isNaN(a)&&a>=10&&a<=3600&&e.onConfigUpdate({refresh_interval:a})};return(()=>{var s=Is(),a=s.firstChild,o=a.nextSibling,g=o.firstChild,c=g.firstChild,b=c.nextSibling,u=b.firstChild,v=u.nextSibling,f=v.nextSibling,d=g.nextSibling,y=d.firstChild,p=y.nextSibling,$=p.firstChild,x=$.firstChild,k=x.nextSibling;return v.$$input=T=>l(T.currentTarget.value),r(b,h(z,{get when(){return t()},get children(){var T=As();return r(T,t),T}}),f),r(o,h(z,{get when(){return e.config.source_type==="file"},get children(){var T=Rs(),E=T.firstChild,N=E.nextSibling,M=N.firstChild,B=M.firstChild;return B.addEventListener("change",j=>e.onConfigUpdate({auto_refresh:j.currentTarget.checked})),r(T,h(z,{get when(){return e.config.auto_refresh},get children(){var j=zs(),L=j.firstChild,D=L.nextSibling,_=D.firstChild,Q=_.nextSibling;return _.$$input=O=>i(O.currentTarget.value),Q.addEventListener("change",O=>i(O.currentTarget.value)),A(()=>_.value=e.config.refresh_interval),A(()=>Q.value=e.config.refresh_interval),j}}),null),A(()=>B.checked=e.config.auto_refresh),T}}),d),r(k,()=>e.config.source_type==="file"?"ğŸ“ ä»æ–‡ä»¶åŠ è½½":"âœï¸ ç›´æ¥è¾“å…¥å†…å®¹"),r(p,h(z,{get when(){return e.config.source_type==="file"},get children(){return[(()=>{var T=Ms(),E=T.firstChild,N=E.nextSibling;return r(N,()=>e.config.file_path||"(æœªé€‰æ‹©æ–‡ä»¶)"),T})(),(()=>{var T=Ns(),E=T.firstChild,N=E.nextSibling;return r(N,()=>e.config.auto_refresh?`âœ… æ¯ ${e.config.refresh_interval} ç§’æ£€æŸ¥ä¸€æ¬¡`:"âŒ å·²å…³é—­"),T})()]}}),null),r(p,h(z,{get when(){return e.config.source_type==="content"},get children(){var T=Os(),E=T.firstChild,N=E.nextSibling,M=N.firstChild;return r(N,()=>{var B;return((B=e.config.json_content)==null?void 0:B.length)||0},M),T}}),null),A(()=>$e(v,`name-input ${t()?"error":""}`)),A(()=>v.value=e.name),s})()}function Lr(e){const[t,n]=ee(null),[l,i]=ee(!1),s=[{name:"ç®€å•å¯¹è±¡",description:"å•ä¸ªJSONå¯¹è±¡",content:`{
  "name": "ç¤ºä¾‹æ•°æ®",
  "value": 123,
  "active": true,
  "created_at": "2024-12-21"
}`},{name:"å¯¹è±¡æ•°ç»„",description:"å¤šæ¡è®°å½•æ•°æ®",content:`[
  {
    "id": 1,
    "name": "å¼ ä¸‰",
    "age": 25,
    "department": "æŠ€æœ¯éƒ¨"
  },
  {
    "id": 2,
    "name": "æå››", 
    "age": 30,
    "department": "é”€å”®éƒ¨"
  }
]`},{name:"å¤æ‚åµŒå¥—",description:"åŒ…å«åµŒå¥—å¯¹è±¡å’Œæ•°ç»„",content:`{
  "company": "ç¤ºä¾‹å…¬å¸",
  "employees": [
    {
      "name": "å¼ ä¸‰",
      "position": "å·¥ç¨‹å¸ˆ",
      "skills": ["JavaScript", "Python"],
      "contact": {
        "email": "zhang@example.com",
        "phone": "138****1234"
      }
    }
  ],
  "metadata": {
    "total": 1,
    "updated": "2024-12-21T10:30:00Z"
  }
}`}],a=g=>{if(e.onContentChange(g),g.trim())try{JSON.parse(g),n(null)}catch(c){n(c instanceof Error?c.message:"æ— æ•ˆçš„JSONæ ¼å¼")}else n(null)},o=g=>{e.onContentChange(g.content),n(null),i(!1)};return(()=>{var g=js(),c=g.firstChild,b=c.firstChild,u=b.nextSibling,v=u.nextSibling,f=c.nextSibling,d=f.firstChild,y=f.nextSibling;return b.$$click=()=>i(!l()),u.$$click=()=>e.onContentChange(""),r(v,h(z,{get when(){return _e(()=>!t())()&&e.content.trim()},get children(){return Us()}}),null),r(v,h(z,{get when(){return t()},get children(){return Fs()}}),null),r(g,h(z,{get when(){return l()},get children(){var p=qs(),$=p.firstChild,x=$.nextSibling;return r(x,h(ce,{each:s,children:k=>(()=>{var T=Qs(),E=T.firstChild,N=E.nextSibling;return T.$$click=()=>o(k),r(E,()=>k.name),r(N,()=>k.description),T})()})),p}}),f),d.$$input=p=>a(p.currentTarget.value),r(g,h(z,{get when(){return t()},get children(){var p=Bs(),$=p.firstChild,x=$.nextSibling;return r(x,t),p}}),y),A(p=>{var $=!e.content,x=`json-textarea ${t()?"error":""}`;return $!==p.e&&(u.disabled=p.e=$),x!==p.t&&$e(d,p.t=x),p},{e:void 0,t:void 0}),A(()=>d.value=e.content),g})()}function Dr(e){const[t,n]=ee(!1),l=()=>e.loading?"ğŸ”„":e.testResult?e.testResult.success?"âœ…":"âŒ":"âš¡",i=()=>e.loading?"æµ‹è¯•è¿æ¥ä¸­...":e.testResult?e.testResult.success?"è¿æ¥æµ‹è¯•æˆåŠŸ":"è¿æ¥æµ‹è¯•å¤±è´¥":"ç‚¹å‡»æµ‹è¯•è¿æ¥",s=()=>e.loading?"testing":e.testResult?e.testResult.success?"success":"error":"ready",a=o=>typeof o=="object"?JSON.stringify(o,null,2):String(o);return(()=>{var o=ar(),g=o.firstChild,c=g.nextSibling,b=c.firstChild,u=b.firstChild,v=u.firstChild,f=v.firstChild,d=f.nextSibling,y=v.nextSibling,p=b.nextSibling,$=p.firstChild,x=$.nextSibling;return r(f,l),r(d,i),Te(y,"click",e.onTest),r(y,(()=>{var k=_e(()=>!!e.loading);return()=>k()?[or(),"æµ‹è¯•ä¸­..."]:[cr(),"æµ‹è¯•è¿æ¥"]})()),r(b,h(z,{get when(){return e.testResult},get children(){var k=Js(),T=k.firstChild,E=T.firstChild,N=E.nextSibling;return r(E,l),r(N,()=>e.testResult.message),r(k,h(z,{get when(){return e.testResult.error},get children(){var M=Hs(),B=M.firstChild,j=B.nextSibling;return r(j,()=>e.testResult.error),M}}),null),A(()=>$e(k,`test-result ${s()}`)),k}}),null),r(c,h(z,{get when(){var k;return((k=e.testResult)==null?void 0:k.success)&&e.testResult.preview},get children(){var k=Ks(),T=k.firstChild,E=T.firstChild,N=E.nextSibling,M=N.firstChild,B=M.firstChild,j=B.nextSibling,L=M.nextSibling,D=L.firstChild,_=D.nextSibling,Q=T.nextSibling,O=Q.firstChild,C=O.nextSibling,P=Q.nextSibling,J=P.firstChild,H=J.nextSibling,V=H.firstChild,W=V.firstChild,G=W.firstChild,U=W.nextSibling,F=P.nextSibling,de=F.firstChild,pe=de.firstChild;return r(j,()=>e.testResult.preview.record_count),r(_,()=>e.testResult.preview.fields.length),r(C,h(ce,{get each(){return e.testResult.preview.fields},children:ae=>(()=>{var ne=dr(),te=ne.firstChild;return r(te,ae),ne})()})),r(G,h(ce,{get each(){return e.testResult.preview.fields},children:ae=>(()=>{var ne=ur();return r(ne,ae),ne})()})),r(U,h(ce,{get each(){return e.testResult.preview.sample_data},children:ae=>(()=>{var ne=gr();return r(ne,h(ce,{get each(){return e.testResult.preview.fields},children:te=>(()=>{var le=hr(),re=le.firstChild;return r(re,(()=>{var Y=_e(()=>ae[te]!==void 0);return()=>Y()?a(ae[te]):"-"})()),le})()})),ne})()})),de.$$click=()=>n(!t()),r(pe,()=>t()?"â–¼":"â–¶"),r(F,h(z,{get when(){return t()},get children(){var ae=Gs(),ne=ae.firstChild,te=ne.firstChild,le=te.firstChild,re=le.nextSibling,Y=te.nextSibling;return r(re,()=>e.config.source_type==="file"?"JSONæ–‡ä»¶":"JSONå†…å®¹"),r(ne,h(z,{get when(){return e.config.source_type==="file"},get children(){return[(()=>{var X=Vs(),ue=X.firstChild,me=ue.nextSibling;return r(me,()=>e.config.file_path),X})(),(()=>{var X=Ws(),ue=X.firstChild,me=ue.nextSibling;return r(me,()=>e.config.auto_refresh?"å·²å¯ç”¨":"å·²ç¦ç”¨"),X})()]}}),Y),ae}}),null),k}}),p),r(x,h(z,{get when(){return!e.testResult},get children(){return[Ys(),Xs(),Zs()]}}),null),r(x,h(z,{get when(){var k;return(k=e.testResult)==null?void 0:k.success},get children(){return[er(),tr(),nr()]}}),null),r(x,h(z,{get when(){return e.testResult&&!e.testResult.success},get children(){return[lr(),ir(),sr()]}}),null),r(c,h(z,{get when(){return e.config.source_type==="file"},get children(){return rr()}}),null),A(k=>{var T=`test-button ${s()}`,E=e.loading;return T!==k.e&&$e(y,k.e=T),E!==k.t&&(y.disabled=k.t=E),k},{e:void 0,t:void 0}),o})()}function Pr(e){const t=s=>{switch(s){case 1:return"é€‰æ‹©æ¥æº";case 2:return"è¾“å…¥æ•°æ®";case 3:return"åŸºç¡€é…ç½®";case 4:return"æµ‹è¯•é¢„è§ˆ";default:return`æ­¥éª¤${s}`}},n=()=>e.currentStep>1,l=()=>e.currentStep<4&&e.canProceed,i=()=>e.currentStep===4&&e.canProceed;return(()=>{var s=$r(),a=s.firstChild,o=a.firstChild,g=o.firstChild,c=g.nextSibling;c.nextSibling;var b=a.nextSibling,u=b.firstChild,v=b.nextSibling;return r(o,()=>e.currentStep,c),r(o,()=>t(e.currentStep),null),r(a,h(z,{get when(){return!e.canProceed&&e.currentStep<4},get children(){return vr()}}),null),Te(u,"click",e.onPrevious),r(b,h(z,{get when(){return e.currentStep<4},get children(){var f=fr();return Te(f,"click",e.onNext),A(()=>f.disabled=!l()||e.loading),f}}),null),r(b,h(z,{get when(){return e.currentStep===4},get children(){var f=mr();return Te(f,"click",e.onFinish),r(f,(()=>{var d=_e(()=>!!e.loading);return()=>d()?[pr(),_r()]:[xr(),Sr()]})()),A(()=>f.disabled=!i()||e.loading),f}}),null),r(v,h(z,{get when(){return e.currentStep===1},get children(){return br()}}),null),r(v,h(z,{get when(){return e.currentStep===2},get children(){var f=en();return r(f,()=>{var d;return(d=e.testResult)!=null&&d.success?"æ•°æ®æ ¼å¼éªŒè¯æˆåŠŸ":"è¯·æä¾›JSONæ•°æ®å†…å®¹"}),f}}),null),r(v,h(z,{get when(){return e.currentStep===3},get children(){return yr()}}),null),r(v,h(z,{get when(){return e.currentStep===4},get children(){var f=en();return r(f,()=>{var d;return(d=e.testResult)!=null&&d.success?"ä¸€åˆ‡å°±ç»ªï¼Œå¯ä»¥åˆ›å»ºæ•°æ®æº":"å»ºè®®å…ˆæµ‹è¯•è¿æ¥ä»¥ç¡®ä¿é…ç½®æ­£ç¡®"}),f}}),null),A(()=>u.disabled=!n()||e.loading),s})()}De(["click","input"]);var Ar=m("<div class=data-sources-panel role=dialog aria-modal=true aria-labelledby=data-panel-title aria-describedby=data-panel-description><a href=#data-panel-content class=skip-to-content>è·³è½¬åˆ°å†…å®¹</a><div class=panel-header><h2 id=data-panel-title>æ•°æ®æºç®¡ç†</h2><span id=data-panel-description class=sr-only>ç®¡ç†JSONæ•°æ®æºï¼ŒåŒ…æ‹¬åˆ›å»ºã€ç¼–è¾‘ã€æµ‹è¯•å’Œé¢„è§ˆåŠŸèƒ½</span><button class=close-btn aria-label=å…³é—­æ•°æ®æºé¢æ¿ title=å…³é—­æ•°æ®æºé¢æ¿>Ã—</button></div><div class=panel-content id=data-panel-content>"),zr=m("<div class=error-message>"),Rr=m("<div class=loading-message>åŠ è½½ä¸­..."),Mr=m("<div class=empty-state><p>å°šæœªé…ç½®ä»»ä½•æ•°æ®æº</p><button>æ·»åŠ ç¬¬ä¸€ä¸ªæ•°æ®æº"),Nr=m("<div class=sources-grid>"),Or=m("<div class=data-sources-list><div class=list-header><div class=list-title><h3>å·²é…ç½®çš„æ•°æ®æº (<!>)</h3><button class=refresh-btn>ğŸ”„ åˆ·æ–°</button></div><button class=add-btn aria-label=æ·»åŠ æ–°çš„æ•°æ®æº title=åˆ›å»ºæ–°çš„JSONæ•°æ®æº>+ æ·»åŠ æ•°æ®æº"),Ir=m("<span class=active-badge title=å½“å‰æ¿€æ´»>å½“å‰"),Ur=m('<div class=source-card><div class=source-header><div class=source-info><h4></h4><span class=source-type></span></div><div class=source-status></div></div><div class=source-meta><div class=meta-item><span>åˆ›å»ºæ—¶é—´:</span><span></span></div><div class=meta-item><span>æœ€åæ›´æ–°:</span><span></span></div></div><div class=source-actions><button class="action-btn preview-btn">ğŸ‘ï¸ é¢„è§ˆ</button><button class="action-btn test-btn"title=è®¾ä¸ºå½“å‰æ•°æ®æº>â­ è®¾ä¸ºå½“å‰</button><button class="action-btn test-btn">ğŸ”Œ æµ‹è¯•</button><button class="action-btn edit-btn">âœï¸ ç¼–è¾‘</button><button class="action-btn delete-btn">ğŸ—‘ï¸ åˆ é™¤'),Fr=m("<span class=changes-indicator>â— æœ‰æœªä¿å­˜çš„æ›´æ”¹"),qr=m("<div class=error-details>"),Br=m("<div><div class=result-message> "),jr=m("<div class=error-message>âŒ "),Qr=m("<button type=button class=reset-btn>é‡ç½®æ›´æ”¹"),Hr=m('<div class=edit-data-source-form><div class=form-header><button class=back-btn>â† è¿”å›</button><div class=header-info><h3>ç¼–è¾‘æ•°æ®æº</h3><div class=source-meta><span class=source-type></span><span class=source-id>ID: </span></div></div></div><div class=edit-content><div class=edit-section><div class=section-header><h4>ğŸ·ï¸ åŸºæœ¬ä¿¡æ¯</h4></div><div class=form-field><label>æ•°æ®æºåç§°</label><input type=text placeholder=è¯·è¾“å…¥æ•°æ®æºåç§°></div></div><div class=edit-section><div class=section-header><h4>âš™ï¸ é…ç½®ä¿¡æ¯</h4></div><div class=form-field><label>æ•°æ®æºé…ç½®</label><textarea rows=12 placeholder="æ•°æ®æºé…ç½® (JSONæ ¼å¼)"></textarea><div class=config-hint>ğŸ’¡ ä¿®æ”¹é…ç½®åå»ºè®®å…ˆæµ‹è¯•è¿æ¥ï¼Œç¡®ä¿é…ç½®æœ‰æ•ˆ</div></div></div><div class=edit-section><div class=section-header><h4>ğŸ”Œ è¿æ¥æµ‹è¯•</h4><button class=test-connection-btn></button></div></div><div class=edit-section><div class=section-header><h4>ğŸ“Š æ•°æ®æºçŠ¶æ€</h4></div><div class=status-grid><div class=status-item><span class=status-label>å½“å‰çŠ¶æ€:</span><span></span></div><div class=status-item><span class=status-label>åˆ›å»ºæ—¶é—´:</span><span class=status-value></span></div><div class=status-item><span class=status-label>æœ€åæ›´æ–°:</span><span class=status-value></span></div></div></div><div class=form-actions><button type=button class=cancel-btn>å–æ¶ˆ</button><button type=button></button></div><div class=edit-tips><div class=tips-title>ğŸ’¡ ç¼–è¾‘æç¤º:</div><ul><li>ä¿®æ”¹é…ç½®åå»ºè®®å…ˆæµ‹è¯•è¿æ¥ç¡®ä¿æœ‰æ•ˆæ€§</li><li>ä¿å­˜æ›´æ”¹åå¯èƒ½éœ€è¦é‡æ–°æ¿€æ´»æ•°æ®æº</li><li>JSONé…ç½®æ ¼å¼é”™è¯¯ä¼šé˜»æ­¢ä¿å­˜</li><li>é‡ç½®æ›´æ”¹å¯æ¢å¤åˆ°ä¿å­˜å‰çš„çŠ¶æ€'),Jr=m("<div class=data-preview><div class=preview-header><button class=back-btn>â† è¿”å›</button><h3>æ•°æ®é¢„è§ˆ: </h3><div class=preview-info>å…± <!> è¡Œæ•°æ®ï¼Œæ˜¾ç¤ºå‰ <!> è¡Œ</div></div><div class=preview-table><table><thead><tr></tr></thead><tbody>"),Vr=m("<th>"),Wr=m("<tr>"),Gr=m("<td>");const Kr=e=>{const t=(e.type_name||e.provider_type||"").toLowerCase();return t.includes("database_mysql")?"MySQL":t.includes("database_postgresql")?"PostgreSQL":t==="json"?"JSON":t==="csv"?"CSV":t==="excel"?"Excel":t.startsWith("api")?"API":t.startsWith("database")?"Database":e.type_name||e.provider_type||"Unknown"};function Yr(e){const[t,n]=ee([]),[l,i]=ee([]),[s,a]=ee("list"),[o,g]=ee(null),[c,b]=ee(null),[u,v]=ee(!1),[f,d]=ee(null),[y,p]=ee(null);qe(async()=>{var j;try{await $(),await x();const L=Oe.subscribe(D=>{p((D==null?void 0:D.dataSource.id)||null)});p(((j=Oe.getCurrentContext())==null?void 0:j.dataSource.id)||null),lt(L)}catch(L){console.error("ğŸš¨ DataSourcesPanelåˆå§‹åŒ–å¤±è´¥:",L),d(`æ•°æ®æºæ¨¡å—åˆå§‹åŒ–å¤±è´¥: ${L}`)}});const $=async()=>{try{v(!0),console.log("ğŸ”„ å¼€å§‹åŠ è½½æ•°æ®æºåˆ—è¡¨...");const j=await we.listDataSources();console.log("âœ… æ•°æ®æºåˆ—è¡¨åŠ è½½æˆåŠŸ:",j),n(j),d(null)}catch(j){console.error("âŒ åŠ è½½æ•°æ®æºå¤±è´¥:",j),d(`åŠ è½½æ•°æ®æºå¤±è´¥: ${j}`)}finally{v(!1)}},x=async()=>{try{console.log("ğŸ”„ å¼€å§‹åŠ è½½å¯ç”¨æ•°æ®æºç±»å‹...");const j=await we.getAvailableTypes();console.log("âœ… æ•°æ®æºç±»å‹åŠ è½½æˆåŠŸ:",j),i(j)}catch(j){console.error("âŒ åŠ è½½æ•°æ®æºç±»å‹å¤±è´¥:",j)}},k=()=>{a("add"),g(null)},T=j=>{g(j),a("edit")},E=async j=>{try{v(!0),d(null),g(j),console.log("ğŸ”„ å¼€å§‹é¢„è§ˆæ•°æ®æº:",j.name),j.status!=="active"&&(console.log("âš ï¸  æ•°æ®æºçŠ¶æ€ä¸æ˜¯æ¿€æ´»çŠ¶æ€:",j.status),d(`æ•°æ®æºçŠ¶æ€ä¸º ${j.status}ï¼Œå¯èƒ½æ— æ³•é¢„è§ˆæ•°æ®`));const L=await we.getPreview(j.id);b(L),a("preview"),console.log("âœ… æ•°æ®é¢„è§ˆåŠ è½½æˆåŠŸ:",L)}catch(L){console.error("âŒ æ•°æ®é¢„è§ˆå¤±è´¥:",L);const D=`é¢„è§ˆæ•°æ®æº "${j.name}" å¤±è´¥: ${L}`;d(D);const _={connection:"è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æºé…ç½®",permission:"æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥è®¤è¯ä¿¡æ¯",not_found:"æ•°æ®æºæˆ–æ•°æ®ä¸å­˜åœ¨",timeout:"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"},Q=String(L).toLowerCase(),O=Object.keys(_).find(C=>Q.includes(C));O&&d(`é¢„è§ˆå¤±è´¥: ${_[O]}`)}finally{v(!1)}},N=async j=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ•°æ®æºå—ï¼Ÿ"))try{await we.deleteDataSource(j),await $()}catch(L){d(`åˆ é™¤æ•°æ®æºå¤±è´¥: ${L}`)}},M=async j=>{try{v(!0),d(null),await Oe.setActiveDataSource(j.id)}catch(L){console.error("âŒ æ¿€æ´»æ•°æ®æºå¤±è´¥:",L),d(`æ¿€æ´»æ•°æ®æºå¤±è´¥: ${L}`)}finally{v(!1)}},B=async j=>{try{v(!0),d(null),console.log("ğŸ”„ å¼€å§‹æµ‹è¯•æ•°æ®æºè¿æ¥:",j);const L=t().find(Q=>Q.id===j);if(!L){const Q=`æ•°æ®æºä¸å­˜åœ¨: ${j}`;console.error("âŒ",Q),d(Q);return}console.log("ğŸ“‹ æ•°æ®æºä¿¡æ¯:",{id:L.id,name:L.name,type_name:L.type_name,provider_type:L.provider_type,config:L.config});let D=L.provider_type||L.type_name;(L.name.includes("MySQL")||L.name.includes("æ•°æ®åº“")||JSON.stringify(L.config).includes("mysql")||JSON.stringify(L.config).includes("3306"))&&(D="database",console.log("ğŸ—„ï¸ æ£€æµ‹åˆ°æ•°æ®åº“ç±»å‹ï¼Œä½¿ç”¨provider_type: database")),console.log("ğŸ” è°ƒç”¨æµ‹è¯•è¿æ¥API:",{providerType:D,config:L.config});const _=await we.testConnection(D,L.config||{});console.log("ğŸ“¨ APIè¿”å›ç»“æœ:",_),_?(console.log("âœ… æ•°æ®æºè¿æ¥æµ‹è¯•æˆåŠŸ:",j),alert(`âœ… æ•°æ®æº "${L.name}" è¿æ¥æµ‹è¯•æˆåŠŸï¼

ğŸ‰ æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨`)):(console.log("âŒ æ•°æ®æºè¿æ¥æµ‹è¯•å¤±è´¥:",j),alert(`âŒ æ•°æ®æº "${L.name}" è¿æ¥æµ‹è¯•å¤±è´¥

è¯·æ£€æŸ¥é…ç½®ä¿¡æ¯æ˜¯å¦æ­£ç¡®`))}catch(L){console.error("âŒ æµ‹è¯•è¿æ¥æ—¶å‘ç”Ÿé”™è¯¯:",L),console.error("âŒ é”™è¯¯è¯¦æƒ…:",{error:L,errorType:typeof L,errorString:String(L),errorJSON:JSON.stringify(L,null,2)});const D=t().find(Q=>Q.id===j),_=`æµ‹è¯•è¿æ¥å¤±è´¥: ${L}`;d(_),!L||String(L)===""||String(L)==="null"?alert(`âŒ æ•°æ®æº "${(D==null?void 0:D.name)||j}" è¿æ¥æµ‹è¯•é‡åˆ°æœªçŸ¥é”™è¯¯

è¯·æ£€æŸ¥ï¼š
â€¢ å¼€å‘è€…å·¥å…·æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
â€¢ åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
â€¢ é…ç½®å‚æ•°æ˜¯å¦æ­£ç¡®`):alert(`âŒ æ•°æ®æº "${(D==null?void 0:D.name)||j}" è¿æ¥æµ‹è¯•å¤±è´¥:

${L}

ğŸ’¡ å¦‚æœæ˜¯ç©ºé”™è¯¯ï¼Œè¯·æ£€æŸ¥å¼€å‘è€…å·¥å…·æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯`)}finally{v(!1)}};return h(z,{get when(){return e.isOpen},get children(){var j=Ar(),L=j.firstChild,D=L.nextSibling,_=D.firstChild,Q=_.nextSibling,O=Q.nextSibling,C=D.nextSibling;return Te(O,"click",e.onClose),r(C,h(z,{get when(){return s()==="list"},get children(){return h(Xr,{get dataSources(){return t()},get loading(){return u()},get error(){return f()},onAdd:k,onEdit:T,onPreview:E,onDelete:N,onActivate:M,onTestConnection:B,onRefresh:$,get activeId(){return y()}})}}),null),r(C,h(z,{get when(){return s()==="add"},get children(){return h(En,{get availableTypes(){return l()},onBack:()=>a("list"),onSuccess:$})}}),null),r(C,h(z,{get when(){return _e(()=>s()==="edit")()&&o()},get children(){return h(Zr,{get dataSource(){return o()},onBack:()=>a("list"),onSuccess:$})}}),null),r(C,h(z,{get when(){return _e(()=>!!(s()==="preview"&&o()))()&&c()},get children(){return h(ea,{get dataSource(){return o()},get data(){return c()},onBack:()=>a("list")})}}),null),j}})}function Xr(e){const t=l=>{switch(l){case"active":return"#22c55e";case"error":return"#ef4444";case"disabled":return"#6b7280";default:return"#6b7280"}},n=l=>new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(()=>{var l=Or(),i=l.firstChild,s=i.firstChild,a=s.firstChild,o=a.firstChild,g=o.nextSibling;g.nextSibling;var c=a.nextSibling,b=s.nextSibling;return r(a,()=>e.dataSources.length,g),Te(c,"click",e.onRefresh),Te(b,"click",e.onAdd),r(l,h(z,{get when(){return e.error},get children(){var u=zr();return r(u,()=>e.error),u}}),null),r(l,h(z,{get when(){return e.loading},get children(){return Rr()}}),null),r(l,h(z,{get when(){return!e.loading&&e.dataSources.length===0},get children(){var u=Mr(),v=u.firstChild,f=v.nextSibling;return Te(f,"click",e.onAdd),u}}),null),r(l,h(z,{get when(){return!e.loading&&e.dataSources.length>0},get children(){var u=Nr();return r(u,h(ce,{get each(){return e.dataSources},children:v=>(()=>{var f=Ur(),d=f.firstChild,y=d.firstChild,p=y.firstChild,$=p.nextSibling,x=y.nextSibling,k=d.nextSibling,T=k.firstChild,E=T.firstChild,N=E.nextSibling,M=T.nextSibling,B=M.firstChild,j=B.nextSibling,L=k.nextSibling,D=L.firstChild,_=D.nextSibling,Q=_.nextSibling,O=Q.nextSibling,C=O.nextSibling;return r(p,()=>v.name,null),r(p,h(z,{get when(){return e.activeId===v.id},get children(){return Ir()}}),null),r($,()=>Kr(v)),r(N,()=>n(v.created_at)),r(j,()=>n(v.last_updated)),D.$$click=()=>e.onPreview(v),_.$$click=()=>e.onActivate(v),Q.$$click=()=>e.onTestConnection(v.id),O.$$click=()=>e.onEdit(v),C.$$click=()=>e.onDelete(v.id),A(P=>{var J=e.activeId===v.id?"true":"false",H=t(v.status),V=`çŠ¶æ€: ${v.status}`,W=v.status!=="active",G=e.activeId===v.id;return J!==P.e&&q(f,"data-active",P.e=J),H!==P.t&&((P.t=H)!=null?x.style.setProperty("background-color",H):x.style.removeProperty("background-color")),V!==P.a&&q(x,"title",P.a=V),W!==P.o&&(D.disabled=P.o=W),G!==P.i&&(_.disabled=P.i=G),P},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),f})()})),u}}),null),A(u=>{var v=e.loading,f=e.loading?"æ­£åœ¨åˆ·æ–°æ•°æ®æºåˆ—è¡¨":"åˆ·æ–°æ•°æ®æºåˆ—è¡¨",d=e.loading?"æ­£åœ¨åˆ·æ–°...":"åˆ·æ–°æ•°æ®æºåˆ—è¡¨";return v!==u.e&&(c.disabled=u.e=v),f!==u.t&&q(c,"aria-label",u.t=f),d!==u.a&&q(c,"title",u.a=d),u},{e:void 0,t:void 0,a:void 0}),l})()}function Zr(e){const[t,n]=ee({name:e.dataSource.name,config:e.dataSource.config||{},loading:!1,error:null,testResult:null,hasChanges:!1}),[l]=ee(JSON.stringify(e.dataSource.config||{})),i=()=>{const b=t(),u=b.name!==e.dataSource.name,v=JSON.stringify(b.config)!==l();n(f=>({...f,hasChanges:u||v}))},s=b=>{n(u=>({...u,name:b})),i()},a=b=>{n(u=>({...u,config:b})),i()},o=async()=>{const b=t();n(u=>({...u,loading:!0,testResult:null}));try{console.log("ğŸ”„ æµ‹è¯•è¿æ¥é…ç½®..."),await we.testConnection(e.dataSource.type_name,b.config)&&(console.log("âœ… è¿æ¥æµ‹è¯•æˆåŠŸ"),n(v=>({...v,testResult:{success:!0,message:"è¿æ¥æµ‹è¯•æˆåŠŸï¼é…ç½®æœ‰æ•ˆã€‚"},loading:!1})))}catch(u){console.error("âŒ è¿æ¥æµ‹è¯•å¤±è´¥:",u),n(v=>({...v,testResult:{success:!1,message:"è¿æ¥æµ‹è¯•å¤±è´¥",error:u instanceof Error?u.message:String(u)},loading:!1}))}},g=async()=>{const b=t();if(!b.hasChanges){e.onBack();return}if(!b.name.trim()){n(u=>({...u,error:"æ•°æ®æºåç§°ä¸èƒ½ä¸ºç©º"}));return}try{n(u=>({...u,loading:!0,error:null})),console.log("ğŸ”„ æ›´æ–°æ•°æ®æºé…ç½®..."),await we.updateConfig(e.dataSource.id,b.config),b.name!==e.dataSource.name?(console.log("âš ï¸  åç§°æ›´æ–°åŠŸèƒ½å¾…å®ç°ï¼Œå½“å‰åªæ›´æ–°äº†é…ç½®"),n(u=>({...u,error:"é…ç½®å·²æ›´æ–°ï¼Œä½†åç§°æ›´æ–°åŠŸèƒ½å¾…å®ç°"}))):console.log("âœ… æ•°æ®æºé…ç½®æ›´æ–°æˆåŠŸ"),e.onSuccess(),e.onBack()}catch(u){console.error("âŒ æ›´æ–°æ•°æ®æºå¤±è´¥:",u),n(v=>({...v,error:`æ›´æ–°å¤±è´¥: ${u}`,loading:!1}))}},c=()=>{n(b=>({...b,name:e.dataSource.name,config:e.dataSource.config||{},hasChanges:!1,error:null,testResult:null}))};return(()=>{var b=Hr(),u=b.firstChild,v=u.firstChild,f=v.nextSibling,d=f.firstChild,y=d.nextSibling,p=y.firstChild,$=p.nextSibling;$.firstChild;var x=u.nextSibling,k=x.firstChild,T=k.firstChild,E=T.nextSibling,N=E.firstChild,M=N.nextSibling,B=k.nextSibling,j=B.firstChild;j.firstChild;var L=j.nextSibling,D=L.firstChild,_=D.nextSibling,Q=B.nextSibling,O=Q.firstChild,C=O.firstChild,P=C.nextSibling,J=Q.nextSibling,H=J.firstChild,V=H.nextSibling,W=V.firstChild,G=W.firstChild,U=G.nextSibling,F=W.nextSibling,de=F.firstChild,pe=de.nextSibling,ae=F.nextSibling,ne=ae.firstChild,te=ne.nextSibling,le=J.nextSibling,re=le.firstChild,Y=re.nextSibling;return Te(v,"click",e.onBack),r(p,()=>e.dataSource.type_name),r($,()=>e.dataSource.id,null),M.$$input=X=>s(X.currentTarget.value),r(j,h(z,{get when(){return t().hasChanges},get children(){return Fr()}}),null),_.$$input=X=>{try{const ue=JSON.parse(X.currentTarget.value);a(ue),n(me=>({...me,error:null}))}catch{n(me=>({...me,error:"é…ç½®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONè¯­æ³•"}))}},P.$$click=o,r(P,()=>t().loading?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿æ¥"),r(Q,h(z,{get when(){return t().testResult},get children(){var X=Br(),ue=X.firstChild,me=ue.firstChild;return r(ue,()=>{var fe;return(fe=t().testResult)!=null&&fe.success?"âœ…":"âŒ"},me),r(ue,()=>{var fe;return(fe=t().testResult)==null?void 0:fe.message},null),r(X,h(z,{get when(){var fe;return(fe=t().testResult)==null?void 0:fe.error},get children(){var fe=qr();return r(fe,()=>{var he;return(he=t().testResult)==null?void 0:he.error}),fe}}),null),A(()=>{var fe;return $e(X,`test-result ${(fe=t().testResult)!=null&&fe.success?"success":"error"}`)}),X}}),null),r(U,()=>e.dataSource.status==="active"?"âœ… æ´»è·ƒ":e.dataSource.status==="error"?"âŒ é”™è¯¯":"âš ï¸ æœªçŸ¥"),r(pe,()=>new Date(e.dataSource.created_at).toLocaleString("zh-CN")),r(te,()=>new Date(e.dataSource.last_updated).toLocaleString("zh-CN")),r(x,h(z,{get when(){return t().error},get children(){var X=jr();return X.firstChild,r(X,()=>t().error,null),X}}),le),Te(re,"click",e.onBack),r(le,h(z,{get when(){return t().hasChanges},get children(){var X=Qr();return X.$$click=c,A(()=>X.disabled=t().loading),X}}),Y),Y.$$click=g,r(Y,(()=>{var X=_e(()=>!!t().loading);return()=>X()?"ä¿å­˜ä¸­...":t().hasChanges?"ä¿å­˜æ›´æ”¹":"æ— æ›´æ”¹"})()),A(X=>{var ve;var ue=t().error&&!t().name.trim()?"error":"",me=t().error&&((ve=t().error)!=null&&ve.includes("é…ç½®æ ¼å¼"))?"error":"",fe=t().loading,he=`status-value status-${e.dataSource.status}`,xe=`save-btn ${t().hasChanges?"has-changes":""}`,ie=t().loading;return ue!==X.e&&$e(M,X.e=ue),me!==X.t&&$e(_,X.t=me),fe!==X.a&&(P.disabled=X.a=fe),he!==X.o&&$e(U,X.o=he),xe!==X.i&&$e(Y,X.i=xe),ie!==X.n&&(Y.disabled=X.n=ie),X},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),A(()=>M.value=t().name),A(()=>_.value=JSON.stringify(t().config,null,2)),b})()}function ea(e){return(()=>{var t=Jr(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;i.firstChild;var s=i.nextSibling,a=s.firstChild,o=a.nextSibling,g=o.nextSibling,c=g.nextSibling;c.nextSibling;var b=n.nextSibling,u=b.firstChild,v=u.firstChild,f=v.firstChild,d=v.nextSibling;return Te(l,"click",e.onBack),r(i,()=>e.dataSource.name,null),r(s,()=>e.data.total_rows,o),r(s,()=>e.data.rows.length,c),r(f,h(ce,{get each(){return e.data.columns},children:y=>(()=>{var p=Vr();return r(p,y),p})()})),r(d,h(ce,{get each(){return e.data.rows.slice(0,50)},children:y=>(()=>{var p=Wr();return r(p,h(ce,{get each(){return e.data.columns},children:$=>(()=>{var x=Gr();return r(x,(()=>{var k=_e(()=>typeof y[$]=="object");return()=>k()?JSON.stringify(y[$]):String(y[$]||"")})()),x})()})),p})()})),t})()}De(["click","input"]);var ta=m("<div class=empty-context><div class=empty-icon>ğŸ“­</div><div class=empty-title>æš‚æ— æ•°æ®æº</div><div class=empty-description>è¯·åœ¨æ•°æ®æºé¢æ¿ä¸­åˆ›å»ºå¹¶é€‰æ‹©ä¸€ä¸ªæ•°æ®æº"),na=m("<div class=loading-overlay><div class=loading-spinner>â³</div><div class=loading-text>åŠ è½½ä¸­..."),la=m("<div class=data-context-panel><div class=panel-header><h3 class=panel-title>ğŸ“‹ æ•°æ®ä¸Šä¸‹æ–‡</h3><div class=status-indicator><span class=status-icon></span><span class=status-text>"),ia=m("<div class=current-record>"),sa=m("<div class=empty-record>æš‚æ— è®°å½•æ•°æ®"),ra=m("<div class=available-fields>"),aa=m("<div class=no-fields>æš‚æ— å¯ç”¨å­—æ®µ"),oa=m('<div class=context-content><div class=section><div class=section-header><h4 class=section-title>ğŸ—„ï¸ æ•°æ®æºä¿¡æ¯</h4></div><div class=data-source-info><div class=info-item><span class=info-label>åç§°:</span><span class=info-value></span></div><div class=info-item><span class=info-label>ç±»å‹:</span><span class=info-value></span></div><div class=info-item><span class=info-label>ID:</span><span class="info-value info-id"></span></div></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ”¢ è®°å½•å¯¼èˆª</h4></div><div class=navigation-controls><button class=nav-button title=ä¸Šä¸€æ¡è®°å½•>â¬…ï¸</button><span class=record-info> / </span><button class=nav-button title=ä¸‹ä¸€æ¡è®°å½•>â¡ï¸</button></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ“‹ å½“å‰è®°å½•</h4></div></div><div class=section><div class=section-header><h4 class=section-title>ğŸ” å¯ç”¨å­—æ®µ</h4><div class=field-count>(<!> ä¸ªå­—æ®µ)'),ca=m("<div class=record-field><div class=field-key>:</div><div class=field-value>"),da=m("<div class=field-display-name>"),ua=m("<div class=field-sample>ç¤ºä¾‹: "),ga=m("<div class=field-item><div class=field-header><span class=field-name></span><span class=field-type>(<!>)</span></div><div class=field-expression>è¡¨è¾¾å¼: <code>"),ha=m("<details class=error-details><summary>è¯¦ç»†ä¿¡æ¯</summary><pre class=error-details-content>"),va=m('<div class="section error-section"><div class=section-header><h4 class="section-title error-title">âŒ é”™è¯¯ä¿¡æ¯</h4></div><div class=error-content><div class=error-type>é”™è¯¯ç±»å‹: </div><div class=error-message>é”™è¯¯æè¿°: ');const fa=()=>{const[e,t]=ee(null),[n,l]=ee(!1);Ft(()=>{const c=Oe.subscribe(b=>{t(b)});return t(Oe.getCurrentContext()),c});const i=Ce(()=>{const c=e();if(!c)return{text:"æœªé€‰æ‹©æ•°æ®æº",color:"#666",icon:"ğŸ“‚"};switch(c.dataSource.status){case"ready":return{text:`æ•°æ®å·²å°±ç»ª - ${c.dataSource.name}`,color:"#52c41a",icon:"âœ…"};case"loading":return{text:"æ­£åœ¨åŠ è½½æ•°æ®...",color:"#1890ff",icon:"â³"};case"error":return{text:"æ•°æ®åŠ è½½å¤±è´¥",color:"#ff4d4f",icon:"âŒ"};case"empty":return{text:"æ•°æ®æºä¸ºç©º",color:"#faad14",icon:"ğŸ“­"};default:return{text:"æœªçŸ¥çŠ¶æ€",color:"#666",icon:"â“"}}}),s=async()=>{l(!0);try{await Oe.navigateNext()}catch(c){console.error("å¯¼èˆªåˆ°ä¸‹ä¸€è®°å½•å¤±è´¥:",c)}finally{l(!1)}},a=async()=>{l(!0);try{await Oe.navigatePrevious()}catch(c){console.error("å¯¼èˆªåˆ°ä¸Šä¸€è®°å½•å¤±è´¥:",c)}finally{l(!1)}},o=c=>c==null?"(ç©º)":typeof c=="string"?`"${c}"`:typeof c=="object"?JSON.stringify(c,null,2):String(c),g=c=>({string:"æ–‡æœ¬",number:"æ•°å­—",boolean:"å¸ƒå°”",date:"æ—¥æœŸ",object:"å¯¹è±¡",array:"æ•°ç»„"})[c]||c;return(()=>{var c=la(),b=c.firstChild,u=b.firstChild,v=u.nextSibling,f=v.firstChild,d=f.nextSibling;return r(f,()=>i().icon),r(d,()=>i().text),r(c,h(z,{get when(){return e()},children:y=>(()=>{var p=oa(),$=p.firstChild,x=$.firstChild,k=x.nextSibling,T=k.firstChild,E=T.firstChild,N=E.nextSibling,M=T.nextSibling,B=M.firstChild,j=B.nextSibling,L=M.nextSibling,D=L.firstChild,_=D.nextSibling,Q=$.nextSibling,O=Q.firstChild,C=O.nextSibling,P=C.firstChild,J=P.nextSibling,H=J.firstChild,V=J.nextSibling,W=Q.nextSibling;W.firstChild;var G=W.nextSibling,U=G.firstChild,F=U.firstChild,de=F.nextSibling,pe=de.firstChild,ae=pe.nextSibling;return ae.nextSibling,r(N,()=>y().dataSource.name),r(j,()=>y().dataSource.type.toUpperCase()),r(_,()=>y().dataSource.id),P.$$click=a,r(J,()=>y().currentRecord.index+1,H),r(J,()=>y().currentRecord.total,null),V.$$click=s,r(W,h(z,{get when(){return Object.keys(y().currentRecord.data).length>0},get children(){var ne=ia();return r(ne,h(ce,{get each(){return Object.entries(y().currentRecord.data)},children:([te,le])=>(()=>{var re=ca(),Y=re.firstChild,X=Y.firstChild,ue=Y.nextSibling;return r(Y,te,X),r(ue,()=>o(le)),re})()})),ne}}),null),r(W,h(z,{get when(){return Object.keys(y().currentRecord.data).length===0},get children(){return sa()}}),null),r(de,()=>y().fields.length,ae),r(G,h(z,{get when(){return y().fields.length>0},get children(){var ne=ra();return r(ne,h(ce,{get each(){return y().fields},children:te=>(()=>{var le=ga(),re=le.firstChild,Y=re.firstChild,X=Y.nextSibling,ue=X.firstChild,me=ue.nextSibling;me.nextSibling;var fe=re.nextSibling,he=fe.firstChild,xe=he.nextSibling;return r(Y,()=>te.name),r(X,()=>g(te.type),me),r(le,h(z,{get when(){return te.displayName&&te.displayName!==te.name},get children(){var ie=da();return r(ie,()=>te.displayName),ie}}),fe),r(le,h(z,{get when(){return te.sample!==void 0},get children(){var ie=ua();return ie.firstChild,r(ie,()=>o(te.sample),null),ie}}),fe),r(xe,()=>`{${te.name}}`),le})()})),ne}}),null),r(G,h(z,{get when(){return y().fields.length===0},get children(){return aa()}}),null),r(p,h(z,{get when(){return y().error},children:ne=>(()=>{var te=va(),le=te.firstChild,re=le.nextSibling,Y=re.firstChild;Y.firstChild;var X=Y.nextSibling;return X.firstChild,r(Y,()=>ne().type,null),r(X,()=>ne().message,null),r(re,h(z,{get when(){return ne().details},get children(){var ue=ha(),me=ue.firstChild,fe=me.nextSibling;return r(fe,()=>JSON.stringify(ne().details,null,2)),ue}}),null),te})()}),null),A(ne=>{var te=n()||y().currentRecord.index<=0,le=n()||y().currentRecord.index>=y().currentRecord.total-1;return te!==ne.e&&(P.disabled=ne.e=te),le!==ne.t&&(V.disabled=ne.t=le),ne},{e:void 0,t:void 0}),p})()}),null),r(c,h(z,{get when(){return!e()},get children(){return ta()}}),null),r(c,h(z,{get when(){return n()},get children(){return na()}}),null),A(y=>(y=i().color)!=null?d.style.setProperty("color",y):d.style.removeProperty("color")),c})()};De(["click"]);var ma=m(`<div class=sql-editor><div class=editor-toolbar><div class=toolbar-left><span class=editor-label>SQLç¼–è¾‘å™¨</span><span class=database-type>(<!>)</span></div><div class=toolbar-right><span class=cursor-position>è¡Œ <!>, åˆ— </span><span class=character-count> å­—ç¬¦</span></div></div><div class=template-toolbar><span class=template-label>æ¨¡æ¿:</span></div><div><textarea class=sql-textarea placeholder="è¯·è¾“å…¥SQLæŸ¥è¯¢è¯­å¥...

ç¤ºä¾‹:
SELECT u.username, u.email, COUNT(o.id) as order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE u.created_at >= '2024-01-01'
GROUP BY u.id, u.username, u.email
ORDER BY order_count DESC
LIMIT 10;"rows=15></textarea><div class=line-numbers></div></div><div class=editor-help><div class=help-item><kbd>Tab</kbd> ç¼©è¿›</div><div class=help-item><kbd>Ctrl+F</kbd> æ ¼å¼åŒ–</div><div class=help-item><kbd>Enter</kbd> è‡ªåŠ¨ç¼©è¿›</div></div><style>
        .sql-editor {
          display: flex;
          flex-direction: column;
          border: 1px solid #ddd;
          border-radius: 6px;
          background: white;
          font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
        }

        .editor-toolbar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 8px 12px;
          background: #f8f9fa;
          border-bottom: 1px solid #ddd;
          font-size: 12px;
        }

        .toolbar-left {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .editor-label {
          font-weight: bold;
          color: #2c3e50;
        }

        .database-type {
          background: #3498db;
          color: white;
          padding: 2px 6px;
          border-radius: 3px;
          font-size: 10px;
        }

        .toolbar-right {
          display: flex;
          align-items: center;
          gap: 12px;
          color: #666;
        }

        .template-toolbar {
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          background: #f1f3f5;
          border-bottom: 1px solid #ddd;
          font-size: 12px;
        }

        .template-label {
          color: #666;
          font-weight: bold;
        }

        .template-btn {
          background: #e9ecef;
          border: 1px solid #ced4da;
          border-radius: 4px;
          padding: 4px 8px;
          font-size: 11px;
          cursor: pointer;
          transition: all 0.2s;
        }

        .template-btn:hover:not(:disabled) {
          background: #dee2e6;
          border-color: #adb5bd;
        }

        .template-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .editor-container {
          position: relative;
          flex: 1;
          min-height: 300px;
        }

        .editor-container.focused {
          box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .editor-container.disabled {
          opacity: 0.6;
          pointer-events: none;
        }

        .sql-textarea {
          width: 100%;
          height: 100%;
          padding: 12px 12px 12px 48px;
          border: none;
          outline: none;
          resize: vertical;
          font-family: inherit;
          font-size: 14px;
          line-height: 1.5;
          background: transparent;
        }

        .line-numbers {
          position: absolute;
          left: 0;
          top: 0;
          bottom: 0;
          width: 36px;
          background: #f8f9fa;
          border-right: 1px solid #e9ecef;
          padding: 12px 4px;
          user-select: none;
          overflow: hidden;
        }

        .line-number {
          text-align: right;
          font-size: 12px;
          color: #6c757d;
          line-height: 1.5;
          padding-right: 8px;
        }

        .editor-help {
          display: flex;
          justify-content: center;
          gap: 16px;
          padding: 6px;
          background: #f8f9fa;
          border-top: 1px solid #ddd;
          font-size: 11px;
          color: #666;
        }

        .help-item {
          display: flex;
          align-items: center;
          gap: 4px;
        }

        kbd {
          background: #e9ecef;
          border: 1px solid #ced4da;
          border-radius: 3px;
          padding: 2px 4px;
          font-size: 10px;
          font-family: inherit;
        }
      `),ba=m("<button class=template-btn>"),ya=m("<div class=line-number>");function $a(e){let t;const[n,l]=ee(!1),[i,s]=ee({line:1,column:1}),a=v=>{const f=v.target;e.onSQLChange(f.value),o()},o=()=>{if(!t)return;const v=t.selectionStart,d=e.sql.substring(0,v).split(`
`);s({line:d.length,column:(d[d.length-1]||"").length+1})},g=v=>{var p;if(!t||e.disabled)return;const f=v.target,d=f.selectionStart,y=f.selectionEnd;if(v.key==="Tab"){v.preventDefault();const $=e.sql.substring(0,d)+"  "+e.sql.substring(y);e.onSQLChange($),setTimeout(()=>{t&&(t.selectionStart=t.selectionEnd=d+2,o())},0)}else if(v.key==="Enter"){const $=e.sql.substring(0,d).split(`
`),x=$[$.length-1],k=((p=x==null?void 0:x.match(/^\s*/))==null?void 0:p[0])||"",T=(x==null?void 0:x.trim().toUpperCase())||"",N=["SELECT","FROM","WHERE","GROUP BY","ORDER BY","HAVING"].some(M=>T.endsWith(M)||T.includes(M+" "))?k+"  ":k;if(N){v.preventDefault();const M=e.sql.substring(0,d)+`
`+N+e.sql.substring(y);e.onSQLChange(M),setTimeout(()=>{if(t){const B=d+1+N.length;t.selectionStart=t.selectionEnd=B,o()}},0)}}},c=v=>{(v.ctrlKey||v.metaKey)&&v.key==="f"&&(v.preventDefault(),console.log("æ ¼å¼åŒ–å¿«æ·é”®è§¦å‘"))},b=v=>{if(!t||e.disabled)return;const f=t.selectionStart,d=t.selectionEnd,y=e.sql.substring(0,f)+v+e.sql.substring(d);e.onSQLChange(y),setTimeout(()=>{t&&(t.focus(),t.selectionStart=t.selectionEnd=f+v.length,o())},0)};qe(()=>{o(),t&&(t.addEventListener("selectionchange",o),t.addEventListener("click",o))});const u=[{name:"åŸºç¡€æŸ¥è¯¢",template:"SELECT * FROM table_name WHERE condition;"},{name:"è”è¡¨æŸ¥è¯¢",template:`SELECT t1.*, t2.*
FROM table1 t1
JOIN table2 t2 ON t1.id = t2.table1_id
WHERE condition;`},{name:"èšåˆæŸ¥è¯¢",template:`SELECT column, COUNT(*), AVG(value)
FROM table_name
GROUP BY column
HAVING COUNT(*) > 1
ORDER BY column;`},{name:"å­æŸ¥è¯¢",template:`SELECT *
FROM table1
WHERE column IN (
  SELECT column
  FROM table2
  WHERE condition
);`}];return(()=>{var v=ma(),f=v.firstChild,d=f.firstChild,y=d.firstChild,p=y.nextSibling,$=p.firstChild,x=$.nextSibling;x.nextSibling;var k=d.nextSibling,T=k.firstChild,E=T.firstChild,N=E.nextSibling;N.nextSibling;var M=T.nextSibling,B=M.firstChild,j=f.nextSibling;j.firstChild;var L=j.nextSibling,D=L.firstChild,_=D.nextSibling;r(p,()=>e.databaseType.toUpperCase(),x),r(T,()=>i().line,N),r(T,()=>i().column,null),r(M,()=>e.sql.length,B),r(j,()=>u.map(O=>(()=>{var C=ba();return C.$$click=()=>b(O.template),r(C,()=>O.name),A(P=>{var J=e.disabled,H=`æ’å…¥${O.name}æ¨¡æ¿`;return J!==P.e&&(C.disabled=P.e=J),H!==P.t&&q(C,"title",P.t=H),P},{e:void 0,t:void 0}),C})()),null),D.addEventListener("blur",()=>l(!1)),D.addEventListener("focus",()=>l(!0)),D.addEventListener("keypress",c),D.$$keydown=g,D.$$input=a;var Q=t;return typeof Q=="function"?Bt(Q,D):t=D,q(D,"spellcheck",!1),r(_,()=>e.sql.split(`
`).map((O,C)=>(()=>{var P=ya();return r(P,C+1),P})())),A(O=>{var C=`editor-container ${n()?"focused":""} ${e.disabled?"disabled":""}`,P=e.disabled;return C!==O.e&&$e(L,O.e=C),P!==O.t&&(D.disabled=O.t=P),O},{e:void 0,t:void 0}),A(()=>D.value=e.sql),v})()}De(["input","keydown","click"]);var pa=m("<div class=empty-message><p>è¯·é€‰æ‹©è¦æŸ¥è¯¢çš„å­—æ®µ</p><button>è‡ªåŠ¨é€‰æ‹©å­—æ®µ"),_a=m("<div class=builder-section><div class=section-header><h4>ğŸ”— è¡¨å…³è” (JOIN)</h4><button class=add-btn>+ æ·»åŠ å…³è”</button></div><div class=joins-list>"),xa=m(`<div class=visual-query-builder><div class=query-options><label class=option-checkbox><input type=checkbox><span>å»é‡æŸ¥è¯¢ (DISTINCT)</span></label></div><div class=builder-section><div class=section-header><h4>ğŸ“‹ é€‰æ‹©å­—æ®µ (SELECT)</h4><button class=add-btn>+ æ·»åŠ å­—æ®µ</button></div><div class=fields-list></div></div><div class=builder-section><div class=section-header><h4>ğŸ” ç­›é€‰æ¡ä»¶ (WHERE)</h4><button class=add-btn>+ æ·»åŠ æ¡ä»¶</button></div><div class=where-list></div></div><div class=builder-section><div class=section-header><h4>âš™ï¸ å…¶ä»–é€‰é¡¹</h4></div><div class=options-grid><div class=option-group><label>é™åˆ¶è¡Œæ•° (LIMIT):</label><input type=number placeholder=æ— é™åˆ¶ min=1 max=10000></div></div></div><style>
        .visual-query-builder {
          display: flex;
          flex-direction: column;
          gap: 20px;
          padding: 16px;
          background: #f8f9fa;
          border-radius: 8px;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .query-options {
          display: flex;
          gap: 16px;
        }

        .option-checkbox {
          display: flex;
          align-items: center;
          gap: 6px;
          cursor: pointer;
        }

        .builder-section {
          background: white;
          border-radius: 6px;
          padding: 16px;
          border: 1px solid #dee2e6;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
          padding-bottom: 8px;
          border-bottom: 1px solid #e9ecef;
        }

        .section-header h4 {
          margin: 0;
          color: #2c3e50;
          font-size: 14px;
        }

        .add-btn {
          background: #28a745;
          color: white;
          border: none;
          border-radius: 4px;
          padding: 6px 12px;
          font-size: 12px;
          cursor: pointer;
        }

        .add-btn:hover:not(:disabled) {
          background: #218838;
        }

        .field-item, .join-item, .where-item {
          display: flex;
          align-items: center;
          gap: 8px;
          margin-bottom: 8px;
          padding: 8px;
          background: #f8f9fa;
          border-radius: 4px;
          flex-wrap: wrap;
        }

        .join-condition {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .separator {
          font-weight: bold;
          color: #6c757d;
        }

        select, input {
          padding: 4px 8px;
          border: 1px solid #ced4da;
          border-radius: 3px;
          font-size: 13px;
        }

        select {
          background: white;
        }

        input[type="text"] {
          min-width: 100px;
          flex: 1;
        }

        input[type="number"] {
          width: 100px;
        }

        .remove-btn {
          background: #dc3545;
          color: white;
          border: none;
          border-radius: 50%;
          width: 24px;
          height: 24px;
          cursor: pointer;
          font-size: 14px;
        }

        .remove-btn:hover:not(:disabled) {
          background: #c82333;
        }

        .empty-message {
          text-align: center;
          padding: 20px;
          color: #6c757d;
        }

        .empty-message button {
          background: #007bff;
          color: white;
          border: none;
          border-radius: 4px;
          padding: 8px 16px;
          cursor: pointer;
          margin-top: 8px;
        }

        .options-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 16px;
        }

        .option-group {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }

        .option-group label {
          font-weight: bold;
          color: #495057;
          font-size: 13px;
        }

        button:disabled, select:disabled, input:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
      `),Sa=m('<div class=field-item><select></select><span class=separator>.</span><select></select><select><option value>æ— èšåˆ</option><option value=COUNT>COUNT</option><option value=SUM>SUM</option><option value=AVG>AVG</option><option value=MIN>MIN</option><option value=MAX>MAX</option><option value=DISTINCT>DISTINCT</option></select><input type=text placeholder="åˆ«å (å¯é€‰)"><button class=remove-btn>Ã—'),Ye=m("<option>"),wa=m("<option> (<!>)"),Ca=m("<div class=join-item><select><option value=INNER>INNER JOIN</option><option value=LEFT>LEFT JOIN</option><option value=RIGHT>RIGHT JOIN</option><option value=FULL>FULL JOIN</option></select><div class=join-condition><select></select><select></select><span>=</span><select></select><select></select></div><button class=remove-btn>Ã—"),ka=m("<select><option value=AND>AND</option><option value=OR>OR"),Ta=m("<input type=text>"),Ea=m('<div class=where-item><select></select><select></select><select><option value="=">=</option><option value="!=">!=</option><option value=">">&gt;</option><option value="<">&lt;</option><option value=">=">&gt;=</option><option value="<=">&lt;=</option><option value=LIKE>LIKE</option><option value=IN>IN</option><option value="IS NULL">IS NULL</option><option value="IS NOT NULL">IS NOT NULL</option></select><button class=remove-btn>Ã—');function La(e){const[t,n]=ee([]),[l,i]=ee([]),[s,a]=ee([]),[o]=ee([]),[g]=ee([]),[c,b]=ee(void 0),[u,v]=ee(!1),f=Ce(()=>{var D,_,Q;return(Q=(_=(D=e.schema)==null?void 0:D.schemas)==null?void 0:_[0])!=null&&Q.tables?e.schema.schemas[0].tables.filter(O=>e.selectedTables.includes(O.name)):[]}),d=D=>{const _=f().find(Q=>Q.name===D);return(_==null?void 0:_.columns)||[]},y=Ce(()=>{var H;const D=f();if(D.length===0||t().length===0)return"";let _="";_+=u()?"SELECT DISTINCT ":"SELECT ";const Q=t().map(V=>{let W=`${V.table}.${V.column}`;return V.aggregate&&(V.aggregate==="DISTINCT"?W=`DISTINCT ${W}`:W=`${V.aggregate}(${W})`),V.alias&&(W+=` AS ${V.alias}`),W});_+=Q.join(`,
       `),_+=`
FROM ${((H=D[0])==null?void 0:H.name)||"table1"}`;const O=l();for(const V of O)_+=`
${V.joinType} JOIN ${V.rightTable} ON ${V.leftTable}.${V.leftColumn} = ${V.rightTable}.${V.rightColumn}`;const C=s();if(C.length>0){_+=`
WHERE `;const V=C.map((W,G)=>{let U="";return G>0&&(U+=`${W.logicalOperator} `),U+=`${W.table}.${W.column} ${W.operator}`,["IS NULL","IS NOT NULL"].includes(W.operator)||(W.operator==="IN"?U+=` (${W.value})`:W.operator==="LIKE"?U+=` '%${W.value}%'`:U+=` '${W.value}'`),U});_+=V.join(" ")}const P=g();P.length>0&&(_+=`
GROUP BY ${P.join(", ")}`);const J=o();if(J.length>0){const V=J.map(W=>`${W.table}.${W.column} ${W.direction}`);_+=`
ORDER BY ${V.join(", ")}`}return c()&&(_+=`
LIMIT ${c()}`),_});qe(()=>{$()});const p=()=>{e.onQueryChange(y())},$=()=>{const D=f();if(D.length===0)return;const _=[];D.forEach(Q=>{var C;(((C=Q.columns)==null?void 0:C.slice(0,3))||[]).forEach(P=>{_.push({table:Q.name,column:P.name})})}),n(_),p()},x=()=>{var O,C;const D=f();if(D.length===0)return;const _=D[0];if(!_)return;const Q=((C=(O=_.columns)==null?void 0:O[0])==null?void 0:C.name)||"id";n(P=>[...P,{table:_.name,column:Q}]),p()},k=D=>{n(_=>_.filter((Q,O)=>O!==D)),p()},T=(D,_)=>{n(Q=>Q.map((O,C)=>{if(C===D){const P={...O,..._};return _.hasOwnProperty("aggregate")&&_.aggregate===void 0&&delete P.aggregate,_.hasOwnProperty("alias")&&_.alias===void 0&&delete P.alias,P}return O})),p()},E=()=>{var J,H,V,W;const D=f();if(D.length<2)return;const _=D[0],Q=D[1];if(!_||!Q)return;const O=((H=(J=_.columns)==null?void 0:J[0])==null?void 0:H.name)||"id",C=((W=(V=Q.columns)==null?void 0:V[0])==null?void 0:W.name)||"id",P={id:Date.now().toString(),leftTable:_.name,leftColumn:O,rightTable:Q.name,rightColumn:C,joinType:"INNER"};i(G=>[...G,P]),p()},N=D=>{i(_=>_.filter(Q=>Q.id!==D)),p()},M=(D,_)=>{i(Q=>Q.map(O=>O.id===D?{...O,..._}:O)),p()},B=()=>{var C,P;const D=f();if(D.length===0)return;const _=D[0];if(!_)return;const Q=((P=(C=_.columns)==null?void 0:C[0])==null?void 0:P.name)||"id",O={id:Date.now().toString(),table:_.name,column:Q,operator:"=",value:"",logicalOperator:"AND"};a(J=>[...J,O]),p()},j=D=>{a(_=>_.filter(Q=>Q.id!==D)),p()},L=(D,_)=>{a(Q=>Q.map(O=>O.id===D?{...O,..._}:O)),p()};return(()=>{var D=xa(),_=D.firstChild,Q=_.firstChild,O=Q.firstChild,C=_.nextSibling,P=C.firstChild,J=P.firstChild,H=J.nextSibling,V=P.nextSibling,W=C.nextSibling,G=W.firstChild,U=G.firstChild,F=U.nextSibling,de=G.nextSibling,pe=W.nextSibling,ae=pe.firstChild,ne=ae.nextSibling,te=ne.firstChild,le=te.firstChild,re=le.nextSibling;return O.addEventListener("change",Y=>{v(Y.currentTarget.checked),p()}),H.$$click=x,r(V,h(ce,{get each(){return t()},children:(Y,X)=>(()=>{var ue=Sa(),me=ue.firstChild,fe=me.nextSibling,he=fe.nextSibling,xe=he.nextSibling,ie=xe.nextSibling,ve=ie.nextSibling;return me.addEventListener("change",S=>{var K,se;const I=f().find(Z=>Z.name===S.currentTarget.value),R=((se=(K=I==null?void 0:I.columns)==null?void 0:K[0])==null?void 0:se.name)||"id";T(X(),{table:S.currentTarget.value,column:R})}),r(me,h(ce,{get each(){return f()},children:S=>(()=>{var w=Ye();return r(w,()=>S.name),A(()=>w.value=S.name),w})()})),he.addEventListener("change",S=>T(X(),{column:S.currentTarget.value})),r(he,h(ce,{get each(){return d(Y.table)},children:S=>(()=>{var w=wa(),I=w.firstChild,R=I.nextSibling;return R.nextSibling,r(w,()=>S.name,I),r(w,()=>S.data_type,R),A(()=>w.value=S.name),w})()})),xe.addEventListener("change",S=>{const w=S.currentTarget.value;w===""?T(X(),{aggregate:void 0}):T(X(),{aggregate:w})}),ie.$$input=S=>{const w=S.currentTarget.value;w===""?T(X(),{alias:void 0}):T(X(),{alias:w})},ve.$$click=()=>k(X()),A(S=>{var w=e.disabled,I=e.disabled,R=e.disabled,K=e.disabled,se=e.disabled;return w!==S.e&&(me.disabled=S.e=w),I!==S.t&&(he.disabled=S.t=I),R!==S.a&&(xe.disabled=S.a=R),K!==S.o&&(ie.disabled=S.o=K),se!==S.i&&(ve.disabled=S.i=se),S},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),A(()=>me.value=Y.table),A(()=>he.value=Y.column),A(()=>xe.value=Y.aggregate||""),A(()=>ie.value=Y.alias||""),ue})()}),null),r(V,h(z,{get when(){return t().length===0},get children(){var Y=pa(),X=Y.firstChild,ue=X.nextSibling;return ue.$$click=$,A(()=>ue.disabled=e.disabled),Y}}),null),r(D,h(z,{get when(){return f().length>1},get children(){var Y=_a(),X=Y.firstChild,ue=X.firstChild,me=ue.nextSibling,fe=X.nextSibling;return me.$$click=E,r(fe,h(ce,{get each(){return l()},children:he=>(()=>{var xe=Ca(),ie=xe.firstChild,ve=ie.nextSibling,S=ve.firstChild,w=S.nextSibling,I=w.nextSibling,R=I.nextSibling,K=R.nextSibling,se=ve.nextSibling;return ie.addEventListener("change",Z=>M(he.id,{joinType:Z.currentTarget.value})),S.addEventListener("change",Z=>M(he.id,{leftTable:Z.currentTarget.value})),r(S,h(ce,{get each(){return f()},children:Z=>(()=>{var be=Ye();return r(be,()=>Z.name),A(()=>be.value=Z.name),be})()})),w.addEventListener("change",Z=>M(he.id,{leftColumn:Z.currentTarget.value})),r(w,h(ce,{get each(){return d(he.leftTable)},children:Z=>(()=>{var be=Ye();return r(be,()=>Z.name),A(()=>be.value=Z.name),be})()})),R.addEventListener("change",Z=>M(he.id,{rightTable:Z.currentTarget.value})),r(R,h(ce,{get each(){return f()},children:Z=>(()=>{var be=Ye();return r(be,()=>Z.name),A(()=>be.value=Z.name),be})()})),K.addEventListener("change",Z=>M(he.id,{rightColumn:Z.currentTarget.value})),r(K,h(ce,{get each(){return d(he.rightTable)},children:Z=>(()=>{var be=Ye();return r(be,()=>Z.name),A(()=>be.value=Z.name),be})()})),se.$$click=()=>N(he.id),A(Z=>{var be=e.disabled,Se=e.disabled,oe=e.disabled,ze=e.disabled,Pe=e.disabled,Ne=e.disabled;return be!==Z.e&&(ie.disabled=Z.e=be),Se!==Z.t&&(S.disabled=Z.t=Se),oe!==Z.a&&(w.disabled=Z.a=oe),ze!==Z.o&&(R.disabled=Z.o=ze),Pe!==Z.i&&(K.disabled=Z.i=Pe),Ne!==Z.n&&(se.disabled=Z.n=Ne),Z},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),A(()=>ie.value=he.joinType),A(()=>S.value=he.leftTable),A(()=>w.value=he.leftColumn),A(()=>R.value=he.rightTable),A(()=>K.value=he.rightColumn),xe})()})),A(()=>me.disabled=e.disabled),Y}}),W),F.$$click=B,r(de,h(ce,{get each(){return s()},children:(Y,X)=>(()=>{var ue=Ea(),me=ue.firstChild,fe=me.nextSibling,he=fe.nextSibling,xe=he.nextSibling;return r(ue,h(z,{get when(){return X()>0},get children(){var ie=ka();return ie.addEventListener("change",ve=>L(Y.id,{logicalOperator:ve.currentTarget.value})),A(()=>ie.disabled=e.disabled),A(()=>ie.value=Y.logicalOperator),ie}}),me),me.addEventListener("change",ie=>L(Y.id,{table:ie.currentTarget.value})),r(me,h(ce,{get each(){return f()},children:ie=>(()=>{var ve=Ye();return r(ve,()=>ie.name),A(()=>ve.value=ie.name),ve})()})),fe.addEventListener("change",ie=>L(Y.id,{column:ie.currentTarget.value})),r(fe,h(ce,{get each(){return d(Y.table)},children:ie=>(()=>{var ve=Ye();return r(ve,()=>ie.name),A(()=>ve.value=ie.name),ve})()})),he.addEventListener("change",ie=>L(Y.id,{operator:ie.currentTarget.value})),r(ue,h(z,{get when(){return!["IS NULL","IS NOT NULL"].includes(Y.operator)},get children(){var ie=Ta();return ie.$$input=ve=>L(Y.id,{value:ve.currentTarget.value}),A(ve=>{var S=Y.operator==="IN"?"å€¼1,å€¼2,å€¼3":"å€¼",w=e.disabled;return S!==ve.e&&q(ie,"placeholder",ve.e=S),w!==ve.t&&(ie.disabled=ve.t=w),ve},{e:void 0,t:void 0}),A(()=>ie.value=Y.value),ie}}),xe),xe.$$click=()=>j(Y.id),A(ie=>{var ve=e.disabled,S=e.disabled,w=e.disabled,I=e.disabled;return ve!==ie.e&&(me.disabled=ie.e=ve),S!==ie.t&&(fe.disabled=ie.t=S),w!==ie.a&&(he.disabled=ie.a=w),I!==ie.o&&(xe.disabled=ie.o=I),ie},{e:void 0,t:void 0,a:void 0,o:void 0}),A(()=>me.value=Y.table),A(()=>fe.value=Y.column),A(()=>he.value=Y.operator),ue})()})),re.$$input=Y=>{const X=parseInt(Y.currentTarget.value)||void 0;b(X),p()},A(Y=>{var X=e.disabled,ue=e.disabled,me=e.disabled,fe=e.disabled;return X!==Y.e&&(O.disabled=Y.e=X),ue!==Y.t&&(H.disabled=Y.t=ue),me!==Y.a&&(F.disabled=Y.a=me),fe!==Y.o&&(re.disabled=Y.o=fe),Y},{e:void 0,t:void 0,a:void 0,o:void 0}),A(()=>O.checked=u()),A(()=>re.value=c()||""),D})()}De(["click","input"]);var Da=m('<button class="action-btn close-btn"title=å…³é—­é¢„è§ˆ>âœ•'),Pa=m("<table class=result-table><thead><tr></tr></thead><tbody>"),Aa=m("<div class=pagination><div class=pagination-info>æ˜¾ç¤º <!> - <!>/ <!> è¡Œ</div><div class=pagination-controls><select><option value=10>10è¡Œ/é¡µ</option><option value=25>25è¡Œ/é¡µ</option><option value=50>50è¡Œ/é¡µ</option><option value=100>100è¡Œ/é¡µ</option></select><div class=page-buttons><button>é¦–é¡µ</button><button>ä¸Šä¸€é¡µ</button><span class=page-info> / </span><button>ä¸‹ä¸€é¡µ</button><button>æœ«é¡µ"),za=m(`<div class=query-preview><div class=preview-header><div class=header-info><h4>ğŸ“Š æŸ¥è¯¢ç»“æœé¢„è§ˆ</h4><div class=result-stats><span class=stat-item>ğŸ“‹ <!> è¡Œæ•°æ®</span><span class=stat-item>ğŸ“Š <!> åˆ—</span><span class=stat-item>â±ï¸ <!>ms</span></div></div><div class=header-actions><button class="action-btn export-btn"title=å¯¼å‡ºä¸ºCSVæ–‡ä»¶>ğŸ“¤ å¯¼å‡ºCSV</button></div></div><div class=query-info><details><summary>ğŸ” æŸ¥è¯¢è¯¦æƒ…</summary><div class=query-details><div class=query-sql><strong>SQLæŸ¥è¯¢:</strong><pre class=sql-code></pre></div><div class=query-metadata><div class=metadata-item><strong>æ‰§è¡Œæ—¶é—´:</strong> <!>ms</div><div class=metadata-item><strong>è¿”å›è¡Œæ•°:</strong> </div><div class=metadata-item><strong>åˆ—æ•°é‡:</strong> </div></div></div></details></div><div class=table-container></div><style>
        .query-preview {
          background: white;
          border: 1px solid #dee2e6;
          border-radius: 8px;
          overflow: hidden;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .preview-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          padding: 16px;
          background: #f8f9fa;
          border-bottom: 1px solid #dee2e6;
        }

        .header-info h4 {
          margin: 0 0 8px 0;
          color: #2c3e50;
        }

        .result-stats {
          display: flex;
          gap: 16px;
          font-size: 13px;
        }

        .stat-item {
          color: #6c757d;
        }

        .header-actions {
          display: flex;
          gap: 8px;
        }

        .action-btn {
          padding: 6px 12px;
          border: 1px solid #ced4da;
          border-radius: 4px;
          background: white;
          cursor: pointer;
          font-size: 12px;
          transition: all 0.2s;
        }

        .export-btn:hover {
          background: #28a745;
          color: white;
          border-color: #28a745;
        }

        .close-btn:hover {
          background: #dc3545;
          color: white;
          border-color: #dc3545;
        }

        .query-info {
          padding: 12px 16px;
          border-bottom: 1px solid #e9ecef;
        }

        .query-details {
          margin-top: 8px;
        }

        .query-sql {
          margin-bottom: 12px;
        }

        .sql-code {
          background: #f8f9fa;
          border: 1px solid #e9ecef;
          border-radius: 4px;
          padding: 12px;
          font-family: 'Monaco', 'Consolas', monospace;
          font-size: 12px;
          overflow-x: auto;
          margin: 4px 0;
        }

        .query-metadata {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
          font-size: 13px;
        }

        .metadata-item {
          color: #495057;
        }

        .table-container {
          overflow: auto;
          max-height: 500px;
        }

        .result-table {
          width: 100%;
          border-collapse: collapse;
          font-size: 13px;
        }

        .result-table th {
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          padding: 8px 12px;
          text-align: left;
          font-weight: 600;
          position: sticky;
          top: 0;
          z-index: 1;
        }

        .result-table th.sortable {
          cursor: pointer;
          user-select: none;
        }

        .result-table th.sortable:hover {
          background: #e9ecef;
        }

        .column-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .sort-indicator {
          opacity: 0.5;
          font-size: 12px;
        }

        .result-table th.sorted-asc .sort-indicator,
        .result-table th.sorted-desc .sort-indicator {
          opacity: 1;
          color: #007bff;
        }

        .result-table td {
          border: 1px solid #dee2e6;
          padding: 6px 12px;
          max-width: 200px;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .result-table tr.even {
          background: #f8f9fa;
        }

        .result-table tr:hover {
          background: #e3f2fd;
        }

        .cell-null {
          color: #6c757d;
          font-style: italic;
        }

        .cell-boolean {
          text-align: center;
          font-weight: bold;
        }

        .cell-integer, .cell-float {
          text-align: right;
          font-family: 'Monaco', 'Consolas', monospace;
        }

        .cell-datetime {
          font-family: 'Monaco', 'Consolas', monospace;
          color: #6f42c1;
        }

        .cell-object {
          font-family: 'Monaco', 'Consolas', monospace;
          color: #e83e8c;
        }

        .empty-result {
          text-align: center;
          padding: 40px 20px;
          color: #6c757d;
        }

        .empty-icon {
          font-size: 48px;
          margin-bottom: 16px;
        }

        .empty-text {
          font-size: 18px;
          font-weight: 500;
          margin-bottom: 8px;
        }

        .empty-hint {
          font-size: 14px;
        }

        .pagination {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px 16px;
          background: #f8f9fa;
          border-top: 1px solid #dee2e6;
          font-size: 13px;
        }

        .pagination-controls {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .page-buttons {
          display: flex;
          align-items: center;
          gap: 4px;
        }

        .page-buttons button {
          padding: 4px 8px;
          border: 1px solid #ced4da;
          background: white;
          border-radius: 4px;
          cursor: pointer;
          font-size: 12px;
        }

        .page-buttons button:hover:not(:disabled) {
          background: #e9ecef;
        }

        .page-buttons button:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .page-info {
          margin: 0 8px;
          font-weight: 500;
        }

        details summary {
          cursor: pointer;
          font-weight: 500;
          color: #495057;
        }

        details[open] summary {
          margin-bottom: 8px;
        }
      `),Ra=m("<div class=empty-result><div class=empty-icon>ğŸ“­</div><div class=empty-text>æŸ¥è¯¢æœªè¿”å›ä»»ä½•æ•°æ®</div><div class=empty-hint>è¯·æ£€æŸ¥æŸ¥è¯¢æ¡ä»¶æˆ–æ•°æ®æº"),Ma=m("<th><div class=column-header><span class=column-name></span><span class=sort-indicator>"),Na=m("<tr>"),Oa=m("<td>");function Ia(e){const[t,n]=ee(1),[l,i]=ee(10),[s,a]=ee(null),[o,g]=ee("asc"),c=Ce(()=>{let d=[...e.result.rows];if(s()){const $=s();d.sort((x,k)=>{const T=x[$],E=k[$];if(T==null)return 1;if(E==null)return-1;const N=String(T).localeCompare(String(E),void 0,{numeric:!0});return o()==="asc"?N:-N})}const y=(t()-1)*l(),p=y+l();return{data:d.slice(y,p),totalPages:Math.ceil(d.length/l()),totalRows:d.length}}),b=d=>{s()===d?g(y=>y==="asc"?"desc":"asc"):(a(d),g("asc"))},u=d=>{if(d==null)return"";if(typeof d=="object")return JSON.stringify(d);if(typeof d=="boolean")return d?"âœ“":"âœ—";if(typeof d=="number")return Number.isInteger(d)?d.toLocaleString():d.toFixed(2);const y=String(d);if(y.match(/^\d{4}-\d{2}-\d{2}/)||y.includes("T"))try{const p=new Date(y);if(!isNaN(p.getTime()))return p.toLocaleString("zh-CN")}catch{}return y.length>50?y.substring(0,47)+"...":y},v=d=>{if(d==null)return"null";if(typeof d=="boolean")return"boolean";if(typeof d=="number")return Number.isInteger(d)?"integer":"float";if(typeof d=="object")return"object";const y=String(d);if(y.match(/^\d{4}-\d{2}-\d{2}/)||y.includes("T"))try{const p=new Date(y);if(!isNaN(p.getTime()))return"datetime"}catch{}return"string"},f=()=>{const d=e.result.columns.join(","),y=e.result.rows.map(T=>e.result.columns.map(E=>{const N=T[E],M=u(N);return M.includes(",")||M.includes('"')||M.includes(`
`)?`"${M.replace(/"/g,'""')}"`:M}).join(",")).join(`
`),p=d+`
`+y,$=new Blob([p],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),k=URL.createObjectURL($);x.setAttribute("href",k),x.setAttribute("download",`query_result_${Date.now()}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x)};return(()=>{var d=za(),y=d.firstChild,p=y.firstChild,$=p.firstChild,x=$.nextSibling,k=x.firstChild,T=k.firstChild,E=T.nextSibling;E.nextSibling;var N=k.nextSibling,M=N.firstChild,B=M.nextSibling;B.nextSibling;var j=N.nextSibling,L=j.firstChild,D=L.nextSibling;D.nextSibling;var _=p.nextSibling,Q=_.firstChild,O=y.nextSibling,C=O.firstChild,P=C.firstChild,J=P.nextSibling,H=J.firstChild,V=H.firstChild,W=V.nextSibling,G=H.nextSibling,U=G.firstChild,F=U.firstChild,de=F.nextSibling,pe=de.nextSibling;pe.nextSibling;var ae=U.nextSibling,ne=ae.firstChild;ne.nextSibling;var te=ae.nextSibling,le=te.firstChild;le.nextSibling;var re=O.nextSibling,Y=re.nextSibling;return r(k,()=>e.result.total_rows,E),r(N,()=>e.result.columns.length,B),r(j,()=>e.result.execution_time,D),Q.$$click=f,r(_,h(z,{get when(){return e.onClose},get children(){var X=Da();return Te(X,"click",e.onClose),X}}),null),r(W,()=>e.result.query),r(U,()=>e.result.execution_time,pe),r(ae,()=>e.result.total_rows,null),r(te,()=>e.result.columns.length,null),r(re,h(z,{get when(){return e.result.rows.length>0},get fallback(){return Ra()},get children(){var X=Pa(),ue=X.firstChild,me=ue.firstChild,fe=ue.nextSibling;return r(me,h(ce,{get each(){return e.result.columns},children:he=>(()=>{var xe=Ma(),ie=xe.firstChild,ve=ie.firstChild,S=ve.nextSibling;return xe.$$click=()=>b(he),q(xe,"title",`ç‚¹å‡»æ’åº ${he}`),r(ve,he),r(S,(()=>{var w=_e(()=>s()===he);return()=>w()?o()==="asc"?"â†‘":"â†“":"â†•"})()),A(()=>$e(xe,`sortable ${s()===he?`sorted-${o()}`:""}`)),xe})()})),r(fe,h(ce,{get each(){return c().data},children:(he,xe)=>(()=>{var ie=Na();return r(ie,h(ce,{get each(){return e.result.columns},children:ve=>(()=>{var S=Oa();return r(S,()=>u(he[ve])),A(w=>{var I=`cell-${v(he[ve])}`,R=`${ve}: ${u(he[ve])}`;return I!==w.e&&$e(S,w.e=I),R!==w.t&&q(S,"title",w.t=R),w},{e:void 0,t:void 0}),S})()})),A(()=>$e(ie,xe()%2===0?"even":"odd")),ie})()})),X}})),r(d,h(z,{get when(){return c().totalPages>1},get children(){var X=Aa(),ue=X.firstChild,me=ue.firstChild,fe=me.nextSibling,he=fe.nextSibling,xe=he.nextSibling,ie=xe.nextSibling,ve=ie.nextSibling;ve.nextSibling;var S=ue.nextSibling,w=S.firstChild,I=w.nextSibling,R=I.firstChild,K=R.nextSibling,se=K.nextSibling,Z=se.firstChild,be=se.nextSibling,Se=be.nextSibling;return r(ue,()=>(t()-1)*l()+1,fe),r(ue,()=>Math.min(t()*l(),c().totalRows),xe),r(ue,()=>c().totalRows,ve),w.addEventListener("change",oe=>{i(parseInt(oe.currentTarget.value)),n(1)}),R.$$click=()=>n(1),K.$$click=()=>n(oe=>Math.max(1,oe-1)),r(se,t,Z),r(se,()=>c().totalPages,null),be.$$click=()=>n(oe=>Math.min(c().totalPages,oe+1)),Se.$$click=()=>n(c().totalPages),A(oe=>{var ze=t()===1,Pe=t()===1,Ne=t()===c().totalPages,Ke=t()===c().totalPages;return ze!==oe.e&&(R.disabled=oe.e=ze),Pe!==oe.t&&(K.disabled=oe.t=Pe),Ne!==oe.a&&(be.disabled=oe.a=Ne),Ke!==oe.o&&(Se.disabled=oe.o=Ke),oe},{e:void 0,t:void 0,a:void 0,o:void 0}),A(()=>w.value=l()),X}}),Y),d})()}De(["click"]);var Ua=m("<span>é€šè¿‡å¯è§†åŒ–ç•Œé¢æ„å»ºæŸ¥è¯¢ï¼Œé€‚åˆåˆå­¦è€…ä½¿ç”¨"),Fa=m("<span>ç›´æ¥ç¼–å†™SQLè¯­å¥ï¼Œé€‚åˆæœ‰ç»éªŒçš„ç”¨æˆ·"),qa=m("<div class=error-message>âŒ "),Ba=m("<div class=validation-errors><strong>é”™è¯¯:</strong><ul>"),ja=m("<div class=validation-warnings><strong>è­¦å‘Š:</strong><ul>"),Qa=m("<div class=validation-suggestions><strong>å»ºè®®:</strong><ul>"),Ha=m("<div><div class=validation-header><span class=validation-status></span><span class=security-status>"),Ja=m('<div class=sql-query-builder><div class=query-mode-selector><div class=mode-tabs><button>ğŸ¯ å¯è§†åŒ–æ„å»º</button><button>ğŸ’» è‡ªå®šä¹‰SQL</button></div><div class=mode-description></div></div><div class=query-content></div><div class=query-preview-section><div class=preview-header><h4>ğŸ“‹ SQLæŸ¥è¯¢é¢„è§ˆ</h4><div class=preview-actions><button class="action-btn format-btn"title=æ ¼å¼åŒ–SQLä»£ç >ğŸ¨ æ ¼å¼åŒ–</button><button class="action-btn validate-btn"title=éªŒè¯SQLè¯­æ³•>âœ“ éªŒè¯è¯­æ³•</button><button class="action-btn copy-btn"title=å¤åˆ¶SQLåˆ°å‰ªè´´æ¿>ğŸ“‹ å¤åˆ¶</button><button class="action-btn execute-btn"title=æ‰§è¡ŒæŸ¥è¯¢é¢„è§ˆ></button></div></div><div class=sql-display><pre class=sql-code><code></code></pre></div></div><div class=query-help><details><summary>ğŸ’¡ æŸ¥è¯¢æ„å»ºå¸®åŠ©</summary><div class=help-content><div class=help-section><h5>å¯è§†åŒ–æ„å»º:</h5><ul><li>é€‰æ‹©è¡¨å’Œå­—æ®µæ¥è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢</li><li>æ”¯æŒJOINå…³è”ã€WHEREæ¡ä»¶ã€ORDER BYæ’åº</li><li>é€‚åˆSQLåˆå­¦è€…ä½¿ç”¨</li></ul></div><div class=help-section><h5>è‡ªå®šä¹‰SQL:</h5><ul><li>ç›´æ¥ç¼–å†™SQLè¯­å¥ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢</li><li>æä¾›è¯­æ³•éªŒè¯å’Œæ ¼å¼åŒ–åŠŸèƒ½</li><li>é€‚åˆæœ‰ç»éªŒçš„ç”¨æˆ·</li></ul></div><div class=help-section><h5>å®‰å…¨æç¤º:</h5><ul><li>ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹SQLæ³¨å…¥é£é™©</li><li>é¢„è§ˆæŸ¥è¯¢é™åˆ¶è¿”å›è¡Œæ•°ï¼Œé¿å…æ€§èƒ½é—®é¢˜</li><li>å»ºè®®å…ˆéªŒè¯è¯­æ³•ï¼Œå†æ‰§è¡Œé¢„è§ˆ'),Rt=m("<li>");function Va(e){const[t,n]=ee("visual"),[l,i]=ee(!1),[s,a]=ee(null),[o,g]=ee(null),[c,b]=ee(null),[u,v]=ee(""),f=Ce(()=>t()==="visual"?u():e.sql),d=Ce(()=>o()),y=async()=>{const T=f().trim();if(!T){g(null),e.onValidationChange(null);return}try{if(i(!0),a(null),console.log("ğŸ” éªŒè¯SQLè¯­æ³•:",T),console.log("ğŸ” SQLQueryBuilder configå¯¹è±¡:",e.config),console.log("ğŸ” configå¯¹è±¡çš„é”®:",Object.keys(e.config)),console.log("ğŸ” database_typeå­—æ®µ:",e.config.database_type),["database_type","databaseType","dbType","type"].forEach(M=>{e.config[M]&&console.log(`ğŸ” æ‰¾åˆ°å­—æ®µ ${M}:`,e.config[M])}),!e.config.database_type)throw new Error(`database_typeå­—æ®µç¼ºå¤±ï¼Œconfigå†…å®¹: ${JSON.stringify(e.config)}`);const N=await we.validateSqlSyntax(T,e.config.database_type);g(N),e.onValidationChange(N),console.log("âœ… SQLéªŒè¯ç»“æœ:",N)}catch(E){console.error("âŒ SQLéªŒè¯å¤±è´¥:",E);const N={valid:!1,errors:[`éªŒè¯å¤±è´¥: ${E}`],warnings:[],suggestions:[],is_safe:!1,security_issues:["æ— æ³•éªŒè¯æŸ¥è¯¢å®‰å…¨æ€§"]};g(N),e.onValidationChange(N),a(`SQLéªŒè¯å¤±è´¥: ${E}`)}finally{i(!1)}},p=async()=>{const T=f().trim();if(T)try{i(!0),a(null),console.log("ğŸ¨ æ ¼å¼åŒ–SQL:",T);const E=await we.formatSql(T,e.config.database_type);t()==="visual"?v(E):e.onSQLChange(E),console.log("âœ… SQLæ ¼å¼åŒ–å®Œæˆ")}catch(E){console.error("âŒ SQLæ ¼å¼åŒ–å¤±è´¥:",E),a(`æ ¼å¼åŒ–å¤±è´¥: ${E}`)}finally{i(!1)}},$=async()=>{const T=f().trim();if(!T){a("è¯·è¾“å…¥SQLæŸ¥è¯¢è¯­å¥");return}try{i(!0),a(null),console.log("â–¶ï¸ æ‰§è¡ŒæŸ¥è¯¢é¢„è§ˆ:",T),await y();const E=o();if(E&&!E.valid){a("SQLè¯­æ³•éªŒè¯å¤±è´¥ï¼Œè¯·ä¿®æ­£åé‡è¯•");return}const N=await we.executeDatabasePreview(e.config,T,50);b(N),e.onQueryResult(N),console.log("âœ… æŸ¥è¯¢é¢„è§ˆæˆåŠŸ:",N)}catch(E){console.error("âŒ æŸ¥è¯¢é¢„è§ˆå¤±è´¥:",E),a(`æŸ¥è¯¢æ‰§è¡Œå¤±è´¥: ${E}`),b(null),e.onQueryResult(null)}finally{i(!1)}},x=async()=>{const T=f();if(T)try{await navigator.clipboard.writeText(T),console.log("ğŸ“‹ SQLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch(E){console.error("âŒ å¤åˆ¶å¤±è´¥:",E),a(`å¤åˆ¶å¤±è´¥: ${E}`)}},k=T=>{n(T),a(null),T==="custom"&&u()&&e.onSQLChange(u())};return(()=>{var T=Ja(),E=T.firstChild,N=E.firstChild,M=N.firstChild,B=M.nextSibling,j=N.nextSibling,L=E.nextSibling,D=L.nextSibling,_=D.firstChild,Q=_.firstChild,O=Q.nextSibling,C=O.firstChild,P=C.nextSibling,J=P.nextSibling,H=J.nextSibling,V=_.nextSibling,W=V.firstChild,G=W.firstChild;return M.$$click=()=>k("visual"),B.$$click=()=>k("custom"),r(j,h(z,{get when(){return t()==="visual"},get children(){return Ua()}}),null),r(j,h(z,{get when(){return t()==="custom"},get children(){return Fa()}}),null),r(T,h(z,{get when(){return s()},get children(){var U=qa();return U.firstChild,r(U,s,null),U}}),L),r(L,h(z,{get when(){return t()==="visual"},get children(){return h(La,{get selectedTables(){return e.selectedTables},get schema(){return e.schema},onQueryChange:v,get disabled(){return l()}})}}),null),r(L,h(z,{get when(){return t()==="custom"},get children(){return h($a,{get sql(){return e.sql},get onSQLChange(){return e.onSQLChange},get databaseType(){return e.config.database_type},get disabled(){return l()}})}}),null),C.$$click=p,P.$$click=y,J.$$click=x,H.$$click=$,r(H,()=>l()?"â³ æ‰§è¡Œä¸­...":"â–¶ï¸ é¢„è§ˆæŸ¥è¯¢"),r(G,()=>f()||"-- è¯·æ„å»ºæˆ–è¾“å…¥SQLæŸ¥è¯¢è¯­å¥"),r(D,h(z,{get when(){return d()},get children(){var U=Ha(),F=U.firstChild,de=F.firstChild,pe=de.nextSibling;return r(de,()=>d().valid?"âœ… è¯­æ³•æ­£ç¡®":"âŒ è¯­æ³•é”™è¯¯"),r(pe,()=>d().is_safe?"ğŸ”’ æŸ¥è¯¢å®‰å…¨":"âš ï¸ å®‰å…¨è­¦å‘Š"),r(U,h(z,{get when(){return _e(()=>!!d().errors)()&&d().errors.length>0},get children(){var ae=Ba(),ne=ae.firstChild,te=ne.nextSibling;return r(te,h(ce,{get each(){return d().errors},children:le=>(()=>{var re=Rt();return r(re,le),re})()})),ae}}),null),r(U,h(z,{get when(){return _e(()=>{var ae;return!!((ae=d())!=null&&ae.warnings)})()&&d().warnings.length>0},get children(){var ae=ja(),ne=ae.firstChild,te=ne.nextSibling;return r(te,h(ce,{get each(){return d().warnings},children:le=>(()=>{var re=Rt();return r(re,le),re})()})),ae}}),null),r(U,h(z,{get when(){return _e(()=>{var ae;return!!((ae=d())!=null&&ae.suggestions)})()&&d().suggestions.length>0},get children(){var ae=Qa(),ne=ae.firstChild,te=ne.nextSibling;return r(te,h(ce,{get each(){return d().suggestions},children:le=>(()=>{var re=Rt();return r(re,le),re})()})),ae}}),null),A(()=>{var ae;return $e(U,`validation-result ${(ae=d())!=null&&ae.valid?"valid":"invalid"}`)}),U}}),null),r(D,h(z,{get when(){return c()},get children(){return h(Ia,{get result(){return c()},onClose:()=>{b(null),e.onQueryResult(null)}})}}),null),A(U=>{var F=`mode-tab ${t()==="visual"?"active":""}`,de=l(),pe=`mode-tab ${t()==="custom"?"active":""}`,ae=l(),ne=l()||!f(),te=l()||!f(),le=l()||!f(),re=l()||!f();return F!==U.e&&$e(M,U.e=F),de!==U.t&&(M.disabled=U.t=de),pe!==U.a&&$e(B,U.a=pe),ae!==U.o&&(B.disabled=U.o=ae),ne!==U.i&&(C.disabled=U.i=ne),te!==U.n&&(P.disabled=U.n=te),le!==U.s&&(J.disabled=U.s=le),re!==U.h&&(H.disabled=U.h=re),U},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),T})()}De(["click"]);var Wa=m("<div class=error-messages>"),Ga=m("<div class=loading-overlay><div class=loading-spinner>â³</div><div class=loading-text>å¤„ç†ä¸­..."),Ka=m('<div class=form-row><div class="form-group flex-2"><label>ä¸»æœºåœ°å€</label><input type=text placeholder=localhost></div><div class="form-group flex-1"><label>ç«¯å£</label><input type=number>'),Ya=m("<div class=form-group><label>æ•°æ®åº“æ–‡ä»¶è·¯å¾„</label><input type=text placeholder=/path/to/database.db>"),Xa=m("<div class=form-group><label>æ•°æ®åº“å</label><input type=text placeholder=myapp_production>"),Za=m("<div class=form-row><div class=form-group><label>ç”¨æˆ·å</label><input type=text></div><div class=form-group><label>å¯†ç </label><input type=password>"),Ln=m("<div><div class=result-message><span class=result-icon></span><span class=result-text>"),eo=m("<div class=connection-step><div class=step-header><h4>ğŸ”Œ æ•°æ®åº“è¿æ¥é…ç½®</h4><p>è¯·å¡«å†™æ•°æ®åº“è¿æ¥ä¿¡æ¯</p></div><div class=form-section><div class=form-group><label>æ•°æ®åº“ç±»å‹</label><select><option value=mysql>MySQL</option><option value=postgresql>PostgreSQL</option><option value=sqlite>SQLite</option><option value=sqlserver>SQL Server</option><option value=oracle>Oracle</option></select></div><div class=connection-test><button class=test-connection-btn>"),to=m("<div class=schema-loading><button class=load-schema-btn>ğŸ”„ åŠ è½½è¡¨ç»“æ„</button><p class=loading-hint>ç‚¹å‡»æŒ‰é’®åŠ è½½æ•°æ®åº“çš„è¡¨ç»“æ„ä¿¡æ¯"),no=m("<div class=views-section><h5>ğŸ‘ï¸ æ•°æ®è§†å›¾åˆ—è¡¨</h5><div class=views-list>"),lo=m("<div class=schema-content><div class=schema-summary><div class=summary-item><span class=summary-label>æ•°æ®åº“:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>è¡¨æ•°é‡:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>è§†å›¾æ•°é‡:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>åŠ è½½æ—¶é—´:</span><span class=summary-value></span></div></div><div class=tables-section><h5>ğŸ“‹ æ•°æ®è¡¨åˆ—è¡¨</h5><div class=tables-grid>"),io=m("<div class=schema-step><div class=step-header><h4>ğŸ—‚ï¸ æ•°æ®åº“è¡¨ç»“æ„</h4><p>é€‰æ‹©è¦æŸ¥è¯¢çš„æ•°æ®è¡¨å’Œå­—æ®µ"),so=m('<div class=database-wizard><div class=wizard-header><button class=back-btn>â† è¿”å›</button><div class=wizard-title><h3>ğŸ—„ï¸ åˆ›å»ºæ•°æ®åº“æ•°æ®æº</h3><p>è¿æ¥æ•°æ®åº“å¹¶é…ç½®æŸ¥è¯¢è¯­å¥</p></div></div><div class=wizard-progress><div><div class=step-indicator>1</div><div class=step-info><div class=step-title>æ•°æ®åº“è¿æ¥</div><div class=step-description>é…ç½®è¿æ¥ä¿¡æ¯</div></div></div><div><div class=step-indicator>2</div><div class=step-info><div class=step-title>è¡¨ç»“æ„</div><div class=step-description>é€‰æ‹©æ•°æ®è¡¨</div></div></div><div><div class=step-indicator>3</div><div class=step-info><div class=step-title>æŸ¥è¯¢æ„å»º</div><div class=step-description>ç¼–å†™SQLæŸ¥è¯¢</div></div></div><div><div class=step-indicator>4</div><div class=step-info><div class=step-title>é¢„è§ˆä¿å­˜</div><div class=step-description>æµ‹è¯•å¹¶ä¿å­˜</div></div></div></div><div class=wizard-content></div><div class=wizard-controls><div class=control-buttons><button class="control-btn back-btn">â† ä¸Šä¸€æ­¥</button><button class="control-btn next-btn">ä¸‹ä¸€æ­¥ â†’'),ro=m("<div class=error-message>âŒ "),ao=m("<span class=view-comment>"),oo=m("<div class=view-item><div class=view-info><span class=view-name></span><span class=view-schema>"),co=m("<div class=table-comment>"),uo=m("<div class=more-columns>+<!> ä¸ªå­—æ®µ..."),go=m("<span class=more-indexes>+"),ho=m("<div class=table-indexes><h6>ç´¢å¼• (<!>)</h6><div class=indexes-list>"),vo=m("<span class=more-relations>+"),fo=m("<div class=table-relations><h6>å…³è” (<!>)</h6><div class=relations-list>"),mo=m("<div><div class=table-card-header><div class=table-card-title><label class=table-checkbox><input type=checkbox><span class=table-name>ğŸ“‹ </span></label></div><div class=table-card-stats><span class=row-count title=é¢„ä¼°è¡Œæ•°> è¡Œ</span><span class=table-size title=é¢„ä¼°å¤§å°></span></div></div><div class=table-columns><h6>å­—æ®µ (<!>)</h6><div class=columns-preview>"),bo=m("<span class=pk-badge title=ä¸»é”®>ğŸ”‘"),yo=m("<span class=fk-badge title=å¤–é”®>ğŸ”—"),$o=m("<div class=column-item><span class=column-icon></span><span class=column-name></span><span class=column-type>"),po=m("<span> "),_o=m("<span class=relation-badge>ğŸ”— "),xo=m('<div class=preview-step><div class=step-header><h4>ğŸ‘ï¸ é¢„è§ˆå’Œä¿å­˜</h4><p>éªŒè¯é…ç½®ã€é¢„è§ˆæ•°æ®å¹¶ä¿å­˜æ•°æ®æº</p></div><div class=basic-info-section><h5>ğŸ“ åŸºæœ¬ä¿¡æ¯</h5><div class=form-row><div class="form-group flex-2"><label>æ•°æ®æºåç§° *</label><input type=text placeholder=è¾“å…¥æ•°æ®æºåç§°... required></div><div class="form-group flex-1"><label>æ ‡ç­¾</label><input type=text placeholder="æ ‡ç­¾1, æ ‡ç­¾2"></div></div><div class=form-group><label>æè¿°</label><textarea placeholder=æè¿°è¿™ä¸ªæ•°æ®æºçš„ç”¨é€”... rows=3>'),So=m("<div class=config-summary><h5>âš™ï¸ é…ç½®æ‘˜è¦</h5><div class=summary-grid><div class=summary-item><span class=summary-label>æ•°æ®åº“ç±»å‹:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>è¿æ¥åœ°å€:</span><span class=summary-value>:</span></div><div class=summary-item><span class=summary-label>æ•°æ®åº“:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>ç”¨æˆ·å:</span><span class=summary-value></span></div><div class=summary-item><span class=summary-label>é€‰ä¸­è¡¨:</span><span class=summary-value> ä¸ªè¡¨</span></div><div class=summary-item><span class=summary-label>æŸ¥è¯¢é•¿åº¦:</span><span class=summary-value> å­—ç¬¦</span></div></div><div class=sql-preview><h6>SQLæŸ¥è¯¢é¢„è§ˆ:</h6><pre class=sql-code>"),wo=m("<div class=validation-warnings><h6>âš ï¸ è­¦å‘Š"),Co=m("<div class=validation-errors><h6>âŒ é”™è¯¯"),ko=m("<div class=validation-suggestions><h6>ğŸ’¡ å»ºè®®"),To=m("<div class=validation-results><div class=validation-checks>"),Eo=m("<div class=validation-section><div class=section-header><h5>âœ… éªŒè¯çŠ¶æ€</h5><button class=validate-btn>"),Lo=m("<div class=warning-item>"),Do=m("<div class=error-item>"),Po=m("<div class=suggestion-item>"),Ao=m("<div><span class=check-icon></span><span class=check-label></span><span>"),zo=m("<div class=no-data>æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®"),Ro=m("<div class=preview-results><div class=preview-stats><div class=stat-item><span class=stat-label>æ ·æœ¬è¡Œæ•°:</span><span class=stat-value></span></div><div class=stat-item><span class=stat-label>é¢„ä¼°æ€»è¡Œæ•°:</span><span class=stat-value></span></div><div class=stat-item><span class=stat-label>æ‰§è¡Œæ—¶é—´:</span><span class=stat-value>ms</span></div></div><div class=preview-data>"),Mo=m("<div class=data-preview-section><div class=section-header><h5>ğŸ“Š æ•°æ®é¢„è§ˆ</h5><button class=preview-btn>"),No=m("<div class=no-data>æ²¡æœ‰æ•°æ®"),Oo=m("<div class=table-footer>æ˜¾ç¤ºå‰10è¡Œï¼Œå…± <!> è¡Œæ•°æ®"),Io=m("<div class=data-table-container><table class=data-table><thead><tr></tr></thead><tbody>"),Uo=m("<th>"),Fo=m("<tr>"),qo=m("<td>"),Bo=m('<div class=save-requirements><div class=requirements-header>â— ä¿å­˜è¦æ±‚æ£€æŸ¥ï¼š</div><div class=requirements-list><div class=requirement-item>æ•°æ®æºåç§°: <!> "<!>"</div><div class=requirement-item>è‡ªå®šä¹‰SQL: <!> </div><div class=requirement-item>æµ‹è¯•è¿æ¥: <!> </div><div class=requirement-item>ä¿å­˜çŠ¶æ€: </div></div><div class=requirements-note>'),jo=m("<div class=result-details><div class=detail-item><span class=detail-label>æ•°æ®æºID:</span><span class=detail-value>"),Qo=m("<div class=result-warnings>"),Ho=m("<div class=result-errors>"),Jo=m("<div class=save-requirements><h6>ä¿å­˜å‰éœ€è¦å®Œæˆ:</h6><ul><li>å¡«å†™æ•°æ®æºåç§°</li><li>ç¡®ä¿SQLæŸ¥è¯¢æœ‰æ•ˆ</li><li>é€šè¿‡åŸºæœ¬éªŒè¯æ£€æŸ¥"),Vo=m("<div class=save-section><div class=section-header><h5>ğŸ’¾ ä¿å­˜æ•°æ®æº</h5><button>"),Wo=m("<div class=warning-item>âš ï¸ "),Go=m("<div class=error-item>âŒ ");const Ko={database_type:"mysql",host:"localhost",port:3306,database:"",username:"",password:"",ssl_enabled:!1,max_connections:10,min_connections:1,connection_timeout:30,idle_timeout:600,sql:"",use_custom_sql:!1,query_timeout:60,default_limit:1e3,enable_caching:!0,cache_ttl:300};function Yo(e){const[t,n]=ee({currentStep:"connection",name:"",description:"",tags:[],config:{...Ko},schema:null,selectedTables:[],generatedSQL:"",customSQL:"",useCustomSQL:!1,testResult:null,queryResult:null,validation:null,dataSourceValidation:null,dataPreview:null,loading:!1,errors:[],isSaving:!1,saveResult:null}),l=Ce(()=>{var d;const f=t();return{connection:((d=f.testResult)==null?void 0:d.success)||!1,schema:f.schema!==null&&f.selectedTables.length>0,query:f.customSQL.trim().length>0,preview:f.name.trim().length>0&&f.customSQL.trim().length>0}}),i=f=>{n(d=>({...d,...f}))},s=f=>{n(d=>({...d,config:{...d.config,...f}}))},a=async()=>{i({loading:!0,errors:[]});try{const f=await we.testDatabaseConnection(t().config);i({testResult:f,loading:!1,errors:f.success?[]:[f.message]}),f.success&&setTimeout(()=>{i({currentStep:"schema"}),o()},1e3)}catch(f){i({loading:!1,errors:[`è¿æ¥æµ‹è¯•å¤±è´¥: ${f}`],testResult:{success:!1,message:String(f)}})}},o=async()=>{i({loading:!0,errors:[]});try{const f=await we.loadDatabaseSchema(t().config);i({schema:f,loading:!1,errors:[]})}catch(f){i({loading:!1,errors:[`æ¶æ„åŠ è½½å¤±è´¥: ${f}`],schema:null})}},g=async()=>{i({loading:!0,errors:[]});try{const f={name:t().name,config:t().config,selected_tables:t().selectedTables,sql:t().customSQL,description:t().description,tags:t().tags,validate_before_save:!0},d=await we.validateDataSourceBeforeSave(f);return i({dataSourceValidation:d,loading:!1,errors:d.errors}),d}catch(f){return i({loading:!1,errors:[`éªŒè¯å¤±è´¥: ${f}`]}),null}},c=async()=>{i({loading:!0,errors:[]});try{const f=await we.captureDataPreview(t().config,t().customSQL);return i({dataPreview:f,loading:!1}),f}catch(f){return i({loading:!1,errors:[`æ•°æ®é¢„è§ˆå¤±è´¥: ${f}`]}),null}},b=async()=>{var f,d,y;i({isSaving:!0,errors:[]});try{console.log("ğŸ” DatabaseWizard ä¿å­˜å‰çŠ¶æ€:",{selectedTables:t().selectedTables,selectedTables_type:typeof t().selectedTables,selectedTables_length:(f=t().selectedTables)==null?void 0:f.length,customSQL_length:(d=t().customSQL)==null?void 0:d.length,name:t().name});const p={name:t().name,config:t().config,selected_tables:t().selectedTables,sql:t().customSQL,description:t().description,tags:t().tags,validate_before_save:!0,capture_schema_snapshot:!0,capture_data_preview:!0,preview_row_limit:10};console.log("ğŸ” æ„å»ºçš„ SaveDataSourceRequest:",{selected_tables:p.selected_tables,selected_tables_type:typeof p.selected_tables,selected_tables_length:(y=p.selected_tables)==null?void 0:y.length});const $=await we.saveDataSource(p);return i({saveResult:$,isSaving:!1}),$.success&&setTimeout(()=>{e.onSuccess()},2e3),$}catch(p){return i({isSaving:!1,errors:[`ä¿å­˜å¤±è´¥: ${p}`]}),null}},u=f=>{i({currentStep:f})},v=()=>{switch(t().currentStep){case"schema":i({currentStep:"connection"});break;case"query":i({currentStep:"schema"});break;case"preview":i({currentStep:"query"});break;default:e.onBack()}};return(()=>{var f=so(),d=f.firstChild,y=d.firstChild,p=d.nextSibling,$=p.firstChild,x=$.nextSibling,k=x.nextSibling,T=k.nextSibling,E=p.nextSibling,N=E.nextSibling,M=N.firstChild,B=M.firstChild,j=B.nextSibling;return y.$$click=v,$.$$click=()=>u("connection"),x.$$click=()=>l().connection&&u("schema"),k.$$click=()=>l().schema&&u("query"),T.$$click=()=>l().query&&u("preview"),r(E,h(z,{get when(){return t().errors.length>0},get children(){var L=Wa();return r(L,h(ce,{get each(){return t().errors},children:D=>(()=>{var _=ro();return _.firstChild,r(_,D,null),_})()})),L}}),null),r(E,h(z,{get when(){return t().loading},get children(){return Ga()}}),null),r(E,h(z,{get when(){return t().currentStep==="connection"},get children(){var L=eo(),D=L.firstChild,_=D.nextSibling,Q=_.firstChild,O=Q.firstChild,C=O.nextSibling,P=Q.nextSibling,J=P.firstChild;return C.addEventListener("change",H=>{const V=H.currentTarget.value,W={mysql:3306,postgresql:5432,sqlserver:1433,oracle:1521,sqlite:0}[V];s({database_type:V,port:W})}),r(_,h(z,{get when(){return t().config.database_type!=="sqlite"},get children(){var H=Ka(),V=H.firstChild,W=V.firstChild,G=W.nextSibling,U=V.nextSibling,F=U.firstChild,de=F.nextSibling;return G.addEventListener("change",pe=>s({host:pe.currentTarget.value})),de.addEventListener("change",pe=>s({port:parseInt(pe.currentTarget.value)||3306})),A(()=>G.value=t().config.host),A(()=>de.value=t().config.port),H}}),P),r(_,h(z,{get when(){return t().config.database_type==="sqlite"},get children(){var H=Ya(),V=H.firstChild,W=V.nextSibling;return W.addEventListener("change",G=>s({database:G.currentTarget.value})),A(()=>W.value=t().config.database),H}}),P),r(_,h(z,{get when(){return t().config.database_type!=="sqlite"},get children(){return[(()=>{var H=Xa(),V=H.firstChild,W=V.nextSibling;return W.addEventListener("change",G=>s({database:G.currentTarget.value})),A(()=>W.value=t().config.database),H})(),(()=>{var H=Za(),V=H.firstChild,W=V.firstChild,G=W.nextSibling,U=V.nextSibling,F=U.firstChild,de=F.nextSibling;return G.addEventListener("change",pe=>s({username:pe.currentTarget.value})),de.addEventListener("change",pe=>s({password:pe.currentTarget.value})),A(()=>G.value=t().config.username),A(()=>de.value=t().config.password),H})()]}}),P),J.$$click=a,r(J,()=>t().loading?"â³ æµ‹è¯•ä¸­...":"ğŸ”— æµ‹è¯•è¿æ¥"),r(P,h(z,{get when(){return t().testResult},get children(){var H=Ln(),V=H.firstChild,W=V.firstChild,G=W.nextSibling;return r(W,()=>{var U;return(U=t().testResult)!=null&&U.success?"âœ…":"âŒ"}),r(G,()=>{var U;return(U=t().testResult)==null?void 0:U.message}),A(()=>{var U;return $e(H,`test-result ${(U=t().testResult)!=null&&U.success?"success":"error"}`)}),H}}),null),A(()=>J.disabled=t().loading),A(()=>C.value=t().config.database_type),L}}),null),r(E,h(z,{get when(){return t().currentStep==="schema"},get children(){var L=io();return L.firstChild,r(L,h(z,{get when(){return _e(()=>!t().schema)()&&!t().loading},get children(){var D=to(),_=D.firstChild;return _.$$click=o,D}}),null),r(L,h(z,{get when(){return t().schema},get children(){var D=lo(),_=D.firstChild,Q=_.firstChild,O=Q.firstChild,C=O.nextSibling,P=Q.nextSibling,J=P.firstChild,H=J.nextSibling,V=P.nextSibling,W=V.firstChild,G=W.nextSibling,U=V.nextSibling,F=U.firstChild,de=F.nextSibling,pe=_.nextSibling,ae=pe.firstChild,ne=ae.nextSibling;return r(C,()=>{var te;return(te=t().schema)==null?void 0:te.database_name}),r(H,()=>{var te,le,re;return((re=(le=(te=t().schema)==null?void 0:te.schemas[0])==null?void 0:le.tables)==null?void 0:re.length)||0}),r(G,()=>{var te,le,re;return((re=(le=(te=t().schema)==null?void 0:te.schemas[0])==null?void 0:le.views)==null?void 0:re.length)||0}),r(de,()=>{var te;return new Date(((te=t().schema)==null?void 0:te.loaded_at)||"").toLocaleString("zh-CN")}),r(ne,h(ce,{get each(){var te,le;return((le=(te=t().schema)==null?void 0:te.schemas[0])==null?void 0:le.tables)||[]},children:te=>h(Xo,{table:te,get selected(){return t().selectedTables.includes(te.name)},onToggle:(le,re)=>{const Y=t().selectedTables;i(re?{selectedTables:[...Y,le]}:{selectedTables:Y.filter(X=>X!==le)})}})})),r(D,h(z,{get when(){return _e(()=>{var te,le;return!!((le=(te=t().schema)==null?void 0:te.schemas[0])!=null&&le.views)})()&&t().schema.schemas[0].views.length>0},get children(){var te=no(),le=te.firstChild,re=le.nextSibling;return r(re,h(ce,{get each(){var Y,X;return((X=(Y=t().schema)==null?void 0:Y.schemas[0])==null?void 0:X.views)||[]},children:Y=>(()=>{var X=oo(),ue=X.firstChild,me=ue.firstChild,fe=me.nextSibling;return r(me,()=>Y.name),r(fe,()=>Y.schema),r(X,h(z,{get when(){return Y.comment},get children(){var he=ao();return r(he,()=>Y.comment),he}}),null),X})()})),te}}),null),D}}),null),L}}),null),r(E,h(z,{get when(){return t().currentStep==="query"},get children(){return h(Va,{get selectedTables(){return t().selectedTables},get schema(){return t().schema},get config(){return t().config},get sql(){return t().customSQL},onSQLChange:L=>i({customSQL:L}),onQueryResult:L=>i({queryResult:L}),onValidationChange:L=>i({validation:L})})}}),null),r(E,h(z,{get when(){return t().currentStep==="preview"},get children(){return h(Zo,{get state(){return t()},onStateUpdate:i,onSave:b,onValidate:g,onPreviewData:c})}}),null),B.$$click=v,j.$$click=()=>{var D;const L=t();L.currentStep==="connection"&&((D=L.testResult)!=null&&D.success)?(i({currentStep:"schema"}),L.schema||o()):L.currentStep==="schema"?i({currentStep:"query"}):L.currentStep==="query"&&i({currentStep:"preview"})},A(L=>{var D=`progress-step ${t().currentStep==="connection"?"active":""} ${l().connection?"completed":""}`,_=`progress-step ${t().currentStep==="schema"?"active":""} ${l().schema?"completed":""}`,Q=`progress-step ${t().currentStep==="query"?"active":""} ${l().query?"completed":""}`,O=`progress-step ${t().currentStep==="preview"?"active":""} ${l().preview?"completed":""}`,C=t().loading;return D!==L.e&&$e($,L.e=D),_!==L.t&&$e(x,L.t=_),Q!==L.a&&$e(k,L.a=Q),O!==L.o&&$e(T,L.o=O),C!==L.i&&(j.disabled=L.i=C),L},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),f})()}function Xo(e){const t=l=>l<1e3?l.toString():l<1e6?`${(l/1e3).toFixed(1)}K`:`${(l/1e6).toFixed(1)}M`,n=l=>{const i=l.toLowerCase();return i.includes("int")||i.includes("number")||i.includes("decimal")?"ğŸ”¢":i.includes("varchar")||i.includes("text")||i.includes("char")?"ğŸ“":i.includes("date")||i.includes("time")?"ğŸ“…":i.includes("bool")?"âœ…":"ğŸ“‹"};return(()=>{var l=mo(),i=l.firstChild,s=i.firstChild,a=s.firstChild,o=a.firstChild,g=o.nextSibling;g.firstChild;var c=s.nextSibling,b=c.firstChild,u=b.firstChild,v=b.nextSibling,f=i.nextSibling,d=f.firstChild,y=d.firstChild,p=y.nextSibling;p.nextSibling;var $=d.nextSibling;return o.addEventListener("change",x=>e.onToggle(e.table.name,x.currentTarget.checked)),r(g,()=>e.table.name,null),r(b,()=>t(e.table.row_count_estimate),u),r(v,()=>e.table.size_estimate),r(l,h(z,{get when(){return e.table.comment},get children(){var x=co();return r(x,()=>e.table.comment),x}}),f),r(d,()=>{var x;return((x=e.table.columns)==null?void 0:x.length)||0},p),r($,h(ce,{get each(){return(e.table.columns||[]).slice(0,6)},children:x=>(()=>{var k=$o(),T=k.firstChild,E=T.nextSibling,N=E.nextSibling;return r(T,()=>n(x.data_type)),r(E,()=>x.name),r(N,()=>x.data_type),r(k,h(z,{get when(){return x.is_primary_key},get children(){return bo()}}),null),r(k,h(z,{get when(){return x.is_foreign_key},get children(){return yo()}}),null),k})()}),null),r($,h(z,{get when(){var x;return(((x=e.table.columns)==null?void 0:x.length)||0)>6},get children(){var x=uo(),k=x.firstChild,T=k.nextSibling;return T.nextSibling,r(x,()=>{var E;return(((E=e.table.columns)==null?void 0:E.length)||0)-6},T),x}}),null),r(l,h(z,{get when(){return e.table.indexes&&e.table.indexes.length>0},get children(){var x=ho(),k=x.firstChild,T=k.firstChild,E=T.nextSibling;E.nextSibling;var N=k.nextSibling;return r(k,()=>e.table.indexes.length,E),r(N,h(ce,{get each(){return e.table.indexes.slice(0,3)},children:M=>(()=>{var B=po(),j=B.firstChild;return r(B,()=>M.unique?"ğŸ”":"ğŸ“‡",j),r(B,()=>M.name,null),A(L=>{var D=`index-badge ${M.unique?"unique":""}`,_=M.columns.join(", ");return D!==L.e&&$e(B,L.e=D),_!==L.t&&q(B,"title",L.t=_),L},{e:void 0,t:void 0}),B})()}),null),r(N,h(z,{get when(){return e.table.indexes.length>3},get children(){var M=go();return M.firstChild,r(M,()=>e.table.indexes.length-3,null),M}}),null),x}}),null),r(l,h(z,{get when(){return e.table.foreign_keys&&e.table.foreign_keys.length>0},get children(){var x=fo(),k=x.firstChild,T=k.firstChild,E=T.nextSibling;E.nextSibling;var N=k.nextSibling;return r(k,()=>e.table.foreign_keys.length,E),r(N,h(ce,{get each(){return e.table.foreign_keys.slice(0,2)},children:M=>(()=>{var B=_o();return B.firstChild,r(B,()=>M.referenced_table,null),A(()=>q(B,"title",`${M.column_name} â†’ ${M.referenced_table}.${M.referenced_column}`)),B})()}),null),r(N,h(z,{get when(){return e.table.foreign_keys.length>2},get children(){var M=vo();return M.firstChild,r(M,()=>e.table.foreign_keys.length-2,null),M}}),null),x}}),null),A(()=>$e(l,`table-card ${e.selected?"selected":""}`)),A(()=>o.checked=e.selected),l})()}function Zo(e){return(()=>{var t=xo(),n=t.firstChild,l=n.nextSibling,i=l.firstChild,s=i.nextSibling,a=s.firstChild,o=a.firstChild,g=o.nextSibling,c=a.nextSibling,b=c.firstChild,u=b.nextSibling,v=s.nextSibling,f=v.firstChild,d=f.nextSibling;return g.$$input=y=>e.onStateUpdate({name:y.currentTarget.value}),u.$$input=y=>{const p=y.currentTarget.value.split(",").map($=>$.trim()).filter($=>$);e.onStateUpdate({tags:p})},d.$$input=y=>e.onStateUpdate({description:y.currentTarget.value}),r(t,h(ec,{get state(){return e.state}}),null),r(t,h(tc,{get validation(){return e.state.dataSourceValidation},get onValidate(){return e.onValidate},get loading(){return e.state.loading}}),null),r(t,h(nc,{get preview(){return e.state.dataPreview},get onPreviewData(){return e.onPreviewData},get loading(){return e.state.loading}}),null),r(t,h(ic,{get state(){return e.state},get saveResult(){return e.state.saveResult},get onSave(){return e.onSave},get isSaving(){return e.state.isSaving},get canSave(){return sc(e.state)}}),null),A(()=>g.value=e.state.name),A(()=>u.value=e.state.tags.join(", ")),A(()=>d.value=e.state.description),t})()}function ec(e){return(()=>{var t=So(),n=t.firstChild,l=n.nextSibling,i=l.firstChild,s=i.firstChild,a=s.nextSibling,o=i.nextSibling,g=o.firstChild,c=g.nextSibling,b=c.firstChild,u=o.nextSibling,v=u.firstChild,f=v.nextSibling,d=u.nextSibling,y=d.firstChild,p=y.nextSibling,$=d.nextSibling,x=$.firstChild,k=x.nextSibling,T=k.firstChild,E=$.nextSibling,N=E.firstChild,M=N.nextSibling,B=M.firstChild,j=l.nextSibling,L=j.firstChild,D=L.nextSibling;return r(a,()=>e.state.config.database_type.toUpperCase()),r(c,()=>e.state.config.host,b),r(c,()=>e.state.config.port,null),r(f,()=>e.state.config.database),r(p,()=>e.state.config.username),r(k,()=>e.state.selectedTables.length,T),r(M,()=>e.state.customSQL.length,B),r(D,()=>e.state.customSQL.slice(0,200),null),r(D,()=>e.state.customSQL.length>200?"...":"",null),t})()}function tc(e){return(()=>{var t=Eo(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return Te(i,"click",e.onValidate),r(i,()=>e.loading?"â³ éªŒè¯ä¸­...":"ğŸ” å¼€å§‹éªŒè¯"),r(t,h(z,{get when(){return e.validation},get children(){var s=To(),a=s.firstChild;return r(a,h(mt,{label:"æ•°æ®åº“è¿æ¥",get status(){var o;return(o=e.validation)!=null&&o.connection_valid?"success":"error"},get icon(){var o;return(o=e.validation)!=null&&o.connection_valid?"âœ…":"âŒ"}}),null),r(a,h(mt,{label:"SQLè¯­æ³•",get status(){var o;return(o=e.validation)!=null&&o.sql_valid?"success":"error"},get icon(){var o;return(o=e.validation)!=null&&o.sql_valid?"âœ…":"âŒ"}}),null),r(a,h(mt,{label:"å®‰å…¨æ£€æŸ¥",get status(){var o;return(o=e.validation)!=null&&o.security_passed?"success":"warning"},get icon(){var o;return(o=e.validation)!=null&&o.security_passed?"âœ…":"âš ï¸"}}),null),r(a,h(mt,{label:"æ€§èƒ½è¯„ä¼°",get status(){var o;return(o=e.validation)!=null&&o.performance_acceptable?"success":"info"},get icon(){var o;return(o=e.validation)!=null&&o.performance_acceptable?"âœ…":"â„¹ï¸"}}),null),r(s,h(z,{get when(){return e.validation&&e.validation.warnings.length>0},get children(){var o=wo();return o.firstChild,r(o,h(ce,{get each(){return e.validation.warnings||[]},children:g=>(()=>{var c=Lo();return r(c,g),c})()}),null),o}}),null),r(s,h(z,{get when(){return e.validation&&e.validation.errors.length>0},get children(){var o=Co();return o.firstChild,r(o,h(ce,{get each(){return e.validation.errors||[]},children:g=>(()=>{var c=Do();return r(c,g),c})()}),null),o}}),null),r(s,h(z,{get when(){return e.validation&&e.validation.suggestions&&e.validation.suggestions.length>0},get children(){var o=ko();return o.firstChild,r(o,h(ce,{get each(){return e.validation.suggestions||[]},children:g=>(()=>{var c=Po();return r(c,g),c})()}),null),o}}),null),s}}),null),A(()=>i.disabled=e.loading),t})()}function mt(e){return(()=>{var t=Ao(),n=t.firstChild,l=n.nextSibling,i=l.nextSibling;return r(n,()=>e.icon),r(l,()=>e.label),r(i,()=>e.status==="success"?"é€šè¿‡":e.status==="error"?"å¤±è´¥":e.status==="warning"?"è­¦å‘Š":"ä¿¡æ¯"),A(s=>{var a=`validation-check ${e.status}`,o=`check-status ${e.status}`;return a!==s.e&&$e(t,s.e=a),o!==s.t&&$e(i,s.t=o),s},{e:void 0,t:void 0}),t})()}function nc(e){return(()=>{var t=Mo(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return Te(i,"click",e.onPreviewData),r(i,()=>e.loading?"â³ åŠ è½½ä¸­...":"ğŸ‘ï¸ é¢„è§ˆæ•°æ®"),r(t,h(z,{get when(){return e.preview},get children(){var s=Ro(),a=s.firstChild,o=a.firstChild,g=o.firstChild,c=g.nextSibling,b=o.nextSibling,u=b.firstChild,v=u.nextSibling,f=b.nextSibling,d=f.firstChild,y=d.nextSibling,p=y.firstChild,$=a.nextSibling;return r(c,()=>{var x;return((x=e.preview)==null?void 0:x.sample_data.length)||0}),r(v,()=>{var x;return((x=e.preview)==null?void 0:x.total_estimated_rows.toLocaleString())||"æœªçŸ¥"}),r(y,()=>{var x;return((x=e.preview)==null?void 0:x.execution_stats.execution_time)||0},p),r($,h(z,{get when(){return e.preview&&e.preview.sample_data.length>0},get children(){return h(lc,{get data(){return e.preview.sample_data||[]}})}}),null),r($,h(z,{get when(){return!e.preview||e.preview.sample_data.length===0},get children(){return zo()}}),null),s}}),null),A(()=>i.disabled=e.loading),t})()}function lc(e){if(!e.data||e.data.length===0)return No();const t=Object.keys(e.data[0]);return(()=>{var n=Io(),l=n.firstChild,i=l.firstChild,s=i.firstChild,a=i.nextSibling;return r(s,h(ce,{each:t,children:o=>(()=>{var g=Uo();return r(g,o),g})()})),r(a,h(ce,{get each(){return e.data.slice(0,10)},children:o=>(()=>{var g=Fo();return r(g,h(ce,{each:t,children:c=>(()=>{var b=qo();return r(b,()=>rc(o[c])),b})()})),g})()})),r(n,h(z,{get when(){return e.data.length>10},get children(){var o=Oo(),g=o.firstChild,c=g.nextSibling;return c.nextSibling,r(o,()=>e.data.length,c),o}}),null),n})()}function ic(e){return(()=>{var t=Vo(),n=t.firstChild,l=n.firstChild,i=l.nextSibling;return Te(i,"click",e.onSave),r(i,()=>e.isSaving?"ğŸ’¾ ä¿å­˜ä¸­...":"ğŸ’¾ ä¿å­˜æ•°æ®æº"),r(t,h(z,{get when(){return!e.canSave&&!e.isSaving},get children(){var s=Bo(),a=s.firstChild,o=a.nextSibling,g=o.firstChild,c=g.firstChild,b=c.nextSibling,u=b.nextSibling,v=u.nextSibling;v.nextSibling;var f=g.nextSibling,d=f.firstChild,y=d.nextSibling;y.nextSibling;var p=f.nextSibling,$=p.firstChild,x=$.nextSibling;x.nextSibling;var k=p.nextSibling;k.firstChild;var T=o.nextSibling;return r(g,()=>e.state.name?"âœ…":"âŒ",b),r(g,()=>e.state.name,v),r(f,()=>e.state.customSQL?"âœ…":"âŒ",y),r(f,()=>e.state.customSQL?`(${e.state.customSQL.length} å­—ç¬¦)`:"(ç©º)",null),r(p,()=>{var E;return(E=e.state.testResult)!=null&&E.success?"âœ…":"âŒ"},x),r(p,()=>{var E;return(E=e.state.testResult)!=null&&E.success?"æˆåŠŸ":e.state.testResult?`å¤±è´¥: ${e.state.testResult.message}`:"æœªæµ‹è¯•"},null),r(k,()=>e.isSaving?"âŒ æ­£åœ¨ä¿å­˜ä¸­":"âœ… ç©ºé—²",null),r(T,()=>{var E;return(E=e.state.testResult)!=null&&E.success?"æ‰€æœ‰æ¡ä»¶éƒ½å·²æ»¡è¶³ï¼Œä½†æŒ‰é’®ä»ç„¶ç¦ç”¨ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªbugã€‚":"è¯·è¿”å›ç¬¬1æ­¥å®Œæˆè¿æ¥æµ‹è¯•ï¼Œç„¶åæ‰èƒ½ä¿å­˜æ•°æ®æºã€‚"}),s}}),null),r(t,h(z,{get when(){return e.saveResult},get children(){var s=Ln(),a=s.firstChild,o=a.firstChild,g=o.nextSibling;return r(o,()=>{var c;return(c=e.saveResult)!=null&&c.success?"âœ…":"âŒ"}),r(g,()=>{var c;return(c=e.saveResult)==null?void 0:c.message}),r(s,h(z,{get when(){var c;return((c=e.saveResult)==null?void 0:c.success)&&e.saveResult.data_source_id},get children(){var c=jo(),b=c.firstChild,u=b.firstChild,v=u.nextSibling;return r(v,()=>e.saveResult.data_source_id),c}}),null),r(s,h(z,{get when(){return e.saveResult&&e.saveResult.warnings&&e.saveResult.warnings.length>0},get children(){var c=Qo();return r(c,h(ce,{get each(){return e.saveResult.warnings||[]},children:b=>(()=>{var u=Wo();return u.firstChild,r(u,b,null),u})()})),c}}),null),r(s,h(z,{get when(){return e.saveResult&&e.saveResult.errors&&e.saveResult.errors.length>0},get children(){var c=Ho();return r(c,h(ce,{get each(){return e.saveResult.errors||[]},children:b=>(()=>{var u=Go();return u.firstChild,r(u,b,null),u})()})),c}}),null),A(()=>{var c;return $e(s,`save-result ${(c=e.saveResult)!=null&&c.success?"success":"error"}`)}),s}}),null),r(t,h(z,{get when(){return!e.canSave},get children(){return Jo()}}),null),A(s=>{var a=`save-btn ${e.canSave?"primary":"disabled"}`,o=e.isSaving||!e.canSave;return a!==s.e&&$e(i,s.e=a),o!==s.t&&(i.disabled=s.t=o),s},{e:void 0,t:void 0}),t})()}function sc(e){var s;const t=e.name.trim().length>0,n=e.customSQL.trim().length>0,l=(s=e.testResult)==null?void 0:s.success,i=!e.isSaving;return console.log("ğŸ” ä¿å­˜æ¡ä»¶æ£€æŸ¥:",{hasName:t,hasSQL:n,hasSuccessfulTest:l,notSaving:i,testResult:e.testResult,name:e.name,sql:e.customSQL}),!!(t&&n&&l&&i)}function rc(e){return e==null?"(null)":typeof e=="string"&&e.length>50?e.substring(0,47)+"...":String(e)}De(["click","input"]);var ac=m("<input type=text class=search-input placeholder=æœç´¢æ•°æ®æº...>"),oc=m("<div class=add-buttons-group><button class=add-data-source-btn>ğŸ“„ æ–‡ä»¶æ•°æ®æº</button><button class=add-database-source-btn>ğŸ—„ï¸ æ•°æ®åº“æ•°æ®æº"),cc=m("<div class=error-message>"),dc=m("<div class=loading-message>åŠ è½½ä¸­..."),uc=m("<div class=empty-state><p></p><button>æ·»åŠ ç¬¬ä¸€ä¸ªæ•°æ®æº"),gc=m("<div class=data-source-grid>"),hc=m("<div class=main-view><div class=sidebar><div class=sidebar-section><h3>åˆ†ç±»å¯¼èˆª</h3><ul class=nav-list><li><button>ğŸ“ å…¨éƒ¨æ•°æ®æº (<!>)</button></li></ul></div><div class=sidebar-section><h3>æŒ‰çŠ¶æ€åˆ†ç±»</h3><ul class=nav-list><li><button>ğŸŸ¢ æ´»è·ƒä½¿ç”¨ (<!>)</button></li><li><button>ğŸ”´ è¿æ¥å¼‚å¸¸ (<!>)</button></li><li><button>ğŸŸ¡ ç©ºé—²çŠ¶æ€ (<!>)</button></li></ul></div><div class=sidebar-section><h3>æŒ‰ç±»å‹åˆ†ç±»</h3><ul class=nav-list><li><button>ğŸ“‹ æ‰€æœ‰ç±»å‹</button></li></ul></div></div><div class=main-content>"),vc=m("<div class=edit-view><div class=edit-header><button>â† è¿”å›</button><h2>ç¼–è¾‘æ•°æ®æº: </h2></div><p>ç¼–è¾‘åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å®Œå–„..."),fc=m("<div class=preview-view><div class=preview-header><button>â† è¿”å›</button><h2>æ•°æ®é¢„è§ˆ: </h2><div class=preview-info>å…± <!> è¡Œæ•°æ®ï¼Œæ˜¾ç¤ºå‰ <!> è¡Œ</div></div><div class=preview-table-container><table class=preview-table><thead><tr></tr></thead><tbody>"),mc=m("<div class=data-source-management-center><div class=management-header><button class=back-to-designer-btn>â† è¿”å›è®¾è®¡å™¨</button><h1>æ•°æ®æºç®¡ç†ä¸­å¿ƒ</h1><div class=header-actions></div></div><div class=management-content>"),bc=m("<li><button> <!> (<!>)"),yc=m("<th>"),$c=m("<tr>"),pc=m("<td>"),_c=m("<span class=active-badge title=å½“å‰æ¿€æ´»>å½“å‰"),xc=m('<div class=data-source-card><div class=card-header><div class=card-title><span class=type-icon></span><h4></h4></div><div class=status-indicator></div></div><div class=card-meta><div class=meta-row><span class=meta-label>ç±»å‹:</span><span class=meta-value></span></div><div class=meta-row><span class=meta-label>çŠ¶æ€:</span><span class=meta-value></span></div><div class=meta-row><span class=meta-label>æœ€åæ›´æ–°:</span><span class=meta-value></span></div></div><div class=card-actions><button class="action-btn preview-btn"title=é¢„è§ˆæ•°æ®>ğŸ‘ï¸ é¢„è§ˆ</button><button class="action-btn test-btn"title=æµ‹è¯•è¿æ¥>ğŸ”Œ æµ‹è¯•</button><button class="action-btn edit-btn"title=ç¼–è¾‘é…ç½®>âœï¸ ç¼–è¾‘</button><button class="action-btn test-btn"title=è®¾ä¸ºå½“å‰æ•°æ®æº>â­ è®¾ä¸ºå½“å‰</button><button class="action-btn delete-btn"title=åˆ é™¤æ•°æ®æº>ğŸ—‘ï¸ åˆ é™¤');function Sc(e){console.log("ğŸ—ï¸  DataSourceManagementCenter ç»„ä»¶æ¸²æŸ“ï¼ŒisOpen:",e.isOpen);const[t,n]=ee([]),[l,i]=ee([]),[s,a]=ee("main"),[o,g]=ee(null),[c,b]=ee(null),[u,v]=ee(!1),[f,d]=ee(null),[y,p]=ee(null),[$,x]=ee(""),[k,T]=ee("all"),[E,N]=ee("all");qe(async()=>{var G;try{await M(),await B();const U=Oe.subscribe(F=>{p((F==null?void 0:F.dataSource.id)||null)});p(((G=Oe.getCurrentContext())==null?void 0:G.dataSource.id)||null),lt(U)}catch(U){console.error("ğŸš¨ æ•°æ®æºç®¡ç†ä¸­å¿ƒåˆå§‹åŒ–å¤±è´¥:",U),d(`åˆå§‹åŒ–å¤±è´¥: ${U}`)}});const M=async()=>{try{v(!0),console.log("ğŸ”„ åŠ è½½æ•°æ®æºåˆ—è¡¨...");const G=await we.listDataSources();console.log("âœ… æ•°æ®æºåˆ—è¡¨åŠ è½½æˆåŠŸ:",G),n(G),d(null)}catch(G){console.error("âŒ åŠ è½½æ•°æ®æºå¤±è´¥:",G),d(`åŠ è½½æ•°æ®æºå¤±è´¥: ${G}`)}finally{v(!1)}},B=async()=>{try{console.log("ğŸ”„ åŠ è½½å¯ç”¨æ•°æ®æºç±»å‹...");const G=await we.getAvailableTypes();console.log("âœ… æ•°æ®æºç±»å‹åŠ è½½æˆåŠŸ:",G),i(G)}catch(G){console.error("âŒ åŠ è½½æ•°æ®æºç±»å‹å¤±è´¥:",G)}},j=G=>{const U=(G.type_name||G.provider_type||"").toLowerCase();return U.includes("database_mysql")?"mysql":U.includes("database_postgresql")?"postgresql":U.includes("database")?"database":U.includes("json")?"json":U.includes("csv")?"csv":U.includes("excel")?"excel":U.includes("api")?"api":U||"unknown"},L=()=>{let G=t();if($()){const U=$().toLowerCase();G=G.filter(F=>(F.name||"").toLowerCase().includes(U)||j(F).includes(U))}return k()!=="all"&&(G=G.filter(U=>U.status===k())),E()!=="all"&&(G=G.filter(U=>j(U)===E())),G},D=G=>t().filter(U=>U.status===G).length,_=G=>t().filter(U=>j(U)===G).length,Q=()=>{a("add"),g(null)},O=()=>{a("add-database"),g(null)},C=G=>{g(G),a("edit")},P=async G=>{try{v(!0),d(null),g(G),console.log("ğŸ”„ å¼€å§‹é¢„è§ˆæ•°æ®æº:",G.name);const U=await we.getPreview(G.id);b(U),a("preview"),console.log("âœ… æ•°æ®é¢„è§ˆåŠ è½½æˆåŠŸ:",U)}catch(U){console.error("âŒ æ•°æ®é¢„è§ˆå¤±è´¥:",U),d(`é¢„è§ˆæ•°æ®æº "${G.name}" å¤±è´¥: ${U}`)}finally{v(!1)}},J=async G=>{try{v(!0),await Oe.setActiveDataSource(G.id)}catch(U){console.error("âŒ æ¿€æ´»æ•°æ®æºå¤±è´¥:",U),d(`æ¿€æ´»æ•°æ®æºå¤±è´¥: ${U}`)}finally{v(!1)}},H=async G=>{try{v(!0);const U=t().find(de=>de.id===G);if(!U){d(`æ•°æ®æºä¸å­˜åœ¨: ${G}`);return}const F=await we.testConnection(U.provider_type,U.config||{});alert(F?`âœ… æ•°æ®æº "${U.name}" è¿æ¥æµ‹è¯•æˆåŠŸï¼`:`âŒ æ•°æ®æº "${U.name}" è¿æ¥æµ‹è¯•å¤±è´¥`)}catch(U){console.error("âŒ æµ‹è¯•è¿æ¥å¤±è´¥:",U);const F=t().find(de=>de.id===G);alert(`âŒ æ•°æ®æº "${(F==null?void 0:F.name)||G}" è¿æ¥æµ‹è¯•å¤±è´¥:
${U}`)}finally{v(!1)}},V=async G=>{const U=t().find(F=>F.id===G);if(confirm(`ç¡®å®šè¦åˆ é™¤æ•°æ®æº "${U==null?void 0:U.name}" å—ï¼Ÿ`))try{await we.deleteDataSource(G),await M()}catch(F){d(`åˆ é™¤æ•°æ®æºå¤±è´¥: ${F}`)}},W=()=>{a("main"),g(null),b(null),d(null)};return h(z,{get when(){return e.isOpen},get children(){var G=mc(),U=G.firstChild,F=U.firstChild,de=F.nextSibling,pe=de.nextSibling,ae=U.nextSibling;return Te(F,"click",e.onClose),r(pe,h(z,{get when(){return s()==="main"},get children(){return[(()=>{var ne=ac();return ne.$$input=te=>x(te.currentTarget.value),A(()=>ne.value=$()),ne})(),(()=>{var ne=oc(),te=ne.firstChild,le=te.nextSibling;return te.$$click=Q,le.$$click=O,ne})()]}})),r(ae,h(z,{get when(){return s()==="main"},get children(){var ne=hc(),te=ne.firstChild,le=te.firstChild,re=le.firstChild,Y=re.nextSibling,X=Y.firstChild,ue=X.firstChild,me=ue.firstChild,fe=me.nextSibling;fe.nextSibling;var he=le.nextSibling,xe=he.firstChild,ie=xe.nextSibling,ve=ie.firstChild,S=ve.firstChild,w=S.firstChild,I=w.nextSibling;I.nextSibling;var R=ve.nextSibling,K=R.firstChild,se=K.firstChild,Z=se.nextSibling;Z.nextSibling;var be=R.nextSibling,Se=be.firstChild,oe=Se.firstChild,ze=oe.nextSibling;ze.nextSibling;var Pe=he.nextSibling,Ne=Pe.firstChild,Ke=Ne.nextSibling,Fe=Ke.firstChild,Dn=Fe.firstChild,vt=te.nextSibling;return ue.$$click=()=>T("all"),r(ue,()=>t().length,fe),S.$$click=()=>T("active"),r(S,()=>D("active"),I),K.$$click=()=>T("error"),r(K,()=>D("error"),Z),Se.$$click=()=>T("disabled"),r(Se,()=>D("disabled"),ze),Dn.$$click=()=>N("all"),r(Ke,h(ce,{get each(){return l()},children:ke=>(()=>{var Ae=bc(),Be=Ae.firstChild,st=Be.firstChild,rt=st.nextSibling,ft=rt.nextSibling,jt=ft.nextSibling;return jt.nextSibling,Be.$$click=()=>N(ke.type_name),r(Be,()=>ke.category==="file"?"ğŸ“„":ke.category==="api"?"ğŸŒ":ke.category==="database"?"ğŸ—„ï¸":"ğŸ“Š",st),r(Be,()=>ke.display_name,rt),r(Be,()=>_(ke.type_name),jt),A(()=>$e(Ae,E()===ke.type_name?"active":"")),Ae})()}),null),r(vt,h(z,{get when(){return f()},get children(){var ke=cc();return r(ke,f),ke}}),null),r(vt,h(z,{get when(){return u()},get children(){return dc()}}),null),r(vt,h(z,{get when(){return _e(()=>!u())()&&L().length===0},get children(){var ke=uc(),Ae=ke.firstChild,Be=Ae.nextSibling;return r(Ae,()=>$()||k()!=="all"||E()!=="all"?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ•°æ®æº":"å°šæœªé…ç½®ä»»ä½•æ•°æ®æº"),Be.$$click=Q,ke}}),null),r(vt,h(z,{get when(){return _e(()=>!u())()&&L().length>0},get children(){var ke=gc();return r(ke,h(ce,{get each(){return L()},children:Ae=>h(wc,{source:Ae,onPreview:()=>P(Ae),onTest:()=>H(Ae.id),onEdit:()=>C(Ae),onDelete:()=>V(Ae.id),onActivate:()=>J(Ae),get active(){return y()===Ae.id}})})),ke}}),null),A(ke=>{var Ae=k()==="all"?"active":"",Be=k()==="active"?"active":"",st=k()==="error"?"active":"",rt=k()==="disabled"?"active":"",ft=E()==="all"?"active":"";return Ae!==ke.e&&$e(X,ke.e=Ae),Be!==ke.t&&$e(ve,ke.t=Be),st!==ke.a&&$e(R,ke.a=st),rt!==ke.o&&$e(be,ke.o=rt),ft!==ke.i&&$e(Fe,ke.i=ft),ke},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),ne}}),null),r(ae,h(z,{get when(){return s()==="add"},get children(){return h(En,{get availableTypes(){return l()},onBack:W,onSuccess:()=>{M(),W()}})}}),null),r(ae,h(z,{get when(){return s()==="add-database"},get children(){return h(Yo,{onBack:W,onSuccess:()=>{M(),W()}})}}),null),r(ae,h(z,{get when(){return _e(()=>s()==="edit")()&&o()},get children(){var ne=vc(),te=ne.firstChild,le=te.firstChild,re=le.nextSibling;return re.firstChild,le.$$click=W,r(re,()=>{var Y;return(Y=o())==null?void 0:Y.name},null),ne}}),null),r(ae,h(z,{get when(){return _e(()=>!!(s()==="preview"&&o()))()&&c()},get children(){var ne=fc(),te=ne.firstChild,le=te.firstChild,re=le.nextSibling;re.firstChild;var Y=re.nextSibling,X=Y.firstChild,ue=X.nextSibling,me=ue.nextSibling,fe=me.nextSibling;fe.nextSibling;var he=te.nextSibling,xe=he.firstChild,ie=xe.firstChild,ve=ie.firstChild,S=ie.nextSibling;return le.$$click=W,r(re,()=>{var w;return(w=o())==null?void 0:w.name},null),r(Y,()=>{var w;return(w=c())==null?void 0:w.total_rows},ue),r(Y,()=>{var w;return(w=c())==null?void 0:w.rows.length},fe),r(ve,h(ce,{get each(){var w;return(w=c())==null?void 0:w.columns},children:w=>(()=>{var I=yc();return r(I,w),I})()})),r(S,h(ce,{get each(){var w;return(w=c())==null?void 0:w.rows.slice(0,50)},children:w=>(()=>{var I=$c();return r(I,h(ce,{get each(){var R;return((R=c())==null?void 0:R.columns)||[]},children:R=>(()=>{var K=pc();return r(K,(()=>{var se=_e(()=>typeof w[R]=="object");return()=>se()?JSON.stringify(w[R]):String(w[R]||"")})()),K})()})),I})()})),ne}}),null),G}})}function wc(e){const t=a=>{switch(a){case"active":return"#22c55e";case"error":return"#ef4444";case"disabled":return"#6b7280";default:return"#6b7280"}},n=a=>{switch(a){case"active":return"å·²è¿æ¥";case"error":return"è¿æ¥å¼‚å¸¸";case"disabled":return"æœªå¯ç”¨";default:return"æœªçŸ¥"}},l=a=>{const o=new Date,g=new Date(a),c=o.getTime()-g.getTime(),b=Math.floor(c/(1e3*60*60));return b<1?"åˆšåˆšæ›´æ–°":b<24?`${b}å°æ—¶å‰`:g.toLocaleDateString("zh-CN")},i=a=>{const o=(a||"").toLowerCase();return o.includes("json")?"ğŸ“„":o.includes("api")?"ğŸŒ":o.includes("csv")?"ğŸ“Š":o.includes("database")?"ğŸ—„ï¸":"ğŸ“‹"},s=a=>{const o=(a.type_name||a.provider_type||"").toLowerCase();return o.includes("database_mysql")?"MySQL":o.includes("database_postgresql")?"PostgreSQL":o==="json"?"JSON":o==="csv"?"CSV":o==="excel"?"Excel":o.startsWith("api")?"API":o.startsWith("database")?"Database":a.type_name||a.provider_type||"Unknown"};return(()=>{var a=xc(),o=a.firstChild,g=o.firstChild,c=g.firstChild,b=c.nextSibling,u=g.nextSibling,v=o.nextSibling,f=v.firstChild,d=f.firstChild,y=d.nextSibling,p=f.nextSibling,$=p.firstChild,x=$.nextSibling,k=p.nextSibling,T=k.firstChild,E=T.nextSibling,N=v.nextSibling,M=N.firstChild,B=M.nextSibling,j=B.nextSibling,L=j.nextSibling,D=L.nextSibling;return r(c,()=>i(e.source.type_name||e.source.provider_type)),r(b,()=>e.source.name,null),r(b,h(z,{get when(){return e.active},get children(){return _c()}}),null),r(y,()=>s(e.source)),r(x,()=>n(e.source.status)),r(E,()=>l(e.source.last_updated)),Te(M,"click",e.onPreview),Te(B,"click",e.onTest),Te(j,"click",e.onEdit),Te(L,"click",e.onActivate),Te(D,"click",e.onDelete),A(_=>{var Q=e.active?"true":"false",O=t(e.source.status),C=`çŠ¶æ€: ${n(e.source.status)}`,P=e.source.status!=="active",J=e.active;return Q!==_.e&&q(a,"data-active",_.e=Q),O!==_.t&&((_.t=O)!=null?u.style.setProperty("background-color",O):u.style.removeProperty("background-color")),C!==_.a&&q(u,"title",_.a=C),P!==_.o&&(M.disabled=_.o=P),J!==_.i&&(L.disabled=_.i=J),_},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a})()}De(["click","input"]);var Cc=m('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col"><div class="flex-1 overflow-y-auto custom-scrollbar"><div class=min-h-fit></div><div class="border-t border-default min-h-fit">');const kc=()=>{const[e,t]=ee(!1),[n,l]=ee(!1);console.log("ğŸ–¥ï¸  MainLayoutæ¸²æŸ“ï¼Œç®¡ç†ä¸­å¿ƒçŠ¶æ€:",n());const i=()=>{console.log("ğŸ”„ æ•°æ®æºæŒ‰é’®è¢«ç‚¹å‡»ï¼Œå‡†å¤‡æ‰“å¼€ç®¡ç†ä¸­å¿ƒ"),console.log("ğŸ“Š å½“å‰ç®¡ç†ä¸­å¿ƒçŠ¶æ€:",n()),l(!0),console.log("âœ… ç®¡ç†ä¸­å¿ƒçŠ¶æ€å·²è®¾ç½®ä¸º true"),console.log("ğŸ“Š è®¾ç½®åçš„ç®¡ç†ä¸­å¿ƒçŠ¶æ€:",n())},s=()=>t(!1),a=()=>l(!1);return h(Zn,{get children(){var o=Cc(),g=o.firstChild,c=g.firstChild,b=c.nextSibling,u=b.nextSibling,v=u.firstChild,f=v.firstChild,d=f.nextSibling;return r(o,h(yl,{onOpenDataSources:i}),g),r(c,h(_l,{})),r(b,h($s,{})),r(f,h(Ti,{})),r(d,h(fa,{})),r(o,h(Sc,{get isOpen(){return n()},onClose:a}),null),r(o,h(Yr,{get isOpen(){return e()},onClose:s}),null),o}})},Tc={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},Ec=()=>{const{state:e,copySelectedElements:t,pasteElements:n,deleteElements:l,undo:i,redo:s,selectAllElements:a,clearSelection:o,moveElements:g}=Ge(),c=(d,y)=>{const p=d.key.toLowerCase()===y.key.toLowerCase()||d.key===y.key,$=!!y.ctrl===(d.ctrlKey||d.metaKey),x=!!y.alt===d.altKey,k=!!y.shift===d.shiftKey;return p&&$&&x&&k},b=async d=>{console.log("ğŸ¯ æ‰§è¡Œå¿«æ·é”®:",d);try{switch(d){case"copy":e.selected_ids.length>0&&(await t(),v("å¤åˆ¶æˆåŠŸ","âœ…"));break;case"paste":const y={x:20,y:20},p=await n(y.x,y.y);p.length>0&&v(`ç²˜è´´ ${p.length} ä¸ªå…ƒç´ `,"ğŸ“‹");break;case"cut":e.selected_ids.length>0&&(await t(),await l([...e.selected_ids]),v("å‰ªåˆ‡æˆåŠŸ","âœ‚ï¸"));break;case"delete":if(e.selected_ids.length>0){const $=e.selected_ids.length;await l([...e.selected_ids]),v(`åˆ é™¤ ${$} ä¸ªå…ƒç´ `,"ğŸ—‘ï¸")}break;case"undo":await i(),v("æ’¤é”€","â†¶");break;case"redo":await s(),v("é‡åš","â†·");break;case"selectAll":await a(),v(`å…¨é€‰ ${e.elements.length} ä¸ªå…ƒç´ `,"ğŸ¯");break;case"clearSelection":e.selected_ids.length>0&&(o(),v("æ¸…é™¤é€‰æ‹©","â­•"));break;case"duplicate":if(e.selected_ids.length>0){await t();const $=await n(20,20);v(`å¤åˆ¶ ${$.length} ä¸ªå…ƒç´ `,"ğŸ“„")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await u(d);break;default:console.warn("æœªçŸ¥çš„å¿«æ·é”®åŠ¨ä½œ:",d)}}catch(y){console.error("å¿«æ·é”®æ‰§è¡Œå¤±è´¥:",y),v("æ“ä½œå¤±è´¥","âŒ")}},u=async d=>{if(e.selected_ids.length===0)return;const y=d.includes("Fast"),p=y?10:1;let $=0,x=0;switch(d){case"moveUp":case"moveFastUp":x=-p;break;case"moveDown":case"moveFastDown":x=p;break;case"moveLeft":case"moveFastLeft":$=-p;break;case"moveRight":case"moveFastRight":$=p;break}($!==0||x!==0)&&(await g([...e.selected_ids],$,x),y&&v(`å¿«é€Ÿç§»åŠ¨ ${p}px`,"ğŸ”„"))},v=(d,y)=>{const p=document.createElement("div");p.className="keyboard-feedback",p.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${y}</span>
        <span class="feedback-text">${d}</span>
      </div>
    `,document.body.appendChild(p),setTimeout(()=>{p.parentNode&&p.parentNode.removeChild(p)},2e3)},f=d=>{const y=d.target;if(!(y.tagName==="INPUT"||y.tagName==="TEXTAREA"||y.contentEditable==="true")){for(const[$,x]of Object.entries(Tc))if(c(d,x.combination)){d.preventDefault(),d.stopPropagation(),console.log("ğŸ¹ å¿«æ·é”®è§¦å‘:",$,x.action),b(x.action);return}}};return qe(()=>{if(document.addEventListener("keydown",f,!0),console.log("ğŸ¹ é”®ç›˜å¿«æ·é”®ç®¡ç†å™¨å·²å¯åŠ¨"),!document.getElementById("keyboard-feedback-styles")){const d=document.createElement("style");d.id="keyboard-feedback-styles",d.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(d)}}),lt(()=>{document.removeEventListener("keydown",f,!0),console.log("ğŸ¹ é”®ç›˜å¿«æ·é”®ç®¡ç†å™¨å·²åœæ­¢")}),null},Lc=()=>(qe(()=>{document.addEventListener("contextmenu",e=>e.preventDefault());try{const e=typeof window<"u"?window.localStorage.getItem("jasper.activeDataSourceId"):null;e&&Oe.setActiveDataSource(e).catch(t=>{console.warn("æ¢å¤æ¿€æ´»æ•°æ®æºå¤±è´¥:",t)})}catch(e){console.warn("è¯»å–æœ¬åœ°æ¿€æ´»æ•°æ®æºå¤±è´¥:",e)}}),h(al,{get children(){return[h(Ec,{}),h(kc,{})]}})),Dc=document.getElementById("root");Jn(()=>h(Lc,{}),Dc);
