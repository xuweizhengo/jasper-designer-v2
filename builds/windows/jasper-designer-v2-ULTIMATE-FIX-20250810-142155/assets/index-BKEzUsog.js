(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function l(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=l(o);fetch(o.href,n)}})();const Ft=!1,Ot=(e,t)=>e===t,ye=Symbol("solid-proxy"),Ze=Symbol("solid-track"),Re={equals:Ot};let yt=$t;const ge=1,Fe=2,wt={owned:null,cleanups:null,context:null,owner:null};var N=null;let qe=null,Nt=null,H=null,Z=null,re=null,Ke=0;function Te(e,t){const l=H,i=N,o=e.length===0,n=t===void 0?i:t,r=o?wt:{owned:null,cleanups:null,context:n?n.context:null,owner:n},s=o?e:()=>e(()=>te(()=>Ee(r)));N=r,H=null;try{return Se(s,!0)}finally{H=l,N=i}}function V(e,t){t=t?Object.assign({},Re,t):Re;const l={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},i=o=>(typeof o=="function"&&(o=o(l.value)),_t(l,o));return[xt.bind(l),i]}function M(e,t,l){const i=lt(e,t,!1,ge);De(i)}function jt(e,t,l){yt=Vt;const i=lt(e,t,!1,ge);i.user=!0,re?re.push(i):De(i)}function q(e,t,l){l=l?Object.assign({},Re,l):Re;const i=lt(e,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=l.equals||void 0,De(i),xt.bind(i)}function Bt(e){return Se(e,!1)}function te(e){if(H===null)return e();const t=H;H=null;try{return e()}finally{H=t}}function nt(e){jt(()=>te(e))}function bt(e){return N===null||(N.cleanups===null?N.cleanups=[e]:N.cleanups.push(e)),e}function We(){return H}function Yt(e,t){const l=Symbol("context");return{id:l,Provider:Gt(l),defaultValue:e}}function Ht(e){let t;return N&&N.context&&(t=N.context[e.id])!==void 0?t:e.defaultValue}function pt(e){const t=q(e),l=q(()=>Je(t()));return l.toArray=()=>{const i=l();return Array.isArray(i)?i:i!=null?[i]:[]},l}function xt(){if(this.sources&&this.state)if(this.state===ge)De(this);else{const e=Z;Z=null,Se(()=>Ne(this),!1),Z=e}if(H){const e=this.observers?this.observers.length:0;H.sources?(H.sources.push(this),H.sourceSlots.push(e)):(H.sources=[this],H.sourceSlots=[e]),this.observers?(this.observers.push(H),this.observerSlots.push(H.sources.length-1)):(this.observers=[H],this.observerSlots=[H.sources.length-1])}return this.value}function _t(e,t,l){let i=e.value;return(!e.comparator||!e.comparator(i,t))&&(e.value=t,e.observers&&e.observers.length&&Se(()=>{for(let o=0;o<e.observers.length;o+=1){const n=e.observers[o],r=qe&&qe.running;r&&qe.disposed.has(n),(r?!n.tState:!n.state)&&(n.pure?Z.push(n):re.push(n),n.observers&&St(n)),r||(n.state=ge)}if(Z.length>1e6)throw Z=[],new Error},!1)),t}function De(e){if(!e.fn)return;Ee(e);const t=Ke;Xt(e,e.value,t)}function Xt(e,t,l){let i;const o=N,n=H;H=N=e;try{i=e.fn(t)}catch(r){return e.pure&&(e.state=ge,e.owned&&e.owned.forEach(Ee),e.owned=null),e.updatedAt=l+1,kt(r)}finally{H=n,N=o}(!e.updatedAt||e.updatedAt<=l)&&(e.updatedAt!=null&&"observers"in e?_t(e,i):e.value=i,e.updatedAt=l)}function lt(e,t,l,i=ge,o){const n={fn:e,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:N,context:N?N.context:null,pure:l};return N===null||N!==wt&&(N.owned?N.owned.push(n):N.owned=[n]),n}function Oe(e){if(e.state===0)return;if(e.state===Fe)return Ne(e);if(e.suspense&&te(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ke);)e.state&&t.push(e);for(let l=t.length-1;l>=0;l--)if(e=t[l],e.state===ge)De(e);else if(e.state===Fe){const i=Z;Z=null,Se(()=>Ne(e,t[0]),!1),Z=i}}function Se(e,t){if(Z)return e();let l=!1;t||(Z=[]),re?l=!0:re=[],Ke++;try{const i=e();return Kt(l),i}catch(i){l||(re=null),Z=null,kt(i)}}function Kt(e){if(Z&&($t(Z),Z=null),e)return;const t=re;re=null,t.length&&Se(()=>yt(t),!1)}function $t(e){for(let t=0;t<e.length;t++)Oe(e[t])}function Vt(e){let t,l=0;for(t=0;t<e.length;t++){const i=e[t];i.user?e[l++]=i:Oe(i)}for(t=0;t<l;t++)Oe(e[t])}function Ne(e,t){e.state=0;for(let l=0;l<e.sources.length;l+=1){const i=e.sources[l];if(i.sources){const o=i.state;o===ge?i!==t&&(!i.updatedAt||i.updatedAt<Ke)&&Oe(i):o===Fe&&Ne(i,t)}}}function St(e){for(let t=0;t<e.observers.length;t+=1){const l=e.observers[t];l.state||(l.state=Fe,l.pure?Z.push(l):re.push(l),l.observers&&St(l))}}function Ee(e){let t;if(e.sources)for(;e.sources.length;){const l=e.sources.pop(),i=e.sourceSlots.pop(),o=l.observers;if(o&&o.length){const n=o.pop(),r=l.observerSlots.pop();i<o.length&&(n.sourceSlots[r]=i,o[i]=n,l.observerSlots[i]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ee(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ee(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function qt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function kt(e,t=N){throw qt(e)}function Je(e){if(typeof e=="function"&&!e.length)return Je(e());if(Array.isArray(e)){const t=[];for(let l=0;l<e.length;l++){const i=Je(e[l]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return e}function Gt(e,t){return function(i){let o;return M(()=>o=te(()=>(N.context={...N.context,[e]:i.value},pt(()=>i.children))),void 0),o}}const Zt=Symbol("fallback");function at(e){for(let t=0;t<e.length;t++)e[t]()}function Wt(e,t,l={}){let i=[],o=[],n=[],r=0,s=t.length>1?[]:null;return bt(()=>at(n)),()=>{let h=e()||[],u=h.length,g,x;return h[Ze],te(()=>{let S,E,b,A,I,L,C,p,$;if(u===0)r!==0&&(at(n),n=[],i=[],o=[],r=0,s&&(s=[])),l.fallback&&(i=[Zt],o[0]=Te(d=>(n[0]=d,l.fallback())),r=1);else if(r===0){for(o=new Array(u),x=0;x<u;x++)i[x]=h[x],o[x]=Te(_);r=u}else{for(b=new Array(u),A=new Array(u),s&&(I=new Array(u)),L=0,C=Math.min(r,u);L<C&&i[L]===h[L];L++);for(C=r-1,p=u-1;C>=L&&p>=L&&i[C]===h[p];C--,p--)b[p]=o[C],A[p]=n[C],s&&(I[p]=s[C]);for(S=new Map,E=new Array(p+1),x=p;x>=L;x--)$=h[x],g=S.get($),E[x]=g===void 0?-1:g,S.set($,x);for(g=L;g<=C;g++)$=i[g],x=S.get($),x!==void 0&&x!==-1?(b[x]=o[g],A[x]=n[g],s&&(I[x]=s[g]),x=E[x],S.set($,x)):n[g]();for(x=L;x<u;x++)x in b?(o[x]=b[x],n[x]=A[x],s&&(s[x]=I[x],s[x](x))):o[x]=Te(_);o=o.slice(0,r=u),i=h.slice(0)}return o});function _(S){if(n[x]=S,s){const[E,b]=V(x);return s[x]=b,t(h[x],E)}return t(h[x])}}}function m(e,t){return te(()=>e(t||{}))}const Ct=e=>`Stale read from <${e}>.`;function _e(e){const t="fallback"in e&&{fallback:()=>e.fallback};return q(Wt(()=>e.each,e.children,t||void 0))}function ne(e){const t=e.keyed,l=q(()=>e.when,void 0,void 0),i=t?l:q(l,void 0,{equals:(o,n)=>!o==!n});return q(()=>{const o=i();if(o){const n=e.children;return typeof n=="function"&&n.length>0?te(()=>n(t?o:()=>{if(!te(i))throw Ct("Show");return l()})):n}return e.fallback},void 0,void 0)}function zt(e){const t=pt(()=>e.children),l=q(()=>{const i=t(),o=Array.isArray(i)?i:[i];let n=()=>{};for(let r=0;r<o.length;r++){const s=r,h=o[r],u=n,g=q(()=>u()?void 0:h.when,void 0,void 0),x=h.keyed?g:q(g,void 0,{equals:(_,S)=>!_==!S});n=()=>u()||(x()?[s,g,h]:void 0)}return n});return q(()=>{const i=l()();if(!i)return e.fallback;const[o,n,r]=i,s=r.children;return typeof s=="function"&&s.length>0?te(()=>s(r.keyed?n():()=>{var u;if(((u=te(l)())==null?void 0:u[0])!==o)throw Ct("Match");return n()})):s},void 0,void 0)}function le(e){return e}const Q=e=>q(()=>e());function Jt(e,t,l){let i=l.length,o=t.length,n=i,r=0,s=0,h=t[o-1].nextSibling,u=null;for(;r<o||s<n;){if(t[r]===l[s]){r++,s++;continue}for(;t[o-1]===l[n-1];)o--,n--;if(o===r){const g=n<i?s?l[s-1].nextSibling:l[n-s]:h;for(;s<n;)e.insertBefore(l[s++],g)}else if(n===s)for(;r<o;)(!u||!u.has(t[r]))&&t[r].remove(),r++;else if(t[r]===l[n-1]&&l[s]===t[o-1]){const g=t[--o].nextSibling;e.insertBefore(l[s++],t[r++].nextSibling),e.insertBefore(l[--n],g),t[o]=l[n]}else{if(!u){u=new Map;let x=s;for(;x<n;)u.set(l[x],x++)}const g=u.get(t[r]);if(g!=null)if(s<g&&g<n){let x=r,_=1,S;for(;++x<o&&x<n&&!((S=u.get(t[x]))==null||S!==g+_);)_++;if(_>g-s){const E=t[r];for(;s<g;)e.insertBefore(l[s++],E)}else e.replaceChild(l[s++],t[r++])}else r++;else t[r++].remove()}}}const ct="_$DX_DELEGATE";function Qt(e,t,l,i={}){let o;return Te(n=>{o=n,t===document?e():v(t,e(),t.firstChild?null:void 0,l)},i.owner),()=>{o(),t.textContent=""}}function P(e,t,l,i){let o;const n=()=>{const s=i?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return s.innerHTML=e,l?s.content.firstChild.firstChild:i?s.firstChild:s.content.firstChild},r=t?()=>te(()=>document.importNode(o||(o=n()),!0)):()=>(o||(o=n())).cloneNode(!0);return r.cloneNode=r,r}function fe(e,t=window.document){const l=t[ct]||(t[ct]=new Set);for(let i=0,o=e.length;i<o;i++){const n=e[i];l.has(n)||(l.add(n),t.addEventListener(n,nn))}}function f(e,t,l){l==null?e.removeAttribute(t):e.setAttribute(t,l)}function xe(e,t){t==null?e.removeAttribute("class"):e.className=t}function Qe(e,t,l,i){Array.isArray(l)?(e[`$$${t}`]=l[0],e[`$$${t}Data`]=l[1]):e[`$$${t}`]=l}function en(e,t,l){if(!t)return l?f(e,"style"):t;const i=e.style;if(typeof t=="string")return i.cssText=t;typeof l=="string"&&(i.cssText=l=void 0),l||(l={}),t||(t={});let o,n;for(n in l)t[n]==null&&i.removeProperty(n),delete l[n];for(n in t)o=t[n],o!==l[n]&&(i.setProperty(n,o),l[n]=o);return l}function tn(e,t,l){return te(()=>e(t,l))}function v(e,t,l,i){if(l!==void 0&&!i&&(i=[]),typeof t!="function")return je(e,t,i,l);M(o=>je(e,t(),o,l),i)}function nn(e){let t=e.target;const l=`$$${e.type}`,i=e.target,o=e.currentTarget,n=h=>Object.defineProperty(e,"target",{configurable:!0,value:h}),r=()=>{const h=t[l];if(h&&!t.disabled){const u=t[`${l}Data`];if(u!==void 0?h.call(t,u,e):h.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},s=()=>{for(;r()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const h=e.composedPath();n(h[0]);for(let u=0;u<h.length-2&&(t=h[u],!!r());u++){if(t._$host){t=t._$host,s();break}if(t.parentNode===o)break}}else s();n(i)}function je(e,t,l,i,o){for(;typeof l=="function";)l=l();if(t===l)return l;const n=typeof t,r=i!==void 0;if(e=r&&l[0]&&l[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===l))return l;if(r){let s=l[0];s&&s.nodeType===3?s.data!==t&&(s.data=t):s=document.createTextNode(t),l=pe(e,l,i,s)}else l!==""&&typeof l=="string"?l=e.firstChild.data=t:l=e.textContent=t}else if(t==null||n==="boolean")l=pe(e,l,i);else{if(n==="function")return M(()=>{let s=t();for(;typeof s=="function";)s=s();l=je(e,s,l,i)}),()=>l;if(Array.isArray(t)){const s=[],h=l&&Array.isArray(l);if(et(s,t,l,o))return M(()=>l=je(e,s,l,i,!0)),()=>l;if(s.length===0){if(l=pe(e,l,i),r)return l}else h?l.length===0?dt(e,s,i):Jt(e,l,s):(l&&pe(e),dt(e,s));l=s}else if(t.nodeType){if(Array.isArray(l)){if(r)return l=pe(e,l,i,t);pe(e,l,null,t)}else l==null||l===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);l=t}}return l}function et(e,t,l,i){let o=!1;for(let n=0,r=t.length;n<r;n++){let s=t[n],h=l&&l[e.length],u;if(!(s==null||s===!0||s===!1))if((u=typeof s)=="object"&&s.nodeType)e.push(s);else if(Array.isArray(s))o=et(e,s,h)||o;else if(u==="function")if(i){for(;typeof s=="function";)s=s();o=et(e,Array.isArray(s)?s:[s],Array.isArray(h)?h:[h])||o}else e.push(s),o=!0;else{const g=String(s);h&&h.nodeType===3&&h.data===g?e.push(h):e.push(document.createTextNode(g))}}return o}function dt(e,t,l=null){for(let i=0,o=t.length;i<o;i++)e.insertBefore(t[i],l)}function pe(e,t,l,i){if(l===void 0)return e.textContent="";const o=i||document.createTextNode("");if(t.length){let n=!1;for(let r=t.length-1;r>=0;r--){const s=t[r];if(o!==s){const h=s.parentNode===e;!n&&!r?h?e.replaceChild(o,s):e.insertBefore(o,l):h&&s.remove()}else n=!0}}else e.insertBefore(o,l);return[o]}const tt=Symbol("store-raw"),$e=Symbol("store-node"),ie=Symbol("store-has"),Et=Symbol("store-self");function At(e){let t=e[ye];if(!t&&(Object.defineProperty(e,ye,{value:t=new Proxy(e,rn)}),!Array.isArray(e))){const l=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let o=0,n=l.length;o<n;o++){const r=l[o];i[r].get&&Object.defineProperty(e,r,{enumerable:i[r].enumerable,get:i[r].get.bind(t)})}}return t}function Be(e){let t;return e!=null&&typeof e=="object"&&(e[ye]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ae(e,t=new Set){let l,i,o,n;if(l=e!=null&&e[tt])return l;if(!Be(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let r=0,s=e.length;r<s;r++)o=e[r],(i=Ae(o,t))!==o&&(e[r]=i)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const r=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let h=0,u=r.length;h<u;h++)n=r[h],!s[n].get&&(o=e[n],(i=Ae(o,t))!==o&&(e[n]=i))}return e}function Ye(e,t){let l=e[t];return l||Object.defineProperty(e,t,{value:l=Object.create(null)}),l}function Pe(e,t,l){if(e[t])return e[t];const[i,o]=V(l,{equals:!1,internal:!0});return i.$=o,e[t]=i}function ln(e,t){const l=Reflect.getOwnPropertyDescriptor(e,t);return!l||l.get||!l.configurable||t===ye||t===$e||(delete l.value,delete l.writable,l.get=()=>e[ye][t]),l}function Pt(e){We()&&Pe(Ye(e,$e),Et)()}function on(e){return Pt(e),Reflect.ownKeys(e)}const rn={get(e,t,l){if(t===tt)return e;if(t===ye)return l;if(t===Ze)return Pt(e),l;const i=Ye(e,$e),o=i[t];let n=o?o():e[t];if(t===$e||t===ie||t==="__proto__")return n;if(!o){const r=Object.getOwnPropertyDescriptor(e,t);We()&&(typeof n!="function"||e.hasOwnProperty(t))&&!(r&&r.get)&&(n=Pe(i,t,n)())}return Be(n)?At(n):n},has(e,t){return t===tt||t===ye||t===Ze||t===$e||t===ie||t==="__proto__"?!0:(We()&&Pe(Ye(e,ie),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:on,getOwnPropertyDescriptor:ln};function He(e,t,l,i=!1){if(!i&&e[t]===l)return;const o=e[t],n=e.length;l===void 0?(delete e[t],e[ie]&&e[ie][t]&&o!==void 0&&e[ie][t].$()):(e[t]=l,e[ie]&&e[ie][t]&&o===void 0&&e[ie][t].$());let r=Ye(e,$e),s;if((s=Pe(r,t,o))&&s.$(()=>l),Array.isArray(e)&&e.length!==n){for(let h=e.length;h<n;h++)(s=r[h])&&s.$();(s=Pe(r,"length",n))&&s.$(e.length)}(s=r[Et])&&s.$()}function Lt(e,t){const l=Object.keys(t);for(let i=0;i<l.length;i+=1){const o=l[i];He(e,o,t[o])}}function sn(e,t){if(typeof t=="function"&&(t=t(e)),t=Ae(t),Array.isArray(t)){if(e===t)return;let l=0,i=t.length;for(;l<i;l++){const o=t[l];e[l]!==o&&He(e,l,o)}He(e,"length",i)}else Lt(e,t)}function ze(e,t,l=[]){let i,o=e;if(t.length>1){i=t.shift();const r=typeof i,s=Array.isArray(e);if(Array.isArray(i)){for(let h=0;h<i.length;h++)ze(e,[i[h]].concat(t),l);return}else if(s&&r==="function"){for(let h=0;h<e.length;h++)i(e[h],h)&&ze(e,[h].concat(t),l);return}else if(s&&r==="object"){const{from:h=0,to:u=e.length-1,by:g=1}=i;for(let x=h;x<=u;x+=g)ze(e,[x].concat(t),l);return}else if(t.length>1){ze(e[i],t,[i].concat(l));return}o=e[i],l=[i].concat(l)}let n=t[0];typeof n=="function"&&(n=n(o,l),n===o)||i===void 0&&n==null||(n=Ae(n),i===void 0||Be(o)&&Be(n)&&!Array.isArray(n)?Lt(o,n):He(e,i,n))}function an(...[e,t]){const l=Ae(e||{}),i=Array.isArray(l),o=At(l);function n(...r){Bt(()=>{i&&r.length===1?sn(l,r[0]):ze(l,r)})}return[o,n]}function cn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ut(e,t=!1){const l=cn(),i=`_${l}`;return Object.defineProperty(window,i,{value:o=>(t&&Reflect.deleteProperty(window,i),e==null?void 0:e(o)),writable:!1,configurable:!0}),l}async function K(e,t={}){return new Promise((l,i)=>{const o=ut(r=>{l(r),Reflect.deleteProperty(window,`_${n}`)},!0),n=ut(r=>{i(r),Reflect.deleteProperty(window,`_${o}`)},!0);window.__TAURI_IPC__({cmd:e,callback:o,error:n,...t})})}const Mt=Yt(),dn=e=>{const[t,l]=an({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[i,o]=V(!1),[n,r]=V(null),[s,h]=V(!1),u=async()=>{try{o(!0),console.log("🔄 Loading app state...");const c=await K("get_app_state");console.log("🔄 App state loaded, selected_ids:",c.selected_ids),l(c)}catch(c){console.error("Failed to load app state:",c)}finally{o(!1)}};nt(()=>{u()});const D={state:t,createElement:async(c,a,z,U={})=>{try{o(!0);const R=await K("create_element",{request:{element_type:c,position:a,size:z,content_data:U}});return await u(),R}catch(R){throw console.error("Failed to create element:",R),R}finally{o(!1)}},updateElement:async(c,a)=>{try{o(!0),await K("update_element",{request:{id:c,updates:a}}),await u()}catch(z){throw console.error("Failed to update element:",z),z}finally{o(!1)}},batchUpdatePositions:async c=>{try{o(!0),await K("batch_update_positions",{request:{updates:c}}),l(a=>{const z=a.elements.map(U=>{const R=c.find(j=>j.element_id===U.id);return R?{...U,position:R.new_position}:U});return{...a,elements:z,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(a){throw console.error("Failed to batch update positions:",a),await u(),a}finally{o(!1)}},deleteElement:async c=>{try{o(!0),await K("delete_element",{elementId:c}),await u()}catch(a){throw console.error("Failed to delete element:",a),a}finally{o(!1)}},selectElement:async c=>{try{console.log("Selecting element:",c),await K("select_element",{elementId:c}),console.log("Select command completed, reloading state..."),await u(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(a){throw console.error("Failed to select element:",a),a}},selectMultiple:async c=>{try{console.log("Selecting multiple elements:",c),c.length>0?(await K("select_multiple",{elementIds:c}),console.log("✅ Multi-select completed for:",c.length,"elements")):await K("clear_selection"),await u()}catch(a){throw console.error("Failed to select multiple elements:",a),a}},addToSelection:async c=>{try{console.log("Adding to selection:",c),await K("add_to_selection",{elementId:c}),await u()}catch(a){throw console.error("Failed to add to selection:",a),a}},removeFromSelection:async c=>{try{console.log("Removing from selection:",c),await K("remove_from_selection",{elementId:c}),await u()}catch(a){throw console.error("Failed to remove from selection:",a),a}},toggleSelection:async c=>{try{console.log("Toggling selection:",c),await K("toggle_selection",{elementId:c}),await u()}catch(a){throw console.error("Failed to toggle selection:",a),a}},clearSelection:async()=>{try{console.log("🚨 CRITICAL: clearSelection called!"),console.log("🚨 Call stack:",new Error().stack),await K("clear_selection"),await u()}catch(c){throw console.error("Failed to clear selection:",c),c}},copySelected:async()=>{try{await K("copy_selected")}catch(c){throw console.error("Failed to copy selected elements:",c),c}},pasteElements:async(c,a)=>{try{o(!0);const z=await K("paste_elements",{offsetX:c,offsetY:a});return await u(),z}catch(z){throw console.error("Failed to paste elements:",z),z}finally{o(!1)}},undo:async()=>{try{o(!0),await K("undo"),await u()}catch(c){throw console.error("Failed to undo:",c),c}finally{o(!1)}},redo:async()=>{try{o(!0),await K("redo"),await u()}catch(c){throw console.error("Failed to redo:",c),c}finally{o(!1)}},updateCanvasConfig:async c=>{try{o(!0),await K("update_canvas_config",{request:c}),await u()}catch(a){throw console.error("Failed to update canvas config:",a),a}finally{o(!1)}},getElementsAtPoint:async(c,a)=>{try{return await K("get_elements_at_point",{x:c,y:a})}catch(z){return console.error("Failed to get elements at point:",z),[]}},isLoading:i,setLoading:o,dragOperation:n,setDragOperation:r,resizeOperation:s,setResizeOperation:h};return m(Mt.Provider,{value:D,get children(){return e.children}})},ae=()=>{const e=Ht(Mt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var un=P("<span class=text-warning>●"),gn=P("<span class=ml-2> 个元素"),fn=P('<span class="ml-2 text-primary">已选择 <!> 个'),hn=P('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const vn=()=>{const{state:e,undo:t,redo:l,updateCanvasConfig:i}=ae(),[o,n]=V(e.canvas_config.zoom*100),r=async _=>{const S=_/100;n(_);try{await i({zoom:S})}catch(E){console.error("Failed to update zoom:",E)}},s=()=>{const _=Math.min(o()+25,500);r(_)},h=()=>{const _=Math.max(o()-25,25);r(_)},u=async()=>{try{await i({show_grid:!e.canvas_config.show_grid})}catch(_){console.error("Failed to toggle grid:",_)}},g=async()=>{try{await i({show_rulers:!e.canvas_config.show_rulers})}catch(_){console.error("Failed to toggle rulers:",_)}},x=async()=>{try{await K("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(_){console.error("Failed to toggle DevTools:",_)}};return(()=>{var _=hn(),S=_.firstChild,E=S.nextSibling,b=E.firstChild,A=b.nextSibling,I=A.nextSibling,L=I.nextSibling,C=L.nextSibling,p=C.nextSibling,$=p.nextSibling,d=$.nextSibling,y=d.nextSibling,k=y.nextSibling,w=k.nextSibling,D=E.nextSibling,c=D.firstChild;return Qe(b,"click",t),Qe(A,"click",l),L.$$click=h,C.addEventListener("change",a=>{const z=a.target.value;if(z==="fit")console.log("Fit to window");else{const U=parseInt(z.replace("%",""));r(U)}}),p.$$click=s,d.$$click=u,y.$$click=g,w.$$click=x,v(D,m(ne,{get when(){return e.dirty},get children(){return un()}}),c),v(c,()=>e.template_name||"未命名模板"),v(D,m(ne,{get when(){return e.elements.length>0},get children(){var a=gn(),z=a.firstChild;return v(a,()=>e.elements.length,z),a}}),null),v(D,m(ne,{get when(){return e.selected_ids.length>0},get children(){var a=fn(),z=a.firstChild,U=z.nextSibling;return U.nextSibling,v(a,()=>e.selected_ids.length,U),a}}),null),M(a=>{var z=`toolbar-btn-icon ${e.can_undo?"":"opacity-50 cursor-not-allowed"}`,U=!e.can_undo,R=`撤销${e.undo_description?` (${e.undo_description})`:""} (Ctrl+Z)`,j=`toolbar-btn-icon ${e.can_redo?"":"opacity-50 cursor-not-allowed"}`,G=!e.can_redo,B=`重做${e.redo_description?` (${e.redo_description})`:""} (Ctrl+Y)`,O=`toolbar-btn-icon ${e.canvas_config.show_grid?"active":""}`,X=`toolbar-btn-icon ${e.canvas_config.show_rulers?"active":""}`;return z!==a.e&&xe(b,a.e=z),U!==a.t&&(b.disabled=a.t=U),R!==a.a&&f(b,"title",a.a=R),j!==a.o&&xe(A,a.o=j),G!==a.i&&(A.disabled=a.i=G),B!==a.n&&f(A,"title",a.n=B),O!==a.s&&xe(d,a.s=O),X!==a.h&&xe(y,a.h=X),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),M(()=>C.value=`${Math.round(o())}%`),_})()};fe(["click"]);var mn=P('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),yn=P('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const wn=()=>{const{createElement:e}=ae(),[t,l]=V(""),i=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:u=>({type:"Text",content:(u==null?void 0:u.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:u=>({type:"DataField",expression:(u==null?void 0:u.expression)||"${fieldName}",format:u==null?void 0:u.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:u=>({type:"Rectangle",fill_color:(u==null?void 0:u.fill_color)||"transparent",border:{color:(u==null?void 0:u.border_color)||"#000000",width:(u==null?void 0:u.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:u=>({type:"Line",color:(u==null?void 0:u.color)||"#000000",width:(u==null?void 0:u.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:u=>({type:"Image",src:(u==null?void 0:u.src)||"",alt:(u==null?void 0:u.alt)||"图片"})}],o=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center"}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right"}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left"}})}],n=[...i,...o],r=()=>{const u=t().toLowerCase();return u?n.filter(g=>g.name.toLowerCase().includes(u)||g.description.toLowerCase().includes(u)):n},s=(u,g)=>{if(console.log("Starting drag for component:",u.id),g.dataTransfer){g.dataTransfer.effectAllowed="copy",g.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:u}));const x=document.createElement("div");x.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${u.icon} ${u.name}
        </div>
      `,x.style.position="absolute",x.style.top="-1000px",document.body.appendChild(x),g.dataTransfer.setDragImage(x,50,20),setTimeout(()=>{document.body.removeChild(x)},0)}},h=async u=>{try{const g=await e(u.id,{x:100,y:100},u.default_size,u.create_content());console.log("Created element:",g)}catch(g){console.error("Failed to create element:",g)}};return(()=>{var u=mn(),g=u.firstChild,x=g.firstChild,_=x.nextSibling,S=g.nextSibling,E=S.firstChild,b=E.firstChild,A=b.firstChild,I=A.nextSibling,L=b.nextSibling,C=L.firstChild,p=C.nextSibling,$=L.nextSibling,d=$.firstChild,y=d.nextSibling;return _.$$input=k=>l(k.target.value),v(I,m(_e,{get each(){return r().filter(k=>k.category==="basic")},children:k=>m(Ge,{component:k,onDrag:w=>s(k,w),onClick:()=>h(k)})})),v(p,m(_e,{get each(){return r().filter(k=>k.category==="data")},children:k=>m(Ge,{component:k,onDrag:w=>s(k,w),onClick:()=>h(k)})})),v(y,m(_e,{get each(){return r().filter(k=>k.category==="bank")},children:k=>m(Ge,{component:k,onDrag:w=>s(k,w),onClick:()=>h(k)})})),M(()=>_.value=t()),u})()},Ge=e=>(()=>{var t=yn(),l=t.firstChild,i=l.firstChild,o=i.nextSibling;return Qe(t,"click",e.onClick),t.addEventListener("dragstart",n=>e.onDrag(n)),f(t,"draggable",!0),v(i,()=>e.component.icon),v(o,()=>e.component.name),M(()=>f(t,"title",e.component.description)),t})();fe(["input","click"]);var bn=P('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),pn=P('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),xn=P("<span class=property-value>"),_n=P('<span class="property-value text-xs text-muted">'),Xe=P("<div class=space-y-2>"),Ce=P("<input type=number class=property-input>"),$n=P('<div class="grid grid-cols-2 gap-2">'),gt=P("<input type=checkbox class=property-checkbox>"),Sn=P('<div class="p-4 space-y-4">'),kn=P("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),Cn=P("<div class=property-field><label class=property-label>"),zn=P("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),Dt=P('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),It=P("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),Ut=P('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),En=P("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),Tt=P('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),An=P('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Pn=P("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),ft=P("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Ln=P('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),Mn=P("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),Dn=P("<input type=text class=property-input placeholder=图片描述文字>"),In=P("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),Un=P("<div class=space-y-3>"),Tn=P("<img class=property-image>"),Rn=P("<input type=text class=property-input placeholder=${fieldName}>"),Fn=P("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),On=P("<div class=space-y-4>"),Nn=P('<div class=flex><input type=number class="property-input flex-1">'),jn=P("<span class=property-unit>"),Bn=P('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),Yn=P("<div class=property-alignment-group>"),Hn=P("<button>");const Xn=()=>{const{state:e,updateElement:t}=ae(),l=q(()=>{const n=new Set(e.selected_ids);return e.elements.filter(r=>n.has(r.id))}),i=q(()=>l()[0]),o=async(n,r,s)=>{try{await t(n,{[r]:s})}catch(h){console.error("Failed to update element property:",h)}};return(()=>{var n=bn(),r=n.firstChild,s=r.nextSibling;return v(s,m(ne,{get when(){return i()},get fallback(){return pn()},get children(){return m(Kn,{get element(){return i()},onUpdate:o})}})),n})()},Kn=e=>{const t=(i,o)=>{const n={...e.element.position,[i]:o};e.onUpdate(e.element.id,"position",n)},l=(i,o)=>{const n={...e.element.size,[i]:Math.max(1,o)};e.onUpdate(e.element.id,"size",n)};return(()=>{var i=Sn();return v(i,m(se,{title:"元素信息",icon:"ℹ️",get children(){var o=Xe();return v(o,m(T,{label:"类型",get children(){var n=xn();return v(n,()=>e.element.content.type),n}}),null),v(o,m(T,{label:"ID",get children(){var n=_n();return v(n,()=>e.element.id),n}}),null),o}}),null),v(i,m(se,{title:"位置和大小",icon:"📐",get children(){var o=$n();return v(o,m(T,{label:"X",get children(){var n=Ce();return n.$$input=r=>t("x",parseFloat(r.target.value)||0),M(()=>n.value=e.element.position.x),n}}),null),v(o,m(T,{label:"Y",get children(){var n=Ce();return n.$$input=r=>t("y",parseFloat(r.target.value)||0),M(()=>n.value=e.element.position.y),n}}),null),v(o,m(T,{label:"宽度",get children(){var n=Ce();return n.$$input=r=>l("width",parseFloat(r.target.value)||1),M(()=>n.value=e.element.size.width),n}}),null),v(o,m(T,{label:"高度",get children(){var n=Ce();return n.$$input=r=>l("height",parseFloat(r.target.value)||1),M(()=>n.value=e.element.size.height),n}}),null),o}}),null),v(i,m(se,{title:"状态",icon:"👁️",get children(){var o=Xe();return v(o,m(T,{label:"可见",get children(){var n=gt();return n.addEventListener("change",r=>e.onUpdate(e.element.id,"visible",r.target.checked)),M(()=>n.checked=e.element.visible),n}}),null),v(o,m(T,{label:"锁定",get children(){var n=gt();return n.addEventListener("change",r=>e.onUpdate(e.element.id,"locked",r.target.checked)),M(()=>n.checked=e.element.locked),n}}),null),v(o,m(T,{label:"层级",get children(){var n=Ce();return n.$$input=r=>e.onUpdate(e.element.id,"z_index",parseInt(r.target.value)||0),M(()=>n.value=e.element.z_index),n}}),null),o}}),null),v(i,m(zt,{get children(){return[m(le,{get when(){return e.element.content.type==="Text"&&e.element.content},children:o=>m(Vn,{get content(){return o()},onUpdate:n=>{console.log("Text content update:",n),e.onUpdate(e.element.id,"content",n)}})}),m(le,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:o=>m(qn,{get content(){return o()},onUpdate:n=>{console.log("Rectangle content update:",n),e.onUpdate(e.element.id,"content",n)}})}),m(le,{get when(){return e.element.content.type==="Line"&&e.element.content},children:o=>m(Gn,{get content(){return o()},onUpdate:n=>{console.log("Line content update:",n),e.onUpdate(e.element.id,"content",n)}})}),m(le,{get when(){return e.element.content.type==="Image"&&e.element.content},children:o=>m(Zn,{get content(){return o()},onUpdate:n=>{console.log("Image content update:",n),e.onUpdate(e.element.id,"content",n)}})}),m(le,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:o=>m(Wn,{get content(){return o()},onUpdate:n=>{console.log("DataField content update:",n),e.onUpdate(e.element.id,"content",n)}})})]}}),null),i})()},se=e=>(()=>{var t=kn(),l=t.firstChild,i=l.firstChild,o=i.nextSibling,n=l.nextSibling;return v(i,()=>e.icon),v(o,()=>e.title),v(n,()=>e.children),t})(),T=e=>(()=>{var t=Cn(),l=t.firstChild;return v(l,()=>e.label),v(t,()=>e.children,null),t})(),Vn=e=>m(se,{title:"文字样式",icon:"🔤",get children(){var t=Ut(),l=t.firstChild,i=l.nextSibling;return v(t,m(T,{label:"内容",get children(){var o=zn();return o.$$input=n=>e.onUpdate({content:n.target.value}),M(()=>o.value=e.content.content),o}}),l),v(l,m(T,{label:"字体",get children(){var o=Dt();return o.addEventListener("change",n=>e.onUpdate({style:{...e.content.style,font_family:n.target.value}})),M(()=>o.value=e.content.style.font_family),o}}),null),v(l,m(T,{label:"大小",get children(){return m(Le,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:o=>e.onUpdate({style:{...e.content.style,font_size:o}})})}}),null),v(i,m(T,{label:"字重",get children(){var o=It();return o.addEventListener("change",n=>e.onUpdate({style:{...e.content.style,font_weight:n.target.value}})),M(()=>o.value=e.content.style.font_weight),o}}),null),v(i,m(T,{label:"对齐",get children(){return m(Rt,{get value(){return e.content.style.align},onUpdate:o=>e.onUpdate({style:{...e.content.style,align:o}})})}}),null),v(t,m(T,{label:"颜色",get children(){return m(Me,{get value(){return e.content.style.color},onUpdate:o=>e.onUpdate({style:{...e.content.style,color:o}})})}}),null),t}}),qn=e=>m(se,{title:"矩形样式",icon:"▭",get children(){var t=An(),l=t.firstChild,i=l.firstChild;return v(t,m(T,{label:"填充颜色",get children(){return m(Me,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:o=>e.onUpdate({fill_color:o})})}}),l),v(l,m(T,{label:"边框",get children(){var o=Xe();return v(o,m(Me,{get value(){var n;return((n=e.content.border)==null?void 0:n.color)||"#000000"},onUpdate:n=>e.onUpdate({border:{...e.content.border,color:n}})})),o}}),i),v(i,m(T,{label:"宽度",get children(){return m(Le,{get value(){var o;return((o=e.content.border)==null?void 0:o.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:o=>e.onUpdate({border:{...e.content.border,width:o}})})}}),null),v(i,m(T,{label:"样式",get children(){var o=En();return o.addEventListener("change",n=>e.onUpdate({border:{...e.content.border,style:n.target.value}})),M(()=>{var n;return o.value=((n=e.content.border)==null?void 0:n.style)||"Solid"}),o}}),null),v(t,m(T,{label:"圆角半径",get children(){return m(Le,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:o=>e.onUpdate({corner_radius:o})})}}),null),v(t,m(T,{label:"透明度",get children(){var o=Tt(),n=o.firstChild,r=n.nextSibling,s=r.firstChild;return n.$$input=h=>e.onUpdate({opacity:parseFloat(h.target.value)/100}),v(r,()=>Math.round((e.content.opacity||1)*100),s),M(()=>n.value=(e.content.opacity||1)*100),o}}),null),t}}),Gn=e=>m(se,{title:"线条样式",icon:"━",get children(){var t=Ln(),l=t.firstChild;return v(t,m(T,{label:"颜色",get children(){return m(Me,{get value(){return e.content.color},onUpdate:i=>e.onUpdate({color:i})})}}),l),v(t,m(T,{label:"宽度",get children(){return m(Le,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:i=>e.onUpdate({width:i})})}}),l),v(t,m(T,{label:"样式",get children(){var i=Pn();return i.addEventListener("change",o=>e.onUpdate({line_style:o.target.value})),M(()=>i.value=e.content.line_style||"Solid"),i}}),l),v(l,m(T,{label:"起点",get children(){var i=ft();return i.addEventListener("change",o=>e.onUpdate({start_cap:o.target.value})),M(()=>i.value=e.content.start_cap||"None"),i}}),null),v(l,m(T,{label:"终点",get children(){var i=ft();return i.addEventListener("change",o=>e.onUpdate({end_cap:o.target.value})),M(()=>i.value=e.content.end_cap||"None"),i}}),null),v(t,m(T,{label:"透明度",get children(){var i=Tt(),o=i.firstChild,n=o.nextSibling,r=n.firstChild;return o.$$input=s=>e.onUpdate({opacity:parseFloat(s.target.value)/100}),v(n,()=>Math.round((e.content.opacity||1)*100),r),M(()=>o.value=(e.content.opacity||1)*100),i}}),null),t}}),Zn=e=>m(se,{title:"图片属性",icon:"🖼️",get children(){var t=Un();return v(t,m(T,{label:"图片地址",get children(){var l=Mn();return l.$$input=i=>e.onUpdate({src:i.target.value}),M(()=>l.value=e.content.src),l}}),null),v(t,m(T,{label:"替代文本",get children(){var l=Dn();return l.$$input=i=>e.onUpdate({alt:i.target.value}),M(()=>l.value=e.content.alt||""),l}}),null),v(t,m(T,{label:"预览",get children(){var l=In(),i=l.firstChild;return v(l,(()=>{var o=Q(()=>!!e.content.src);return()=>o()?(()=>{var n=Tn();return n.addEventListener("load",r=>{const s=r.target,h=s.nextElementSibling;s&&(s.style.display="block"),h&&(h.style.display="none")}),n.addEventListener("error",r=>{const s=r.target,h=s.nextElementSibling;s&&(s.style.display="none"),h&&(h.style.display="flex")}),M(r=>{var s=e.content.src,h=e.content.alt||"图片预览";return s!==r.e&&f(n,"src",r.e=s),h!==r.t&&f(n,"alt",r.t=h),r},{e:void 0,t:void 0}),n})():null})(),i),M(o=>(o=e.content.src?"none":"flex")!=null?i.style.setProperty("display",o):i.style.removeProperty("display")),l}}),null),t}}),Wn=e=>(()=>{var t=On();return v(t,m(se,{title:"数据字段",icon:"🔗",get children(){var l=Xe();return v(l,m(T,{label:"表达式",get children(){var i=Rn();return i.$$input=o=>e.onUpdate({expression:o.target.value}),M(()=>i.value=e.content.expression),i}}),null),v(l,m(T,{label:"格式",get children(){var i=Fn();return i.addEventListener("change",o=>e.onUpdate({format:o.target.value==="default"?void 0:o.target.value})),M(()=>i.value=e.content.format||"default"),i}}),null),l}}),null),v(t,m(se,{title:"字段样式",icon:"🎨",get children(){var l=Ut(),i=l.firstChild,o=i.nextSibling;return v(i,m(T,{label:"字体",get children(){var n=Dt();return n.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_family:r.target.value}})),M(()=>n.value=e.content.style.font_family),n}}),null),v(i,m(T,{label:"大小",get children(){return m(Le,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:n=>e.onUpdate({style:{...e.content.style,font_size:n}})})}}),null),v(o,m(T,{label:"字重",get children(){var n=It();return n.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_weight:r.target.value}})),M(()=>n.value=e.content.style.font_weight),n}}),null),v(o,m(T,{label:"对齐",get children(){return m(Rt,{get value(){return e.content.style.align},onUpdate:n=>e.onUpdate({style:{...e.content.style,align:n}})})}}),null),v(l,m(T,{label:"颜色",get children(){return m(Me,{get value(){return e.content.style.color},onUpdate:n=>e.onUpdate({style:{...e.content.style,color:n}})})}}),null),l}}),null),t})(),Le=e=>(()=>{var t=Nn(),l=t.firstChild;return l.addEventListener("blur",i=>{const o=parseFloat(i.target.value)||e.value,n=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));n!==o&&(i.target.value=n.toString(),e.onUpdate(n))}),l.$$input=i=>{const o=parseFloat(i.target.value);if(!isNaN(o)){const n=Math.max(e.min||-1/0,Math.min(e.max||1/0,o));e.onUpdate(n)}},v(t,(()=>{var i=Q(()=>!!e.unit);return()=>i()&&(()=>{var o=jn();return v(o,()=>e.unit),o})()})(),null),M(i=>{var o=e.min,n=e.max,r=e.step||1;return o!==i.e&&f(l,"min",i.e=o),n!==i.t&&f(l,"max",i.t=n),r!==i.a&&f(l,"step",i.a=r),i},{e:void 0,t:void 0,a:void 0}),M(()=>l.value=e.value),t})(),Me=e=>(()=>{var t=Bn(),l=t.firstChild,i=l.firstChild,o=i.nextSibling,n=l.nextSibling;return i.$$input=r=>e.onUpdate(r.target.value),n.$$input=r=>{const s=r.target.value;(/^#[0-9A-Fa-f]{6}$/.test(s)||/^#[0-9A-Fa-f]{3}$/.test(s))&&e.onUpdate(s)},M(r=>(r=e.value)!=null?o.style.setProperty("background-color",r):o.style.removeProperty("background-color")),M(()=>i.value=e.value),M(()=>n.value=e.value),t})(),Rt=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var l=Yn();return v(l,()=>t.map(i=>(()=>{var o=Hn();return o.$$click=()=>e.onUpdate(i.value),v(o,()=>i.icon),M(n=>{var r=`property-alignment-btn ${e.value===i.value?"active":""}`,s=i.label;return r!==n.e&&xe(o,n.e=r),s!==n.t&&f(o,"title",n.t=s),n},{e:void 0,t:void 0}),o})())),l})()};fe(["input","click"]);var Jn=P("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),Qn=P("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const el=e=>m(ne,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Jn(),l=t.firstChild,i=l.firstChild,o=i.nextSibling;return M(n=>{var r=e.config.grid_size,s=e.config.grid_size,h=e.config.grid_size,u=e.config.grid_size,g=e.config.grid_size,x=e.config.grid_size,_=e.config.grid_size,S=e.config.grid_size;return r!==n.e&&f(l,"width",n.e=r),s!==n.t&&f(l,"height",n.t=s),h!==n.a&&f(i,"x1",n.a=h),u!==n.o&&f(i,"x2",n.o=u),g!==n.i&&f(i,"y2",n.i=g),x!==n.n&&f(o,"y1",n.n=x),_!==n.s&&f(o,"x2",n.s=_),S!==n.h&&f(o,"y2",n.h=S),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=Qn();return M(l=>{var i=e.config.width,o=e.config.height;return i!==l.e&&f(t,"width",l.e=i),o!==l.t&&f(t,"height",l.t=o),l},{e:void 0,t:void 0}),t})()]}});var ht=P("<svg><text dominant-baseline=hanging></svg>",!1,!0,!1),tl=P("<svg><tspan></svg>",!1,!0,!1),nl=P("<svg><rect x=0 y=0></svg>",!1,!0,!1),ll=P('<svg><marker id=arrowhead markerWidth=10 markerHeight=7 refX=9 refY=3.5 orient=auto><polygon points="0 0, 10 3.5, 0 7"></svg>',!1,!0,!1),ol=P("<svg><circle cx=0></svg>",!1,!0,!1),il=P("<svg><circle></svg>",!1,!0,!1),vt=P("<svg><rect></svg>",!1,!0,!1),rl=P("<svg><g><defs></defs><line x1=0></svg>",!1,!0,!1),sl=P("<svg><foreignObject x=0 y=0><div></svg>",!1,!0,!1),al=P("<img>"),cl=P("<div><div></div><div>"),dl=P('<svg><rect x=0 y=0 fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.3)"stroke-width=1 stroke-dasharray=2,2></svg>',!1,!0,!1),ul=P("<svg><g></svg>",!1,!0,!1);const gl=e=>{const{state:t,selectElement:l,updateElement:i,batchUpdatePositions:o,dragOperation:n,setDragOperation:r,toggleSelection:s,addToSelection:h}=ae(),u=q(()=>{const _=n(),S=(_==null?void 0:_.type)==="move"&&(_==null?void 0:_.element_ids)&&_.element_ids.includes(e.element.id),E=e.element.position.x,b=e.element.position.y;let A=`translate(${E}px, ${b}px)`;return S&&(_!=null&&_.delta)&&(A=`translate(${E+_.delta.x}px, ${b+_.delta.y}px)`),{transform:A,opacity:e.element.visible?S?.7:1:.5,cursor:e.element.locked?"not-allowed":e.selected?"move":"pointer","will-change":S?"transform":"auto"}}),g=_=>{if(e.element.locked||!e.selected)return;_.preventDefault(),_.stopPropagation();const{state:S}=ae(),E=S.selected_ids,b=_.clientX,A=_.clientY;console.log("🎯 Starting optimized drag for",E.length>1?"multiple elements":"single element:",e.element.id);const I=new Map;E.forEach(p=>{const $=S.elements.find(d=>d.id===p);$&&I.set(p,{x:$.position.x,y:$.position.y})}),r({type:"move",element_ids:E.length>0?E:[e.element.id],start_mouse_position:{x:b,y:A},initial_positions:I,delta:{x:0,y:0}});const L=p=>{const $=p.clientX-b,d=p.clientY-A;r(y=>y?{...y,delta:{x:$,y:d}}:null)},C=async p=>{const $=p.clientX-b,d=p.clientY-A;if(Math.abs($)>2||Math.abs(d)>2){const y=n(),k=(y==null?void 0:y.element_ids)||[e.element.id],w=y==null?void 0:y.initial_positions;console.log("🎯 Finishing optimized drag for",k.length,"element(s)");try{const D=[];for(const c of k){const a=w==null?void 0:w.get(c);if(a){const z=Math.max(0,a.x+$),U=Math.max(0,a.y+d);D.push({element_id:c,new_position:{x:z,y:U}})}}D.length>0&&(console.log(`🚀 Optimized batch updating ${D.length} elements`),await o(D),console.log("✅ Optimized batch update completed"))}catch(D){console.error("❌ Failed to update element positions:",D)}}r(null),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",C)},x=()=>{const{content:_,size:S}=e.element;return m(zt,{get children(){return[m(le,{get when(){return _.type==="Text"&&_},children:E=>{const b=E().style.align,A=b==="Center"?"middle":b==="Right"?"end":"start",I=b==="Center"?S.width/2:b==="Right"?S.width:0;return(()=>{var L=ht();return f(L,"x",I),f(L,"text-anchor",A),v(L,()=>E().content.split(`
`).map((C,p)=>(()=>{var $=tl();return f($,"x",I),v($,C),M(()=>f($,"dy",p===0?0:E().style.font_size*1.2)),$})())),M(C=>{var p=E().style.font_size*.75,$=E().style.font_family,d=`${E().style.font_size}`,y=E().style.font_weight,k=E().style.color;return p!==C.e&&f(L,"y",C.e=p),$!==C.t&&f(L,"font-family",C.t=$),d!==C.a&&f(L,"font-size",C.a=d),y!==C.o&&f(L,"font-weight",C.o=y),k!==C.i&&f(L,"fill",C.i=k),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),L})()}}),m(le,{get when(){return _.type==="Rectangle"&&_},children:E=>{const b=E(),A=b.opacity!==void 0?b.opacity:1,I=b.corner_radius||0;return(()=>{var L=nl();return f(L,"rx",I),f(L,"ry",I),f(L,"fill-opacity",A),f(L,"stroke-opacity",A),M(C=>{var D,c,a,z;var p=S.width,$=S.height,d=b.fill_color||"transparent",y=((D=b.border)==null?void 0:D.color)||"#000000",k=((c=b.border)==null?void 0:c.width)||1,w=((a=b.border)==null?void 0:a.style)==="Dashed"?"5,5":((z=b.border)==null?void 0:z.style)==="Dotted"?"2,2":"none";return p!==C.e&&f(L,"width",C.e=p),$!==C.t&&f(L,"height",C.t=$),d!==C.a&&f(L,"fill",C.a=d),y!==C.o&&f(L,"stroke",C.o=y),k!==C.i&&f(L,"stroke-width",C.i=k),w!==C.n&&f(L,"stroke-dasharray",C.n=w),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),L})()}}),m(le,{get when(){return _.type==="Line"&&_},children:E=>{const b=E(),A=b.opacity!==void 0?b.opacity:1,I=b.line_style||"Solid",L=I==="Dashed"?"8,4":I==="Dotted"?"2,2":I==="DashDot"?"8,4,2,4":"none";return(()=>{var C=rl(),p=C.firstChild,$=p.nextSibling;return v(p,m(ne,{get when(){return b.start_cap==="Arrow"||b.end_cap==="Arrow"},get children(){var d=ll(),y=d.firstChild;return f(y,"fill-opacity",A),M(()=>f(y,"fill",b.color)),d}})),f($,"stroke-opacity",A),f($,"stroke-dasharray",L),v(C,m(ne,{get when(){return b.start_cap==="Circle"},get children(){var d=ol();return f(d,"fill-opacity",A),M(y=>{var k=S.height/2,w=b.width,D=b.color;return k!==y.e&&f(d,"cy",y.e=k),w!==y.t&&f(d,"r",y.t=w),D!==y.a&&f(d,"fill",y.a=D),y},{e:void 0,t:void 0,a:void 0}),d}}),null),v(C,m(ne,{get when(){return b.end_cap==="Circle"},get children(){var d=il();return f(d,"fill-opacity",A),M(y=>{var k=S.width,w=S.height/2,D=b.width,c=b.color;return k!==y.e&&f(d,"cx",y.e=k),w!==y.t&&f(d,"cy",y.t=w),D!==y.a&&f(d,"r",y.a=D),c!==y.o&&f(d,"fill",y.o=c),y},{e:void 0,t:void 0,a:void 0,o:void 0}),d}}),null),v(C,m(ne,{get when(){return b.start_cap==="Square"},get children(){var d=vt();return f(d,"fill-opacity",A),M(y=>{var k=-b.width,w=S.height/2-b.width,D=b.width*2,c=b.width*2,a=b.color;return k!==y.e&&f(d,"x",y.e=k),w!==y.t&&f(d,"y",y.t=w),D!==y.a&&f(d,"width",y.a=D),c!==y.o&&f(d,"height",y.o=c),a!==y.i&&f(d,"fill",y.i=a),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),d}}),null),v(C,m(ne,{get when(){return b.end_cap==="Square"},get children(){var d=vt();return f(d,"fill-opacity",A),M(y=>{var k=S.width-b.width,w=S.height/2-b.width,D=b.width*2,c=b.width*2,a=b.color;return k!==y.e&&f(d,"x",y.e=k),w!==y.t&&f(d,"y",y.t=w),D!==y.a&&f(d,"width",y.a=D),c!==y.o&&f(d,"height",y.o=c),a!==y.i&&f(d,"fill",y.i=a),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),d}}),null),M(d=>{var y=S.height/2,k=S.width,w=S.height/2,D=b.color,c=b.width,a=b.start_cap==="Arrow"?"url(#arrowhead)":void 0,z=b.end_cap==="Arrow"?"url(#arrowhead)":void 0;return y!==d.e&&f($,"y1",d.e=y),k!==d.t&&f($,"x2",d.t=k),w!==d.a&&f($,"y2",d.a=w),D!==d.o&&f($,"stroke",d.o=D),c!==d.i&&f($,"stroke-width",d.i=c),a!==d.n&&f($,"marker-start",d.n=a),z!==d.s&&f($,"marker-end",d.s=z),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),C})()}}),m(le,{get when(){return _.type==="Image"&&_},children:E=>{const[b,A]=V(!1),[I,L]=V(!1);return(()=>{var C=sl(),p=C.firstChild;return p.style.setProperty("width","100%"),p.style.setProperty("height","100%"),p.style.setProperty("display","flex"),p.style.setProperty("align-items","center"),p.style.setProperty("justify-content","center"),p.style.setProperty("overflow","hidden"),v(p,(()=>{var $=Q(()=>!!(E().src&&!I()));return()=>$()?(()=>{var d=al();return d.addEventListener("error",()=>{L(!0),A(!1)}),d.addEventListener("load",()=>A(!0)),d.style.setProperty("max-width","100%"),d.style.setProperty("max-height","100%"),d.style.setProperty("object-fit","contain"),M(y=>{var k=E().src,w=E().alt||"图片",D=b()?"block":"none";return k!==y.e&&f(d,"src",y.e=k),w!==y.t&&f(d,"alt",y.t=w),D!==y.a&&((y.a=D)!=null?d.style.setProperty("display",D):d.style.removeProperty("display")),y},{e:void 0,t:void 0,a:void 0}),d})():null})(),null),v(p,(()=>{var $=Q(()=>!!(!E().src||I()||!b()&&E().src));return()=>$()?(()=>{var d=cl(),y=d.firstChild,k=y.nextSibling;return d.style.setProperty("width","100%"),d.style.setProperty("height","100%"),d.style.setProperty("display","flex"),d.style.setProperty("align-items","center"),d.style.setProperty("justify-content","center"),d.style.setProperty("flex-direction","column"),d.style.setProperty("background","rgba(0,0,0,0.05)"),d.style.setProperty("border","1px dashed #ccc"),d.style.setProperty("box-sizing","border-box"),d.style.setProperty("color","#666"),d.style.setProperty("font-size","12px"),d.style.setProperty("font-family","Arial, sans-serif"),y.style.setProperty("margin-bottom","4px"),v(y,(()=>{var w=Q(()=>!E().src);return()=>w()?"📷":I()?"❌":"⏳"})()),v(k,(()=>{var w=Q(()=>!E().src);return()=>w()?"无图片":I()?"加载失败":"加载中..."})()),d})():null})(),null),M($=>{var d=S.width,y=S.height;return d!==$.e&&f(C,"width",$.e=d),y!==$.t&&f(C,"height",$.t=y),$},{e:void 0,t:void 0}),C})()}}),m(le,{get when(){return _.type==="DataField"&&_},children:E=>[(()=>{var b=dl();return M(A=>{var I=S.width,L=S.height;return I!==A.e&&f(b,"width",A.e=I),L!==A.t&&f(b,"height",A.t=L),A},{e:void 0,t:void 0}),b})(),(()=>{var b=ht();return v(b,()=>E().expression||"[数据字段]"),M(A=>{var I=E().style.align==="Center"?S.width/2:E().style.align==="Right"?S.width-4:4,L=E().style.font_size*.8,C=E().style.font_family,p=`${E().style.font_size}`,$=E().style.font_weight,d=E().style.color,y=E().style.align==="Center"?"middle":E().style.align==="Right"?"end":"start";return I!==A.e&&f(b,"x",A.e=I),L!==A.t&&f(b,"y",A.t=L),C!==A.a&&f(b,"font-family",A.a=C),p!==A.o&&f(b,"font-size",A.o=p),$!==A.i&&f(b,"font-weight",A.i=$),d!==A.n&&f(b,"fill",A.n=d),y!==A.s&&f(b,"text-anchor",A.s=y),A},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),b})()]})]}})};return(()=>{var _=ul();return _.$$mousedown=g,_.$$click=async S=>{S.stopPropagation(),console.log("🖱️ Element clicked!",e.element.id,{ctrl:S.ctrlKey,shift:S.shiftKey,selected:e.selected});try{S.ctrlKey?(console.log("🔄 Toggling selection:",e.element.id),await s(e.element.id)):S.shiftKey?(console.log("➕ Adding to selection:",e.element.id),await h(e.element.id)):e.selected||(await l(e.element.id),console.log("✅ Element selected successfully:",e.element.id))}catch(E){console.error("❌ Failed to select element:",E)}},v(_,x),M(S=>{var L,C;var E=`element ${e.selected?"element-selected":""} ${(C=(L=n())==null?void 0:L.element_ids)!=null&&C.includes(e.element.id)?"element-dragging":""}`,b=u(),A=e.element.id,I=e.element.content.type;return E!==S.e&&f(_,"class",S.e=E),S.t=en(_,b,S.t),A!==S.a&&f(_,"data-element-id",S.a=A),I!==S.o&&f(_,"data-element-type",S.o=I),S},{e:void 0,t:void 0,a:void 0,o:void 0}),_})()};fe(["click","mousedown"]);var fl=P("<svg><g class=resize-handles></svg>",!1,!0,!1),hl=P("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const mt=e=>{const{updateElement:t,resizeOperation:l,setResizeOperation:i}=ae(),[o,n]=V(!1),[r,s]=V(null),[h,u]=V({x:0,y:0}),[g,x]=V({width:0,height:0}),[_,S]=V({x:0,y:0}),E=q(()=>{const{size:p}=e.element,d=8/2;return[{position:"nw",cursor:"nw-resize",x:-d,y:-d},{position:"ne",cursor:"ne-resize",x:p.width-d,y:-d},{position:"sw",cursor:"sw-resize",x:-d,y:p.height-d},{position:"se",cursor:"se-resize",x:p.width-d,y:p.height-d},{position:"n",cursor:"n-resize",x:p.width/2-d,y:-d},{position:"s",cursor:"s-resize",x:p.width/2-d,y:p.height-d},{position:"w",cursor:"w-resize",x:-d,y:p.height/2-d},{position:"e",cursor:"e-resize",x:p.width-d,y:p.height/2-d}]}),b=(p,$,d,y=!1,k=!1)=>{const w=g(),D=_();let c=w.width,a=w.height,z=D.x,U=D.y;switch(p){case"nw":c=w.width-$,a=w.height-d,z=D.x+$,U=D.y+d;break;case"ne":c=w.width+$,a=w.height-d,U=D.y+d;break;case"sw":c=w.width-$,a=w.height+d,z=D.x+$;break;case"se":c=w.width+$,a=w.height+d;break;case"n":a=w.height-d,U=D.y+d;break;case"s":a=w.height+d;break;case"w":c=w.width-$,z=D.x+$;break;case"e":c=w.width+$;break}if(y&&(p==="nw"||p==="ne"||p==="sw"||p==="se")){const j=w.width/w.height;c/a>j?(c=a*j,(p==="nw"||p==="sw")&&(z=D.x+(w.width-c))):(a=c/j,(p==="nw"||p==="ne")&&(U=D.y+(w.height-a)))}if(k){const j=D.x+w.width/2,G=D.y+w.height/2;z=j-c/2,U=G-a/2}const R=20;return c=Math.max(R,c),a=Math.max(R,a),{size:{width:c,height:a},position:{x:z,y:U}}},A=p=>(console.log("🚫 DOCUMENT CLICK INTERCEPTED during resize operation!"),console.log("🚫 Preventing ALL click events from propagating"),p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation(),!1),I=(p,$)=>{var y;console.log("🔧 handleMouseDown called for handle:",p),console.log("🔧 SETTING RESIZE OPERATION TO TRUE - IMMEDIATE"),i(!0),console.log("🛡️ Adding document-level click interceptor - IMMEDIATE"),document.addEventListener("click",A,{capture:!0});const d=k=>(console.log("🚫 Blocking event during resize:",k.type),k.preventDefault(),k.stopPropagation(),k.stopImmediatePropagation(),!1);document.addEventListener("mouseup",d,{capture:!0,once:!0}),document.addEventListener("click",d,{capture:!0,once:!0}),console.log("🔧 ResizeHandle - All safety measures active"),console.log("🔧 Global resize operation now:",l()),n(!0),s(p),u({x:$.clientX,y:$.clientY}),x({width:e.element.size.width,height:e.element.size.height}),S({x:e.element.position.x,y:e.element.position.y}),console.log("🔧 Starting resize from handle:",p,"initial size:",e.element.size),document.addEventListener("mousemove",L),document.addEventListener("mouseup",C),document.body.style.cursor=((y=E().find(k=>k.position===p))==null?void 0:y.cursor)||"default"},L=p=>{if(!o())return;const $=r();if(!$)return;const d=h(),y=p.clientX-d.x,k=p.clientY-d.y,w=b($,y,k,p.shiftKey,p.altKey);e.onResize&&e.onResize(w.size,w.position)},C=async p=>{if(!o())return;const $=r();if(!$)return;const d=h(),y=p.clientX-d.x,k=p.clientY-d.y;if(console.log("🔧 Mouse up - deltaX:",y,"deltaY:",k),Math.abs(y)>2||Math.abs(k)>2){const w=b($,y,k,p.shiftKey,p.altKey);console.log("🔧 Finishing resize:",{handle:$,oldSize:g(),newSize:w.size,oldPosition:_(),newPosition:w.position});try{await t(e.element.id,{size:w.size,position:w.position}),console.log("✅ Resize update completed successfully")}catch(D){console.error("❌ Failed to update element size:",D)}}else console.log("🔧 No significant movement, skipping update");console.log("🛡️ Removing document-level click interceptor"),document.removeEventListener("click",A,{capture:!0}),console.log("🔧 CLEARING RESIZE OPERATION FLAG"),i(!1),n(!1),s(null),document.body.style.cursor="default",document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",C),console.log("🔧 Global resize operation now:",l())};return bt(()=>{i(!1),console.log("🛡️ Cleanup: Removing document-level click interceptor"),document.removeEventListener("click",A,{capture:!0}),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",C),document.body.style.cursor="default"}),(()=>{var p=fl();return v(p,()=>(console.log("🔧 ResizeHandles rendering for element:",e.element.id,"at position:",e.element.position,"with size:",e.element.size,"handles count:",E().length),null),null),v(p,()=>E().map($=>(()=>{var d=hl(),y=d.firstChild,k=y.nextSibling;return k.$$contextmenu=w=>(w.preventDefault(),w.stopPropagation(),!1),k.$$pointerdown=w=>{console.log("🔧 Resize handle pointerdown blocked"),w.preventDefault(),w.stopPropagation(),w.stopImmediatePropagation()},k.$$click=w=>(console.log("🚫 Resize handle onClick - COMPLETELY BLOCKED"),w.preventDefault(),w.stopPropagation(),w.stopImmediatePropagation(),!1),k.$$mousedown=w=>(console.log("🔧 Resize handle onMouseDown triggered for:",$.position),console.log("🔧 Event details:",{target:w.target,currentTarget:w.currentTarget,bubbles:w.bubbles,cancelable:w.cancelable,timeStamp:w.timeStamp}),w.preventDefault(),w.stopPropagation(),w.stopImmediatePropagation(),console.log("🔧 All event propagation stopped, starting resize operation"),I($.position,w),!1),k.style.setProperty("pointer-events","all"),k.style.setProperty("transition","fill 0.1s ease"),M(w=>{var D=$.x+4,c=$.y+4,a=$.x,z=$.y,U=$.cursor;return D!==w.e&&f(y,"cx",w.e=D),c!==w.t&&f(y,"cy",w.t=c),a!==w.a&&f(k,"x",w.a=a),z!==w.o&&f(k,"y",w.o=z),U!==w.i&&((w.i=U)!=null?k.style.setProperty("cursor",U):k.style.removeProperty("cursor")),w},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),d})()),null),M(()=>f(p,"transform",`translate(${e.element.position.x}, ${e.element.position.y})`)),p})()};fe(["mousedown","click","pointerdown","contextmenu"]);var vl=P("<svg><g class=selection-box data-testid=selection-box><rect fill=none stroke=var(--color-selection) stroke-width=2 stroke-dasharray=5,5 opacity=0.8 pointer-events=none></rect><rect fill=transparent></svg>",!1,!0,!1);const ml=e=>{const{updateElement:t,dragOperation:l}=ae(),[i,o]=V(!1),n=q(()=>{if(e.elements.length===0)return{x:0,y:0,width:0,height:0};let s=1/0,h=1/0,u=-1/0,g=-1/0;for(const x of e.elements){const{position:_,size:S}=x;s=Math.min(s,_.x),h=Math.min(h,_.y),u=Math.max(u,_.x+S.width),g=Math.max(g,_.y+S.height)}return{x:s,y:h,width:u-s,height:g-h}}),r=s=>{if(l()){console.log("🚫 SelectionBox drag blocked - already in drag operation");return}s.stopPropagation(),console.log("🎯 SelectionBox drag start"),o(!0);const h=s.clientX,u=s.clientY,g=e.elements.map(S=>({id:S.id,x:S.position.x,y:S.position.y})),x=S=>{const E=S.clientX-h,b=S.clientY-u;g.forEach(async A=>{try{await t(A.id,{position:{x:A.x+E,y:A.y+b}})}catch(I){console.error("Failed to update element position:",I)}})},_=()=>{o(!1),document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",x),document.addEventListener("mouseup",_)};return(()=>{var s=vl(),h=s.firstChild,u=h.nextSibling;return v(s,()=>(console.log("🔧 SelectionBox rendering with elements:",e.elements.length,"elements:",e.elements.map(g=>g.id)),null),h),u.$$mousedown=r,v(s,()=>{var g;return console.log("🔧 SelectionBox ResizeHandles check:",{elementsCount:e.elements.length,singleElement:e.elements.length===1,multipleElements:e.elements.length>1,firstElement:e.elements[0]}),e.elements.length===1?(console.log("🔧 Rendering ResizeHandles for single element:",(g=e.elements[0])==null?void 0:g.id),e.elements[0]?m(mt,{get element(){return e.elements[0]}}):null):e.elements.length>1?(console.log("🔧 Rendering ResizeHandles for multiple elements"),m(mt,{get element(){return{id:"multi-selection",position:{x:n().x,y:n().y},size:{width:n().width,height:n().height},content:{type:"Rectangle",fill_color:"#ffffff",border:{color:"#000000",width:1,style:"Solid"},opacity:.1},z_index:0,visible:!0,locked:!1}}})):(console.log("🔧 No elements to render ResizeHandles for"),null)},null),M(g=>{var x=n().x,_=n().y,S=n().width,E=n().height,b=n().x+8,A=n().y+8,I=Math.max(0,n().width-16),L=Math.max(0,n().height-16),C=i()?"grabbing":"grab";return x!==g.e&&f(h,"x",g.e=x),_!==g.t&&f(h,"y",g.t=_),S!==g.a&&f(h,"width",g.a=S),E!==g.o&&f(h,"height",g.o=E),b!==g.i&&f(u,"x",g.i=b),A!==g.n&&f(u,"y",g.n=A),I!==g.s&&f(u,"width",g.s=I),L!==g.h&&f(u,"height",g.h=L),C!==g.r&&((g.r=C)!=null?u.style.setProperty("cursor",C):u.style.removeProperty("cursor")),g},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),s})()};fe(["mousedown"]);var yl=P('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class="block cursor-default"><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer>'),wl=P("<span class=ml-2>Zoom: <!>%"),bl=P('<svg><rect fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.6)"stroke-width=1 stroke-dasharray=5,5 class="selection-rectangle pointer-events-none"></svg>',!1,!0,!1),pl=P('<svg><rect fill=none stroke="rgba(59, 130, 246, 0.8)"stroke-width=1 stroke-dasharray=3,3 class="selection-preview pointer-events-none"></svg>',!1,!0,!1);const xl=()=>{const{state:e,getElementsAtPoint:t,selectElement:l,clearSelection:i,createElement:o,dragOperation:n,selectMultiple:r,resizeOperation:s}=ae();let h;const[u,g]=V({width:800,height:600}),[x,_]=V(!1),[S,E]=V(null);console.log("Canvas size:",u());const b=q(()=>e.elements.filter(c=>c.visible)),A=q(()=>{const c=new Set(e.selected_ids),a=e.elements.filter(z=>c.has(z.id));return console.log("📊 Selected elements updated:",a.length,"selected_ids:",e.selected_ids),a}),I=(c,a)=>{if(!h)return{x:0,y:0};const z=h.getBoundingClientRect(),U=(c-z.left)/e.canvas_config.zoom,R=(a-z.top)/e.canvas_config.zoom;return{x:U,y:R}},L=async c=>{var R,j,G;if(console.log("🎯 Canvas handleCanvasClick triggered"),console.log("🎯 Resize operation active:",s()),console.log("🎯 Drag operation active:",n()),console.log("🎯 Event target details:",{tagName:c.target.tagName,className:c.target.className,classList:Array.from(c.target.classList||[]),id:c.target.id}),s()){console.log("🔧 Canvas click blocked - resize operation in progress"),c.preventDefault(),c.stopPropagation();return}if(!h)return;const a=c.target;if(a.classList.contains("resize-handle")||a.closest(".resize-handles")||(R=a.getAttribute("class"))!=null&&R.includes("resize-handle")||a.tagName.toLowerCase()==="rect"&&((j=a.getAttribute("class"))!=null&&j.includes("resize-handle"))||a.tagName.toLowerCase()==="circle"&&((G=a.parentElement)!=null&&G.querySelector(".resize-handle"))){console.log("🔧 Canvas click ignored - clicked on resize handle or related element"),c.preventDefault(),c.stopPropagation();return}const{x:z,y:U}=I(c.clientX,c.clientY);console.log("🎯 Canvas coordinates:",{x:z,y:U});try{const B=await t(z,U);console.log("🎯 Elements at point:",B),B.length>0?(console.log("🎯 Selecting element:",B[B.length-1]),await l(B[B.length-1]||"")):(console.log("🎯 No elements at point, clearing selection"),await i())}catch(B){console.error("Failed to handle canvas click:",B)}},C=(c,a)=>{const z={x:c.position.x,y:c.position.y,width:c.size.width,height:c.size.height};return!(z.x>a.x+a.width||z.x+z.width<a.x||z.y>a.y+a.height||z.y+z.height<a.y)},p=()=>{const c=S();if(!c)return[];const a={x:Math.min(c.startX,c.currentX),y:Math.min(c.startY,c.currentY),width:Math.abs(c.currentX-c.startX),height:Math.abs(c.currentY-c.startY)};return e.elements.filter(z=>z.visible&&C(z,a))},$=c=>{var j,G,B,O,X,ce,de,we,he,Y,oe;if(!h)return;const a=c.target;if(console.log("🖱️ Canvas mousedown detailed check:",{target:a.tagName,className:a.className,classList:Array.from(a.classList||[]),id:a.id,dataset:a.dataset,isResizeHandle:(j=a.classList)==null?void 0:j.contains("resize-handle"),isResizeHandles:a.closest(".resize-handles")!==null,parentElement:(G=a.parentElement)==null?void 0:G.tagName}),(B=a.classList)!=null&&B.contains("resize-handle")||a.closest(".resize-handles")||(O=a.getAttribute("class"))!=null&&O.includes("resize-handle")||a.tagName.toLowerCase()==="rect"&&((X=a.getAttribute("class"))!=null&&X.includes("resize-handle"))||a.tagName.toLowerCase()==="circle"&&((ce=a.parentElement)!=null&&ce.querySelector(".resize-handle"))||(we=(de=a.parentElement)==null?void 0:de.classList)!=null&&we.contains("resize-handles")||(oe=(Y=(he=a.parentElement)==null?void 0:he.parentElement)==null?void 0:Y.classList)!=null&&oe.contains("resize-handles")){console.log("🔧 Canvas mousedown BLOCKED - resize handle detected"),c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation();return}const z=a.tagName==="rect"&&a.getAttribute("width")===e.canvas_config.width.toString()&&a.getAttribute("height")===e.canvas_config.height.toString()&&a.getAttribute("fill")===e.canvas_config.background_color;if(console.log("🖱️ Canvas mousedown background check:",{target:a.tagName,isCanvasBackground:z,width:a.getAttribute("width"),expectedWidth:e.canvas_config.width.toString(),height:a.getAttribute("height"),expectedHeight:e.canvas_config.height.toString(),fill:a.getAttribute("fill"),expectedFill:e.canvas_config.background_color,dragOperation:!!n(),resizeOperation:!!s(),modifiers:{ctrl:c.ctrlKey,shift:c.shiftKey}}),!z||n()||s()||c.ctrlKey||c.shiftKey){console.log("🚫 Skipping selection start - not canvas background or operations in progress");return}c.preventDefault();const{x:U,y:R}=I(c.clientX,c.clientY);_(!0),E({startX:U,startY:R,currentX:U,currentY:R}),console.log("🔲 Starting selection rectangle at:",U,R)},d=c=>{c.preventDefault(),c.dataTransfer.dropEffect="copy"},y=async c=>{var a;c.preventDefault();try{const z=(a=c.dataTransfer)==null?void 0:a.getData("application/json");if(!z)return;const{type:U,component:R}=JSON.parse(z);if(U==="component"){const{x:j,y:G}=I(c.clientX,c.clientY),B=Math.max(0,j-R.default_size.width/2),O=Math.max(0,G-R.default_size.height/2);console.log("🎯 Dropping component:",R.name,"at",B,O);const X=await o(R.id,{x:B,y:O},R.default_size,R.create_content());console.log("✅ Element created via drag & drop:",X),await l(X)}}catch(z){console.error("Failed to handle drop:",z)}},k=c=>{!x()||n()||requestAnimationFrame(()=>{if(!x())return;const{x:a,y:z}=I(c.clientX,c.clientY);E(U=>U?{...U,currentX:a,currentY:z}:null)})},w=async()=>{if(n()){_(!1),E(null);return}if(!x())return;_(!1);const c=p();console.log("🔲 Selection finished, found elements:",c.length);try{if(c.length>0){const a=c.map(z=>z.id);await r(a),console.log("✅ Multi-select completed:",a)}else await i(),console.log("🔲 No elements in selection, cleared selection")}catch(a){console.error("❌ Failed to update selection:",a)}E(null)};nt(()=>{const c=()=>{if(h!=null&&h.parentElement){const a=h.parentElement.getBoundingClientRect();g({width:a.width,height:a.height})}};return c(),window.addEventListener("resize",c),document.addEventListener("mousemove",k),document.addEventListener("mouseup",w),()=>{window.removeEventListener("resize",c),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",w)}});const D=q(()=>{const{width:c,height:a}=e.canvas_config;return`0 0 ${c} ${a}`});return(()=>{var c=yl(),a=c.firstChild,z=a.firstChild,U=z.firstChild,R=U.nextSibling,j=R.nextSibling,G=j.nextSibling,B=G.nextSibling,O=B.nextSibling,X=O.firstChild,ce=X.nextSibling;ce.nextSibling;var de=a.nextSibling,we=de.firstChild,he=we.firstChild,Y=he.firstChild,oe=Y.firstChild,ve=oe.nextSibling,Ve=ve.nextSibling;v(z,()=>e.canvas_config.width,R),v(z,()=>e.canvas_config.height,G),v(z,(()=>{var F=Q(()=>e.canvas_config.zoom!==1);return()=>F()&&(()=>{var W=wl(),be=W.firstChild,me=be.nextSibling;return me.nextSibling,v(W,()=>Math.round(e.canvas_config.zoom*100),me),W})()})(),O),v(O,()=>e.elements.length,ce),v(O,()=>e.selected_ids.length,null),Y.$$mousedown=$,Y.addEventListener("drop",y),Y.addEventListener("dragover",d),Y.$$contextmenu=F=>F.preventDefault(),Y.$$click=L;var ke=h;return typeof ke=="function"?tn(ke,Y):h=Y,v(Y,m(el,{get config(){return e.canvas_config}}),ve),v(Ve,m(_e,{get each(){return b()},children:F=>m(gl,{element:F,get selected(){return e.selected_ids.includes(F.id)}})})),v(Y,(()=>{var F=Q(()=>A().length>0);return()=>F()&&m(ml,{get elements(){return A()}})})(),null),v(Y,(()=>{var F=Q(()=>!!(x()&&S()));return()=>F()&&(()=>{const W=S(),be=Math.min(W.startX,W.currentX),me=Math.min(W.startY,W.currentY),Ie=Math.abs(W.currentX-W.startX),Ue=Math.abs(W.currentY-W.startY);return[(()=>{var J=bl();return f(J,"x",be),f(J,"y",me),f(J,"width",Ie),f(J,"height",Ue),J})(),Q(()=>p().map(J=>(()=>{var ue=pl();return M(ee=>{var ot=J.position.x-1,it=J.position.y-1,rt=J.size.width+2,st=J.size.height+2;return ot!==ee.e&&f(ue,"x",ee.e=ot),it!==ee.t&&f(ue,"y",ee.t=it),rt!==ee.a&&f(ue,"width",ee.a=rt),st!==ee.o&&f(ue,"height",ee.o=st),ee},{e:void 0,t:void 0,a:void 0,o:void 0}),ue})()))]})()})(),null),M(F=>{var W=e.canvas_config.width*e.canvas_config.zoom,be=e.canvas_config.height*e.canvas_config.zoom,me=D(),Ie=e.canvas_config.width,Ue=e.canvas_config.height,J=e.canvas_config.background_color,ue=e.canvas_config.width,ee=e.canvas_config.height;return W!==F.e&&f(Y,"width",F.e=W),be!==F.t&&f(Y,"height",F.t=be),me!==F.a&&f(Y,"viewBox",F.a=me),Ie!==F.o&&f(oe,"width",F.o=Ie),Ue!==F.i&&f(oe,"height",F.i=Ue),J!==F.n&&f(oe,"fill",F.n=J),ue!==F.s&&f(ve,"width",F.s=ue),ee!==F.h&&f(ve,"height",F.h=ee),F},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),c})()};fe(["click","contextmenu","mousedown"]);var _l=P('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),$l=P('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Sl=P('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),kl=P('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Cl=P('<div class="text-xs text-gray-500 p-2">暂无元素');const zl=()=>{const{state:e,createElement:t,selectElement:l,clearSelection:i}=ae(),[o,n]=V(!1),r=[{name:"创建文字元素",action:async()=>{const g=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",g),g}},{name:"创建矩形元素",action:async()=>{const g=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",g),g}},{name:"创建线条元素",action:async()=>{const g=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",g),g}},{name:"创建数据字段",action:async()=>{const g=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",g),g}}],s=async g=>{try{console.log(`🧪 开始测试: ${g.name}`);const x=await g.action();await l(x),console.log(`✅ 测试完成: ${g.name}, 元素ID: ${x}`)}catch(x){console.error(`❌ 测试失败: ${g.name}`,x)}},h=async()=>{console.log("🚀 开始运行所有测试案例..."),await i();for(const g of r)await s(g),await new Promise(x=>setTimeout(x,500));console.log("🎉 所有测试案例运行完成!")},u=async()=>{try{console.log("🧹 清理所有测试元素..."),await i(),console.log("✅ 清理完成")}catch(g){console.error("❌ 清理失败:",g)}};return[(()=>{var g=_l();return g.$$click=()=>n(!o()),g})(),Q(()=>Q(()=>!!o())()&&(()=>{var g=$l(),x=g.firstChild,_=x.firstChild,S=_.nextSibling,E=x.nextSibling,b=E.firstChild,A=b.firstChild,I=A.firstChild,L=I.nextSibling,C=A.nextSibling,p=C.firstChild,$=p.nextSibling,d=C.nextSibling,y=d.firstChild,k=y.nextSibling,w=d.nextSibling,D=w.firstChild,c=D.nextSibling,a=E.nextSibling,z=a.firstChild,U=z.nextSibling,R=a.nextSibling;R.firstChild;var j=R.nextSibling,G=j.firstChild,B=G.nextSibling;return S.$$click=()=>n(!1),v(L,()=>e.elements.length),v($,()=>e.selected_ids.length),v(k,()=>e.can_undo?"是":"否"),v(c,()=>e.can_redo?"是":"否"),z.$$click=h,U.$$click=u,v(R,m(_e,{each:r,children:O=>(()=>{var X=Sl();return X.$$click=()=>s(O),v(X,()=>O.name),X})()}),null),v(B,m(_e,{get each(){return e.elements},children:O=>(()=>{var X=kl(),ce=X.firstChild,de=ce.nextSibling,we=de.firstChild,he=we.nextSibling;he.nextSibling;var Y=de.nextSibling,oe=Y.firstChild,ve=oe.nextSibling,Ve=ve.nextSibling,ke=Ve.nextSibling;return ke.nextSibling,X.$$click=()=>l(O.id),v(ce,()=>O.content.type),v(de,()=>O.id.slice(0,8),he),v(Y,()=>Math.round(O.position.x),ve),v(Y,()=>Math.round(O.position.y),ke),M(()=>xe(X,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(O.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),X})()}),null),v(B,(()=>{var O=Q(()=>e.elements.length===0);return()=>O()&&Cl()})(),null),g})())]};fe(["click"]);var El=P('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const Al=()=>(()=>{var e=El(),t=e.firstChild,l=t.firstChild,i=l.nextSibling,o=i.nextSibling;return v(e,m(vn,{}),t),v(l,m(wn,{})),v(i,m(xl,{})),v(o,m(Xn,{})),v(e,m(zl,{}),null),e})(),Pl=()=>(nt(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),m(dn,{get children(){return m(Al,{})}})),Ll=document.getElementById("root");Qt(()=>m(Pl,{}),Ll);
