(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Xt=!1,Yt=(e,t)=>e===t,Ae=Symbol("solid-proxy"),st=Symbol("solid-track"),We={equals:Yt};let wt=Ct;const ke=1,Xe=2,_t={owned:null,cleanups:null,context:null,owner:null};var J=null;let ot=null,Zt=null,ne=null,oe=null,be=null,lt=0;function qe(e,t){const o=ne,n=J,l=e.length===0,i=t===void 0?n:t,r=l?_t:{owned:null,cleanups:null,context:i?i.context:null,owner:i},s=l?e:()=>e(()=>de(()=>Ne(r)));J=r,ne=null;try{return De(s,!0)}finally{ne=o,J=n}}function Q(e,t){t=t?Object.assign({},We,t):We;const o={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=l=>(typeof l=="function"&&(l=l(o.value)),St(o,l));return[kt.bind(o),n]}function M(e,t,o){const n=ft(e,t,!1,ke);Ge(n)}function Jt(e,t,o){wt=on;const n=ft(e,t,!1,ke);n.user=!0,be?be.push(n):Ge(n)}function ie(e,t,o){o=o?Object.assign({},We,o):We;const n=ft(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=o.equals||void 0,Ge(n),kt.bind(n)}function Qt(e){return De(e,!1)}function de(e){if(ne===null)return e();const t=ne;ne=null;try{return e()}finally{ne=t}}function He(e){Jt(()=>de(e))}function it(e){return J===null||(J.cleanups===null?J.cleanups=[e]:J.cleanups.push(e)),e}function at(){return ne}function en(e,t){const o=Symbol("context");return{id:o,Provider:sn(o),defaultValue:e}}function tn(e){let t;return J&&J.context&&(t=J.context[e.id])!==void 0?t:e.defaultValue}function $t(e){const t=ie(e),o=ie(()=>ct(t()));return o.toArray=()=>{const n=o();return Array.isArray(n)?n:n!=null?[n]:[]},o}function kt(){if(this.sources&&this.state)if(this.state===ke)Ge(this);else{const e=oe;oe=null,De(()=>Ze(this),!1),oe=e}if(ne){const e=this.observers?this.observers.length:0;ne.sources?(ne.sources.push(this),ne.sourceSlots.push(e)):(ne.sources=[this],ne.sourceSlots=[e]),this.observers?(this.observers.push(ne),this.observerSlots.push(ne.sources.length-1)):(this.observers=[ne],this.observerSlots=[ne.sources.length-1])}return this.value}function St(e,t,o){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&De(()=>{for(let l=0;l<e.observers.length;l+=1){const i=e.observers[l],r=ot&&ot.running;r&&ot.disposed.has(i),(r?!i.tState:!i.state)&&(i.pure?oe.push(i):be.push(i),i.observers&&Et(i)),r||(i.state=ke)}if(oe.length>1e6)throw oe=[],new Error},!1)),t}function Ge(e){if(!e.fn)return;Ne(e);const t=lt;nn(e,e.value,t)}function nn(e,t,o){let n;const l=J,i=ne;ne=J=e;try{n=e.fn(t)}catch(r){return e.pure&&(e.state=ke,e.owned&&e.owned.forEach(Ne),e.owned=null),e.updatedAt=o+1,zt(r)}finally{ne=i,J=l}(!e.updatedAt||e.updatedAt<=o)&&(e.updatedAt!=null&&"observers"in e?St(e,n):e.value=n,e.updatedAt=o)}function ft(e,t,o,n=ke,l){const i={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:J,context:J?J.context:null,pure:o};return J===null||J!==_t&&(J.owned?J.owned.push(i):J.owned=[i]),i}function Ye(e){if(e.state===0)return;if(e.state===Xe)return Ze(e);if(e.suspense&&de(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<lt);)e.state&&t.push(e);for(let o=t.length-1;o>=0;o--)if(e=t[o],e.state===ke)Ge(e);else if(e.state===Xe){const n=oe;oe=null,De(()=>Ze(e,t[0]),!1),oe=n}}function De(e,t){if(oe)return e();let o=!1;t||(oe=[]),be?o=!0:be=[],lt++;try{const n=e();return ln(o),n}catch(n){o||(be=null),oe=null,zt(n)}}function ln(e){if(oe&&(Ct(oe),oe=null),e)return;const t=be;be=null,t.length&&De(()=>wt(t),!1)}function Ct(e){for(let t=0;t<e.length;t++)Ye(e[t])}function on(e){let t,o=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[o++]=n:Ye(n)}for(t=0;t<o;t++)Ye(e[t])}function Ze(e,t){e.state=0;for(let o=0;o<e.sources.length;o+=1){const n=e.sources[o];if(n.sources){const l=n.state;l===ke?n!==t&&(!n.updatedAt||n.updatedAt<lt)&&Ye(n):l===Xe&&Ze(n,t)}}}function Et(e){for(let t=0;t<e.observers.length;t+=1){const o=e.observers[t];o.state||(o.state=Xe,o.pure?oe.push(o):be.push(o),o.observers&&Et(o))}}function Ne(e){let t;if(e.sources)for(;e.sources.length;){const o=e.sources.pop(),n=e.sourceSlots.pop(),l=o.observers;if(l&&l.length){const i=l.pop(),r=o.observerSlots.pop();n<l.length&&(i.sourceSlots[r]=n,l[n]=i,o.observerSlots[n]=r)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ne(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ne(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function rn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function zt(e,t=J){throw rn(e)}function ct(e){if(typeof e=="function"&&!e.length)return ct(e());if(Array.isArray(e)){const t=[];for(let o=0;o<e.length;o++){const n=ct(e[o]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function sn(e,t){return function(n){let l;return M(()=>l=de(()=>(J.context={...J.context,[e]:n.value},$t(()=>n.children))),void 0),l}}const an=Symbol("fallback");function vt(e){for(let t=0;t<e.length;t++)e[t]()}function cn(e,t,o={}){let n=[],l=[],i=[],r=0,s=t.length>1?[]:null;return it(()=>vt(i)),()=>{let h=e()||[],a=h.length,f,g;return h[st],de(()=>{let j,E,z,A,I,k,p,L,D;if(a===0)r!==0&&(vt(i),i=[],n=[],l=[],r=0,s&&(s=[])),o.fallback&&(n=[an],l[0]=qe(P=>(i[0]=P,o.fallback())),r=1);else if(r===0){for(l=new Array(a),g=0;g<a;g++)n[g]=h[g],l[g]=qe($);r=a}else{for(z=new Array(a),A=new Array(a),s&&(I=new Array(a)),k=0,p=Math.min(r,a);k<p&&n[k]===h[k];k++);for(p=r-1,L=a-1;p>=k&&L>=k&&n[p]===h[L];p--,L--)z[L]=l[p],A[L]=i[p],s&&(I[L]=s[p]);for(j=new Map,E=new Array(L+1),g=L;g>=k;g--)D=h[g],f=j.get(D),E[g]=f===void 0?-1:f,j.set(D,g);for(f=k;f<=p;f++)D=n[f],g=j.get(D),g!==void 0&&g!==-1?(z[g]=l[f],A[g]=i[f],s&&(I[g]=s[f]),g=E[g],j.set(D,g)):i[f]();for(g=k;g<a;g++)g in z?(l[g]=z[g],i[g]=A[g],s&&(s[g]=I[g],s[g](g))):l[g]=qe($);l=l.slice(0,r=a),n=h.slice(0)}return l});function $(j){if(i[g]=j,s){const[E,z]=Q(g);return s[g]=z,t(h[g],E)}return t(h[g])}}}function y(e,t){return de(()=>e(t||{}))}const Pt=e=>`Stale read from <${e}>.`;function ze(e){const t="fallback"in e&&{fallback:()=>e.fallback};return ie(cn(()=>e.each,e.children,t||void 0))}function xe(e){const t=e.keyed,o=ie(()=>e.when,void 0,void 0),n=t?o:ie(o,void 0,{equals:(l,i)=>!l==!i});return ie(()=>{const l=n();if(l){const i=e.children;return typeof i=="function"&&i.length>0?de(()=>i(t?l:()=>{if(!de(n))throw Pt("Show");return o()})):i}return e.fallback},void 0,void 0)}function dn(e){const t=$t(()=>e.children),o=ie(()=>{const n=t(),l=Array.isArray(n)?n:[n];let i=()=>{};for(let r=0;r<l.length;r++){const s=r,h=l[r],a=i,f=ie(()=>a()?void 0:h.when,void 0,void 0),g=h.keyed?f:ie(f,void 0,{equals:($,j)=>!$==!j});i=()=>a()||(g()?[s,f,h]:void 0)}return i});return ie(()=>{const n=o()();if(!n)return e.fallback;const[l,i,r]=n,s=r.children;return typeof s=="function"&&s.length>0?de(()=>s(r.keyed?i():()=>{var a;if(((a=de(o)())==null?void 0:a[0])!==l)throw Pt("Match");return i()})):s},void 0,void 0)}function Re(e){return e}const ae=e=>ie(()=>e());function un(e,t,o){let n=o.length,l=t.length,i=n,r=0,s=0,h=t[l-1].nextSibling,a=null;for(;r<l||s<i;){if(t[r]===o[s]){r++,s++;continue}for(;t[l-1]===o[i-1];)l--,i--;if(l===r){const f=i<n?s?o[s-1].nextSibling:o[i-s]:h;for(;s<i;)e.insertBefore(o[s++],f)}else if(i===s)for(;r<l;)(!a||!a.has(t[r]))&&t[r].remove(),r++;else if(t[r]===o[i-1]&&o[s]===t[l-1]){const f=t[--l].nextSibling;e.insertBefore(o[s++],t[r++].nextSibling),e.insertBefore(o[--i],f),t[l]=o[i]}else{if(!a){a=new Map;let g=s;for(;g<i;)a.set(o[g],g++)}const f=a.get(t[r]);if(f!=null)if(s<f&&f<i){let g=r,$=1,j;for(;++g<l&&g<i&&!((j=a.get(t[g]))==null||j!==f+$);)$++;if($>f-s){const E=t[r];for(;s<f;)e.insertBefore(o[s++],E)}else e.replaceChild(o[s++],t[r++])}else r++;else t[r++].remove()}}}const yt="_$DX_DELEGATE";function hn(e,t,o,n={}){let l;return qe(i=>{l=i,t===document?e():d(t,e(),t.firstChild?null:void 0,o)},n.owner),()=>{l(),t.textContent=""}}function C(e,t,o,n){let l;const i=()=>{const s=n?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return s.innerHTML=e,o?s.content.firstChild.firstChild:n?s.firstChild:s.content.firstChild},r=t?()=>de(()=>document.importNode(l||(l=i()),!0)):()=>(l||(l=i())).cloneNode(!0);return r.cloneNode=r,r}function Se(e,t=window.document){const o=t[yt]||(t[yt]=new Set);for(let n=0,l=e.length;n<l;n++){const i=e[n];o.has(i)||(o.add(i),t.addEventListener(i,gn))}}function w(e,t,o){o==null?e.removeAttribute(t):e.setAttribute(t,o)}function Ue(e,t){t==null?e.removeAttribute("class"):e.className=t}function dt(e,t,o,n){Array.isArray(o)?(e[`$$${t}`]=o[0],e[`$$${t}Data`]=o[1]):e[`$$${t}`]=o}function fn(e,t,o){if(!t)return o?w(e,"style"):t;const n=e.style;if(typeof t=="string")return n.cssText=t;typeof o=="string"&&(n.cssText=o=void 0),o||(o={}),t||(t={});let l,i;for(i in o)t[i]==null&&n.removeProperty(i),delete o[i];for(i in t)l=t[i],l!==o[i]&&(n.setProperty(i,l),o[i]=l);return o}function At(e,t,o){return de(()=>e(t,o))}function d(e,t,o,n){if(o!==void 0&&!n&&(n=[]),typeof t!="function")return Je(e,t,n,o);M(l=>Je(e,t(),l,o),n)}function gn(e){let t=e.target;const o=`$$${e.type}`,n=e.target,l=e.currentTarget,i=h=>Object.defineProperty(e,"target",{configurable:!0,value:h}),r=()=>{const h=t[o];if(h&&!t.disabled){const a=t[`${o}Data`];if(a!==void 0?h.call(t,a,e):h.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&i(t.host),!0},s=()=>{for(;r()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const h=e.composedPath();i(h[0]);for(let a=0;a<h.length-2&&(t=h[a],!!r());a++){if(t._$host){t=t._$host,s();break}if(t.parentNode===l)break}}else s();i(n)}function Je(e,t,o,n,l){for(;typeof o=="function";)o=o();if(t===o)return o;const i=typeof t,r=n!==void 0;if(e=r&&o[0]&&o[0].parentNode||e,i==="string"||i==="number"){if(i==="number"&&(t=t.toString(),t===o))return o;if(r){let s=o[0];s&&s.nodeType===3?s.data!==t&&(s.data=t):s=document.createTextNode(t),o=Ie(e,o,n,s)}else o!==""&&typeof o=="string"?o=e.firstChild.data=t:o=e.textContent=t}else if(t==null||i==="boolean")o=Ie(e,o,n);else{if(i==="function")return M(()=>{let s=t();for(;typeof s=="function";)s=s();o=Je(e,s,o,n)}),()=>o;if(Array.isArray(t)){const s=[],h=o&&Array.isArray(o);if(ut(s,t,o,l))return M(()=>o=Je(e,s,o,n,!0)),()=>o;if(s.length===0){if(o=Ie(e,o,n),r)return o}else h?o.length===0?mt(e,s,n):un(e,o,s):(o&&Ie(e),mt(e,s));o=s}else if(t.nodeType){if(Array.isArray(o)){if(r)return o=Ie(e,o,n,t);Ie(e,o,null,t)}else o==null||o===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);o=t}}return o}function ut(e,t,o,n){let l=!1;for(let i=0,r=t.length;i<r;i++){let s=t[i],h=o&&o[e.length],a;if(!(s==null||s===!0||s===!1))if((a=typeof s)=="object"&&s.nodeType)e.push(s);else if(Array.isArray(s))l=ut(e,s,h)||l;else if(a==="function")if(n){for(;typeof s=="function";)s=s();l=ut(e,Array.isArray(s)?s:[s],Array.isArray(h)?h:[h])||l}else e.push(s),l=!0;else{const f=String(s);h&&h.nodeType===3&&h.data===f?e.push(h):e.push(document.createTextNode(f))}}return l}function mt(e,t,o=null){for(let n=0,l=t.length;n<l;n++)e.insertBefore(t[n],o)}function Ie(e,t,o,n){if(o===void 0)return e.textContent="";const l=n||document.createTextNode("");if(t.length){let i=!1;for(let r=t.length-1;r>=0;r--){const s=t[r];if(l!==s){const h=s.parentNode===e;!i&&!r?h?e.replaceChild(l,s):e.insertBefore(l,o):h&&s.remove()}else i=!0}}else e.insertBefore(l,o);return[l]}const ht=Symbol("store-raw"),Le=Symbol("store-node"),ye=Symbol("store-has"),It=Symbol("store-self");function Ut(e){let t=e[Ae];if(!t&&(Object.defineProperty(e,Ae,{value:t=new Proxy(e,mn)}),!Array.isArray(e))){const o=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let l=0,i=o.length;l<i;l++){const r=o[l];n[r].get&&Object.defineProperty(e,r,{enumerable:n[r].enumerable,get:n[r].get.bind(t)})}}return t}function Qe(e){let t;return e!=null&&typeof e=="object"&&(e[Ae]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function je(e,t=new Set){let o,n,l,i;if(o=e!=null&&e[ht])return o;if(!Qe(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let r=0,s=e.length;r<s;r++)l=e[r],(n=je(l,t))!==l&&(e[r]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const r=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let h=0,a=r.length;h<a;h++)i=r[h],!s[i].get&&(l=e[i],(n=je(l,t))!==l&&(e[i]=n))}return e}function et(e,t){let o=e[t];return o||Object.defineProperty(e,t,{value:o=Object.create(null)}),o}function Be(e,t,o){if(e[t])return e[t];const[n,l]=Q(o,{equals:!1,internal:!0});return n.$=l,e[t]=n}function vn(e,t){const o=Reflect.getOwnPropertyDescriptor(e,t);return!o||o.get||!o.configurable||t===Ae||t===Le||(delete o.value,delete o.writable,o.get=()=>e[Ae][t]),o}function Lt(e){at()&&Be(et(e,Le),It)()}function yn(e){return Lt(e),Reflect.ownKeys(e)}const mn={get(e,t,o){if(t===ht)return e;if(t===Ae)return o;if(t===st)return Lt(e),o;const n=et(e,Le),l=n[t];let i=l?l():e[t];if(t===Le||t===ye||t==="__proto__")return i;if(!l){const r=Object.getOwnPropertyDescriptor(e,t);at()&&(typeof i!="function"||e.hasOwnProperty(t))&&!(r&&r.get)&&(i=Be(n,t,i)())}return Qe(i)?Ut(i):i},has(e,t){return t===ht||t===Ae||t===st||t===Le||t===ye||t==="__proto__"?!0:(at()&&Be(et(e,ye),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:yn,getOwnPropertyDescriptor:vn};function tt(e,t,o,n=!1){if(!n&&e[t]===o)return;const l=e[t],i=e.length;o===void 0?(delete e[t],e[ye]&&e[ye][t]&&l!==void 0&&e[ye][t].$()):(e[t]=o,e[ye]&&e[ye][t]&&l===void 0&&e[ye][t].$());let r=et(e,Le),s;if((s=Be(r,t,l))&&s.$(()=>o),Array.isArray(e)&&e.length!==i){for(let h=e.length;h<i;h++)(s=r[h])&&s.$();(s=Be(r,"length",i))&&s.$(e.length)}(s=r[It])&&s.$()}function Dt(e,t){const o=Object.keys(t);for(let n=0;n<o.length;n+=1){const l=o[n];tt(e,l,t[l])}}function bn(e,t){if(typeof t=="function"&&(t=t(e)),t=je(t),Array.isArray(t)){if(e===t)return;let o=0,n=t.length;for(;o<n;o++){const l=t[o];e[o]!==l&&tt(e,o,l)}tt(e,"length",n)}else Dt(e,t)}function Oe(e,t,o=[]){let n,l=e;if(t.length>1){n=t.shift();const r=typeof n,s=Array.isArray(e);if(Array.isArray(n)){for(let h=0;h<n.length;h++)Oe(e,[n[h]].concat(t),o);return}else if(s&&r==="function"){for(let h=0;h<e.length;h++)n(e[h],h)&&Oe(e,[h].concat(t),o);return}else if(s&&r==="object"){const{from:h=0,to:a=e.length-1,by:f=1}=n;for(let g=h;g<=a;g+=f)Oe(e,[g].concat(t),o);return}else if(t.length>1){Oe(e[n],t,[n].concat(o));return}l=e[n],o=[n].concat(o)}let i=t[0];typeof i=="function"&&(i=i(l,o),i===l)||n===void 0&&i==null||(i=je(i),n===void 0||Qe(l)&&Qe(i)&&!Array.isArray(i)?Dt(l,i):tt(e,n,i))}function xn(...[e,t]){const o=je(e||{}),n=Array.isArray(o),l=Ut(o);function i(...r){Qt(()=>{n&&r.length===1?bn(o,r[0]):Oe(o,r)})}return[l,i]}function pn(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function bt(e,t=!1){const o=pn(),n=`_${o}`;return Object.defineProperty(window,n,{value:l=>(t&&Reflect.deleteProperty(window,n),e==null?void 0:e(l)),writable:!1,configurable:!0}),o}async function le(e,t={}){return new Promise((o,n)=>{const l=bt(r=>{o(r),Reflect.deleteProperty(window,`_${i}`)},!0),i=bt(r=>{n(r),Reflect.deleteProperty(window,`_${l}`)},!0);window.__TAURI_IPC__({cmd:e,callback:l,error:i,...t})})}const Mt=en(),wn=e=>{const[t,o]=xn({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[n,l]=Q(!1),[i,r]=Q(null),[s,h]=Q(!1),a=async()=>{try{l(!0),console.log("🔄 Loading app state...");const v=await le("get_app_state");console.log("🔄 App state loaded, selected_ids:",v.selected_ids),o(v)}catch(v){console.error("Failed to load app state:",v)}finally{l(!1)}};He(()=>{a()});const f=async(v,_,U,R={})=>{try{l(!0);const F=await le("create_element",{request:{element_type:v,position:_,size:U,content_data:R}});return await a(),F}catch(F){throw console.error("Failed to create element:",F),F}finally{l(!1)}},g=async(v,_)=>{try{l(!0),await le("update_element",{request:{id:v,updates:_}}),await a()}catch(U){throw console.error("Failed to update element:",U),U}finally{l(!1)}},$=async v=>{try{l(!0),await le("batch_update_positions",{request:{updates:v}}),o(_=>{const U=_.elements.map(R=>{const F=v.find(X=>X.element_id===R.id);return F?{...R,position:F.new_position}:R});return{..._,elements:U,dirty:!0}}),console.log("🚀 Optimized batch position update completed without full reload")}catch(_){throw console.error("Failed to batch update positions:",_),await a(),_}finally{l(!1)}},j=async v=>{try{l(!0),await le("delete_element",{elementId:v}),await a()}catch(_){throw console.error("Failed to delete element:",_),_}finally{l(!1)}},E=async v=>{try{console.log("Selecting element:",v),await le("select_element",{elementId:v}),console.log("Select command completed, reloading state..."),await a(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(_){throw console.error("Failed to select element:",_),_}},z=async v=>{try{console.log("Selecting multiple elements:",v),v.length>0?(await le("select_multiple",{elementIds:v}),console.log("✅ Multi-select completed for:",v.length,"elements")):await le("clear_selection"),await a()}catch(_){throw console.error("Failed to select multiple elements:",_),_}},A=async v=>{try{console.log("Adding to selection:",v),await le("add_to_selection",{elementId:v}),await a()}catch(_){throw console.error("Failed to add to selection:",_),_}},I=async v=>{try{console.log("Removing from selection:",v),await le("remove_from_selection",{elementId:v}),await a()}catch(_){throw console.error("Failed to remove from selection:",_),_}},k=async v=>{try{console.log("Toggling selection:",v),await le("toggle_selection",{elementId:v}),await a()}catch(_){throw console.error("Failed to toggle selection:",_),_}},p=async()=>{try{await le("clear_selection"),await a()}catch(v){throw console.error("Failed to clear selection:",v),v}},L=async()=>{try{await le("copy_selected")}catch(v){throw console.error("Failed to copy selected elements:",v),v}},V={state:t,createElement:f,updateElement:g,batchUpdatePositions:$,deleteElement:j,selectElement:E,selectMultiple:z,addToSelection:A,removeFromSelection:I,toggleSelection:k,clearSelection:p,copySelected:L,copySelectedElements:async()=>L(),pasteElements:async(v,_)=>{try{l(!0);const U=await le("paste_elements",{offsetX:v,offsetY:_});return await a(),U}catch(U){throw console.error("Failed to paste elements:",U),U}finally{l(!1)}},deleteElements:async v=>{try{l(!0);for(const _ of v)await le("delete_element",{elementId:_});await a()}catch(_){throw console.error("Failed to delete elements:",_),_}finally{l(!1)}},selectAllElements:async()=>{try{const v=t.elements.map(_=>_.id);await z(v)}catch(v){throw console.error("Failed to select all elements:",v),v}},moveElements:async(v,_,U)=>{try{l(!0);const R=t.elements.filter(F=>v.includes(F.id)).map(F=>({element_id:F.id,new_position:{x:F.position.x+_,y:F.position.y+U}}));R.length>0&&await $(R)}catch(R){throw console.error("Failed to move elements:",R),R}finally{l(!1)}},undo:async()=>{try{l(!0),await le("undo"),await a()}catch(v){throw console.error("Failed to undo:",v),v}finally{l(!1)}},redo:async()=>{try{l(!0),await le("redo"),await a()}catch(v){throw console.error("Failed to redo:",v),v}finally{l(!1)}},updateCanvasConfig:async v=>{try{l(!0),await le("update_canvas_config",{request:v}),await a()}catch(_){throw console.error("Failed to update canvas config:",_),_}finally{l(!1)}},getElementsAtPoint:async(v,_)=>{try{return await le("get_elements_at_point",{x:v,y:_})}catch(U){return console.error("Failed to get elements at point:",U),[]}},isLoading:n,setLoading:l,dragOperation:i,setDragOperation:r,resizeOperation:s,setResizeOperation:h};return y(Mt.Provider,{value:V,get children(){return e.children}})},we=()=>{const e=tn(Mt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var _n=C("<span class=text-warning>●"),$n=C("<span class=ml-2> 个元素"),kn=C('<span class="ml-2 text-primary">已选择 <!> 个'),Sn=C('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const Cn=()=>{const{state:e,undo:t,redo:o,updateCanvasConfig:n}=we(),[l,i]=Q(e.canvas_config.zoom*100),r=async $=>{const j=$/100;i($);try{await n({zoom:j})}catch(E){console.error("Failed to update zoom:",E)}},s=()=>{const $=Math.min(l()+25,500);r($)},h=()=>{const $=Math.max(l()-25,25);r($)},a=async()=>{try{await n({show_grid:!e.canvas_config.show_grid})}catch($){console.error("Failed to toggle grid:",$)}},f=async()=>{try{await n({show_rulers:!e.canvas_config.show_rulers})}catch($){console.error("Failed to toggle rulers:",$)}},g=async()=>{try{await le("toggle_devtools"),console.log("🔧 DevTools toggled")}catch($){console.error("Failed to toggle DevTools:",$)}};return(()=>{var $=Sn(),j=$.firstChild,E=j.nextSibling,z=E.firstChild,A=z.nextSibling,I=A.nextSibling,k=I.nextSibling,p=k.nextSibling,L=p.nextSibling,D=L.nextSibling,P=D.nextSibling,Y=P.nextSibling,q=Y.nextSibling,Z=q.nextSibling,O=E.nextSibling,N=O.firstChild;return dt(z,"click",t),dt(A,"click",o),k.$$click=h,p.addEventListener("change",b=>{const T=b.target.value;if(T==="fit")console.log("Fit to window");else{const V=parseInt(T.replace("%",""));r(V)}}),L.$$click=s,P.$$click=a,Y.$$click=f,Z.$$click=g,d(O,y(xe,{get when(){return e.dirty},get children(){return _n()}}),N),d(N,()=>e.template_name||"未命名模板"),d(O,y(xe,{get when(){return e.elements.length>0},get children(){var b=$n(),T=b.firstChild;return d(b,()=>e.elements.length,T),b}}),null),d(O,y(xe,{get when(){return e.selected_ids.length>0},get children(){var b=kn(),T=b.firstChild,V=T.nextSibling;return V.nextSibling,d(b,()=>e.selected_ids.length,V),b}}),null),M(b=>{var T=`toolbar-btn-icon ${e.can_undo?"":"opacity-50 cursor-not-allowed"}`,V=!e.can_undo,v=`撤销${e.undo_description?` (${e.undo_description})`:""} (Ctrl+Z)`,_=`toolbar-btn-icon ${e.can_redo?"":"opacity-50 cursor-not-allowed"}`,U=!e.can_redo,R=`重做${e.redo_description?` (${e.redo_description})`:""} (Ctrl+Y)`,F=`toolbar-btn-icon ${e.canvas_config.show_grid?"active":""}`,X=`toolbar-btn-icon ${e.canvas_config.show_rulers?"active":""}`;return T!==b.e&&Ue(z,b.e=T),V!==b.t&&(z.disabled=b.t=V),v!==b.a&&w(z,"title",b.a=v),_!==b.o&&Ue(A,b.o=_),U!==b.i&&(A.disabled=b.i=U),R!==b.n&&w(A,"title",b.n=R),F!==b.s&&Ue(P,b.s=F),X!==b.h&&Ue(Y,b.h=X),b},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),M(()=>p.value=`${Math.round(l())}%`),$})()};Se(["click"]);var En=C('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),zn=C('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const Pn=()=>{const{createElement:e}=we(),[t,o]=Q(""),n=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:a=>({type:"Text",content:(a==null?void 0:a.text)||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:a=>({type:"DataField",expression:(a==null?void 0:a.expression)||"${fieldName}",format:a==null?void 0:a.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:a=>({type:"Rectangle",fill_color:(a==null?void 0:a.fill_color)||"transparent",border:{color:(a==null?void 0:a.border_color)||"#000000",width:(a==null?void 0:a.border_width)||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:a=>({type:"Line",color:(a==null?void 0:a.color)||"#000000",width:(a==null?void 0:a.width)||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:a=>({type:"Image",src:(a==null?void 0:a.src)||"",alt:(a==null?void 0:a.alt)||"图片"})}],l=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left",border:{color:"#cccccc",width:1,style:"Solid",radius:0},background:{color:"#f8f9fa",opacity:.8,padding:2}}})}],i=[...n,...l],r=()=>{const a=t().toLowerCase();return a?i.filter(f=>f.name.toLowerCase().includes(a)||f.description.toLowerCase().includes(a)):i},s=(a,f)=>{if(console.log("Starting drag for component:",a.id),f.dataTransfer){f.dataTransfer.effectAllowed="copy",f.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:a}));const g=document.createElement("div");g.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${a.icon} ${a.name}
        </div>
      `,g.style.position="absolute",g.style.top="-1000px",document.body.appendChild(g),f.dataTransfer.setDragImage(g,50,20),setTimeout(()=>{document.body.removeChild(g)},0)}},h=async a=>{try{const f=await e(a.id,{x:100,y:100},a.default_size,a.create_content());console.log("Created element:",f)}catch(f){console.error("Failed to create element:",f)}};return(()=>{var a=En(),f=a.firstChild,g=f.firstChild,$=g.nextSibling,j=f.nextSibling,E=j.firstChild,z=E.firstChild,A=z.firstChild,I=A.nextSibling,k=z.nextSibling,p=k.firstChild,L=p.nextSibling,D=k.nextSibling,P=D.firstChild,Y=P.nextSibling;return $.$$input=q=>o(q.target.value),d(I,y(ze,{get each(){return r().filter(q=>q.category==="basic")},children:q=>y(rt,{component:q,onDrag:Z=>s(q,Z),onClick:()=>h(q)})})),d(L,y(ze,{get each(){return r().filter(q=>q.category==="data")},children:q=>y(rt,{component:q,onDrag:Z=>s(q,Z),onClick:()=>h(q)})})),d(Y,y(ze,{get each(){return r().filter(q=>q.category==="bank")},children:q=>y(rt,{component:q,onDrag:Z=>s(q,Z),onClick:()=>h(q)})})),M(()=>$.value=t()),a})()},rt=e=>(()=>{var t=zn(),o=t.firstChild,n=o.firstChild,l=n.nextSibling;return dt(t,"click",e.onClick),t.addEventListener("dragstart",i=>e.onDrag(i)),w(t,"draggable",!0),d(n,()=>e.component.icon),d(l,()=>e.component.name),M(()=>w(t,"title",e.component.description)),t})();Se(["input","click"]);var An=C('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),In=C('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),Un=C("<span class=property-value>"),Ln=C('<span class="property-value text-xs text-muted">'),nt=C("<div class=space-y-2>"),Fe=C("<input type=number class=property-input>"),Dn=C('<div class="grid grid-cols-2 gap-2">'),xt=C("<input type=checkbox class=property-checkbox>"),Mn=C('<div class="p-4 space-y-4">'),Tn=C("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),Rn=C("<div class=property-field><label class=property-label>"),Fn=C("<textarea class=property-textarea rows=2 placeholder=输入文本内容...>"),Tt=C('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=KaiTi>楷体</option><option value=Arial>Arial</option><option value="Times New Roman">Times New Roman</option><option value=Helvetica>Helvetica'),Rt=C("<select class=property-select><option value=normal>正常</option><option value=bold>粗体</option><option value=lighter>细体</option><option value=100>100</option><option value=200>200</option><option value=300>300</option><option value=400>400</option><option value=500>500</option><option value=600>600</option><option value=700>700</option><option value=800>800</option><option value=900>900"),On=C('<div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Ft=C("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线"),Nn=C('<div class=space-y-2><div class="grid grid-cols-3 gap-2">'),Ot=C('<div class=space-y-3><div class="grid grid-cols-2 gap-2"></div><div class="grid grid-cols-2 gap-2">'),Nt=C('<div class="flex gap-2 items-center"><input type=range class="property-slider flex-1"min=0 max=100 step=1><span class="property-value w-12 text-center">%'),jn=C('<div class=space-y-3><div class=space-y-2><div class="grid grid-cols-2 gap-2">'),Bn=C("<select class=property-select><option value=Solid>实线</option><option value=Dashed>虚线</option><option value=Dotted>点线</option><option value=DashDot>点划线"),pt=C("<select class=property-select><option value=None>无</option><option value=Arrow>箭头</option><option value=Circle>圆点</option><option value=Square>方块"),Hn=C('<div class=space-y-3><div class="grid grid-cols-2 gap-2">'),Gn=C("<input type=text class=property-input placeholder=https://example.com/image.jpg>"),Kn=C("<input type=text class=property-input placeholder=图片描述文字>"),Vn=C("<div class=property-image-preview><div class=property-image-placeholder><span>📷 无图片"),qn=C("<div class=space-y-3>"),Wn=C("<img class=property-image>"),Xn=C("<input type=text class=property-input placeholder=${fieldName}>"),Yn=C("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字"),Zn=C("<div class=space-y-4>"),Jn=C('<div class=flex><input type=number class="property-input flex-1">'),Qn=C("<span class=property-unit>"),el=C('<div class="flex gap-2"><div class=property-color-wrapper><input type=color class=property-color><div class=property-color-preview></div></div><input type=text class="property-input flex-1"placeholder=#000000>'),tl=C("<div class=property-alignment-group>"),nl=C("<button>");const ll=()=>{const{state:e,updateElement:t}=we(),o=ie(()=>{const i=new Set(e.selected_ids);return e.elements.filter(r=>i.has(r.id))}),n=ie(()=>o()[0]),l=async(i,r,s)=>{try{await t(i,{[r]:s})}catch(h){console.error("Failed to update element property:",h)}};return(()=>{var i=An(),r=i.firstChild,s=r.nextSibling;return d(s,y(xe,{get when(){return n()},get fallback(){return In()},get children(){return y(il,{get element(){return n()},onUpdate:l})}})),i})()},il=e=>{const t=(n,l)=>{const i={...e.element.position,[n]:l};e.onUpdate(e.element.id,"position",i)},o=(n,l)=>{const i={...e.element.size,[n]:Math.max(1,l)};e.onUpdate(e.element.id,"size",i)};return(()=>{var n=Mn();return d(n,y(pe,{title:"元素信息",icon:"ℹ️",get children(){var l=nt();return d(l,y(K,{label:"类型",get children(){var i=Un();return d(i,()=>e.element.content.type),i}}),null),d(l,y(K,{label:"ID",get children(){var i=Ln();return d(i,()=>e.element.id),i}}),null),l}}),null),d(n,y(pe,{title:"位置和大小",icon:"📐",get children(){var l=Dn();return d(l,y(K,{label:"X",get children(){var i=Fe();return i.$$input=r=>t("x",parseFloat(r.target.value)||0),M(()=>i.value=e.element.position.x),i}}),null),d(l,y(K,{label:"Y",get children(){var i=Fe();return i.$$input=r=>t("y",parseFloat(r.target.value)||0),M(()=>i.value=e.element.position.y),i}}),null),d(l,y(K,{label:"宽度",get children(){var i=Fe();return i.$$input=r=>o("width",parseFloat(r.target.value)||1),M(()=>i.value=e.element.size.width),i}}),null),d(l,y(K,{label:"高度",get children(){var i=Fe();return i.$$input=r=>o("height",parseFloat(r.target.value)||1),M(()=>i.value=e.element.size.height),i}}),null),l}}),null),d(n,y(pe,{title:"状态",icon:"👁️",get children(){var l=nt();return d(l,y(K,{label:"可见",get children(){var i=xt();return i.addEventListener("change",r=>e.onUpdate(e.element.id,"visible",r.target.checked)),M(()=>i.checked=e.element.visible),i}}),null),d(l,y(K,{label:"锁定",get children(){var i=xt();return i.addEventListener("change",r=>e.onUpdate(e.element.id,"locked",r.target.checked)),M(()=>i.checked=e.element.locked),i}}),null),d(l,y(K,{label:"层级",get children(){var i=Fe();return i.$$input=r=>e.onUpdate(e.element.id,"z_index",parseInt(r.target.value)||0),M(()=>i.value=e.element.z_index),i}}),null),l}}),null),d(n,y(dn,{get children(){return[y(Re,{get when(){return e.element.content.type==="Text"&&e.element.content},children:l=>y(ol,{get content(){return l()},onUpdate:i=>{console.log("Text content update:",i),e.onUpdate(e.element.id,"content",i)}})}),y(Re,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:l=>y(rl,{get content(){return l()},onUpdate:i=>{console.log("Rectangle content update:",i),e.onUpdate(e.element.id,"content",i)}})}),y(Re,{get when(){return e.element.content.type==="Line"&&e.element.content},children:l=>y(sl,{get content(){return l()},onUpdate:i=>{console.log("Line content update:",i),e.onUpdate(e.element.id,"content",i)}})}),y(Re,{get when(){return e.element.content.type==="Image"&&e.element.content},children:l=>y(al,{get content(){return l()},onUpdate:i=>{console.log("Image content update:",i),e.onUpdate(e.element.id,"content",i)}})}),y(Re,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:l=>y(cl,{get content(){return l()},onUpdate:i=>{console.log("DataField content update:",i),e.onUpdate(e.element.id,"content",i)}})})]}}),null),n})()},pe=e=>(()=>{var t=Tn(),o=t.firstChild,n=o.firstChild,l=n.nextSibling,i=o.nextSibling;return d(n,()=>e.icon),d(l,()=>e.title),d(i,()=>e.children),t})(),K=e=>(()=>{var t=Rn(),o=t.firstChild;return d(o,()=>e.label),d(t,()=>e.children,null),t})(),ol=e=>y(pe,{title:"文字样式",icon:"🔤",get children(){var t=Ot(),o=t.firstChild,n=o.nextSibling;return d(t,y(K,{label:"内容",get children(){var l=Fn();return l.$$input=i=>e.onUpdate({content:i.target.value}),M(()=>l.value=e.content.content),l}}),o),d(o,y(K,{label:"字体",get children(){var l=Tt();return l.addEventListener("change",i=>e.onUpdate({style:{...e.content.style,font_family:i.target.value}})),M(()=>l.value=e.content.style.font_family),l}}),null),d(o,y(K,{label:"大小",get children(){return y(me,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:l=>e.onUpdate({style:{...e.content.style,font_size:l}})})}}),null),d(n,y(K,{label:"字重",get children(){var l=Rt();return l.addEventListener("change",i=>e.onUpdate({style:{...e.content.style,font_weight:i.target.value}})),M(()=>l.value=e.content.style.font_weight),l}}),null),d(n,y(K,{label:"对齐",get children(){return y(jt,{get value(){return e.content.style.align},onUpdate:l=>e.onUpdate({style:{...e.content.style,align:l}})})}}),null),d(t,y(K,{label:"颜色",get children(){return y(Pe,{get value(){return e.content.style.color},onUpdate:l=>e.onUpdate({style:{...e.content.style,color:l}})})}}),null),d(t,y(K,{label:"背景",get children(){var l=On(),i=l.firstChild;return d(l,y(Pe,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.color)||"transparent"},onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,color:r}}})}),i),d(i,y(K,{label:"透明度",get children(){return y(me,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.opacity)||1},min:0,max:1,step:.1,onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,opacity:r}}})})}}),null),d(i,y(K,{label:"内边距",get children(){return y(me,{get value(){var r;return((r=e.content.style.background)==null?void 0:r.padding)||0},min:0,max:20,step:1,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,background:{...e.content.style.background,padding:r}}})})}}),null),l}}),null),d(t,y(K,{label:"边框",get children(){var l=Nn(),i=l.firstChild;return d(l,y(Pe,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.color)||"#000000"},onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,color:r}}})}),i),d(i,y(K,{label:"宽度",get children(){return y(me,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.width)||1},min:0,max:10,step:.5,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,width:r}}})})}}),null),d(i,y(K,{label:"样式",get children(){var r=Ft();return r.addEventListener("change",s=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,style:s.target.value}}})),M(()=>{var s;return r.value=((s=e.content.style.border)==null?void 0:s.style)||"Solid"}),r}}),null),d(i,y(K,{label:"圆角",get children(){return y(me,{get value(){var r;return((r=e.content.style.border)==null?void 0:r.radius)||0},min:0,max:20,step:1,unit:"px",onUpdate:r=>e.onUpdate({style:{...e.content.style,border:{...e.content.style.border,radius:r}}})})}}),null),l}}),null),t}}),rl=e=>y(pe,{title:"矩形样式",icon:"▭",get children(){var t=jn(),o=t.firstChild,n=o.firstChild;return d(t,y(K,{label:"填充颜色",get children(){return y(Pe,{get value(){return e.content.fill_color||"#ffffff"},onUpdate:l=>e.onUpdate({fill_color:l})})}}),o),d(o,y(K,{label:"边框",get children(){var l=nt();return d(l,y(Pe,{get value(){var i;return((i=e.content.border)==null?void 0:i.color)||"#000000"},onUpdate:i=>e.onUpdate({border:{...e.content.border,color:i}})})),l}}),n),d(n,y(K,{label:"宽度",get children(){return y(me,{get value(){var l;return((l=e.content.border)==null?void 0:l.width)||1},min:0,max:20,step:.5,unit:"px",onUpdate:l=>e.onUpdate({border:{...e.content.border,width:l}})})}}),null),d(n,y(K,{label:"样式",get children(){var l=Ft();return l.addEventListener("change",i=>e.onUpdate({border:{...e.content.border,style:i.target.value}})),M(()=>{var i;return l.value=((i=e.content.border)==null?void 0:i.style)||"Solid"}),l}}),null),d(t,y(K,{label:"圆角半径",get children(){return y(me,{get value(){return e.content.corner_radius||0},min:0,max:50,step:1,unit:"px",onUpdate:l=>e.onUpdate({corner_radius:l})})}}),null),d(t,y(K,{label:"透明度",get children(){var l=Nt(),i=l.firstChild,r=i.nextSibling,s=r.firstChild;return i.$$input=h=>e.onUpdate({opacity:parseFloat(h.target.value)/100}),d(r,()=>Math.round((e.content.opacity||1)*100),s),M(()=>i.value=(e.content.opacity||1)*100),l}}),null),t}}),sl=e=>y(pe,{title:"线条样式",icon:"━",get children(){var t=Hn(),o=t.firstChild;return d(t,y(K,{label:"颜色",get children(){return y(Pe,{get value(){return e.content.color},onUpdate:n=>e.onUpdate({color:n})})}}),o),d(t,y(K,{label:"宽度",get children(){return y(me,{get value(){return e.content.width},min:.5,max:20,step:.5,unit:"px",onUpdate:n=>e.onUpdate({width:n})})}}),o),d(t,y(K,{label:"样式",get children(){var n=Bn();return n.addEventListener("change",l=>e.onUpdate({line_style:l.target.value})),M(()=>n.value=e.content.line_style||"Solid"),n}}),o),d(o,y(K,{label:"起点",get children(){var n=pt();return n.addEventListener("change",l=>e.onUpdate({start_cap:l.target.value})),M(()=>n.value=e.content.start_cap||"None"),n}}),null),d(o,y(K,{label:"终点",get children(){var n=pt();return n.addEventListener("change",l=>e.onUpdate({end_cap:l.target.value})),M(()=>n.value=e.content.end_cap||"None"),n}}),null),d(t,y(K,{label:"透明度",get children(){var n=Nt(),l=n.firstChild,i=l.nextSibling,r=i.firstChild;return l.$$input=s=>e.onUpdate({opacity:parseFloat(s.target.value)/100}),d(i,()=>Math.round((e.content.opacity||1)*100),r),M(()=>l.value=(e.content.opacity||1)*100),n}}),null),t}}),al=e=>y(pe,{title:"图片属性",icon:"🖼️",get children(){var t=qn();return d(t,y(K,{label:"图片地址",get children(){var o=Gn();return o.$$input=n=>e.onUpdate({src:n.target.value}),M(()=>o.value=e.content.src),o}}),null),d(t,y(K,{label:"替代文本",get children(){var o=Kn();return o.$$input=n=>e.onUpdate({alt:n.target.value}),M(()=>o.value=e.content.alt||""),o}}),null),d(t,y(K,{label:"预览",get children(){var o=Vn(),n=o.firstChild;return d(o,(()=>{var l=ae(()=>!!e.content.src);return()=>l()?(()=>{var i=Wn();return i.addEventListener("load",r=>{const s=r.target,h=s.nextElementSibling;s&&(s.style.display="block"),h&&(h.style.display="none")}),i.addEventListener("error",r=>{const s=r.target,h=s.nextElementSibling;s&&(s.style.display="none"),h&&(h.style.display="flex")}),M(r=>{var s=e.content.src,h=e.content.alt||"图片预览";return s!==r.e&&w(i,"src",r.e=s),h!==r.t&&w(i,"alt",r.t=h),r},{e:void 0,t:void 0}),i})():null})(),n),M(l=>(l=e.content.src?"none":"flex")!=null?n.style.setProperty("display",l):n.style.removeProperty("display")),o}}),null),t}}),cl=e=>(()=>{var t=Zn();return d(t,y(pe,{title:"数据字段",icon:"🔗",get children(){var o=nt();return d(o,y(K,{label:"表达式",get children(){var n=Xn();return n.$$input=l=>e.onUpdate({expression:l.target.value}),M(()=>n.value=e.content.expression),n}}),null),d(o,y(K,{label:"格式",get children(){var n=Yn();return n.addEventListener("change",l=>e.onUpdate({format:l.target.value==="default"?void 0:l.target.value})),M(()=>n.value=e.content.format||"default"),n}}),null),o}}),null),d(t,y(pe,{title:"字段样式",icon:"🎨",get children(){var o=Ot(),n=o.firstChild,l=n.nextSibling;return d(n,y(K,{label:"字体",get children(){var i=Tt();return i.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_family:r.target.value}})),M(()=>i.value=e.content.style.font_family),i}}),null),d(n,y(K,{label:"大小",get children(){return y(me,{get value(){return e.content.style.font_size},min:6,max:72,step:1,unit:"px",onUpdate:i=>e.onUpdate({style:{...e.content.style,font_size:i}})})}}),null),d(l,y(K,{label:"字重",get children(){var i=Rt();return i.addEventListener("change",r=>e.onUpdate({style:{...e.content.style,font_weight:r.target.value}})),M(()=>i.value=e.content.style.font_weight),i}}),null),d(l,y(K,{label:"对齐",get children(){return y(jt,{get value(){return e.content.style.align},onUpdate:i=>e.onUpdate({style:{...e.content.style,align:i}})})}}),null),d(o,y(K,{label:"颜色",get children(){return y(Pe,{get value(){return e.content.style.color},onUpdate:i=>e.onUpdate({style:{...e.content.style,color:i}})})}}),null),o}}),null),t})(),me=e=>(()=>{var t=Jn(),o=t.firstChild;return o.addEventListener("blur",n=>{const l=parseFloat(n.target.value)||e.value,i=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));i!==l&&(n.target.value=i.toString(),e.onUpdate(i))}),o.$$input=n=>{const l=parseFloat(n.target.value);if(!isNaN(l)){const i=Math.max(e.min||-1/0,Math.min(e.max||1/0,l));e.onUpdate(i)}},d(t,(()=>{var n=ae(()=>!!e.unit);return()=>n()&&(()=>{var l=Qn();return d(l,()=>e.unit),l})()})(),null),M(n=>{var l=e.min,i=e.max,r=e.step||1;return l!==n.e&&w(o,"min",n.e=l),i!==n.t&&w(o,"max",n.t=i),r!==n.a&&w(o,"step",n.a=r),n},{e:void 0,t:void 0,a:void 0}),M(()=>o.value=e.value),t})(),Pe=e=>(()=>{var t=el(),o=t.firstChild,n=o.firstChild,l=n.nextSibling,i=o.nextSibling;return n.$$input=r=>e.onUpdate(r.target.value),i.$$input=r=>{const s=r.target.value;(/^#[0-9A-Fa-f]{6}$/.test(s)||/^#[0-9A-Fa-f]{3}$/.test(s))&&e.onUpdate(s)},M(r=>(r=e.value)!=null?l.style.setProperty("background-color",r):l.style.removeProperty("background-color")),M(()=>n.value=e.value),M(()=>i.value=e.value),t})(),jt=e=>{const t=[{value:"Left",icon:"⬅️",label:"左对齐"},{value:"Center",icon:"↔️",label:"居中"},{value:"Right",icon:"➡️",label:"右对齐"}];return(()=>{var o=tl();return d(o,()=>t.map(n=>(()=>{var l=nl();return l.$$click=()=>e.onUpdate(n.value),d(l,()=>n.icon),M(i=>{var r=`property-alignment-btn ${e.value===n.value?"active":""}`,s=n.label;return r!==i.e&&Ue(l,i.e=r),s!==i.t&&w(l,"title",i.t=s),i},{e:void 0,t:void 0}),l})())),o})()};Se(["input","click"]);var dl=C("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),ul=C("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const hl=e=>y(xe,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=dl(),o=t.firstChild,n=o.firstChild,l=n.nextSibling;return M(i=>{var r=e.config.grid_size,s=e.config.grid_size,h=e.config.grid_size,a=e.config.grid_size,f=e.config.grid_size,g=e.config.grid_size,$=e.config.grid_size,j=e.config.grid_size;return r!==i.e&&w(o,"width",i.e=r),s!==i.t&&w(o,"height",i.t=s),h!==i.a&&w(n,"x1",i.a=h),a!==i.o&&w(n,"x2",i.o=a),f!==i.i&&w(n,"y2",i.i=f),g!==i.n&&w(l,"y1",i.n=g),$!==i.s&&w(l,"x2",i.s=$),j!==i.h&&w(l,"y2",i.h=j),i},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=ul();return M(o=>{var n=e.config.width,l=e.config.height;return n!==o.e&&w(t,"width",o.e=n),l!==o.t&&w(t,"height",o.t=l),o},{e:void 0,t:void 0}),t})()]}});var fl=C("<svg><g class=text-element-container><text dominant-baseline=hanging></svg>",!1,!0,!1),gl=C("<svg><rect y=0 class=text-background></svg>",!1,!0,!1),vl=C("<svg><rect y=0 fill=none class=text-border></svg>",!1,!0,!1),yl=C("<svg><tspan></svg>",!1,!0,!1),ml=C('<svg><rect y=-2 fill="rgba(59, 130, 246, 0.08)"stroke=#3b82f6 stroke-width=1 stroke-dasharray=3,3 rx=2 ry=2 class=text-selection-background></svg>',!1,!0,!1),bl=C("<svg><rect x=0 y=0></svg>",!1,!0,!1),xl=C("<svg><line x1=0></svg>",!1,!0,!1),pl=C('<svg><rect x=0 y=0 fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.3)"stroke-width=1 stroke-dasharray=2,2></svg>',!1,!0,!1),wl=C("<svg><text dominant-baseline=hanging></svg>",!1,!0,!1),_l=C("<svg><rect x=0 y=0 fill=#f0f0f0 stroke=#ccc stroke-width=1 stroke-dasharray=5,5></svg>",!1,!0,!1),$l=C("<svg><g></svg>",!1,!0,!1);const kl=e=>{const t=ie(()=>{const{position:n}=e.element;return{transform:`translate(${n.x}px, ${n.y}px)`,opacity:e.element.visible?1:.5}}),o=()=>{var i;const{content:n,size:l}=e.element;if(n.type==="Text"&&n.content&&n.style){const r=n.style.align,s=r==="Center"?"middle":r==="Right"?"end":"start",a=((z,A)=>{const I=z.split(`
`),k=Math.max(...I.map(P=>P.length)),p=A.font_size*.8,L=Math.min(k*p,l.width),D=I.length*A.font_size*1.2;return{width:L,height:D,lines:I.length}})(n.content,n.style),f=r==="Center"?l.width/2:r==="Right"?l.width:0,g=((i=n.style.background)==null?void 0:i.padding)||0,$=a.width+g*2,j=a.height+g*2,E=r==="Center"?(l.width-$)/2:r==="Right"?l.width-$:0;return(()=>{var z=fl(),A=z.firstChild;return d(z,(()=>{var I=ae(()=>!!n.style.background);return()=>I()&&(()=>{var k=gl();return w(k,"x",E),w(k,"width",$),w(k,"height",j),M(p=>{var q,Z;var L=n.style.background.color,D=n.style.background.opacity||1,P=((q=n.style.border)==null?void 0:q.radius)||0,Y=((Z=n.style.border)==null?void 0:Z.radius)||0;return L!==p.e&&w(k,"fill",p.e=L),D!==p.t&&w(k,"fill-opacity",p.t=D),P!==p.a&&w(k,"rx",p.a=P),Y!==p.o&&w(k,"ry",p.o=Y),p},{e:void 0,t:void 0,a:void 0,o:void 0}),k})()})(),A),d(z,(()=>{var I=ae(()=>!!n.style.border);return()=>I()&&(()=>{var k=vl();return w(k,"x",E),w(k,"width",$),w(k,"height",j),M(p=>{var L=n.style.border.color,D=n.style.border.width,P=n.style.border.style==="Dashed"?"5,5":n.style.border.style==="Dotted"?"2,2":"none",Y=n.style.border.radius||0,q=n.style.border.radius||0;return L!==p.e&&w(k,"stroke",p.e=L),D!==p.t&&w(k,"stroke-width",p.t=D),P!==p.a&&w(k,"stroke-dasharray",p.a=P),Y!==p.o&&w(k,"rx",p.o=Y),q!==p.i&&w(k,"ry",p.i=q),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),k})()})(),A),w(A,"x",f),w(A,"text-anchor",s),d(A,()=>n.content.split(`
`).map((I,k)=>(()=>{var p=yl();return w(p,"x",f),d(p,I),M(()=>w(p,"dy",k===0?0:n.style.font_size*1.2)),p})())),d(z,(()=>{var I=ae(()=>!!e.selected);return()=>I()&&(()=>{var k=ml();return w(k,"x",E-2),w(k,"width",$+4),w(k,"height",j+4),k})()})(),null),M(I=>{var k=n.style.font_size*.75,p=n.style.font_family,L=`${n.style.font_size}`,D=n.style.font_weight,P=n.style.color;return k!==I.e&&w(A,"y",I.e=k),p!==I.t&&w(A,"font-family",I.t=p),L!==I.a&&w(A,"font-size",I.a=L),D!==I.o&&w(A,"font-weight",I.o=D),P!==I.i&&w(A,"fill",I.i=P),I},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),z})()}if(n.type==="Rectangle"){const r=n.opacity!==void 0?n.opacity:1,s=n.corner_radius||0;return(()=>{var h=bl();return w(h,"rx",s),w(h,"ry",s),w(h,"fill-opacity",r),w(h,"stroke-opacity",r),M(a=>{var A,I,k,p;var f=l.width,g=l.height,$=n.fill_color||"transparent",j=((A=n.border)==null?void 0:A.color)||"#000000",E=((I=n.border)==null?void 0:I.width)||1,z=((k=n.border)==null?void 0:k.style)==="Dashed"?"5,5":((p=n.border)==null?void 0:p.style)==="Dotted"?"2,2":"none";return f!==a.e&&w(h,"width",a.e=f),g!==a.t&&w(h,"height",a.t=g),$!==a.a&&w(h,"fill",a.a=$),j!==a.o&&w(h,"stroke",a.o=j),E!==a.i&&w(h,"stroke-width",a.i=E),z!==a.n&&w(h,"stroke-dasharray",a.n=z),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),h})()}if(n.type==="Line"){const r=n.opacity!==void 0?n.opacity:1,s=n.line_style||"Solid",h=s==="Dashed"?"8,4":s==="Dotted"?"2,2":s==="DashDot"?"8,4,2,4":"none";return(()=>{var a=xl();return w(a,"stroke-opacity",r),w(a,"stroke-dasharray",h),M(f=>{var g=l.height/2,$=l.width,j=l.height/2,E=n.color,z=n.width;return g!==f.e&&w(a,"y1",f.e=g),$!==f.t&&w(a,"x2",f.t=$),j!==f.a&&w(a,"y2",f.a=j),E!==f.o&&w(a,"stroke",f.o=E),z!==f.i&&w(a,"stroke-width",f.i=z),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a})()}return n.type==="DataField"&&n.style?[(()=>{var r=pl();return M(s=>{var h=l.width,a=l.height;return h!==s.e&&w(r,"width",s.e=h),a!==s.t&&w(r,"height",s.t=a),s},{e:void 0,t:void 0}),r})(),(()=>{var r=wl();return d(r,()=>n.expression||"[数据字段]"),M(s=>{var h=n.style.align==="Center"?l.width/2:n.style.align==="Right"?l.width-4:4,a=n.style.font_size*.8,f=n.style.font_family,g=`${n.style.font_size}`,$=n.style.font_weight,j=n.style.color,E=n.style.align==="Center"?"middle":n.style.align==="Right"?"end":"start";return h!==s.e&&w(r,"x",s.e=h),a!==s.t&&w(r,"y",s.t=a),f!==s.a&&w(r,"font-family",s.a=f),g!==s.o&&w(r,"font-size",s.o=g),$!==s.i&&w(r,"font-weight",s.i=$),j!==s.n&&w(r,"fill",s.n=j),E!==s.s&&w(r,"text-anchor",s.s=E),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),r})()]:(()=>{var r=_l();return M(s=>{var h=l.width,a=l.height;return h!==s.e&&w(r,"width",s.e=h),a!==s.t&&w(r,"height",s.t=a),s},{e:void 0,t:void 0}),r})()};return(()=>{var n=$l();return d(n,o),M(l=>{var i=`element ${e.selected?"element-selected":""}`,r=t(),s=e.element.id,h=e.element.content.type;return i!==l.e&&w(n,"class",l.e=i),l.t=fn(n,r,l.t),s!==l.a&&w(n,"data-element-id",l.a=s),h!==l.o&&w(n,"data-element-type",l.o=h),l},{e:void 0,t:void 0,a:void 0,o:void 0}),n})()};var Sl=C("<svg><g class=resize-handles></svg>",!1,!0,!1),Cl=C("<svg><g><circle r=6 fill=white stroke=#cccccc stroke-width=1 pointer-events=none></circle><rect class=resize-handle width=8 height=8 rx=1 fill=#007bff stroke=white stroke-width=1></svg>",!1,!0,!1);const El=e=>{const{updateElement:t,setResizeOperation:o}=we(),[n,l]=Q(!1),[i,r]=Q(null),[s,h]=Q({x:0,y:0}),[a,f]=Q({width:0,height:0}),[g,$]=Q({x:0,y:0}),[j,E]=Q({width:0,height:0}),[z,A]=Q({x:0,y:0}),[I,k]=Q(!1),p=ie(()=>{const{position:O,size:N}=e.element,T=8/2,V=O.x,v=O.y,_=O.x+N.width,U=O.y+N.height,R=O.x+N.width/2,F=O.y+N.height/2;return[{position:"nw",cursor:"nw-resize",x:V-T,y:v-T},{position:"ne",cursor:"ne-resize",x:_-T,y:v-T},{position:"sw",cursor:"sw-resize",x:V-T,y:U-T},{position:"se",cursor:"se-resize",x:_-T,y:U-T},{position:"n",cursor:"n-resize",x:R-T,y:v-T},{position:"s",cursor:"s-resize",x:R-T,y:U-T},{position:"w",cursor:"w-resize",x:V-T,y:F-T},{position:"e",cursor:"e-resize",x:_-T,y:F-T}]}),L=(O,N,b,T=!1,V=!1)=>{const v=a(),_=g();let U=v.width,R=v.height,F=_.x,X=_.y;switch(O){case"nw":U=v.width-N,R=v.height-b,F=_.x+N,X=_.y+b;break;case"ne":U=v.width+N,R=v.height-b,X=_.y+b;break;case"sw":U=v.width-N,R=v.height+b,F=_.x+N;break;case"se":U=v.width+N,R=v.height+b;break;case"n":R=v.height-b,X=_.y+b;break;case"s":R=v.height+b;break;case"w":U=v.width-N,F=_.x+N;break;case"e":U=v.width+N;break}if(T&&(O==="nw"||O==="ne"||O==="sw"||O==="se")){const se=v.width/v.height;U/R>se?(U=R*se,(O==="nw"||O==="sw")&&(F=_.x+(v.width-U))):(R=U/se,(O==="nw"||O==="ne")&&(X=_.y+(v.height-R)))}if(V){const se=_.x+v.width/2,B=_.y+v.height/2;F=se-U/2,X=B-R/2}const he=20;return U=Math.max(he,U),R=Math.max(he,R),{size:{width:U,height:R},position:{x:F,y:X}}},D=O=>(O.preventDefault(),O.stopPropagation(),O.stopImmediatePropagation(),!1),P=(O,N)=>{var b;o(!0),document.addEventListener("click",D,{capture:!0}),l(!0),r(O),h({x:N.clientX,y:N.clientY}),f({width:e.element.size.width,height:e.element.size.height}),$({x:e.element.position.x,y:e.element.position.y}),E(e.element.size),A(e.element.position),k(!1),document.addEventListener("mousemove",q),document.addEventListener("mouseup",Z),document.body.style.cursor=((b=p().find(T=>T.position===O))==null?void 0:b.cursor)||"default"};let Y=0;const q=O=>{if(!n())return;const N=i();if(!N)return;const b=s(),T=O.clientX-b.x,V=O.clientY-b.y,v=L(N,T,V,O.shiftKey,O.altKey);E(v.size),A(v.position),k(Math.abs(T)>2||Math.abs(V)>2);const _=Date.now();if(_-Y>50)try{t(e.element.id,{size:v.size,position:v.position}),Y=_}catch{}},Z=()=>{if(!n()||!i())return;const N=()=>{document.removeEventListener("click",D,{capture:!0}),o(!1),l(!1),r(null),document.body.style.cursor="default",document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",Z)};if(I()){const b=j(),T=z();t(e.element.id,{size:b,position:T}).catch(V=>{t(e.element.id,{size:a(),position:g()}).catch(v=>{})})}N()};return it(()=>{o(!1),document.removeEventListener("click",D,{capture:!0}),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",Z),document.body.style.cursor="default"}),(()=>{var O=Sl();return d(O,()=>p().map(N=>(()=>{var b=Cl(),T=b.firstChild,V=T.nextSibling;return V.addEventListener("mouseleave",v=>{n()||(document.body.style.cursor="default")}),V.addEventListener("mouseenter",v=>{n()||(document.body.style.cursor=N.cursor)}),V.$$mousedown=v=>{v.stopPropagation(),v.preventDefault(),P(N.position,v)},V.style.setProperty("pointer-events","all"),M(v=>{var _=N.x+4,U=N.y+4,R=N.x,F=N.y,X=N.cursor;return _!==v.e&&w(T,"cx",v.e=_),U!==v.t&&w(T,"cy",v.t=U),R!==v.a&&w(V,"x",v.a=R),F!==v.o&&w(V,"y",v.o=F),X!==v.i&&((v.i=X)!=null?V.style.setProperty("cursor",X):V.style.removeProperty("cursor")),v},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),b})())),O})()};Se(["mousedown"]);var ce=(e=>(e.IDLE="idle",e.HOVER="hover",e.SELECTING="selecting",e.DRAGGING="dragging",e))(ce||{});const zl={dragThreshold:3,updateThrottle:16};var Pl=C("<div tabindex=0>"),Al=C("<div>"),Il=C("<div><div>🎯 修复版交互层</div><div>模式: </div><div>选中: </div><div>光标: "),Ul=C("<div>拖拽: <!>个元素"),Ll=C("<div>[<!>]");const Dl=e=>{const{resizeOperation:t,setResizeOperation:o}=we(),n=zl;let l;const[i,r]=Q(ce.IDLE),[s,h]=Q([]),[a,f]=Q(null),[g,$]=Q(null),[j,E]=Q(null),z=(c,u)=>Math.sqrt(Math.pow(c.x-u.x,2)+Math.pow(c.y-u.y,2)),A=(c,u)=>c.length===u.length&&c.every((x,m)=>x===u[m]),I=()=>{E(null)},[k,p]=Q(null);let L="default";const D=(c,u)=>{!l||L===c||(l.style.cursor=c,L=c)},P=(c,...u)=>{console.log(`🎯 [InteractionLayer] ${c}`,...u)},Y=c=>{if(!l)return{x:0,y:0};const u=l.getBoundingClientRect();return{x:c.clientX-u.left,y:c.clientY-u.top}},q=(c,u)=>c.x>=u.position.x&&c.x<=u.position.x+u.size.width&&c.y>=u.position.y&&c.y<=u.position.y+u.size.height,Z=c=>{var x;const u=O(c);return u.length>0&&(x=u[0])!=null?x:null},O=c=>{const u=e.getAllElements();return u.filter(m=>m&&m.visible&&q(c,m)).sort((m,S)=>{var ee,te;const H=(ee=m.z_index)!=null?ee:u.indexOf(m);return((te=S.z_index)!=null?te:u.indexOf(S))-H})},N=c=>{const u=s();if(u.length===0)return null;const x=e.getAllElements();for(const m of u){const S=x.find($e=>$e.id===m);if(!S||!S.visible)continue;const H=8,G=H/2,ee=S.position.x,te=S.position.y,W=S.position.x+S.size.width,Ee=S.position.y+S.size.height,ve=S.position.x+S.size.width/2,Te=S.position.y+S.size.height/2,Wt=[{direction:"nw",cursor:"nw-resize",x:ee-G,y:te-G},{direction:"ne",cursor:"ne-resize",x:W-G,y:te-G},{direction:"sw",cursor:"sw-resize",x:ee-G,y:Ee-G},{direction:"se",cursor:"se-resize",x:W-G,y:Ee-G},{direction:"n",cursor:"n-resize",x:ve-G,y:te-G},{direction:"s",cursor:"s-resize",x:ve-G,y:Ee-G},{direction:"w",cursor:"w-resize",x:ee-G,y:Te-G},{direction:"e",cursor:"e-resize",x:W-G,y:Te-G}];for(const $e of Wt)if(c.x>=$e.x&&c.x<$e.x+H&&c.y>=$e.y&&c.y<$e.y+H)return{elementId:S.id,direction:$e.direction,cursor:$e.cursor}}return null},b=c=>e.getAllElements().filter(x=>{if(!x.visible)return!1;const m={x:x.position.x,y:x.position.y,width:x.size.width,height:x.size.height};return!(m.x>c.x+c.width||m.x+m.width<c.x||m.y>c.y+c.height||m.y+m.height<c.y)}),T=(c,u)=>{var m,S,H;const x=O(c);return P("重叠选择检测",{elementsCount:x.length,isCtrlClick:u,elementIds:x.map(G=>G.id)}),x.length===0?null:x.length===1?(I(),((m=x[0])==null?void 0:m.id)||null):u?V(c,x):(I(),P("普通点击选中最上层",{elementId:(S=x[0])==null?void 0:S.id}),((H=x[0])==null?void 0:H.id)||null)},V=(c,u)=>{var H,G,ee,te;const x=j(),m=Date.now();if(P("循环选择开始",{hasContext:!!x,elementIds:u.map(W=>W.id)}),!x||z(c,x.clickPoint)>5||m-x.lastClickTime>3e3||!A(u.map(W=>W.id),x.overlappingElements.map(W=>W.id))){const W=u.length>1?1:0;return E({clickPoint:c,overlappingElements:u,currentSelectedIndex:W,lastClickTime:m}),P("循环选择重置",{selectedIndex:W,selectedId:(H=u[W])==null?void 0:H.id,reason:x?z(c,x.clickPoint)>5?"position_changed":m-x.lastClickTime>3e3?"timeout":"elements_changed":"no_context"}),v(W+1,u.length,c),((G=u[W])==null?void 0:G.id)||null}else{const W=(x.currentSelectedIndex+1)%u.length;return E({...x,currentSelectedIndex:W,lastClickTime:m}),P("循环选择继续",{selectedIndex:W,selectedId:(ee=u[W])==null?void 0:ee.id}),v(W+1,u.length,c),((te=u[W])==null?void 0:te.id)||null}},v=(c,u,x)=>{const m=document.querySelector(".overlap-indicator");m!=null&&m.parentNode&&m.parentNode.removeChild(m);const S=document.createElement("div");S.className="overlap-indicator",S.textContent=`${c}/${u}`,Object.assign(S.style,{position:"fixed",background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"2px 6px",fontSize:"11px",fontFamily:"monospace",borderRadius:"3px",pointerEvents:"none",zIndex:"9999",whiteSpace:"nowrap",left:`${x.x+10}px`,top:`${x.y-20}px`}),document.body.appendChild(S),P("显示重叠指示器",{current:c,total:u,point:x}),setTimeout(()=>{S.parentNode&&(S.parentNode.removeChild(S),P("移除重叠指示器"))},1500)},_=c=>{var x;const u=Y(c);if(k()){Bt(u);return}if(i()===ce.DRAGGING){Ke(u);return}if(i()===ce.SELECTING){Ve(u);return}if(i()===ce.IDLE&&a()&&!((x=a())!=null&&x.isDragging)){fe(u);return}i()===ce.IDLE&&!a()&&!k()&&U(u)},U=c=>{const u=N(c);if(u){D(u.cursor);return}const x=Z(c);if(x){const S=s().includes(x.id)?"grab":"pointer";D(S);return}D("default")},R=c=>{const u=Y(c),x=N(u);if(x){P("点击ResizeHandle",{elementId:x.elementId,direction:x.direction}),F(x,u);return}if(t()){P("调整大小操作进行中，跳过交互处理");return}const m=T(u,c.ctrlKey);if(P("鼠标按下",{point:u,selectedElementId:m,currentMode:i(),isCtrlClick:c.ctrlKey}),m){const S=e.getAllElements().find(H=>H.id===m);S&&X(S,u,c)}else he(u)},F=(c,u,x)=>{const m=e.getAllElements().find(S=>S.id===c.elementId);m&&(P("开始resize操作",{elementId:c.elementId,direction:c.direction}),o(!0),p({elementId:c.elementId,handlePosition:c.direction,startPoint:u,initialSize:{width:m.size.width,height:m.size.height},initialPosition:{x:m.position.x,y:m.position.y},cursor:c.cursor}),D(c.cursor),P("resize状态已设置",k()))},X=(c,u,x)=>{const m=s().includes(c.id),S=s(),H=!!j();P("元素点击",{elementId:c.id,isSelected:m,currentlySelected:S,ctrlKey:x.ctrlKey,shiftKey:x.shiftKey,hasOverlapContext:H}),x.ctrlKey&&!H?se(c.id):x.shiftKey&&s().length>0?B(c.id):m?(P("点击已选中元素，准备拖拽",{selectedCount:S.length}),ue(S,u)):re(c.id,u)},he=(c,u)=>{var x;P("开始框选",{point:c}),h([]),(x=e.onElementsSelect)==null||x.call(e,[]),I(),r(ce.SELECTING),D("crosshair"),$({startPoint:c,currentPoint:c,selectedIds:[]})},se=c=>{var m;const u=s(),x=u.includes(c)?u.filter(S=>S!==c):[...u,c];P("切换选择",{elementId:c,newSelection:x}),h(x),(m=e.onElementsSelect)==null||m.call(e,x)},B=c=>{var x;const u=s();if(!u.includes(c)){const m=[...u,c];P("添加到选择",{elementId:c,newSelection:m}),h(m),(x=e.onElementsSelect)==null||x.call(e,m)}},re=(c,u,x)=>{var m;P("选择并准备拖拽",{elementId:c,point:u}),h([c]),(m=e.onElementsSelect)==null||m.call(e,[c]),ue([c],u)},ue=(c,u,x)=>{P("准备拖拽操作",{elementIds:c,startPoint:u});const m=e.getAllElements(),S=new Map;c.forEach(H=>{const G=m.find(ee=>ee.id===H);G&&S.set(H,{x:G.position.x,y:G.position.y})}),f({elementIds:c,startPoint:u,startPositions:S,currentOffset:{x:0,y:0},isDragging:!1})},fe=c=>{const u=a();if(!u)return;const x=Math.sqrt(Math.pow(c.x-u.startPoint.x,2)+Math.pow(c.y-u.startPoint.y,2));x>n.dragThreshold&&(P("开始拖拽",{distance:x,threshold:n.dragThreshold}),r(ce.DRAGGING),D("grabbing"),f({...u,isDragging:!0}))};let ge=!1,Ce=0;const _e=(c,u=!1)=>{if(u){c();return}Date.now()-Ce>=n.updateThrottle&&!ge&&(ge=!0,requestAnimationFrame(()=>{c(),ge=!1,Ce=Date.now()}))},Ke=c=>{const u=a();if(!u)return;const x={x:c.x-u.startPoint.x,y:c.y-u.startPoint.y};f({...u,currentOffset:x}),_e(()=>{if(e.onBatchUpdatePositions&&u.elementIds.length>1){const m=u.elementIds.map(S=>{const H=u.startPositions.get(S);return H?{element_id:S,new_position:{x:H.x+x.x,y:H.y+x.y}}:null}).filter(Boolean);m.length>0&&e.onBatchUpdatePositions(m).catch(()=>{})}else if(e.onElementMove){const m=u.elementIds.map(S=>{const H=u.startPositions.get(S);if(H)return e.onElementMove(S,{x:H.x+x.x,y:H.y+x.y})}).filter(Boolean);Promise.allSettled(m).catch(()=>{})}})},Ve=c=>{const u=g();if(!u)return;const x={...u,currentPoint:c};$(x);const m={x:Math.min(u.startPoint.x,c.x),y:Math.min(u.startPoint.y,c.y),width:Math.abs(c.x-u.startPoint.x),height:Math.abs(c.y-u.startPoint.y)},H=b(m).map(G=>G.id);$({...x,selectedIds:H}),h(H)},Bt=c=>{const u=k();if(!u)return;const x=c.x-u.startPoint.x,m=c.y-u.startPoint.y,S=Ht(u.handlePosition,x,m,u.initialSize,u.initialPosition);_e(()=>{e.onElementResize&&e.onElementResize(u.elementId,S.size,S.position)})},Ht=(c,u,x,m,S)=>{let H=m.width,G=m.height,ee=S.x,te=S.y;switch(c){case"nw":H=m.width-u,G=m.height-x,ee=S.x+u,te=S.y+x;break;case"ne":H=m.width+u,G=m.height-x,te=S.y+x;break;case"sw":H=m.width-u,G=m.height+x,ee=S.x+u;break;case"se":H=m.width+u,G=m.height+x;break;case"n":G=m.height-x,te=S.y+x;break;case"s":G=m.height+x;break;case"w":H=m.width-u,ee=S.x+u;break;case"e":H=m.width+u;break}const W=10;return H=Math.max(W,H),G=Math.max(W,G),{size:{width:H,height:G},position:{x:ee,y:te}}},gt=()=>{const c=i();if(P("鼠标释放",{currentMode:c,hasResizeState:!!k()}),k()){Vt();return}c===ce.DRAGGING?Gt():c===ce.SELECTING&&Kt(),qt()},Gt=()=>{const c=a();if(!c||!c.isDragging&&c.currentOffset.x===0&&c.currentOffset.y===0){P("拖拽完成，无实际移动");return}if(e.onBatchUpdatePositions&&c.elementIds.length>1){const u=c.elementIds.map(x=>{const m=c.startPositions.get(x);return m?{element_id:x,new_position:{x:m.x+c.currentOffset.x,y:m.y+c.currentOffset.y}}:null}).filter(Boolean);u.length>0&&(P("拖拽完成 - 批量更新",{elementCount:u.length}),e.onBatchUpdatePositions(u).catch(x=>{console.warn("批量更新最终位置失败:",x)}))}},Kt=()=>{const c=g();c&&(P("框选完成",{selectedCount:c.selectedIds.length}),e.onElementsSelect&&e.onElementsSelect(c.selectedIds))},Vt=()=>{const c=k();c&&(P("完成resize操作",{elementId:c.elementId}),o(!1),p(null))},qt=()=>{r(ce.IDLE),D("default"),f(null),$(null),p(null),o(!1),I(),P("状态重置完成")};He(async()=>{document.addEventListener("mousemove",_),document.addEventListener("mouseup",gt),P("修复版交互层已初始化")}),it(()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",gt),P("修复版交互层已清理")});const Me=()=>{const c=g();if(!c||i()!==ce.SELECTING)return null;const{startPoint:u,currentPoint:x}=c;return{x:Math.min(u.x,x.x),y:Math.min(u.y,x.y),width:Math.abs(x.x-u.x),height:Math.abs(x.y-u.y)}};return(()=>{var c=Pl();c.$$mousedown=R;var u=l;return typeof u=="function"?At(u,c):l=c,c.style.setProperty("position","absolute"),c.style.setProperty("top","0"),c.style.setProperty("left","0"),c.style.setProperty("width","100%"),c.style.setProperty("height","100%"),c.style.setProperty("z-index","10"),c.style.setProperty("pointer-events","all"),c.style.setProperty("background","transparent"),c.style.setProperty("user-select","none"),d(c,(()=>{var x=ae(()=>!!Me());return()=>x()&&(()=>{var m=Al();return m.style.setProperty("position","absolute"),m.style.setProperty("border","1px dashed #007acc"),m.style.setProperty("background","rgba(0, 122, 204, 0.1)"),m.style.setProperty("pointer-events","none"),M(S=>{var H=`${Me().x}px`,G=`${Me().y}px`,ee=`${Me().width}px`,te=`${Me().height}px`;return H!==S.e&&((S.e=H)!=null?m.style.setProperty("left",H):m.style.removeProperty("left")),G!==S.t&&((S.t=G)!=null?m.style.setProperty("top",G):m.style.removeProperty("top")),ee!==S.a&&((S.a=ee)!=null?m.style.setProperty("width",ee):m.style.removeProperty("width")),te!==S.o&&((S.o=te)!=null?m.style.setProperty("height",te):m.style.removeProperty("height")),S},{e:void 0,t:void 0,a:void 0,o:void 0}),m})()})(),null),d(c,(()=>{var x=ae(()=>!!e.enableDebugMode);return()=>x()&&(()=>{var m=Il(),S=m.firstChild,H=S.nextSibling;H.firstChild;var G=H.nextSibling;G.firstChild;var ee=G.nextSibling;return ee.firstChild,m.style.setProperty("position","fixed"),m.style.setProperty("top","10px"),m.style.setProperty("right","10px"),m.style.setProperty("padding","8px"),m.style.setProperty("background","rgba(0, 0, 0, 0.8)"),m.style.setProperty("color","white"),m.style.setProperty("font-family","monospace"),m.style.setProperty("font-size","12px"),m.style.setProperty("border-radius","4px"),m.style.setProperty("z-index","9999"),m.style.setProperty("pointer-events","none"),d(H,i,null),d(G,()=>s().length,null),d(ee,L,null),d(m,(()=>{var te=ae(()=>{var W;return!!((W=a())!=null&&W.isDragging)});return()=>te()&&(()=>{var W=Ul(),Ee=W.firstChild,ve=Ee.nextSibling;return ve.nextSibling,W.style.setProperty("color","#ffeb3b"),d(W,()=>{var Te;return(Te=a())==null?void 0:Te.elementIds.length},ve),W})()})(),null),d(m,(()=>{var te=ae(()=>s().length>0);return()=>te()&&(()=>{var W=Ll(),Ee=W.firstChild,ve=Ee.nextSibling;return ve.nextSibling,W.style.setProperty("font-size","10px"),W.style.setProperty("color","#ccc"),d(W,()=>s().slice(0,3).join(", "),ve),d(W,()=>s().length>3&&"...",ve),W})()})(),null),m})()})(),null),c})()};Se(["mousedown"]);var Ml=C("<div class=toolbar-section><div class=section-title>智能建议</div><button class=smart-align-button><div class=smart-icon>🎯</div><div class=smart-text></div></button><div class=smart-reason>"),Tl=C("<div class=toolbar-status><div class=status-text>选择至少2个元素以使用对齐功能"),Rl=C('<div class=toolbar-status><div class="status-text aligning"><div class=spinner></div>正在执行对齐操作...'),Fl=C('<div class=alignment-toolbar><div class=toolbar-section><div class=section-title>对齐</div><div class=button-group><button class="align-button left"title=左对齐><div class=align-icon><div class="line left-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button h-center"title=水平居中对齐><div class=align-icon><div class="line center-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button right"title=右对齐><div class=align-icon><div class="line right-line"></div><div class=shapes><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>垂直对齐</div><div class=button-group><button class="align-button top"title=顶部对齐><div class="align-icon vertical"><div class="line top-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button v-center"title=垂直居中对齐><div class="align-icon vertical"><div class="line v-center-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button><button class="align-button bottom"title=底部对齐><div class="align-icon vertical"><div class="line bottom-line"></div><div class="shapes vertical"><div class=shape></div><div class=shape></div><div class=shape></div></div></div></button></div></div><div class=toolbar-section><div class=section-title>分布</div><div class=button-group><button class="align-button distribute-h"title=水平均匀分布><div class=align-icon><div class="shapes distribute"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape></div></div></div></button><button class="align-button distribute-v"title=垂直均匀分布><div class="align-icon vertical"><div class="shapes distribute vertical"><div class=shape></div><div class=spacer></div><div class=shape></div><div class=spacer></div><div class=shape>');const Ol=(e,t)=>{if(e.length<2)return[];const o=e.map(n=>({x:n.position.x,y:n.position.y,width:n.size.width,height:n.size.height}));return o.map((n,l)=>{let i=n.x,r=n.y;switch(t){case"left":i=Math.min(...o.map(g=>g.x));break;case"right":i=Math.max(...o.map(g=>g.x+g.width))-n.width;break;case"top":r=Math.min(...o.map(g=>g.y));break;case"bottom":r=Math.max(...o.map(g=>g.y+g.height))-n.height;break;case"h_center":i=o.reduce((g,$)=>g+$.x+$.width/2,0)/o.length-n.width/2;break;case"v_center":r=o.reduce((g,$)=>g+$.y+$.height/2,0)/o.length-n.height/2;break}return{element_id:e[l].id,new_position:{x:i,y:r}}})},Nl=e=>{const{batchUpdatePositions:t,state:o}=we(),[n,l]=Q(!1),i=()=>e.selectedElementIds().length>=2,r=()=>{const f=e.selectedElementIds();return o.elements.filter(g=>f.includes(g.id))},s=async f=>{const g=r();if(g.length<2){console.warn("对齐功能需要至少2个元素");return}try{l(!0),console.log(`🎯 执行${f}对齐:`,g.length,"个元素");const $=Ol(g,f);await t($),console.log("✅ 对齐操作完成"),e.onAlignmentComplete&&e.onAlignmentComplete($)}catch($){console.error("❌ 对齐操作失败:",$)}finally{l(!1)}},h=()=>r().length<2?null:{recommended:"left",reason:"建议左对齐",results:[]},a=()=>h();return(()=>{var f=Fl(),g=f.firstChild,$=g.firstChild,j=$.nextSibling,E=j.firstChild,z=E.nextSibling,A=z.nextSibling,I=g.nextSibling,k=I.firstChild,p=k.nextSibling,L=p.firstChild,D=L.nextSibling,P=D.nextSibling,Y=I.nextSibling,q=Y.firstChild,Z=q.nextSibling,O=Z.firstChild,N=O.nextSibling;return E.$$click=()=>s("left"),z.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"h_center")}),z.$$click=()=>s("h_center"),A.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"right")}),A.$$click=()=>s("right"),L.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"top")}),L.$$click=()=>s("top"),D.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"v_center")}),D.$$click=()=>s("v_center"),P.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"bottom")}),P.$$click=()=>s("bottom"),O.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"distribute_h")}),O.$$click=()=>s("distribute_h"),N.addEventListener("mouseenter",()=>{var b;return(b=e.onAlignmentPreview)==null?void 0:b.call(e,"distribute_v")}),N.$$click=()=>s("distribute_v"),d(f,y(xe,{get when(){return ae(()=>!!i())()&&a()},get children(){var b=Ml(),T=b.firstChild,V=T.nextSibling,v=V.firstChild,_=v.nextSibling,U=V.nextSibling;return V.$$click=()=>s(a().recommended),d(_,()=>a().recommended==="left"&&"左对齐",null),d(_,()=>a().recommended==="right"&&"右对齐",null),d(_,()=>a().recommended==="top"&&"顶对齐",null),d(_,()=>a().recommended==="bottom"&&"底对齐",null),d(_,()=>a().recommended==="h_center"&&"水平居中",null),d(_,()=>a().recommended==="v_center"&&"垂直居中",null),d(U,()=>a().reason),M(R=>{var F=n(),X=a().reason;return F!==R.e&&(V.disabled=R.e=F),X!==R.t&&w(V,"title",R.t=X),R},{e:void 0,t:void 0}),b}}),null),d(f,y(xe,{get when(){return!i()},get children(){var b=Tl(),T=b.firstChild;return T.firstChild,d(T,()=>e.selectedElementIds().length<3&&"，至少3个元素以使用分布功能",null),b}}),null),d(f,y(xe,{get when(){return n()},get children(){return Rl()}}),null),M(b=>{var T=!i()||n(),V=!i()||n(),v=!i()||n(),_=!i()||n(),U=!i()||n(),R=!i()||n(),F=e.selectedElementIds().length<3||n(),X=e.selectedElementIds().length<3||n();return T!==b.e&&(E.disabled=b.e=T),V!==b.t&&(z.disabled=b.t=V),v!==b.a&&(A.disabled=b.a=v),_!==b.o&&(L.disabled=b.o=_),U!==b.i&&(D.disabled=b.i=U),R!==b.n&&(P.disabled=b.n=R),F!==b.s&&(O.disabled=b.s=F),X!==b.h&&(N.disabled=b.h=X),b},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),f})()},jl=`
.alignment-toolbar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: #f8f9fa;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  min-width: 280px;
}

.toolbar-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.button-group {
  display: flex;
  gap: 4px;
}

.align-button {
  width: 36px;
  height: 36px;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
}

.align-button:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
  transform: translateY(-1px);
}

.align-button:active:not(:disabled) {
  transform: translateY(0);
  background: #e5e7eb;
}

.align-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.align-icon {
  position: relative;
  width: 20px;
  height: 16px;
}

.align-icon.vertical {
  width: 16px;
  height: 20px;
}

.line {
  position: absolute;
  background: #3b82f6;
  z-index: 2;
}

.left-line, .right-line, .center-line {
  width: 2px;
  height: 16px;
  top: 0;
}

.left-line { left: 2px; }
.right-line { right: 2px; }
.center-line { left: 9px; }

.top-line, .bottom-line, .v-center-line {
  height: 2px;
  width: 16px;
  left: 0;
}

.top-line { top: 2px; }
.bottom-line { bottom: 2px; }
.v-center-line { top: 9px; }

.shapes {
  display: flex;
  gap: 2px;
  align-items: flex-start;
}

.shapes.vertical {
  flex-direction: column;
  height: 100%;
  align-items: flex-start;
}

.shapes.distribute {
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.shapes.distribute.vertical {
  height: 100%;
  width: auto;
}

.shape {
  width: 4px;
  height: 6px;
  background: #6b7280;
  border-radius: 1px;
}

.shapes.vertical .shape {
  width: 6px;
  height: 4px;
}

.spacer {
  width: 2px;
  height: 1px;
  background: #d1d5db;
}

.shapes.distribute.vertical .spacer {
  width: 1px;
  height: 2px;
}

.smart-align-button {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.smart-align-button:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.smart-align-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.smart-icon {
  font-size: 16px;
}

.smart-text {
  font-size: 14px;
  font-weight: 500;
}

.smart-reason {
  font-size: 11px;
  color: #6b7280;
  font-style: italic;
  margin-top: 4px;
}

.toolbar-status {
  padding: 8px;
  border-radius: 4px;
  background: #f3f4f6;
  border: 1px solid #d1d5db;
}

.status-text {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
}

.status-text.aligning {
  color: #3b82f6;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.spinner {
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.preview-info {
  padding: 6px 8px;
  background: #eff6ff;
  border: 1px solid #bfdbfe;
  border-radius: 4px;
}

.preview-text {
  font-size: 11px;
  color: #1d4ed8;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;if(typeof document<"u"){const e=document.createElement("style");e.textContent=jl,document.head.appendChild(e)}Se(["click"]);var Bl=C("<div>"),Hl=C('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class=block><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer></g><g class=resize-handles-layer>'),Gl=C("<span class=ml-2>Zoom: <!>%");const Kl=()=>{const{state:e,selectElement:t,clearSelection:o,createElement:n,selectMultiple:l,updateElement:i,batchUpdatePositions:r}=we();let s;const[h,a]=Q([]),f=ie(()=>e.elements.filter(p=>p.visible)),g=(p,L)=>{if(!s)return{x:0,y:0};const D=s.getBoundingClientRect(),P=(p-D.left)/e.canvas_config.zoom,Y=(L-D.top)/e.canvas_config.zoom;return{x:P,y:Y}},$=async p=>{console.log("🎯 选择元素",p),a([...p]);try{p.length===0?await o():p.length===1?await t(p[0]):await l([...p])}catch(L){console.error("❌ 选择元素失败:",L)}},j=async p=>{try{await r(p)}catch(L){console.error("❌ 批量更新位置失败:",L)}},E=async(p,L)=>{try{await i(p,{position:{x:L.x,y:L.y}})}catch(D){console.error("❌ 移动元素失败:",D)}},z=async(p,L,D)=>{try{await i(p,{size:L,position:D})}catch(P){console.error("❌ 调整大小失败:",P)}},A=async p=>{console.log("🖱️ 画布点击",p)},I=async p=>{var L;p.preventDefault();try{const D=(L=p.dataTransfer)==null?void 0:L.getData("application/json");if(!D)return;const{type:P,component:Y}=JSON.parse(D);if(P==="component"){const{x:q,y:Z}=g(p.clientX,p.clientY),O=Math.max(0,q-Y.default_size.width/2),N=Math.max(0,Z-Y.default_size.height/2);console.log("🎯 通过拖放创建组件:",Y.name,"at",O,N);const b=await n(Y.id,{x:O,y:N},Y.default_size,Y.create_content());console.log("✅ 通过拖放创建元素成功:",b),a([b]),await t(b)}}catch(D){console.error("拖放处理失败:",D)}};He(()=>{a([...e.selected_ids])}),ie(()=>{a([...e.selected_ids])});const k=ie(()=>{const{width:p,height:L}=e.canvas_config;return`0 0 ${p} ${L}`});return(()=>{var p=Hl(),L=p.firstChild,D=L.firstChild,P=D.firstChild,Y=P.nextSibling,q=Y.nextSibling,Z=q.nextSibling,O=Z.nextSibling,N=O.nextSibling,b=N.firstChild,T=b.nextSibling;T.nextSibling;var V=L.nextSibling,v=V.firstChild,_=v.firstChild,U=_.firstChild,R=U.firstChild,F=R.nextSibling,X=F.nextSibling,he=X.nextSibling;d(D,()=>e.canvas_config.width,Y),d(D,()=>e.canvas_config.height,Z),d(D,(()=>{var B=ae(()=>e.canvas_config.zoom!==1);return()=>B()&&(()=>{var re=Gl(),ue=re.firstChild,fe=ue.nextSibling;return fe.nextSibling,d(re,()=>Math.round(e.canvas_config.zoom*100),fe),re})()})(),N),d(N,()=>e.elements.length,T),d(N,()=>h().length,null),_.style.setProperty("position","relative"),U.addEventListener("drop",I),U.addEventListener("dragover",B=>{B.preventDefault(),B.dataTransfer.dropEffect="copy"}),U.$$contextmenu=B=>B.preventDefault();var se=s;return typeof se=="function"?At(se,U):s=U,d(U,y(hl,{get config(){return e.canvas_config}}),F),d(X,y(ze,{get each(){return f()},children:B=>y(kl,{element:B,get selected(){return h().includes(B.id)}})})),d(he,y(ze,{get each(){return f().filter(B=>h().includes(B.id))},children:B=>y(El,{element:B})})),d(_,y(Dl,{canvasRef:s,getAllElements:()=>[...e.elements],onElementsSelect:$,onElementMove:E,onBatchUpdatePositions:j,onElementResize:z,onCanvasClick:A,get enableDebugMode(){return!1}}),null),d(_,y(xe,{get when(){return h().length>=2},get children(){var B=Bl();return B.style.setProperty("position","fixed"),B.style.setProperty("top","80px"),B.style.setProperty("right","20px"),B.style.setProperty("z-index","1000"),B.style.setProperty("background","white"),B.style.setProperty("border-radius","8px"),B.style.setProperty("box-shadow","0 4px 12px rgba(0, 0, 0, 0.15)"),B.style.setProperty("border","1px solid #e5e7eb"),d(B,y(Nl,{selectedElementIds:h,onAlignmentComplete:re=>{console.log("✅ 对齐操作完成:",re)},onAlignmentPreview:re=>{console.log("👁️ 对齐预览:",re)},onPreviewCancel:()=>{console.log("❌ 取消对齐预览")}})),B}}),null),M(B=>{var re=e.canvas_config.width*e.canvas_config.zoom,ue=e.canvas_config.height*e.canvas_config.zoom,fe=k(),ge=e.canvas_config.width,Ce=e.canvas_config.height,_e=e.canvas_config.background_color,Ke=e.canvas_config.width,Ve=e.canvas_config.height;return re!==B.e&&w(U,"width",B.e=re),ue!==B.t&&w(U,"height",B.t=ue),fe!==B.a&&w(U,"viewBox",B.a=fe),ge!==B.o&&w(R,"width",B.o=ge),Ce!==B.i&&w(R,"height",B.i=Ce),_e!==B.n&&w(R,"fill",B.n=_e),Ke!==B.s&&w(F,"width",B.s=Ke),Ve!==B.h&&w(F,"height",B.h=Ve),B},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),p})()};Se(["contextmenu"]);var Vl=C('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),ql=C('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Wl=C('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),Xl=C('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Yl=C('<div class="text-xs text-gray-500 p-2">暂无元素');const Zl=()=>{const{state:e,createElement:t,selectElement:o,clearSelection:n}=we(),[l,i]=Q(!1),r=[{name:"创建文字元素",action:async()=>{const f=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",f),f}},{name:"创建矩形元素",action:async()=>{const f=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",f),f}},{name:"创建线条元素",action:async()=>{const f=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",f),f}},{name:"创建数据字段",action:async()=>{const f=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",f),f}}],s=async f=>{try{console.log(`🧪 开始测试: ${f.name}`);const g=await f.action();await o(g),console.log(`✅ 测试完成: ${f.name}, 元素ID: ${g}`)}catch(g){console.error(`❌ 测试失败: ${f.name}`,g)}},h=async()=>{console.log("🚀 开始运行所有测试案例..."),await n();for(const f of r)await s(f),await new Promise(g=>setTimeout(g,500));console.log("🎉 所有测试案例运行完成!")},a=async()=>{try{console.log("🧹 清理所有测试元素..."),await n(),console.log("✅ 清理完成")}catch(f){console.error("❌ 清理失败:",f)}};return[(()=>{var f=Vl();return f.$$click=()=>i(!l()),f})(),ae(()=>ae(()=>!!l())()&&(()=>{var f=ql(),g=f.firstChild,$=g.firstChild,j=$.nextSibling,E=g.nextSibling,z=E.firstChild,A=z.firstChild,I=A.firstChild,k=I.nextSibling,p=A.nextSibling,L=p.firstChild,D=L.nextSibling,P=p.nextSibling,Y=P.firstChild,q=Y.nextSibling,Z=P.nextSibling,O=Z.firstChild,N=O.nextSibling,b=E.nextSibling,T=b.firstChild,V=T.nextSibling,v=b.nextSibling;v.firstChild;var _=v.nextSibling,U=_.firstChild,R=U.nextSibling;return j.$$click=()=>i(!1),d(k,()=>e.elements.length),d(D,()=>e.selected_ids.length),d(q,()=>e.can_undo?"是":"否"),d(N,()=>e.can_redo?"是":"否"),T.$$click=h,V.$$click=a,d(v,y(ze,{each:r,children:F=>(()=>{var X=Wl();return X.$$click=()=>s(F),d(X,()=>F.name),X})()}),null),d(R,y(ze,{get each(){return e.elements},children:F=>(()=>{var X=Xl(),he=X.firstChild,se=he.nextSibling,B=se.firstChild,re=B.nextSibling;re.nextSibling;var ue=se.nextSibling,fe=ue.firstChild,ge=fe.nextSibling,Ce=ge.nextSibling,_e=Ce.nextSibling;return _e.nextSibling,X.$$click=()=>o(F.id),d(he,()=>F.content.type),d(se,()=>F.id.slice(0,8),re),d(ue,()=>Math.round(F.position.x),ge),d(ue,()=>Math.round(F.position.y),_e),M(()=>Ue(X,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(F.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),X})()}),null),d(R,(()=>{var F=ae(()=>e.elements.length===0);return()=>F()&&Yl()})(),null),f})())]};Se(["click"]);var Jl=C('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const Ql=()=>(()=>{var e=Jl(),t=e.firstChild,o=t.firstChild,n=o.nextSibling,l=n.nextSibling;return d(e,y(Cn,{}),t),d(o,y(Pn,{})),d(n,y(Kl,{})),d(l,y(ll,{})),d(e,y(Zl,{}),null),e})(),ei={copy:{action:"copy",combination:{key:"c",ctrl:!0}},paste:{action:"paste",combination:{key:"v",ctrl:!0}},cut:{action:"cut",combination:{key:"x",ctrl:!0}},delete:{action:"delete",combination:{key:"Delete"}},deleteAlt:{action:"delete",combination:{key:"Backspace"}},undo:{action:"undo",combination:{key:"z",ctrl:!0}},redo:{action:"redo",combination:{key:"y",ctrl:!0}},redoAlt:{action:"redo",combination:{key:"z",ctrl:!0,shift:!0}},selectAll:{action:"selectAll",combination:{key:"a",ctrl:!0}},clearSelection:{action:"clearSelection",combination:{key:"Escape"}},duplicate:{action:"duplicate",combination:{key:"d",ctrl:!0}},moveUp:{action:"moveUp",combination:{key:"ArrowUp"}},moveDown:{action:"moveDown",combination:{key:"ArrowDown"}},moveLeft:{action:"moveLeft",combination:{key:"ArrowLeft"}},moveRight:{action:"moveRight",combination:{key:"ArrowRight"}},moveFastUp:{action:"moveFastUp",combination:{key:"ArrowUp",shift:!0}},moveFastDown:{action:"moveFastDown",combination:{key:"ArrowDown",shift:!0}},moveFastLeft:{action:"moveFastLeft",combination:{key:"ArrowLeft",shift:!0}},moveFastRight:{action:"moveFastRight",combination:{key:"ArrowRight",shift:!0}}},ti=()=>{const{state:e,copySelectedElements:t,pasteElements:o,deleteElements:n,undo:l,redo:i,selectAllElements:r,clearSelection:s,moveElements:h}=we(),a=(E,z)=>{const A=E.key.toLowerCase()===z.key.toLowerCase()||E.key===z.key,I=!!z.ctrl===(E.ctrlKey||E.metaKey),k=!!z.alt===E.altKey,p=!!z.shift===E.shiftKey;return A&&I&&k&&p},f=async E=>{console.log("🎯 执行快捷键:",E);try{switch(E){case"copy":e.selected_ids.length>0&&(await t(),$("复制成功","✅"));break;case"paste":const z={x:20,y:20},A=await o(z.x,z.y);A.length>0&&$(`粘贴 ${A.length} 个元素`,"📋");break;case"cut":e.selected_ids.length>0&&(await t(),await n([...e.selected_ids]),$("剪切成功","✂️"));break;case"delete":if(e.selected_ids.length>0){const I=e.selected_ids.length;await n([...e.selected_ids]),$(`删除 ${I} 个元素`,"🗑️")}break;case"undo":await l(),$("撤销","↶");break;case"redo":await i(),$("重做","↷");break;case"selectAll":await r(),$(`全选 ${e.elements.length} 个元素`,"🎯");break;case"clearSelection":e.selected_ids.length>0&&(s(),$("清除选择","⭕"));break;case"duplicate":if(e.selected_ids.length>0){await t();const I=await o(20,20);$(`复制 ${I.length} 个元素`,"📄")}break;case"moveUp":case"moveDown":case"moveLeft":case"moveRight":case"moveFastUp":case"moveFastDown":case"moveFastLeft":case"moveFastRight":await g(E);break;default:console.warn("未知的快捷键动作:",E)}}catch(z){console.error("快捷键执行失败:",z),$("操作失败","❌")}},g=async E=>{if(e.selected_ids.length===0)return;const z=E.includes("Fast"),A=z?10:1;let I=0,k=0;switch(E){case"moveUp":case"moveFastUp":k=-A;break;case"moveDown":case"moveFastDown":k=A;break;case"moveLeft":case"moveFastLeft":I=-A;break;case"moveRight":case"moveFastRight":I=A;break}(I!==0||k!==0)&&(await h([...e.selected_ids],I,k),z&&$(`快速移动 ${A}px`,"🔄"))},$=(E,z)=>{const A=document.createElement("div");A.className="keyboard-feedback",A.innerHTML=`
      <div class="feedback-content">
        <span class="feedback-icon">${z}</span>
        <span class="feedback-text">${E}</span>
      </div>
    `,document.body.appendChild(A),setTimeout(()=>{A.parentNode&&A.parentNode.removeChild(A)},2e3)},j=E=>{const z=E.target;if(!(z.tagName==="INPUT"||z.tagName==="TEXTAREA"||z.contentEditable==="true")){for(const[I,k]of Object.entries(ei))if(a(E,k.combination)){E.preventDefault(),E.stopPropagation(),console.log("🎹 快捷键触发:",I,k.action),f(k.action);return}}};return He(()=>{if(document.addEventListener("keydown",j,!0),console.log("🎹 键盘快捷键管理器已启动"),!document.getElementById("keyboard-feedback-styles")){const E=document.createElement("style");E.id="keyboard-feedback-styles",E.textContent=`
        .keyboard-feedback {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          z-index: 10000;
          animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 1.7s;
          pointer-events: none;
        }

        .feedback-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feedback-icon {
          font-size: 16px;
        }

        .feedback-text {
          font-size: 14px;
          font-weight: 500;
        }

        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes fadeOut {
          from {
            opacity: 1;
          }
          to {
            opacity: 0;
          }
        }
      `,document.head.appendChild(E)}}),it(()=>{document.removeEventListener("keydown",j,!0),console.log("🎹 键盘快捷键管理器已停止")}),null},ni=()=>(He(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),y(wn,{get children(){return[y(ti,{}),y(Ql,{})]}})),li=document.getElementById("root");hn(()=>y(ni,{}),li);
