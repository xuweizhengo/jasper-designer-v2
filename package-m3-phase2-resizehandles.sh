#!/bin/bash

# M3 Phase 2 - ResizeHandlesåŠŸèƒ½æµ‹è¯•ç‰ˆæœ¬æ‰“åŒ…è„šæœ¬
# åŒ…å«å®Œæ•´çš„å…ƒç´ è°ƒæ•´å¤§å°åŠŸèƒ½

echo "ðŸŽ¯ åˆ›å»º M3 Phase 2 ResizeHandles æµ‹è¯•åŒ…"
echo "=================================="

# åˆ›å»ºæ—¶é—´æˆ³
TIMESTAMP=$(date +"%Y%m%d-%H%M%S")
PACKAGE_NAME="jasper-designer-M3-Phase2-ResizeHandles-${TIMESTAMP}"
PACKAGE_DIR="builds/windows/${PACKAGE_NAME}"

echo "ðŸ“¦ åŒ…å: ${PACKAGE_NAME}"
echo "ðŸ“ ç›®å½•: ${PACKAGE_DIR}"

# åˆ›å»ºæž„å»ºç›®å½•
mkdir -p "${PACKAGE_DIR}"

# å¤åˆ¶Windowså¯æ‰§è¡Œæ–‡ä»¶
echo "ðŸ“‹ å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶..."
cp "src-tauri/target/x86_64-pc-windows-gnu/release/jasper-designer.exe" "${PACKAGE_DIR}/"
cp "src-tauri/target/x86_64-pc-windows-gnu/release/WebView2Loader.dll" "${PACKAGE_DIR}/"

# å¤åˆ¶å‰ç«¯èµ„æº
echo "ðŸ“‹ å¤åˆ¶å‰ç«¯èµ„æº..."
cp -r dist/* "${PACKAGE_DIR}/"

# å¤åˆ¶å›¾æ ‡
echo "ðŸ“‹ å¤åˆ¶å›¾æ ‡..."
mkdir -p "${PACKAGE_DIR}/icons"
cp src-tauri/icons/* "${PACKAGE_DIR}/icons/" 2>/dev/null || echo "å›¾æ ‡å¤åˆ¶è·³è¿‡"

# åˆ›å»ºå¯åŠ¨è„šæœ¬
echo "ðŸ“‹ åˆ›å»ºå¯åŠ¨è„šæœ¬..."
cat > "${PACKAGE_DIR}/run-jasper.bat" << 'EOF'
@echo off
title Jasper Designer V2 - M3 Phase 2 ResizeHandles æµ‹è¯•ç‰ˆ
echo ============================================
echo ðŸŽ¯ Jasper Designer V2 - M3 Phase 2 æµ‹è¯•ç‰ˆ
echo ============================================
echo.
echo âœ¨ æ–°åŠŸèƒ½æµ‹è¯•ç‰ˆæœ¬ç‰¹æ€§:
echo    - âœ… M1: åŸºç¡€ç¨³å®š (TypeScripté›¶é”™è¯¯æž„å»º)
echo    - âœ… M2: æ ¸å¿ƒäº¤äº’ (é€‰æ‹©ã€æ‹–æ‹½ã€æ¡†é€‰)
echo    - âœ… M3 Phase 1: å±žæ€§é¢æ¿å®Œå–„
echo    - ðŸ”¥ M3 Phase 2: å…ƒç´ è°ƒæ•´å¤§å°åŠŸèƒ½ (æ–°!)
echo.
echo ðŸŽ® ResizeHandles åŠŸèƒ½æµ‹è¯•:
echo    â€¢ é€‰æ‹©å…ƒç´ æ˜¾ç¤º8ä¸ªè°ƒæ•´æŽ§åˆ¶ç‚¹
echo    â€¢ æ‹–æ‹½è§’æŽ§åˆ¶ç‚¹è°ƒæ•´å®½åº¦å’Œé«˜åº¦  
echo    â€¢ æ‹–æ‹½è¾¹æŽ§åˆ¶ç‚¹å•å‘è°ƒæ•´
echo    â€¢ Shift+æ‹–æ‹½ç­‰æ¯”ä¾‹ç¼©æ”¾
echo    â€¢ Alt+æ‹–æ‹½ä»Žä¸­å¿ƒç‚¹ç¼©æ”¾
echo    â€¢ 20pxæœ€å°å°ºå¯¸ä¿æŠ¤
echo.
echo ðŸš€ å¯åŠ¨åº”ç”¨ç¨‹åº...
echo.
start "" "jasper-designer.exe"
EOF

# åˆ›å»ºè¯¦ç»†è¯´æ˜Žæ–‡æ¡£
cat > "${PACKAGE_DIR}/M3-PHASE2-README.md" << 'EOF'
# ðŸŽ¯ Jasper Designer V2 - M3 Phase 2 ResizeHandles æµ‹è¯•ç‰ˆ

**ç‰ˆæœ¬**: M3 Phase 2 - å…ƒç´ è°ƒæ•´å¤§å°åŠŸèƒ½  
**æž„å»ºæ—¶é—´**: 2025-08-10  
**çŠ¶æ€**: âœ… ResizeHandlesåŠŸèƒ½å®Œå…¨å®žçŽ°  

## ðŸŽ® æ ¸å¿ƒæ–°åŠŸèƒ½

### ðŸ”¥ å…ƒç´ è°ƒæ•´å¤§å°ç³»ç»Ÿ
- **8ä¸ªè°ƒæ•´æŽ§åˆ¶ç‚¹**: å››è§’æŽ§åˆ¶ç‚¹ + å››è¾¹ä¸­ç‚¹ï¼Œå…¨é¢æŽ§åˆ¶
- **æ™ºèƒ½æ‹–æ‹½ä½“éªŒ**: ä¸“ä¸šå…‰æ ‡åé¦ˆï¼Œç¬¦åˆè®¾è®¡è½¯ä»¶æ ‡å‡†
- **ç­‰æ¯”ä¾‹ç¼©æ”¾**: Shift+æ‹–æ‹½ä¿æŒå®½é«˜æ¯”ä¸å˜
- **ä¸­å¿ƒç‚¹ç¼©æ”¾**: Alt+æ‹–æ‹½ä»Žå…ƒç´ ä¸­å¿ƒå¯¹ç§°ç¼©æ”¾
- **æœ€å°å°ºå¯¸ä¿æŠ¤**: 20x20pxæœ€å°å°ºå¯¸ï¼Œé˜²æ­¢å…ƒç´ è¿‡å°

### âœ¨ ä¸“ä¸šäº¤äº’ä½“éªŒ
- **ç²¾ç¡®æŽ§åˆ¶**: 8ç§æ–¹å‘çš„ä¸“ä¸šè°ƒæ•´å…‰æ ‡
- **è§†è§‰åé¦ˆ**: æŽ§åˆ¶ç‚¹æ‚¬åœæ”¾å¤§æ•ˆæžœ
- **çŠ¶æ€åè°ƒ**: è°ƒæ•´å¤§å°æ—¶æš‚åœå…¶ä»–äº¤äº’ï¼Œé¿å…å†²çª
- **å®žæ—¶æ›´æ–°**: 50msèŠ‚æµä¼˜åŒ–ï¼Œç¡®ä¿æµç•…æ€§

## ðŸ§ª æµ‹è¯•æŒ‡å—

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
1. **åˆ›å»ºå…ƒç´ **: ä»Žå·¦ä¾§ç»„ä»¶åº“æ‹–æ‹½åˆ›å»ºæ–‡å­—ã€çŸ©å½¢ã€çº¿æ¡
2. **é€‰æ‹©å…ƒç´ **: ç‚¹å‡»å…ƒç´ ï¼Œè§‚å¯Ÿ8ä¸ªè“è‰²è°ƒæ•´æŽ§åˆ¶ç‚¹
3. **è°ƒæ•´å¤§å°**: æ‹–æ‹½æŽ§åˆ¶ç‚¹è°ƒæ•´å…ƒç´ å°ºå¯¸

### é«˜çº§åŠŸèƒ½æµ‹è¯•  
4. **ç­‰æ¯”ä¾‹ç¼©æ”¾**: æŒ‰ä½Shift + æ‹–æ‹½è§’æŽ§åˆ¶ç‚¹
5. **ä¸­å¿ƒç¼©æ”¾**: æŒ‰ä½Alt + æ‹–æ‹½è§’æŽ§åˆ¶ç‚¹  
6. **è¾¹ç¼˜è°ƒæ•´**: æ‹–æ‹½è¾¹æŽ§åˆ¶ç‚¹å•å‘è°ƒæ•´å®½åº¦æˆ–é«˜åº¦
7. **æœ€å°å°ºå¯¸**: å°è¯•ç¼©å°åˆ°æžå°ï¼ŒéªŒè¯20pxé™åˆ¶

### äº¤äº’åè°ƒæµ‹è¯•
8. **çŠ¶æ€åè°ƒ**: è°ƒæ•´å¤§å°æ—¶ï¼Œé€‰æ‹©åŠŸèƒ½åº”è¯¥æš‚åœ
9. **å…‰æ ‡åé¦ˆ**: æ‚¬åœæŽ§åˆ¶ç‚¹è§‚å¯Ÿå…‰æ ‡å˜åŒ–
10. **å®Œæˆæµ‹è¯•**: è°ƒæ•´ç»“æŸåŽï¼Œæ‰€æœ‰äº¤äº’æ¢å¤æ­£å¸¸

## ðŸ“Š æŠ€æœ¯äº®ç‚¹

### ç®—æ³•éªŒè¯ âœ…
- 6/6 æ ¸å¿ƒç®—æ³•æµ‹è¯•å…¨éƒ¨é€šè¿‡
- æ•°å­¦è®¡ç®—ç²¾ç¡®åˆ°0.1px
- å®Œå–„çš„è¾¹ç•Œæ£€æŸ¥å’Œé”™è¯¯å¤„ç†

### æ€§èƒ½ä¼˜åŒ– âœ…  
- 50msèŠ‚æµæ›´æ–°æœºåˆ¶
- çŠ¶æ€åè°ƒé¿å…å†²çª
- å†…å­˜å’ŒCPUä½¿ç”¨ä¼˜åŒ–

### ä»£ç è´¨é‡ âœ…
- TypeScripté›¶é”™è¯¯æž„å»º
- 325è¡Œä¸“ä¸šResizeHandlesç»„ä»¶
- å®Œæ•´çš„äº‹ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ðŸŽ¯ å¼€å‘çŠ¶æ€

### å·²å®Œæˆé‡Œç¨‹ç¢‘
- âœ… **M1**: Foundation Stability (åŸºç¡€ç¨³å®š)
- âœ… **M2**: Core Interactions (æ ¸å¿ƒäº¤äº’)  
- âœ… **M3 Phase 1**: å±žæ€§é¢æ¿å®Œå–„
- âœ… **M3 Phase 2**: å…ƒç´ è°ƒæ•´å¤§å°åŠŸèƒ½

### æ•´ä½“è¿›åº¦
**M3æ€»è¿›åº¦**: 56% (2/4é˜¶æ®µå®Œæˆ)  
**é¡¹ç›®æ€»è¿›åº¦**: ~70% (æ ¸å¿ƒåŠŸèƒ½åŸºæœ¬å®Œæˆ)

### ä¸‹ä¸€æ­¥è®¡åˆ’
- **M3 Phase 3**: å¯¹é½å’Œåˆ†å¸ƒå·¥å…·
- **M3 Phase 4**: ç¾¤ç»„å’Œå³é”®èœå•
- **M4**: ç»„ä»¶ç”Ÿæ€å®Œå–„

## ðŸŽ‰ æµ‹è¯•åé¦ˆ

å¦‚æžœå‘çŽ°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·è®°å½•ï¼š
- å…·ä½“æ“ä½œæ­¥éª¤
- é¢„æœŸè¡Œä¸º vs å®žé™…è¡Œä¸º  
- æµè§ˆå™¨æŽ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
- æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨ç‰ˆæœ¬

**ResizeHandlesåŠŸèƒ½æ˜¯è®¾è®¡è½¯ä»¶çš„æ ¸å¿ƒåŸºç¡€åŠŸèƒ½ï¼ŒæœŸå¾…æ‚¨çš„æµ‹è¯•åé¦ˆï¼** ðŸš€

---
**æ‰“åŒ…æ—¶é—´**: $(date)  
**æž„å»ºçŽ¯å¢ƒ**: Linux + Rust + TypeScript + Vite
EOF

# åˆ›å»ºåŽ‹ç¼©åŒ…
echo "ðŸ“¦ åˆ›å»ºåŽ‹ç¼©åŒ…..."
cd builds/windows/
tar -czf "${PACKAGE_NAME}.tar.gz" "${PACKAGE_NAME}/"
cd ../../

# èŽ·å–æ–‡ä»¶å¤§å°
PACKAGE_SIZE=$(du -sh "builds/windows/${PACKAGE_NAME}" | cut -f1)
ARCHIVE_SIZE=$(du -sh "builds/windows/${PACKAGE_NAME}.tar.gz" | cut -f1)

echo ""
echo "ðŸŽ‰ M3 Phase 2 ResizeHandles æµ‹è¯•åŒ…åˆ›å»ºå®Œæˆ!"
echo "=============================================="
echo "ðŸ“ åŒ…ç›®å½•: builds/windows/${PACKAGE_NAME}"
echo "ðŸ“¦ åŽ‹ç¼©åŒ…: builds/windows/${PACKAGE_NAME}.tar.gz"
echo "ðŸ“ åŒ…å¤§å°: ${PACKAGE_SIZE}"
echo "ðŸ“¦ åŽ‹ç¼©åŽ: ${ARCHIVE_SIZE}"
echo ""
echo "ðŸŽ¯ æ–°åŠŸèƒ½äº®ç‚¹:"
echo "âœ¨ 8ä¸ªè°ƒæ•´æŽ§åˆ¶ç‚¹ - å››è§’+å››è¾¹å®Œæ•´æŽ§åˆ¶"
echo "âœ¨ Shiftç­‰æ¯”ä¾‹ç¼©æ”¾ - ä¸“ä¸šè®¾è®¡è½¯ä»¶æ ‡å‡†"
echo "âœ¨ Altä¸­å¿ƒç‚¹ç¼©æ”¾ - å¯¹ç§°è°ƒæ•´åŠŸèƒ½"
echo "âœ¨ 20pxæœ€å°å°ºå¯¸ä¿æŠ¤ - é˜²æ­¢å…ƒç´ è¿‡å°"
echo "âœ¨ å®Œç¾Žçš„äº¤äº’çŠ¶æ€åè°ƒ - æ— å†²çªä½“éªŒ"
echo ""
echo "ðŸš€ è§£åŽ‹å¹¶è¿è¡Œ run-jasper.bat å¼€å§‹æµ‹è¯•!"