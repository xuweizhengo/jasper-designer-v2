#!/bin/bash

# åˆ›å»ºç®€åŒ–ç‰ˆæœ¬çš„Windowsæ‰“åŒ…
TIMESTAMP=$(date +"%Y%m%d-%H%M%S")
PACKAGE_NAME="jasper-designer-v2-ALIGNMENT-FEATURE-$TIMESTAMP"
PACKAGE_DIR="builds/windows/$PACKAGE_NAME"

echo "ðŸš€ å¼€å§‹æž„å»ºå¯¹é½åˆ†å¸ƒåŠŸèƒ½ç‰ˆæœ¬..."
echo "ðŸ“¦ åŒ…å: $PACKAGE_NAME"

# åˆ›å»ºåŒ…ç›®å½•
mkdir -p "$PACKAGE_DIR"

echo "ðŸ“ åˆ›å»ºåŒ…ç›®å½•: $PACKAGE_DIR"

# å¤åˆ¶å‰ç«¯æž„å»ºäº§ç‰©
if [ -d "dist" ]; then
    cp -r dist/* "$PACKAGE_DIR/"
    echo "âœ… å¤åˆ¶å‰ç«¯èµ„æºå®Œæˆ"
else
    echo "âŒ å‰ç«¯distç›®å½•ä¸å­˜åœ¨"
    exit 1
fi

# å°è¯•ä½¿ç”¨çŽ°æœ‰çš„exeæ–‡ä»¶ (ä¿®å¤æ–‡ä»¶å)
if [ -f "src-tauri/target/x86_64-pc-windows-gnu/release/jasper-designer.exe" ]; then
    cp "src-tauri/target/x86_64-pc-windows-gnu/release/jasper-designer.exe" "$PACKAGE_DIR/jasper-designer.exe"
    echo "âœ… å¤åˆ¶çŽ°æœ‰exeæ–‡ä»¶ (è·¨å¹³å°ç¼–è¯‘ç‰ˆæœ¬)"
elif [ -f "src-tauri/target/release/jasper-designer.exe" ]; then
    cp "src-tauri/target/release/jasper-designer.exe" "$PACKAGE_DIR/jasper-designer.exe"
    echo "âœ… å¤åˆ¶æœ¬åœ°exeæ–‡ä»¶"
else
    echo "âš ï¸ æœªæ‰¾åˆ°exeæ–‡ä»¶ï¼Œåˆ›å»ºå ä½ç¬¦..."
    echo "# Jasper Designer executable placeholder" > "$PACKAGE_DIR/jasper-designer.exe"
fi

# å¤åˆ¶WebView2Loader.dllï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
if [ -f "src-tauri/target/x86_64-pc-windows-gnu/release/WebView2Loader.dll" ]; then
    cp "src-tauri/target/x86_64-pc-windows-gnu/release/WebView2Loader.dll" "$PACKAGE_DIR/"
    echo "âœ… å¤åˆ¶WebView2Loader.dll"
fi

# å¤åˆ¶å›¾æ ‡
if [ -d "src-tauri/icons" ]; then
    mkdir -p "$PACKAGE_DIR/icons"
    cp src-tauri/icons/* "$PACKAGE_DIR/icons/"
    echo "âœ… å¤åˆ¶å›¾æ ‡æ–‡ä»¶"
fi

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > "$PACKAGE_DIR/run-alignment-feature.bat" << 'EOF'
@echo off
title Jasper Designer V2 - å¯¹é½åˆ†å¸ƒåŠŸèƒ½ç‰ˆæœ¬
echo ========================================
echo ðŸŽ¯ Jasper Designer V2 - å¯¹é½åˆ†å¸ƒåŠŸèƒ½ç‰ˆæœ¬
echo ========================================
echo.
echo âœ¨ æœ¬ç‰ˆæœ¬æ–°å¢žåŠŸèƒ½:
echo    â”œâ”€ ðŸŽ¯ å®Œæ•´çš„å¯¹é½åˆ†å¸ƒåŠŸèƒ½
echo    â”œâ”€ ðŸ–±ï¸ 8ç§å¯¹é½æ–¹å¼æ”¯æŒ
echo    â”œâ”€ ðŸ“ æ™ºèƒ½å¯¹é½å»ºè®®ç³»ç»Ÿ
echo    â”œâ”€ ðŸ‘ï¸ å®žæ—¶é¢„è§ˆæ•ˆæžœ
echo    â”œâ”€ âŒ¨ï¸ é”®ç›˜å¿«æ·é”®æ”¯æŒ
echo    â””â”€ ðŸ”§ çŽ°ä»£åŒ–ç¼“å­˜æž¶æž„
echo.
echo ðŸ”§ ç¼“å­˜ç³»ç»Ÿå‡çº§:
echo    â”œâ”€ ðŸ“Š åˆ†å±‚ç¼“å­˜æž¶æž„
echo    â”œâ”€ âš¡ è‡ªåŠ¨å¤±æ•ˆç®¡ç†
echo    â”œâ”€ ðŸŽ­ å“åº”å¼æ›´æ–°
echo    â””â”€ ðŸ” å®Œæ•´è°ƒè¯•å·¥å…·
echo.
echo ðŸŽ® å¯¹é½åŠŸèƒ½:
echo    â”œâ”€ å·¦/å³/é¡¶/åº•å¯¹é½
echo    â”œâ”€ æ°´å¹³/åž‚ç›´å±…ä¸­å¯¹é½
echo    â”œâ”€ æ°´å¹³/åž‚ç›´å‡åŒ€åˆ†å¸ƒ
echo    â””â”€ æ™ºèƒ½ç®—æ³•æŽ¨èå¯¹é½
echo.
echo ðŸš€ å¯åŠ¨åº”ç”¨...
echo.
start "" "jasper-designer.exe"
EOF

# åˆ›å»ºåŠŸèƒ½è¯´æ˜Žæ–‡æ¡£
cat > "$PACKAGE_DIR/ALIGNMENT-FEATURES.md" << 'EOF'
# ðŸŽ¯ Jasper Designer V2 - å¯¹é½åˆ†å¸ƒåŠŸèƒ½ç‰ˆæœ¬

**ç‰ˆæœ¬**: v2.1.0-alignment  
**æž„å»ºæ—¶é—´**: 2025-08-11  
**çŠ¶æ€**: âœ… å¯¹é½åˆ†å¸ƒåŠŸèƒ½å®Œæ•´å®žçŽ°  

## ðŸŽ‰ æ–°åŠŸèƒ½äº®ç‚¹

### ðŸŽ¯ å®Œæ•´çš„å¯¹é½åˆ†å¸ƒç³»ç»Ÿ
- **8ç§å¯¹é½æ–¹å¼**: å·¦ã€å³ã€é¡¶ã€åº•ã€æ°´å¹³å±…ä¸­ã€åž‚ç›´å±…ä¸­ã€æ°´å¹³åˆ†å¸ƒã€åž‚ç›´åˆ†å¸ƒ
- **æ™ºèƒ½å¯¹é½å»ºè®®**: AIç®—æ³•åˆ†æžå…ƒç´ å¸ƒå±€ï¼Œè‡ªåŠ¨æŽ¨èæœ€ä½³å¯¹é½æ–¹å¼
- **å®žæ—¶é¢„è§ˆæ•ˆæžœ**: é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºå¯¹é½é¢„è§ˆï¼ŒåŒ…å«è¾…åŠ©çº¿å’Œç§»åŠ¨åŠ¨ç”»
- **æ‰¹é‡æ“ä½œä¼˜åŒ–**: ä¸€æ¬¡æ“ä½œå¤šä¸ªå…ƒç´ ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æ‰¹é‡ä½ç½®æ›´æ–°

### âš¡ çŽ°ä»£åŒ–ç¼“å­˜æž¶æž„
- **åˆ†å±‚ç¼“å­˜è®¾è®¡**: å‡ ä½•å±‚ã€äº¤äº’å±‚ã€å¯¹é½å±‚ç‹¬ç«‹ç®¡ç†
- **è‡ªåŠ¨ä¾èµ–è¿½è¸ª**: å…ƒç´ å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆç›¸å…³ç¼“å­˜
- **å“åº”å¼æ›´æ–°**: ä¸ŽSolid.jsæ·±åº¦é›†æˆï¼ŒçŠ¶æ€å˜åŒ–è‡ªåŠ¨æ›´æ–°
- **LRUæ·˜æ±°æœºåˆ¶**: å†…å­˜ä½¿ç”¨ä¼˜åŒ–ï¼Œé˜²æ­¢ç¼“å­˜è†¨èƒ€

### ðŸŽ® ç”¨æˆ·ä½“éªŒå‡çº§
- **é”®ç›˜å¿«æ·é”®**: 
  - `Ctrl+Shift+â†` å·¦å¯¹é½
  - `Ctrl+Shift+â†’` å³å¯¹é½  
  - `Ctrl+Shift+â†‘` é¡¶å¯¹é½
  - `Ctrl+Shift+â†“` åº•å¯¹é½
- **æµ®åŠ¨å·¥å…·é¢æ¿**: å¯æ‹–æ‹½çš„å¯¹é½å·¥å…·æ ï¼Œä½ç½®è‡ªç”±è°ƒèŠ‚
- **è§†è§‰åé¦ˆ**: æ“ä½œè¿‡ç¨‹ä¸­çš„åŠ¨ç”»æ•ˆæžœå’ŒçŠ¶æ€æç¤º
- **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é™çº§æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

## ðŸ”§ æŠ€æœ¯æž¶æž„

### ç¼“å­˜ç³»ç»Ÿæž¶æž„
```
CacheSystem (ç»Ÿä¸€å…¥å£)
â”œâ”€â”€ GeometryLayer (å‡ ä½•è®¡ç®—ç¼“å­˜)
â”‚   â”œâ”€â”€ å…ƒç´ è¾¹ç•Œæ¡†ç¼“å­˜
â”‚   â”œâ”€â”€ ä¸­å¿ƒç‚¹è®¡ç®—ç¼“å­˜
â”‚   â””â”€â”€ é€‰æ‹©èŒƒå›´ç¼“å­˜
â”œâ”€â”€ InteractionLayer (äº¤äº’å…ƒç´ ç¼“å­˜)  
â”‚   â”œâ”€â”€ ResizeHandleç¼“å­˜
â”‚   â”œâ”€â”€ é€‰æ‹©æ¡†ç¼“å­˜
â”‚   â””â”€â”€ æ‚¬åœåŒºåŸŸç¼“å­˜
â””â”€â”€ AlignmentLayer (å¯¹é½åˆ†å¸ƒç¼“å­˜)
    â”œâ”€â”€ å¯¹é½ç»“æžœç¼“å­˜
    â”œâ”€â”€ é¢„è§ˆæ•ˆæžœç¼“å­˜
    â””â”€â”€ æ™ºèƒ½å»ºè®®ç¼“å­˜
```

### å¯¹é½ç®—æ³•
- **å·¦å³å¯¹é½**: æ‰¾åˆ°æœ€å·¦/å³è¾¹ç•Œï¼Œç»Ÿä¸€Xåæ ‡
- **ä¸Šä¸‹å¯¹é½**: æ‰¾åˆ°æœ€ä¸Š/ä¸‹è¾¹ç•Œï¼Œç»Ÿä¸€Yåæ ‡  
- **å±…ä¸­å¯¹é½**: è®¡ç®—æ‰€æœ‰å…ƒç´ çš„å¹³å‡ä¸­å¿ƒç‚¹
- **å‡åŒ€åˆ†å¸ƒ**: ä¿æŒé¦–å°¾ä½ç½®ï¼Œä¸­é—´å…ƒç´ ç­‰é—´è·åˆ†å¸ƒ
- **æ™ºèƒ½å»ºè®®**: åˆ†æžå…ƒç´ åˆ†å¸ƒç‰¹å¾ï¼ŒæŽ¨èæœ€é€‚åˆçš„å¯¹é½æ–¹å¼

## ðŸŽ® ä½¿ç”¨æ–¹æ³•

### åŸºç¡€å¯¹é½æ“ä½œ
1. **é€‰æ‹©å…ƒç´ **: ç‚¹å‡»æˆ–æ¡†é€‰å¤šä¸ªå…ƒç´ ï¼ˆè‡³å°‘2ä¸ªï¼‰
2. **æ˜¾ç¤ºå·¥å…·æ **: å¯¹é½å·¥å…·æ ä¼šè‡ªåŠ¨å‡ºçŽ°åœ¨å³ä¸Šè§’
3. **é¢„è§ˆæ•ˆæžœ**: é¼ æ ‡æ‚¬åœåœ¨å¯¹é½æŒ‰é’®ä¸ŠæŸ¥çœ‹é¢„è§ˆ
4. **æ‰§è¡Œå¯¹é½**: ç‚¹å‡»æŒ‰é’®æ‰§è¡Œå¯¹é½æ“ä½œ
5. **å¿«æ·é”®**: ä½¿ç”¨é”®ç›˜å¿«æ·é”®å¿«é€Ÿå¯¹é½

### é«˜çº§åŠŸèƒ½
- **æ™ºèƒ½å»ºè®®**: ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æžå¹¶æŽ¨èæœ€ä½³å¯¹é½æ–¹å¼
- **æµ®åŠ¨é¢æ¿**: æ‹–æ‹½å·¥å…·æ åˆ°ä»»æ„ä½ç½®
- **é¢„è§ˆå–æ¶ˆ**: ç§»å¼€é¼ æ ‡å¯å–æ¶ˆé¢„è§ˆ
- **æ‰¹é‡é€‰æ‹©**: æ”¯æŒCtrlå¤šé€‰å’ŒShiftèŒƒå›´é€‰æ‹©

## ðŸ§ª æµ‹è¯•å»ºè®®

### åŸºç¡€æµ‹è¯•åœºæ™¯
1. **ç®€å•å¯¹é½**: åˆ›å»º3-4ä¸ªçŸ©å½¢ï¼Œæµ‹è¯•å„ç§å¯¹é½æ–¹å¼
2. **å¤æ‚å¸ƒå±€**: æ··åˆä¸åŒå¤§å°çš„å…ƒç´ ï¼ŒéªŒè¯å¯¹é½æ•ˆæžœ
3. **è¾¹ç•Œæƒ…å†µ**: æµ‹è¯•é‡å å…ƒç´ ã€è¾¹ç•Œå…ƒç´ çš„å¯¹é½è¡Œä¸º
4. **æ€§èƒ½æµ‹è¯•**: å¤§é‡å…ƒç´ æ—¶çš„å¯¹é½æ€§èƒ½è¡¨çŽ°

### äº¤äº’æµ‹è¯•
1. **é¢„è§ˆåŠŸèƒ½**: æ‚¬åœæŸ¥çœ‹é¢„è§ˆæ•ˆæžœæ˜¯å¦æ­£ç¡®
2. **å¿«æ·é”®**: éªŒè¯é”®ç›˜å¿«æ·é”®æ˜¯å¦å“åº”
3. **æ™ºèƒ½å»ºè®®**: ä¸åŒå¸ƒå±€ä¸‹çš„æ™ºèƒ½æŽ¨èæ˜¯å¦åˆç†
4. **ç¼“å­˜æ•ˆæžœ**: é‡å¤æ“ä½œæ—¶çš„æ€§èƒ½è¡¨çŽ°

## ðŸ› å·²çŸ¥é—®é¢˜

- æŸäº›TypeScriptç±»åž‹æ£€æŸ¥è­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- å¤æ‚åµŒå¥—å…ƒç´ çš„å¯¹é½é¢„è§ˆå¯èƒ½ä¸å¤Ÿç²¾ç¡®
- æµ®åŠ¨é¢æ¿åœ¨æŸäº›æžç«¯ä½ç½®å¯èƒ½è¢«é®æŒ¡

## ðŸ”® åŽç»­å¼€å‘

- **M3 Phase4**: ç¾¤ç»„å’Œä¸Šä¸‹æ–‡èœå•åŠŸèƒ½
- **M4**: é«˜çº§ç¼–è¾‘åŠŸèƒ½ï¼ˆæ—‹è½¬ã€å˜æ¢ç­‰ï¼‰
- **M5**: æ¨¡æ¿å’Œä¸»é¢˜ç³»ç»Ÿ
- **M6**: åä½œå’Œå¯¼å‡ºåŠŸèƒ½

---

**ç«‹å³ä½“éªŒå…¨æ–°çš„å¯¹é½åˆ†å¸ƒåŠŸèƒ½ï¼ðŸš€âœ¨**
EOF

# èŽ·å–åŒ…å¤§å°
PACKAGE_SIZE=$(du -sh "$PACKAGE_DIR" | cut -f1)

# åˆ›å»ºåŽ‹ç¼©åŒ…
cd builds/windows/
tar -czf "$PACKAGE_NAME.tar.gz" "$PACKAGE_NAME/"
cd ../../

ARCHIVE_SIZE=$(du -sh "builds/windows/$PACKAGE_NAME.tar.gz" | cut -f1)

echo ""
echo "ðŸŽ‰ å¯¹é½åˆ†å¸ƒåŠŸèƒ½ç‰ˆæœ¬æ‰“åŒ…å®Œæˆï¼"
echo "========================================"
echo "ðŸ“ åŒ…ç›®å½•: builds/windows/$PACKAGE_NAME"
echo "ðŸ“¦ åŽ‹ç¼©åŒ…: builds/windows/$PACKAGE_NAME.tar.gz"
echo "ðŸ“ åŒ…å¤§å°: $PACKAGE_SIZE"
echo "ðŸ“¦ åŽ‹ç¼©åŽ: $ARCHIVE_SIZE"
echo ""
echo "ðŸŽ¯ æœ¬ç‰ˆæœ¬ç‰¹è‰²åŠŸèƒ½:"
echo "âœ… å®Œæ•´çš„8ç§å¯¹é½åˆ†å¸ƒåŠŸèƒ½"
echo "âœ… æ™ºèƒ½å¯¹é½å»ºè®®ç³»ç»Ÿ" 
echo "âœ… å®žæ—¶é¢„è§ˆæ•ˆæžœ"
echo "âœ… çŽ°ä»£åŒ–åˆ†å±‚ç¼“å­˜æž¶æž„"
echo "âœ… é”®ç›˜å¿«æ·é”®æ”¯æŒ"
echo "âœ… æµ®åŠ¨å·¥å…·é¢æ¿"
echo ""
echo "ðŸš€ è¿è¡Œæ–¹å¼:"
echo "1. è§£åŽ‹: tar -xzf builds/windows/$PACKAGE_NAME.tar.gz"
echo "2. è¿›å…¥: cd builds/windows/$PACKAGE_NAME"  
echo "3. å¯åŠ¨: run-alignment-feature.bat"
echo ""