(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const Ct=!1,Et=(e,t)=>e===t,he=Symbol("solid-proxy"),qe=Symbol("solid-track"),De={equals:Et};let ut=mt;const ce=1,Oe=2,ft={owned:null,cleanups:null,context:null,owner:null};var O=null;let He=null,zt=null,U=null,H=null,le=null,Be=0;function Te(e,t){const n=U,o=O,i=e.length===0,l=t===void 0?o:t,s=i?ft:{owned:null,cleanups:null,context:l?l.context:null,owner:l},r=i?e:()=>e(()=>Q(()=>ke(s)));O=s,U=null;try{return xe(r,!0)}finally{U=n,O=o}}function ee(e,t){t=t?Object.assign({},De,t):De;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},o=i=>(typeof i=="function"&&(i=i(n.value)),vt(n,i));return[gt.bind(n),o]}function A(e,t,n){const o=tt(e,t,!1,ce);ze(o)}function At(e,t,n){ut=Ot;const o=tt(e,t,!1,ce);o.user=!0,le?le.push(o):ze(o)}function X(e,t,n){n=n?Object.assign({},De,n):De;const o=tt(e,t,!0,0);return o.observers=null,o.observerSlots=null,o.comparator=n.equals||void 0,ze(o),gt.bind(o)}function Mt(e){return xe(e,!1)}function Q(e){if(U===null)return e();const t=U;U=null;try{return e()}finally{U=t}}function et(e){At(()=>Q(e))}function Pt(e){return O===null||(O.cleanups===null?O.cleanups=[e]:O.cleanups.push(e)),e}function Ge(){return U}function Lt(e,t){const n=Symbol("context");return{id:n,Provider:Ut(n),defaultValue:e}}function Ft(e){let t;return O&&O.context&&(t=O.context[e.id])!==void 0?t:e.defaultValue}function ht(e){const t=X(e),n=X(()=>Ze(t()));return n.toArray=()=>{const o=n();return Array.isArray(o)?o:o!=null?[o]:[]},n}function gt(){if(this.sources&&this.state)if(this.state===ce)ze(this);else{const e=H;H=null,xe(()=>Ue(this),!1),H=e}if(U){const e=this.observers?this.observers.length:0;U.sources?(U.sources.push(this),U.sourceSlots.push(e)):(U.sources=[this],U.sourceSlots=[e]),this.observers?(this.observers.push(U),this.observerSlots.push(U.sources.length-1)):(this.observers=[U],this.observerSlots=[U.sources.length-1])}return this.value}function vt(e,t,n){let o=e.value;return(!e.comparator||!e.comparator(o,t))&&(e.value=t,e.observers&&e.observers.length&&xe(()=>{for(let i=0;i<e.observers.length;i+=1){const l=e.observers[i],s=He&&He.running;s&&He.disposed.has(l),(s?!l.tState:!l.state)&&(l.pure?H.push(l):le.push(l),l.observers&&yt(l)),s||(l.state=ce)}if(H.length>1e6)throw H=[],new Error},!1)),t}function ze(e){if(!e.fn)return;ke(e);const t=Be;Tt(e,e.value,t)}function Tt(e,t,n){let o;const i=O,l=U;U=O=e;try{o=e.fn(t)}catch(s){return e.pure&&(e.state=ce,e.owned&&e.owned.forEach(ke),e.owned=null),e.updatedAt=n+1,wt(s)}finally{U=l,O=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?vt(e,o):e.value=o,e.updatedAt=n)}function tt(e,t,n,o=ce,i){const l={fn:e,state:o,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:O,context:O?O.context:null,pure:n};return O===null||O!==ft&&(O.owned?O.owned.push(l):O.owned=[l]),l}function Ie(e){if(e.state===0)return;if(e.state===Oe)return Ue(e);if(e.suspense&&Q(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Be);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===ce)ze(e);else if(e.state===Oe){const o=H;H=null,xe(()=>Ue(e,t[0]),!1),H=o}}function xe(e,t){if(H)return e();let n=!1;t||(H=[]),le?n=!0:le=[],Be++;try{const o=e();return Dt(n),o}catch(o){n||(le=null),H=null,wt(o)}}function Dt(e){if(H&&(mt(H),H=null),e)return;const t=le;le=null,t.length&&xe(()=>ut(t),!1)}function mt(e){for(let t=0;t<e.length;t++)Ie(e[t])}function Ot(e){let t,n=0;for(t=0;t<e.length;t++){const o=e[t];o.user?e[n++]=o:Ie(o)}for(t=0;t<n;t++)Ie(e[t])}function Ue(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const o=e.sources[n];if(o.sources){const i=o.state;i===ce?o!==t&&(!o.updatedAt||o.updatedAt<Be)&&Ie(o):i===Oe&&Ue(o,t)}}}function yt(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=Oe,n.pure?H.push(n):le.push(n),n.observers&&yt(n))}}function ke(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),o=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const l=i.pop(),s=n.observerSlots.pop();o<i.length&&(l.sourceSlots[s]=o,i[o]=l,n.observerSlots[o]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)ke(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)ke(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function It(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function wt(e,t=O){throw It(e)}function Ze(e){if(typeof e=="function"&&!e.length)return Ze(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const o=Ze(e[n]);Array.isArray(o)?t.push.apply(t,o):t.push(o)}return t}return e}function Ut(e,t){return function(o){let i;return A(()=>i=Q(()=>(O.context={...O.context,[e]:o.value},ht(()=>o.children))),void 0),i}}const jt=Symbol("fallback");function rt(e){for(let t=0;t<e.length;t++)e[t]()}function Yt(e,t,n={}){let o=[],i=[],l=[],s=0,r=t.length>1?[]:null;return Pt(()=>rt(l)),()=>{let g=e()||[],d=g.length,c,f;return g[qe],Q(()=>{let m,b,h,a,S,k,z,P,T;if(d===0)s!==0&&(rt(l),l=[],o=[],i=[],s=0,r&&(r=[])),n.fallback&&(o=[jt],i[0]=Te(L=>(l[0]=L,n.fallback())),s=1);else if(s===0){for(i=new Array(d),f=0;f<d;f++)o[f]=g[f],i[f]=Te(v);s=d}else{for(h=new Array(d),a=new Array(d),r&&(S=new Array(d)),k=0,z=Math.min(s,d);k<z&&o[k]===g[k];k++);for(z=s-1,P=d-1;z>=k&&P>=k&&o[z]===g[P];z--,P--)h[P]=i[z],a[P]=l[z],r&&(S[P]=r[z]);for(m=new Map,b=new Array(P+1),f=P;f>=k;f--)T=g[f],c=m.get(T),b[f]=c===void 0?-1:c,m.set(T,f);for(c=k;c<=z;c++)T=o[c],f=m.get(T),f!==void 0&&f!==-1?(h[f]=i[c],a[f]=l[c],r&&(S[f]=r[c]),f=b[f],m.set(T,f)):l[c]();for(f=k;f<d;f++)f in h?(i[f]=h[f],l[f]=a[f],r&&(r[f]=S[f],r[f](f))):i[f]=Te(v);i=i.slice(0,s=d),o=g.slice(0)}return i});function v(m){if(l[f]=m,r){const[b,h]=ee(f);return r[f]=h,t(g[f],b)}return t(g[f])}}}function _(e,t){return Q(()=>e(t||{}))}const bt=e=>`Stale read from <${e}>.`;function ue(e){const t="fallback"in e&&{fallback:()=>e.fallback};return X(Yt(()=>e.each,e.children,t||void 0))}function Se(e){const t=e.keyed,n=X(()=>e.when,void 0,void 0),o=t?n:X(n,void 0,{equals:(i,l)=>!i==!l});return X(()=>{const i=o();if(i){const l=e.children;return typeof l=="function"&&l.length>0?Q(()=>l(t?i:()=>{if(!Q(o))throw bt("Show");return n()})):l}return e.fallback},void 0,void 0)}function xt(e){const t=ht(()=>e.children),n=X(()=>{const o=t(),i=Array.isArray(o)?o:[o];let l=()=>{};for(let s=0;s<i.length;s++){const r=s,g=i[s],d=l,c=X(()=>d()?void 0:g.when,void 0,void 0),f=g.keyed?c:X(c,void 0,{equals:(v,m)=>!v==!m});l=()=>d()||(f()?[r,c,g]:void 0)}return l});return X(()=>{const o=n()();if(!o)return e.fallback;const[i,l,s]=o,r=s.children;return typeof r=="function"&&r.length>0?Q(()=>r(s.keyed?l():()=>{if(Q(n)()?.[0]!==i)throw bt("Match");return l()})):r},void 0,void 0)}function ne(e){return e}const se=e=>X(()=>e());function Xt(e,t,n){let o=n.length,i=t.length,l=o,s=0,r=0,g=t[i-1].nextSibling,d=null;for(;s<i||r<l;){if(t[s]===n[r]){s++,r++;continue}for(;t[i-1]===n[l-1];)i--,l--;if(i===s){const c=l<o?r?n[r-1].nextSibling:n[l-r]:g;for(;r<l;)e.insertBefore(n[r++],c)}else if(l===r)for(;s<i;)(!d||!d.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[l-1]&&n[r]===t[i-1]){const c=t[--i].nextSibling;e.insertBefore(n[r++],t[s++].nextSibling),e.insertBefore(n[--l],c),t[i]=n[l]}else{if(!d){d=new Map;let f=r;for(;f<l;)d.set(n[f],f++)}const c=d.get(t[s]);if(c!=null)if(r<c&&c<l){let f=s,v=1,m;for(;++f<i&&f<l&&!((m=d.get(t[f]))==null||m!==c+v);)v++;if(v>c-r){const b=t[s];for(;r<c;)e.insertBefore(n[r++],b)}else e.replaceChild(n[r++],t[s++])}else s++;else t[s++].remove()}}}const st="_$DX_DELEGATE";function Nt(e,t,n,o={}){let i;return Te(l=>{i=l,t===document?e():w(t,e(),t.firstChild?null:void 0,n)},o.owner),()=>{i(),t.textContent=""}}function E(e,t,n,o){let i;const l=()=>{const r=o?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return r.innerHTML=e,n?r.content.firstChild.firstChild:o?r.firstChild:r.content.firstChild},s=t?()=>Q(()=>document.importNode(i||(i=l()),!0)):()=>(i||(i=l())).cloneNode(!0);return s.cloneNode=s,s}function ge(e,t=window.document){const n=t[st]||(t[st]=new Set);for(let o=0,i=e.length;o<i;o++){const l=e[o];n.has(l)||(n.add(l),t.addEventListener(l,Vt))}}function y(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function $e(e,t){t==null?e.removeAttribute("class"):e.className=t}function We(e,t,n,o){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function Rt(e,t,n){if(!t)return n?y(e,"style"):t;const o=e.style;if(typeof t=="string")return o.cssText=t;typeof n=="string"&&(o.cssText=n=void 0),n||(n={}),t||(t={});let i,l;for(l in n)t[l]==null&&o.removeProperty(l),delete n[l];for(l in t)i=t[l],i!==n[l]&&(o.setProperty(l,i),n[l]=i);return n}function Bt(e,t,n){return Q(()=>e(t,n))}function w(e,t,n,o){if(n!==void 0&&!o&&(o=[]),typeof t!="function")return je(e,t,o,n);A(i=>je(e,t(),i,n),o)}function Vt(e){let t=e.target;const n=`$$${e.type}`,o=e.target,i=e.currentTarget,l=g=>Object.defineProperty(e,"target",{configurable:!0,value:g}),s=()=>{const g=t[n];if(g&&!t.disabled){const d=t[`${n}Data`];if(d!==void 0?g.call(t,d,e):g.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},r=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const g=e.composedPath();l(g[0]);for(let d=0;d<g.length-2&&(t=g[d],!!s());d++){if(t._$host){t=t._$host,r();break}if(t.parentNode===i)break}}else r();l(o)}function je(e,t,n,o,i){for(;typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,s=o!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===n))return n;if(s){let r=n[0];r&&r.nodeType===3?r.data!==t&&(r.data=t):r=document.createTextNode(t),n=ye(e,n,o,r)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean")n=ye(e,n,o);else{if(l==="function")return A(()=>{let r=t();for(;typeof r=="function";)r=r();n=je(e,r,n,o)}),()=>n;if(Array.isArray(t)){const r=[],g=n&&Array.isArray(n);if(Je(r,t,n,i))return A(()=>n=je(e,r,n,o,!0)),()=>n;if(r.length===0){if(n=ye(e,n,o),s)return n}else g?n.length===0?at(e,r,o):Xt(e,n,r):(n&&ye(e),at(e,r));n=r}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=ye(e,n,o,t);ye(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Je(e,t,n,o){let i=!1;for(let l=0,s=t.length;l<s;l++){let r=t[l],g=n&&n[e.length],d;if(!(r==null||r===!0||r===!1))if((d=typeof r)=="object"&&r.nodeType)e.push(r);else if(Array.isArray(r))i=Je(e,r,g)||i;else if(d==="function")if(o){for(;typeof r=="function";)r=r();i=Je(e,Array.isArray(r)?r:[r],Array.isArray(g)?g:[g])||i}else e.push(r),i=!0;else{const c=String(r);g&&g.nodeType===3&&g.data===c?e.push(g):e.push(document.createTextNode(c))}}return i}function at(e,t,n=null){for(let o=0,i=t.length;o<i;o++)e.insertBefore(t[o],n)}function ye(e,t,n,o){if(n===void 0)return e.textContent="";const i=o||document.createTextNode("");if(t.length){let l=!1;for(let s=t.length-1;s>=0;s--){const r=t[s];if(i!==r){const g=r.parentNode===e;!l&&!s?g?e.replaceChild(i,r):e.insertBefore(i,n):g&&r.remove()}else l=!0}}else e.insertBefore(i,n);return[i]}const Qe=Symbol("store-raw"),we=Symbol("store-node"),te=Symbol("store-has"),_t=Symbol("store-self");function $t(e){let t=e[he];if(!t&&(Object.defineProperty(e,he,{value:t=new Proxy(e,qt)}),!Array.isArray(e))){const n=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let i=0,l=n.length;i<l;i++){const s=n[i];o[s].get&&Object.defineProperty(e,s,{enumerable:o[s].enumerable,get:o[s].get.bind(t)})}}return t}function Ye(e){let t;return e!=null&&typeof e=="object"&&(e[he]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ce(e,t=new Set){let n,o,i,l;if(n=e!=null&&e[Qe])return n;if(!Ye(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,r=e.length;s<r;s++)i=e[s],(o=Ce(i,t))!==i&&(e[s]=o)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let g=0,d=s.length;g<d;g++)l=s[g],!r[l].get&&(i=e[l],(o=Ce(i,t))!==i&&(e[l]=o))}return e}function Xe(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Ee(e,t,n){if(e[t])return e[t];const[o,i]=ee(n,{equals:!1,internal:!0});return o.$=i,e[t]=o}function Ht(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===he||t===we||(delete n.value,delete n.writable,n.get=()=>e[he][t]),n}function pt(e){Ge()&&Ee(Xe(e,we),_t)()}function Kt(e){return pt(e),Reflect.ownKeys(e)}const qt={get(e,t,n){if(t===Qe)return e;if(t===he)return n;if(t===qe)return pt(e),n;const o=Xe(e,we),i=o[t];let l=i?i():e[t];if(t===we||t===te||t==="__proto__")return l;if(!i){const s=Object.getOwnPropertyDescriptor(e,t);Ge()&&(typeof l!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(l=Ee(o,t,l)())}return Ye(l)?$t(l):l},has(e,t){return t===Qe||t===he||t===qe||t===we||t===te||t==="__proto__"?!0:(Ge()&&Ee(Xe(e,te),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Kt,getOwnPropertyDescriptor:Ht};function Ne(e,t,n,o=!1){if(!o&&e[t]===n)return;const i=e[t],l=e.length;n===void 0?(delete e[t],e[te]&&e[te][t]&&i!==void 0&&e[te][t].$()):(e[t]=n,e[te]&&e[te][t]&&i===void 0&&e[te][t].$());let s=Xe(e,we),r;if((r=Ee(s,t,i))&&r.$(()=>n),Array.isArray(e)&&e.length!==l){for(let g=e.length;g<l;g++)(r=s[g])&&r.$();(r=Ee(s,"length",l))&&r.$(e.length)}(r=s[_t])&&r.$()}function St(e,t){const n=Object.keys(t);for(let o=0;o<n.length;o+=1){const i=n[o];Ne(e,i,t[i])}}function Gt(e,t){if(typeof t=="function"&&(t=t(e)),t=Ce(t),Array.isArray(t)){if(e===t)return;let n=0,o=t.length;for(;n<o;n++){const i=t[n];e[n]!==i&&Ne(e,n,i)}Ne(e,"length",o)}else St(e,t)}function pe(e,t,n=[]){let o,i=e;if(t.length>1){o=t.shift();const s=typeof o,r=Array.isArray(e);if(Array.isArray(o)){for(let g=0;g<o.length;g++)pe(e,[o[g]].concat(t),n);return}else if(r&&s==="function"){for(let g=0;g<e.length;g++)o(e[g],g)&&pe(e,[g].concat(t),n);return}else if(r&&s==="object"){const{from:g=0,to:d=e.length-1,by:c=1}=o;for(let f=g;f<=d;f+=c)pe(e,[f].concat(t),n);return}else if(t.length>1){pe(e[o],t,[o].concat(n));return}i=e[o],n=[o].concat(n)}let l=t[0];typeof l=="function"&&(l=l(i,n),l===i)||o===void 0&&l==null||(l=Ce(l),o===void 0||Ye(i)&&Ye(l)&&!Array.isArray(l)?St(i,l):Ne(e,o,l))}function Zt(...[e,t]){const n=Ce(e||{}),o=Array.isArray(n),i=$t(n);function l(...s){Mt(()=>{o&&s.length===1?Gt(n,s[0]):pe(n,s)})}return[i,l]}function Wt(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function ct(e,t=!1){const n=Wt(),o=`_${n}`;return Object.defineProperty(window,o,{value:i=>(t&&Reflect.deleteProperty(window,o),e?.(i)),writable:!1,configurable:!0}),n}async function Y(e,t={}){return new Promise((n,o)=>{const i=ct(s=>{n(s),Reflect.deleteProperty(window,`_${l}`)},!0),l=ct(s=>{o(s),Reflect.deleteProperty(window,`_${i}`)},!0);window.__TAURI_IPC__({cmd:e,callback:i,error:l,...t})})}const kt=Lt(),Jt=e=>{const[t,n]=Zt({elements:[],selected_ids:[],canvas_config:{width:595,height:842,zoom:1,offset_x:0,offset_y:0,show_grid:!0,show_rulers:!0,grid_size:10,snap_to_grid:!0,background_color:"#ffffff"},can_undo:!1,can_redo:!1,dirty:!1}),[o,i]=ee(!1),[l,s]=ee(null),r=async()=>{try{i(!0);const $=await Y("get_app_state");n($)}catch($){console.error("Failed to load app state:",$)}finally{i(!1)}};et(()=>{r()});const M={state:t,createElement:async($,u,p,x={})=>{try{i(!0);const C=await Y("create_element",{request:{element_type:$,position:u,size:p,content_data:x}});return await r(),C}catch(C){throw console.error("Failed to create element:",C),C}finally{i(!1)}},updateElement:async($,u)=>{try{i(!0),await Y("update_element",{request:{id:$,updates:u}}),await r()}catch(p){throw console.error("Failed to update element:",p),p}finally{i(!1)}},batchUpdatePositions:async $=>{try{i(!0),await Y("batch_update_positions",{request:{updates:$}}),await r()}catch(u){throw console.error("Failed to batch update positions:",u),u}finally{i(!1)}},deleteElement:async $=>{try{i(!0),await Y("delete_element",{elementId:$}),await r()}catch(u){throw console.error("Failed to delete element:",u),u}finally{i(!1)}},selectElement:async $=>{try{console.log("Selecting element:",$),await Y("select_element",{elementId:$}),console.log("Select command completed, reloading state..."),await r(),console.log("State reloaded, selected_ids:",t.selected_ids)}catch(u){throw console.error("Failed to select element:",u),u}},selectMultiple:async $=>{try{console.log("Selecting multiple elements:",$),$.length>0?(await Y("select_multiple",{elementIds:$}),console.log("✅ Multi-select completed for:",$.length,"elements")):await Y("clear_selection"),await r()}catch(u){throw console.error("Failed to select multiple elements:",u),u}},addToSelection:async $=>{try{console.log("Adding to selection:",$),await Y("add_to_selection",{elementId:$}),await r()}catch(u){throw console.error("Failed to add to selection:",u),u}},removeFromSelection:async $=>{try{console.log("Removing from selection:",$),await Y("remove_from_selection",{elementId:$}),await r()}catch(u){throw console.error("Failed to remove from selection:",u),u}},toggleSelection:async $=>{try{console.log("Toggling selection:",$),await Y("toggle_selection",{elementId:$}),await r()}catch(u){throw console.error("Failed to toggle selection:",u),u}},clearSelection:async()=>{try{await Y("clear_selection"),await r()}catch($){throw console.error("Failed to clear selection:",$),$}},copySelected:async()=>{try{await Y("copy_selected")}catch($){throw console.error("Failed to copy selected elements:",$),$}},pasteElements:async($,u)=>{try{i(!0);const p=await Y("paste_elements",{offsetX:$,offsetY:u});return await r(),p}catch(p){throw console.error("Failed to paste elements:",p),p}finally{i(!1)}},undo:async()=>{try{i(!0),await Y("undo"),await r()}catch($){throw console.error("Failed to undo:",$),$}finally{i(!1)}},redo:async()=>{try{i(!0),await Y("redo"),await r()}catch($){throw console.error("Failed to redo:",$),$}finally{i(!1)}},updateCanvasConfig:async $=>{try{i(!0),await Y("update_canvas_config",{request:$}),await r()}catch(u){throw console.error("Failed to update canvas config:",u),u}finally{i(!1)}},getElementsAtPoint:async($,u)=>{try{return await Y("get_elements_at_point",{x:$,y:u})}catch(p){return console.error("Failed to get elements at point:",p),[]}},isLoading:o,setLoading:i,dragOperation:l,setDragOperation:s};return _(kt.Provider,{value:M,get children(){return e.children}})},ae=()=>{const e=Ft(kt);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e};var Qt=E("<span class=text-warning>●"),en=E("<span class=ml-2> 个元素"),tn=E('<span class="ml-2 text-primary">已选择 <!> 个'),nn=E('<div class="h-12 bg-primary border-b border-default flex items-center justify-between px-4"><div class="flex items-center gap-2"><button class=toolbar-btn title="新建 (Ctrl+N)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>新建</span></button><button class=toolbar-btn title="打开 (Ctrl+O)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg><span>打开</span></button><button class=toolbar-btn title="保存 (Ctrl+S)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg><span>保存</span></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn title=预览><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span>预览</span></button></div><div class="flex items-center gap-2"><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></button><button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class=toolbar-btn-icon title="缩小 (Ctrl+-)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><select class=zoom-select><option value=25%>25%</option><option value=50%>50%</option><option value=75%>75%</option><option value=100%>100%</option><option value=125%>125%</option><option value=150%>150%</option><option value=200%>200%</option><option value=fit>适应窗口</option></select><button class=toolbar-btn-icon title="放大 (Ctrl++)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button title="显示网格 (Ctrl+G)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg></button><button title="显示标尺 (Ctrl+R)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v14a2 2 0 01-2 2H7zM20 3v18l-4-4V7l4-4z"></path></svg></button><div class="w-px h-6 bg-border-default mx-2"></div><button class="toolbar-btn-icon bg-yellow-100 hover:bg-yellow-200 text-yellow-800"title="开启/关闭开发者工具 (F12)"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button></div><div class="flex items-center gap-2 text-secondary text-sm"><span>');const ln=()=>{const{state:e,undo:t,redo:n,updateCanvasConfig:o}=ae(),[i,l]=ee(e.canvas_config.zoom*100),s=async v=>{const m=v/100;l(v);try{await o({zoom:m})}catch(b){console.error("Failed to update zoom:",b)}},r=()=>{const v=Math.min(i()+25,500);s(v)},g=()=>{const v=Math.max(i()-25,25);s(v)},d=async()=>{try{await o({show_grid:!e.canvas_config.show_grid})}catch(v){console.error("Failed to toggle grid:",v)}},c=async()=>{try{await o({show_rulers:!e.canvas_config.show_rulers})}catch(v){console.error("Failed to toggle rulers:",v)}},f=async()=>{try{await Y("toggle_devtools"),console.log("🔧 DevTools toggled")}catch(v){console.error("Failed to toggle DevTools:",v)}};return(()=>{var v=nn(),m=v.firstChild,b=m.nextSibling,h=b.firstChild,a=h.nextSibling,S=a.nextSibling,k=S.nextSibling,z=k.nextSibling,P=z.nextSibling,T=P.nextSibling,L=T.nextSibling,I=L.nextSibling,M=I.nextSibling,$=M.nextSibling,u=b.nextSibling,p=u.firstChild;return We(h,"click",t),We(a,"click",n),k.$$click=g,z.addEventListener("change",x=>{const C=x.target.value;if(C==="fit")console.log("Fit to window");else{const D=parseInt(C.replace("%",""));s(D)}}),P.$$click=r,L.$$click=d,I.$$click=c,$.$$click=f,w(u,_(Se,{get when(){return e.dirty},get children(){return Qt()}}),p),w(p,()=>e.template_name||"未命名模板"),w(u,_(Se,{get when(){return e.elements.length>0},get children(){var x=en(),C=x.firstChild;return w(x,()=>e.elements.length,C),x}}),null),w(u,_(Se,{get when(){return e.selected_ids.length>0},get children(){var x=tn(),C=x.firstChild,D=C.nextSibling;return D.nextSibling,w(x,()=>e.selected_ids.length,D),x}}),null),A(x=>{var C=`toolbar-btn-icon ${e.can_undo?"":"opacity-50 cursor-not-allowed"}`,D=!e.can_undo,R=`撤销${e.undo_description?` (${e.undo_description})`:""} (Ctrl+Z)`,N=`toolbar-btn-icon ${e.can_redo?"":"opacity-50 cursor-not-allowed"}`,W=!e.can_redo,G=`重做${e.redo_description?` (${e.redo_description})`:""} (Ctrl+Y)`,V=`toolbar-btn-icon ${e.canvas_config.show_grid?"active":""}`,q=`toolbar-btn-icon ${e.canvas_config.show_rulers?"active":""}`;return C!==x.e&&$e(h,x.e=C),D!==x.t&&(h.disabled=x.t=D),R!==x.a&&y(h,"title",x.a=R),N!==x.o&&$e(a,x.o=N),W!==x.i&&(a.disabled=x.i=W),G!==x.n&&y(a,"title",x.n=G),V!==x.s&&$e(L,x.s=V),q!==x.h&&$e(I,x.h=q),x},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),A(()=>z.value=`${Math.round(i())}%`),v})()};ge(["click"]);var on=E('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary mb-3">组件库</h2><input type=text placeholder=搜索组件... class=component-search></div><div class="flex-1 overflow-y-auto custom-scrollbar p-4"><div class=space-y-4><div><h3 class="text-sm font-medium text-secondary mb-2">基础组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">数据组件</h3><div class="grid grid-cols-2 gap-2"></div></div><div><h3 class="text-sm font-medium text-secondary mb-2">银行组件</h3><div class="grid grid-cols-2 gap-2">'),rn=E('<div class=component-item><div class=text-center><div class="text-lg mb-1"></div><div class="text-xs font-medium text-primary">');const sn=()=>{const{createElement:e}=ae(),[t,n]=ee(""),o=[{id:"text",name:"文字",category:"basic",icon:"📝",description:"静态文字标签",default_size:{width:100,height:24},create_content:d=>({type:"Text",content:d?.text||"文字内容",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"data_field",name:"数据字段",category:"data",icon:"🔗",description:"动态数据字段",default_size:{width:120,height:24},create_content:d=>({type:"DataField",expression:d?.expression||"${fieldName}",format:d?.format,style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}})},{id:"rectangle",name:"矩形",category:"basic",icon:"▭",description:"矩形框架",default_size:{width:100,height:60},create_content:d=>({type:"Rectangle",fill_color:d?.fill_color||"transparent",border:{color:d?.border_color||"#000000",width:d?.border_width||1,style:"Solid"}})},{id:"line",name:"线条",category:"basic",icon:"━",description:"分隔线",default_size:{width:200,height:2},create_content:d=>({type:"Line",color:d?.color||"#000000",width:d?.width||1})},{id:"image",name:"图片",category:"basic",icon:"🖼️",description:"图片占位符",default_size:{width:100,height:80},create_content:d=>({type:"Image",src:d?.src||"",alt:d?.alt||"图片"})}],i=[{id:"bank_header",name:"银行抬头",category:"bank",icon:"🏦",description:"银行标题和Logo区域",default_size:{width:300,height:60},create_content:()=>({type:"Text",content:"中国工商银行电子回单",style:{font_family:"SimHei",font_size:18,font_weight:"bold",color:"#000000",align:"Center"}})},{id:"amount_field",name:"金额字段",category:"bank",icon:"💰",description:"格式化金额显示",default_size:{width:120,height:24},create_content:()=>({type:"DataField",expression:"${amount}",format:"currency",style:{font_family:"SimSun",font_size:14,font_weight:"bold",color:"#000000",align:"Right"}})},{id:"customer_info",name:"客户信息",category:"bank",icon:"👤",description:"客户姓名和账号",default_size:{width:150,height:24},create_content:()=>({type:"DataField",expression:"${customerName}",style:{font_family:"SimSun",font_size:12,font_weight:"normal",color:"#000000",align:"Left"}})}],l=[...o,...i],s=()=>{const d=t().toLowerCase();return d?l.filter(c=>c.name.toLowerCase().includes(d)||c.description.toLowerCase().includes(d)):l},r=(d,c)=>{if(console.log("Starting drag for component:",d.id),c.dataTransfer){c.dataTransfer.effectAllowed="copy",c.dataTransfer.setData("application/json",JSON.stringify({type:"component",component:d}));const f=document.createElement("div");f.innerHTML=`
        <div style="
          background: #f3f4f6; 
          border: 2px solid #3b82f6; 
          border-radius: 8px; 
          padding: 8px 12px; 
          font-size: 12px;
          white-space: nowrap;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ">
          ${d.icon} ${d.name}
        </div>
      `,f.style.position="absolute",f.style.top="-1000px",document.body.appendChild(f),c.dataTransfer.setDragImage(f,50,20),setTimeout(()=>{document.body.removeChild(f)},0)}},g=async d=>{try{const c=await e(d.id,{x:100,y:100},d.default_size,d.create_content());console.log("Created element:",c)}catch(c){console.error("Failed to create element:",c)}};return(()=>{var d=on(),c=d.firstChild,f=c.firstChild,v=f.nextSibling,m=c.nextSibling,b=m.firstChild,h=b.firstChild,a=h.firstChild,S=a.nextSibling,k=h.nextSibling,z=k.firstChild,P=z.nextSibling,T=k.nextSibling,L=T.firstChild,I=L.nextSibling;return v.$$input=M=>n(M.target.value),w(S,_(ue,{get each(){return s().filter(M=>M.category==="basic")},children:M=>_(Ke,{component:M,onDrag:$=>r(M,$),onClick:()=>g(M)})})),w(P,_(ue,{get each(){return s().filter(M=>M.category==="data")},children:M=>_(Ke,{component:M,onDrag:$=>r(M,$),onClick:()=>g(M)})})),w(I,_(ue,{get each(){return s().filter(M=>M.category==="bank")},children:M=>_(Ke,{component:M,onDrag:$=>r(M,$),onClick:()=>g(M)})})),A(()=>v.value=t()),d})()},Ke=e=>(()=>{var t=rn(),n=t.firstChild,o=n.firstChild,i=o.nextSibling;return We(t,"click",e.onClick),t.addEventListener("dragstart",l=>e.onDrag(l)),y(t,"draggable",!0),w(o,()=>e.component.icon),w(i,()=>e.component.name),A(()=>y(t,"title",e.component.description)),t})();ge(["input","click"]);var an=E('<div class="flex flex-col h-full"><div class="p-4 border-b border-default"><h2 class="text-lg font-semibold text-primary">属性面板</h2></div><div class="flex-1 overflow-y-auto custom-scrollbar">'),cn=E('<div class="p-4 text-center text-muted"><svg class="w-12 h-12 mx-auto mb-2 opacity-50"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg><p class=text-sm>选择元素以查看属性'),dn=E("<span class=property-value>"),un=E('<span class="property-value text-xs text-muted">'),be=E("<div class=space-y-2>"),re=E("<input type=number class=property-input>"),fn=E('<div class="grid grid-cols-2 gap-2">'),dt=E("<input type=checkbox class=property-checkbox>"),hn=E('<div class="p-4 space-y-4">'),gn=E("<div class=property-group><div class=property-group-title><span></span><span></span></div><div class=property-group-content>"),vn=E("<div class=property-field><label class=property-label>"),mn=E("<input type=text class=property-input>"),yn=E('<select class=property-select><option value=SimSun>宋体</option><option value=SimHei>黑体</option><option value="Microsoft YaHei">微软雅黑</option><option value=Arial>Arial'),Re=E("<input type=color class=property-color>"),wn=E("<input type=text class=property-input placeholder=${fieldName}>"),bn=E("<select class=property-select><option value=default>默认</option><option value=currency>货币</option><option value=date>日期</option><option value=datetime>日期时间</option><option value=number>数字");const xn=()=>{const{state:e,updateElement:t}=ae(),n=X(()=>{const l=new Set(e.selected_ids);return e.elements.filter(s=>l.has(s.id))}),o=X(()=>n()[0]),i=async(l,s,r)=>{try{await t(l,{[s]:r})}catch(g){console.error("Failed to update element property:",g)}};return(()=>{var l=an(),s=l.firstChild,r=s.nextSibling;return w(r,_(Se,{get when(){return o()},get fallback(){return cn()},get children(){return _(_n,{get element(){return o()},onUpdate:i})}})),l})()},_n=e=>{const t=(o,i)=>{const l={...e.element.position,[o]:i};e.onUpdate(e.element.id,"position",l)},n=(o,i)=>{const l={...e.element.size,[o]:Math.max(1,i)};e.onUpdate(e.element.id,"size",l)};return(()=>{var o=hn();return w(o,_(fe,{title:"元素信息",icon:"ℹ️",get children(){var i=be();return w(i,_(j,{label:"类型",get children(){var l=dn();return w(l,()=>e.element.content.type),l}}),null),w(i,_(j,{label:"ID",get children(){var l=un();return w(l,()=>e.element.id),l}}),null),i}}),null),w(o,_(fe,{title:"位置和大小",icon:"📐",get children(){var i=fn();return w(i,_(j,{label:"X",get children(){var l=re();return l.$$input=s=>t("x",parseFloat(s.target.value)||0),A(()=>l.value=e.element.position.x),l}}),null),w(i,_(j,{label:"Y",get children(){var l=re();return l.$$input=s=>t("y",parseFloat(s.target.value)||0),A(()=>l.value=e.element.position.y),l}}),null),w(i,_(j,{label:"宽度",get children(){var l=re();return l.$$input=s=>n("width",parseFloat(s.target.value)||1),A(()=>l.value=e.element.size.width),l}}),null),w(i,_(j,{label:"高度",get children(){var l=re();return l.$$input=s=>n("height",parseFloat(s.target.value)||1),A(()=>l.value=e.element.size.height),l}}),null),i}}),null),w(o,_(fe,{title:"状态",icon:"👁️",get children(){var i=be();return w(i,_(j,{label:"可见",get children(){var l=dt();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"visible",s.target.checked)),A(()=>l.checked=e.element.visible),l}}),null),w(i,_(j,{label:"锁定",get children(){var l=dt();return l.addEventListener("change",s=>e.onUpdate(e.element.id,"locked",s.target.checked)),A(()=>l.checked=e.element.locked),l}}),null),w(i,_(j,{label:"层级",get children(){var l=re();return l.$$input=s=>e.onUpdate(e.element.id,"z_index",parseInt(s.target.value)||0),A(()=>l.value=e.element.z_index),l}}),null),i}}),null),w(o,_(xt,{get children(){return[_(ne,{get when(){return e.element.content.type==="Text"&&e.element.content},children:i=>_($n,{get content(){return i()},onUpdate:l=>e.onUpdate(e.element.id,"content",{...i(),...l})})}),_(ne,{get when(){return e.element.content.type==="Rectangle"&&e.element.content},children:i=>_(pn,{get content(){return i()},onUpdate:l=>e.onUpdate(e.element.id,"content",{...i(),...l})})}),_(ne,{get when(){return e.element.content.type==="Line"&&e.element.content},children:i=>_(Sn,{get content(){return i()},onUpdate:l=>e.onUpdate(e.element.id,"content",{...i(),...l})})}),_(ne,{get when(){return e.element.content.type==="DataField"&&e.element.content},children:i=>_(kn,{get content(){return i()},onUpdate:l=>e.onUpdate(e.element.id,"content",{...i(),...l})})})]}}),null),o})()},fe=e=>(()=>{var t=gn(),n=t.firstChild,o=n.firstChild,i=o.nextSibling,l=n.nextSibling;return w(o,()=>e.icon),w(i,()=>e.title),w(l,()=>e.children),t})(),j=e=>(()=>{var t=vn(),n=t.firstChild;return w(n,()=>e.label),w(t,()=>e.children,null),t})(),$n=e=>_(fe,{title:"文字样式",icon:"🔤",get children(){var t=be();return w(t,_(j,{label:"内容",get children(){var n=mn();return n.$$input=o=>e.onUpdate({content:o.target.value}),A(()=>n.value=e.content.content),n}}),null),w(t,_(j,{label:"字体",get children(){var n=yn();return n.addEventListener("change",o=>e.onUpdate({style:{...e.content.style,font_family:o.target.value}})),A(()=>n.value=e.content.style.font_family),n}}),null),w(t,_(j,{label:"大小",get children(){var n=re();return n.$$input=o=>e.onUpdate({style:{...e.content.style,font_size:parseFloat(o.target.value)||12}}),A(()=>n.value=e.content.style.font_size),n}}),null),w(t,_(j,{label:"颜色",get children(){var n=Re();return n.$$input=o=>e.onUpdate({style:{...e.content.style,color:o.target.value}}),A(()=>n.value=e.content.style.color),n}}),null),t}}),pn=e=>_(fe,{title:"矩形样式",icon:"▭",get children(){var t=be();return w(t,_(j,{label:"填充颜色",get children(){var n=Re();return n.$$input=o=>e.onUpdate({fill_color:o.target.value}),A(()=>n.value=e.content.fill_color||"#ffffff"),n}}),null),w(t,_(j,{label:"边框颜色",get children(){var n=Re();return n.$$input=o=>e.onUpdate({border:{...e.content.border,color:o.target.value}}),A(()=>n.value=e.content.border?.color||"#000000"),n}}),null),w(t,_(j,{label:"边框宽度",get children(){var n=re();return n.$$input=o=>e.onUpdate({border:{...e.content.border,width:parseFloat(o.target.value)||1}}),A(()=>n.value=e.content.border?.width||1),n}}),null),t}}),Sn=e=>_(fe,{title:"线条样式",icon:"━",get children(){var t=be();return w(t,_(j,{label:"颜色",get children(){var n=Re();return n.$$input=o=>e.onUpdate({color:o.target.value}),A(()=>n.value=e.content.color),n}}),null),w(t,_(j,{label:"宽度",get children(){var n=re();return n.$$input=o=>e.onUpdate({width:parseFloat(o.target.value)||1}),A(()=>n.value=e.content.width),n}}),null),t}}),kn=e=>_(fe,{title:"数据字段",icon:"🔗",get children(){var t=be();return w(t,_(j,{label:"表达式",get children(){var n=wn();return n.$$input=o=>e.onUpdate({expression:o.target.value}),A(()=>n.value=e.content.expression),n}}),null),w(t,_(j,{label:"格式",get children(){var n=bn();return n.addEventListener("change",o=>e.onUpdate({format:o.target.value==="default"?void 0:o.target.value})),A(()=>n.value=e.content.format||"default"),n}}),null),t}});ge(["input"]);var Cn=E("<svg><defs><pattern id=canvas-grid patternUnits=userSpaceOnUse><line y1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></line><line x1=0 stroke=#cbd5e1 stroke-width=0.5 opacity=0.8></svg>",!1,!0,!1),En=E("<svg><rect fill=url(#canvas-grid)></svg>",!1,!0,!1);const zn=e=>_(Se,{get when(){return e.config.show_grid},get children(){return[(()=>{var t=Cn(),n=t.firstChild,o=n.firstChild,i=o.nextSibling;return A(l=>{var s=e.config.grid_size,r=e.config.grid_size,g=e.config.grid_size,d=e.config.grid_size,c=e.config.grid_size,f=e.config.grid_size,v=e.config.grid_size,m=e.config.grid_size;return s!==l.e&&y(n,"width",l.e=s),r!==l.t&&y(n,"height",l.t=r),g!==l.a&&y(o,"x1",l.a=g),d!==l.o&&y(o,"x2",l.o=d),c!==l.i&&y(o,"y2",l.i=c),f!==l.n&&y(i,"y1",l.n=f),v!==l.s&&y(i,"x2",l.s=v),m!==l.h&&y(i,"y2",l.h=m),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),t})(),(()=>{var t=En();return A(n=>{var o=e.config.width,i=e.config.height;return o!==n.e&&y(t,"width",n.e=o),i!==n.t&&y(t,"height",n.t=i),n},{e:void 0,t:void 0}),t})()]}});var An=E("<svg><text x=0 dominant-baseline=hanging></svg>",!1,!0,!1),Mn=E("<svg><rect x=0 y=0></svg>",!1,!0,!1),Pn=E("<svg><line x1=0></svg>",!1,!0,!1),Ln=E('<svg><image x=0 y=0 preserveAspectRatio="xMidYMid meet"></svg>',!1,!0,!1),Fn=E("<svg><rect x=0 y=0 fill=none stroke=#cccccc stroke-width=1 stroke-dasharray=3,3></svg>",!1,!0,!1),Tn=E("<svg><text text-anchor=middle dominant-baseline=middle font-size=12 fill=#666666>Image</svg>",!1,!0,!1),Dn=E('<svg><rect x=0 y=0 fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.3)"stroke-width=1 stroke-dasharray=2,2></svg>',!1,!0,!1),On=E("<svg><text x=4></svg>",!1,!0,!1),In=E("<svg><g></svg>",!1,!0,!1),Un=E("<svg><rect x=-1 y=-1 fill=none stroke=var(--color-selection) stroke-width=2 stroke-dasharray=none></svg>",!1,!0,!1);const jn=e=>{const{state:t,selectElement:n,updateElement:o,batchUpdatePositions:i,dragOperation:l,setDragOperation:s,toggleSelection:r,addToSelection:g}=ae(),d=X(()=>{const v=l()?.type==="move"&&l()?.element_ids.includes(e.element.id);let m=e.element.position.x,b=e.element.position.y;if(v){const h=l(),a=h?.delta,S=h?.initial_positions?.get(e.element.id);a&&S&&(m=S.x+a.x,b=S.y+a.y)}return{transform:`translate(${m}px, ${b}px)`,opacity:e.element.visible?v?.7:1:.5,cursor:e.element.locked?"not-allowed":e.selected?"move":"pointer"}}),c=v=>{if(e.element.locked||!e.selected)return;v.preventDefault(),v.stopPropagation();const{state:m}=ae(),b=m.selected_ids,h=v.clientX,a=v.clientY,S=e.element.position.x,k=e.element.position.y;console.log("🎯 Starting drag for",b.length>1?"multiple elements":"single element:",e.element.id),console.log("📋 Selected elements:",b);const z=new Map;b.forEach(L=>{const I=m.elements.find(M=>M.id===L);I&&z.set(L,{x:I.position.x,y:I.position.y})}),s({type:"move",element_ids:b.length>0?b:[e.element.id],start_position:{x:S,y:k},current_position:{x:S,y:k},offset:{x:h-S,y:a-k},initial_positions:z});const P=L=>{const I=L.clientX-h,M=L.clientY-a,$=S+I,u=k+M;s(p=>p?{...p,current_position:{x:$,y:u},delta:{x:I,y:M}}:null)},T=async L=>{const I=L.clientX-h,M=L.clientY-a;if(Math.abs(I)>2||Math.abs(M)>2){const $=l(),u=$?.element_ids||[e.element.id],p=$?.initial_positions;console.log("🎯 Finishing drag for",u.length,"element(s)");try{const x=[];for(const C of u){const D=p?.get(C);if(D){const R=Math.max(0,D.x+I),N=Math.max(0,D.y+M);console.log(`📍 Preparing update for ${C} from (${D.x}, ${D.y}) to (${R}, ${N})`),x.push({element_id:C,new_position:{x:R,y:N}})}else{const R=m.elements.find(N=>N.id===C);if(R){const N=Math.max(0,R.position.x+I),W=Math.max(0,R.position.y+M);console.log(`📍 Fallback preparing update for ${C} to position:`,N,W),x.push({element_id:C,new_position:{x:N,y:W}})}}}if(x.length>1)console.log(`🚀 Batch updating ${x.length} elements`),await i(x);else if(x.length===1){const C=x[0];C&&await o(C.element_id,{position:C.new_position})}console.log("✅ All elements updated successfully")}catch(x){console.error("❌ Failed to update element positions:",x)}}s(null),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",T)};document.addEventListener("mousemove",P),document.addEventListener("mouseup",T)},f=()=>{const{content:v,size:m}=e.element;return _(xt,{get children(){return[_(ne,{get when(){return v.type==="Text"&&v},children:b=>(()=>{var h=An();return w(h,()=>b().content),A(a=>{var S=b().style.font_size*.8,k=b().style.font_family,z=`${b().style.font_size}`,P=b().style.font_weight,T=b().style.color,L=b().style.align==="Center"?"middle":b().style.align==="Right"?"end":"start";return S!==a.e&&y(h,"y",a.e=S),k!==a.t&&y(h,"font-family",a.t=k),z!==a.a&&y(h,"font-size",a.a=z),P!==a.o&&y(h,"font-weight",a.o=P),T!==a.i&&y(h,"fill",a.i=T),L!==a.n&&y(h,"text-anchor",a.n=L),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),h})()}),_(ne,{get when(){return v.type==="Rectangle"&&v},children:b=>(()=>{var h=Mn();return A(a=>{var S=m.width,k=m.height,z=b().fill_color||"transparent",P=b().border?.color||"#000000",T=b().border?.width||1,L=b().border?.style==="Dashed"?"5,5":b().border?.style==="Dotted"?"2,2":"none";return S!==a.e&&y(h,"width",a.e=S),k!==a.t&&y(h,"height",a.t=k),z!==a.a&&y(h,"fill",a.a=z),P!==a.o&&y(h,"stroke",a.o=P),T!==a.i&&y(h,"stroke-width",a.i=T),L!==a.n&&y(h,"stroke-dasharray",a.n=L),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),h})()}),_(ne,{get when(){return v.type==="Line"&&v},children:b=>(()=>{var h=Pn();return A(a=>{var S=m.height/2,k=m.width,z=m.height/2,P=b().color,T=b().width;return S!==a.e&&y(h,"y1",a.e=S),k!==a.t&&y(h,"x2",a.t=k),z!==a.a&&y(h,"y2",a.a=z),P!==a.o&&y(h,"stroke",a.o=P),T!==a.i&&y(h,"stroke-width",a.i=T),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),h})()}),_(ne,{get when(){return v.type==="Image"&&v},children:b=>[(()=>{var h=Ln();return A(a=>{var S=m.width,k=m.height,z=b().src;return S!==a.e&&y(h,"width",a.e=S),k!==a.t&&y(h,"height",a.t=k),z!==a.a&&y(h,"href",a.a=z),a},{e:void 0,t:void 0,a:void 0}),h})(),(()=>{var h=Fn();return A(a=>{var S=m.width,k=m.height;return S!==a.e&&y(h,"width",a.e=S),k!==a.t&&y(h,"height",a.t=k),a},{e:void 0,t:void 0}),h})(),(()=>{var h=Tn();return A(a=>{var S=m.width/2,k=m.height/2;return S!==a.e&&y(h,"x",a.e=S),k!==a.t&&y(h,"y",a.t=k),a},{e:void 0,t:void 0}),h})()]}),_(ne,{get when(){return v.type==="DataField"&&v},children:b=>[(()=>{var h=Dn();return A(a=>{var S=m.width,k=m.height;return S!==a.e&&y(h,"width",a.e=S),k!==a.t&&y(h,"height",a.t=k),a},{e:void 0,t:void 0}),h})(),(()=>{var h=On();return w(h,()=>b().expression||"[数据字段]"),A(a=>{var S=b().style.font_size*.8,k=b().style.font_family,z=`${b().style.font_size}`,P=b().style.font_weight,T=b().style.color,L=b().style.align==="Center"?"middle":b().style.align==="Right"?"end":"start";return S!==a.e&&y(h,"y",a.e=S),k!==a.t&&y(h,"font-family",a.t=k),z!==a.a&&y(h,"font-size",a.a=z),P!==a.o&&y(h,"font-weight",a.o=P),T!==a.i&&y(h,"fill",a.i=T),L!==a.n&&y(h,"text-anchor",a.n=L),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),h})()]})]}})};return(()=>{var v=In();return v.$$mousedown=c,v.$$click=async m=>{m.stopPropagation(),console.log("🖱️ Element clicked!",e.element.id,{ctrl:m.ctrlKey,shift:m.shiftKey,selected:e.selected});try{m.ctrlKey?(console.log("🔄 Toggling selection:",e.element.id),await r(e.element.id)):m.shiftKey?(console.log("➕ Adding to selection:",e.element.id),await g(e.element.id)):e.selected||(await n(e.element.id),console.log("✅ Element selected successfully:",e.element.id))}catch(b){console.error("❌ Failed to select element:",b)}},w(v,f,null),w(v,(()=>{var m=se(()=>!!e.selected);return()=>m()&&(()=>{var b=Un();return A(h=>{var a=e.element.size.width+2,S=e.element.size.height+2;return a!==h.e&&y(b,"width",h.e=a),S!==h.t&&y(b,"height",h.t=S),h},{e:void 0,t:void 0}),b})()})(),null),A(m=>{var b=`element ${e.selected?"element-selected":""}`,h=d(),a=e.element.id,S=e.element.content.type;return b!==m.e&&y(v,"class",m.e=b),m.t=Rt(v,h,m.t),a!==m.a&&y(v,"data-element-id",m.a=a),S!==m.o&&y(v,"data-element-type",m.o=S),m},{e:void 0,t:void 0,a:void 0,o:void 0}),v})()};ge(["click","mousedown"]);var Yn=E("<svg><g class=selection-box data-testid=selection-box><rect fill=none stroke=var(--color-selection) stroke-width=2 stroke-dasharray=5,5 opacity=0.8></rect><rect fill=transparent></svg>",!1,!0,!1),Xn=E("<svg><rect width=8 height=8 class=selection-handle></svg>",!1,!0,!1);const Nn=e=>{const{updateElement:t}=ae(),[n,o]=ee(!1),i=X(()=>{if(e.elements.length===0)return{x:0,y:0,width:0,height:0};let r=1/0,g=1/0,d=-1/0,c=-1/0;for(const f of e.elements){const{position:v,size:m}=f;r=Math.min(r,v.x),g=Math.min(g,v.y),d=Math.max(d,v.x+m.width),c=Math.max(c,v.y+m.height)}return{x:r,y:g,width:d-r,height:c-g}}),l=X(()=>{const r=i(),d=8/2;return[{x:r.x-d,y:r.y-d,cursor:"nw-resize"},{x:r.x+r.width/2-d,y:r.y-d,cursor:"n-resize"},{x:r.x+r.width-d,y:r.y-d,cursor:"ne-resize"},{x:r.x+r.width-d,y:r.y+r.height/2-d,cursor:"e-resize"},{x:r.x+r.width-d,y:r.y+r.height-d,cursor:"se-resize"},{x:r.x+r.width/2-d,y:r.y+r.height-d,cursor:"s-resize"},{x:r.x-d,y:r.y+r.height-d,cursor:"sw-resize"},{x:r.x-d,y:r.y+r.height/2-d,cursor:"w-resize"}]}),s=r=>{r.stopPropagation(),o(!0);const g=r.clientX,d=r.clientY,c=e.elements.map(m=>({id:m.id,x:m.position.x,y:m.position.y})),f=m=>{const b=m.clientX-g,h=m.clientY-d;c.forEach(async a=>{try{await t(a.id,{position:{x:a.x+b,y:a.y+h}})}catch(S){console.error("Failed to update element position:",S)}})},v=()=>{o(!1),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",v)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",v)};return(()=>{var r=Yn(),g=r.firstChild,d=g.nextSibling;return w(r,_(ue,{get each(){return l()},children:c=>(()=>{var f=Xn();return f.$$mousedown=v=>{v.stopPropagation(),console.log("Resize handle clicked:",c.cursor)},A(v=>{var m=c.x,b=c.y,h=c.cursor;return m!==v.e&&y(f,"x",v.e=m),b!==v.t&&y(f,"y",v.t=b),h!==v.a&&((v.a=h)!=null?f.style.setProperty("cursor",h):f.style.removeProperty("cursor")),v},{e:void 0,t:void 0,a:void 0}),f})()}),d),d.$$mousedown=s,A(c=>{var f=i().x,v=i().y,m=i().width,b=i().height,h=i().x,a=i().y,S=i().width,k=i().height,z=n()?"grabbing":"grab";return f!==c.e&&y(g,"x",c.e=f),v!==c.t&&y(g,"y",c.t=v),m!==c.a&&y(g,"width",c.a=m),b!==c.o&&y(g,"height",c.o=b),h!==c.i&&y(d,"x",c.i=h),a!==c.n&&y(d,"y",c.n=a),S!==c.s&&y(d,"width",c.s=S),k!==c.h&&y(d,"height",c.h=k),z!==c.r&&((c.r=z)!=null?d.style.setProperty("cursor",z):d.style.removeProperty("cursor")),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),r})()};ge(["mousedown"]);var Rn=E('<div class="flex-1 flex flex-col overflow-hidden"><div class="h-12 bg-primary border-b border-default flex items-center px-4"><div class="text-sm text-secondary">Canvas: <!> × <!>px<span class="ml-4 px-2 py-1 bg-blue-100 rounded text-xs">元素: <!> | 选中: </span></div></div><div class="flex-1 overflow-auto custom-scrollbar bg-tertiary p-4"><div class="flex items-center justify-center min-h-full"><div class="bg-canvas-bg shadow-lg rounded-lg overflow-hidden"><svg class="block cursor-default"><rect></rect><rect fill=none stroke=var(--color-border) stroke-width=1></rect><g class=elements-layer>'),Bn=E("<span class=ml-2>Zoom: <!>%"),Vn=E('<svg><rect fill="rgba(59, 130, 246, 0.1)"stroke="rgba(59, 130, 246, 0.6)"stroke-width=1 stroke-dasharray=5,5 class="selection-rectangle pointer-events-none"></svg>',!1,!0,!1),Hn=E('<svg><rect fill=none stroke="rgba(59, 130, 246, 0.8)"stroke-width=1 stroke-dasharray=3,3 class="selection-preview pointer-events-none"></svg>',!1,!0,!1);const Kn=()=>{const{state:e,getElementsAtPoint:t,selectElement:n,clearSelection:o,createElement:i,dragOperation:l,selectMultiple:s}=ae();let r;const[g,d]=ee({width:800,height:600}),[c,f]=ee(!1),[v,m]=ee(null);console.log("Canvas size:",g());const b=X(()=>e.elements.filter(u=>u.visible)),h=X(()=>{const u=new Set(e.selected_ids),p=e.elements.filter(x=>u.has(x.id));return console.log("📊 Selected elements updated:",p.length,"selected_ids:",e.selected_ids),p}),a=(u,p)=>{if(!r)return{x:0,y:0};const x=r.getBoundingClientRect(),C=(u-x.left)/e.canvas_config.zoom,D=(p-x.top)/e.canvas_config.zoom;return{x:C,y:D}},S=async u=>{if(!r)return;const{x:p,y:x}=a(u.clientX,u.clientY);try{const C=await t(p,x);C.length>0?await n(C[C.length-1]||""):await o()}catch(C){console.error("Failed to handle canvas click:",C)}},k=(u,p)=>{const x={x:u.position.x,y:u.position.y,width:u.size.width,height:u.size.height};return!(x.x>p.x+p.width||x.x+x.width<p.x||x.y>p.y+p.height||x.y+x.height<p.y)},z=()=>{const u=v();if(!u)return[];const p={x:Math.min(u.startX,u.currentX),y:Math.min(u.startY,u.currentY),width:Math.abs(u.currentX-u.startX),height:Math.abs(u.currentY-u.startY)};return e.elements.filter(x=>x.visible&&k(x,p))},P=u=>{if(!r)return;const p=u.target,x=p.tagName==="rect"&&p.getAttribute("width")===e.canvas_config.width.toString();if(console.log("🖱️ Canvas mousedown:",{target:p.tagName,isBackground:x,hasClass:p.className,dragOperation:!!l(),modifiers:{ctrl:u.ctrlKey,shift:u.shiftKey}}),!x||l()||u.ctrlKey||u.shiftKey){console.log("🚫 Skipping selection start");return}u.preventDefault();const{x:C,y:D}=a(u.clientX,u.clientY);f(!0),m({startX:C,startY:D,currentX:C,currentY:D}),console.log("🔲 Starting selection rectangle at:",C,D)},T=u=>{u.preventDefault(),u.dataTransfer.dropEffect="copy"},L=async u=>{u.preventDefault();try{const p=u.dataTransfer?.getData("application/json");if(!p)return;const{type:x,component:C}=JSON.parse(p);if(x==="component"){const{x:D,y:R}=a(u.clientX,u.clientY),N=Math.max(0,D-C.default_size.width/2),W=Math.max(0,R-C.default_size.height/2);console.log("🎯 Dropping component:",C.name,"at",N,W);const G=await i(C.id,{x:N,y:W},C.default_size,C.create_content());console.log("✅ Element created via drag & drop:",G),await n(G)}}catch(p){console.error("Failed to handle drop:",p)}},I=u=>{if(!c()||l())return;const{x:p,y:x}=a(u.clientX,u.clientY);m(C=>C?{...C,currentX:p,currentY:x}:null)},M=async()=>{if(l()){f(!1),m(null);return}if(!c())return;f(!1);const u=z();console.log("🔲 Selection finished, found elements:",u.length);try{if(u.length>0){const p=u.map(x=>x.id);await s(p),console.log("✅ Multi-select completed:",p)}else await o(),console.log("🔲 No elements in selection, cleared selection")}catch(p){console.error("❌ Failed to update selection:",p)}m(null)};et(()=>{const u=()=>{if(r?.parentElement){const p=r.parentElement.getBoundingClientRect();d({width:p.width,height:p.height})}};return u(),window.addEventListener("resize",u),document.addEventListener("mousemove",I),document.addEventListener("mouseup",M),()=>{window.removeEventListener("resize",u),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",M)}});const $=X(()=>{const{width:u,height:p}=e.canvas_config;return`0 0 ${u} ${p}`});return(()=>{var u=Rn(),p=u.firstChild,x=p.firstChild,C=x.firstChild,D=C.nextSibling,R=D.nextSibling,N=R.nextSibling,W=N.nextSibling,G=W.nextSibling,V=G.firstChild,q=V.nextSibling;q.nextSibling;var Ae=p.nextSibling,_e=Ae.firstChild,Ve=_e.firstChild,B=Ve.firstChild,oe=B.firstChild,ve=oe.nextSibling,Me=ve.nextSibling;w(x,()=>e.canvas_config.width,D),w(x,()=>e.canvas_config.height,N),w(x,(()=>{var F=se(()=>e.canvas_config.zoom!==1);return()=>F()&&(()=>{var K=Bn(),me=K.firstChild,de=me.nextSibling;return de.nextSibling,w(K,()=>Math.round(e.canvas_config.zoom*100),de),K})()})(),G),w(G,()=>e.elements.length,q),w(G,()=>e.selected_ids.length,null),B.$$mousedown=P,B.addEventListener("drop",L),B.addEventListener("dragover",T),B.$$contextmenu=F=>F.preventDefault(),B.$$click=S;var Pe=r;return typeof Pe=="function"?Bt(Pe,B):r=B,w(B,_(zn,{get config(){return e.canvas_config}}),ve),w(Me,_(ue,{get each(){return b()},children:F=>_(jn,{element:F,get selected(){return e.selected_ids.includes(F.id)}})})),w(B,(()=>{var F=se(()=>h().length>0);return()=>F()&&_(Nn,{get elements(){return h()}})})(),null),w(B,(()=>{var F=se(()=>!!(c()&&v()));return()=>F()&&(()=>{const K=v(),me=Math.min(K.startX,K.currentX),de=Math.min(K.startY,K.currentY),Le=Math.abs(K.currentX-K.startX),Fe=Math.abs(K.currentY-K.startY);return[(()=>{var Z=Vn();return y(Z,"x",me),y(Z,"y",de),y(Z,"width",Le),y(Z,"height",Fe),Z})(),se(()=>z().map(Z=>(()=>{var ie=Hn();return A(J=>{var nt=Z.position.x-1,lt=Z.position.y-1,ot=Z.size.width+2,it=Z.size.height+2;return nt!==J.e&&y(ie,"x",J.e=nt),lt!==J.t&&y(ie,"y",J.t=lt),ot!==J.a&&y(ie,"width",J.a=ot),it!==J.o&&y(ie,"height",J.o=it),J},{e:void 0,t:void 0,a:void 0,o:void 0}),ie})()))]})()})(),null),A(F=>{var K=e.canvas_config.width*e.canvas_config.zoom,me=e.canvas_config.height*e.canvas_config.zoom,de=$(),Le=e.canvas_config.width,Fe=e.canvas_config.height,Z=e.canvas_config.background_color,ie=e.canvas_config.width,J=e.canvas_config.height;return K!==F.e&&y(B,"width",F.e=K),me!==F.t&&y(B,"height",F.t=me),de!==F.a&&y(B,"viewBox",F.a=de),Le!==F.o&&y(oe,"width",F.o=Le),Fe!==F.i&&y(oe,"height",F.i=Fe),Z!==F.n&&y(oe,"fill",F.n=Z),ie!==F.s&&y(ve,"width",F.s=ie),J!==F.h&&y(ve,"height",F.h=J),F},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),u})()};ge(["click","contextmenu","mousedown"]);var qn=E('<button class="fixed top-20 right-4 z-50 bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg shadow-lg text-sm font-medium"title=开启/关闭测试面板>🧪 测试'),Gn=E('<div class="fixed top-16 right-4 z-40 bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-800">🧪 测试面板</h3><button class="text-gray-500 hover:text-gray-700">✕</button></div><div class="mb-4 p-3 bg-gray-50 rounded-lg"><div class="text-sm text-gray-600"><div>元素总数: <span class=font-medium></span></div><div>已选择: <span class=font-medium></span></div><div>可撤销: <span class=font-medium></span></div><div>可重做: <span class=font-medium></span></div></div></div><div class="space-y-2 mb-4"><button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm">🚀 运行所有测试</button><button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded text-sm">🧹 清理元素</button></div><div class=space-y-2><h4 class="text-sm font-medium text-gray-700 mb-2">单独测试:</h4></div><div class=mt-4><h4 class="text-sm font-medium text-gray-700 mb-2">当前元素:</h4><div class="max-h-32 overflow-y-auto">'),Zn=E('<button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded text-sm text-left">'),Wn=E('<div><div class=font-medium></div><div class="text-gray-500 truncate">ID: <!>...</div><div class=text-gray-500>位置: (<!>, <!>)'),Jn=E('<div class="text-xs text-gray-500 p-2">暂无元素');const Qn=()=>{const{state:e,createElement:t,selectElement:n,clearSelection:o}=ae(),[i,l]=ee(!1),s=[{name:"创建文字元素",action:async()=>{const c=await t("text",{x:100,y:100},{width:100,height:24},{type:"Text",content:"测试文字",style:{font_family:"SimSun",font_size:14,font_weight:"normal",color:"#000000",align:"Left"}});return console.log("✅ 测试文字元素创建成功:",c),c}},{name:"创建矩形元素",action:async()=>{const c=await t("rectangle",{x:250,y:100},{width:100,height:60},{type:"Rectangle",fill_color:"rgba(59, 130, 246, 0.2)",border:{color:"#3b82f6",width:2,style:"Solid"}});return console.log("✅ 测试矩形元素创建成功:",c),c}},{name:"创建线条元素",action:async()=>{const c=await t("line",{x:400,y:130},{width:150,height:2},{type:"Line",color:"#ef4444",width:3});return console.log("✅ 测试线条元素创建成功:",c),c}},{name:"创建数据字段",action:async()=>{const c=await t("data_field",{x:100,y:200},{width:120,height:24},{type:"DataField",expression:"${测试数据}",format:void 0,style:{font_family:"SimSun",font_size:12,font_weight:"bold",color:"#059669",align:"Left"}});return console.log("✅ 测试数据字段创建成功:",c),c}}],r=async c=>{try{console.log(`🧪 开始测试: ${c.name}`);const f=await c.action();await n(f),console.log(`✅ 测试完成: ${c.name}, 元素ID: ${f}`)}catch(f){console.error(`❌ 测试失败: ${c.name}`,f)}},g=async()=>{console.log("🚀 开始运行所有测试案例..."),await o();for(const c of s)await r(c),await new Promise(f=>setTimeout(f,500));console.log("🎉 所有测试案例运行完成!")},d=async()=>{try{console.log("🧹 清理所有测试元素..."),await o(),console.log("✅ 清理完成")}catch(c){console.error("❌ 清理失败:",c)}};return[(()=>{var c=qn();return c.$$click=()=>l(!i()),c})(),se(()=>se(()=>!!i())()&&(()=>{var c=Gn(),f=c.firstChild,v=f.firstChild,m=v.nextSibling,b=f.nextSibling,h=b.firstChild,a=h.firstChild,S=a.firstChild,k=S.nextSibling,z=a.nextSibling,P=z.firstChild,T=P.nextSibling,L=z.nextSibling,I=L.firstChild,M=I.nextSibling,$=L.nextSibling,u=$.firstChild,p=u.nextSibling,x=b.nextSibling,C=x.firstChild,D=C.nextSibling,R=x.nextSibling;R.firstChild;var N=R.nextSibling,W=N.firstChild,G=W.nextSibling;return m.$$click=()=>l(!1),w(k,()=>e.elements.length),w(T,()=>e.selected_ids.length),w(M,()=>e.can_undo?"是":"否"),w(p,()=>e.can_redo?"是":"否"),C.$$click=g,D.$$click=d,w(R,_(ue,{each:s,children:V=>(()=>{var q=Zn();return q.$$click=()=>r(V),w(q,()=>V.name),q})()}),null),w(G,_(ue,{get each(){return e.elements},children:V=>(()=>{var q=Wn(),Ae=q.firstChild,_e=Ae.nextSibling,Ve=_e.firstChild,B=Ve.nextSibling;B.nextSibling;var oe=_e.nextSibling,ve=oe.firstChild,Me=ve.nextSibling,Pe=Me.nextSibling,F=Pe.nextSibling;return F.nextSibling,q.$$click=()=>n(V.id),w(Ae,()=>V.content.type),w(_e,()=>V.id.slice(0,8),B),w(oe,()=>Math.round(V.position.x),Me),w(oe,()=>Math.round(V.position.y),F),A(()=>$e(q,`text-xs p-2 mb-1 rounded cursor-pointer ${e.selected_ids.includes(V.id)?"bg-blue-100 border border-blue-300":"bg-gray-50 hover:bg-gray-100"}`)),q})()}),null),w(G,(()=>{var V=se(()=>e.elements.length===0);return()=>V()&&Jn()})(),null),c})())]};ge(["click"]);var el=E('<div class="h-full flex flex-col bg-secondary"><div class="flex-1 flex overflow-hidden"><div class="w-80 bg-primary border-r border-default flex flex-col"></div><div class="flex-1 flex flex-col bg-tertiary"></div><div class="w-80 bg-primary border-l border-default flex flex-col">');const tl=()=>(()=>{var e=el(),t=e.firstChild,n=t.firstChild,o=n.nextSibling,i=o.nextSibling;return w(e,_(ln,{}),t),w(n,_(sn,{})),w(o,_(Kn,{})),w(i,_(xn,{})),w(e,_(Qn,{}),null),e})(),nl=()=>(et(()=>{document.addEventListener("contextmenu",e=>e.preventDefault())}),_(Jt,{get children(){return _(tl,{})}})),ll=document.getElementById("root");Nt(()=>_(nl,{}),ll);
